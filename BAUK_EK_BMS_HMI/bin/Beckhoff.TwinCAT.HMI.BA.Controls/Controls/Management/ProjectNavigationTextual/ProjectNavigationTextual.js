var TcHmi,__awaiter=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(n,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(t){!function(s){!function(i){class n extends s.System.BaseControl{constructor(s,i,n){super(s,i,n),this.__loadBaChildren=!0,this.__loadTexts=!0,this.__baUsedTitle=null,this.__showHeader=null,this.__showValue=null,this.__showEvents=null,this.__showObjectType=null,this.__useNestedList=null,this.__contentWindow=new t.Components.ContentWindow(this.__id+"-content-window",this),this.__backButton=new t.Components.Button(this.__id+"-back-button",this),this.__searchField=new t.Components.InputBox(this.__id+"-search-field",this),this.__contextMenu=this.__contentWindow.addMenu(),this.__listContainer=this.__contentWindow.getContentContainer().addClass("list-container"),this.__navHistory=[],this.__entrySelectedHandler=(e,t,s)=>{this.__onObjectSelected(s)},this.__cbUsedTitleChangedHandler=e=>{this.setBaUsedTitle(e),this.__contextMenu.close()},this.__toggleButtonPressedHandler=(e,t,s)=>{var i,n,o;switch(t){case"Nested list":this.setUseNestedList(e);break;case"Show object types":null===(i=this.__rootView)||void 0===i||i.setShowObjectType(e);break;case"Show value":null===(n=this.__rootView)||void 0===n||n.setShowValue(e);break;case"Show events":null===(o=this.__rootView)||void 0===o||o.setShowEvents(e)}},this.__searchFieldFocusOutHandler=()=>{let e=this.__searchField.getValue();null!=e&&e.length<=0&&this.__searchField.backgroundStyler.setImage(t.Icons.Standard.Lens.path,!0)},this.__contentViewButtonPressedHandler=(s,i,n)=>__awaiter(this,void 0,void 0,(function*(){let s=n.baObjectHandler.baObject;if(null==s)return;let i=yield s.getContent();if(null!=i){let s=e.Controls.get(t.Globals.HostRegionName);if(null==s)return void this.logger.log(t.Logger.Severity.warn,`Global host region '${t.Globals.HostRegionName}' was not found!\nMake sure the the content region on your Desktop.view has the name ${t.Globals.HostRegionName}'.`);s.setTargetContent(i)}else null==this.__dialog&&(this.__dialog=new t.Components.DialogWindow(this.__id+"-dialog",this),this.__dialog.setButtons(t.Components.DialogWindow.Buttons.OkCancelSize).layoutHandler.setWidth(1e3)),s.tryReadBaVariable(t.BA.BaParameterId.eDescription).then(e=>{var t;return null===(t=this.__dialog)||void 0===t?void 0:t.setHeadlineText(e)}),t.BA.Helper.getSpecialVisu(s,this,this.__dialog,!0),this.__dialog.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosed,e=>{var t;e.destroy(),null===(t=this.__dialog)||void 0===t||t.destroy(),delete this.__dialog}),this.__dialog.open(!1)}))}__previnit(){super.__previnit(),this.baObjectHandler=new t.BaObjectHandler(this),this.__element.append(this.__contentWindow.getElement()),this.__contentWindow.setHeadlineText("View name"),this.__backButton.getElement().addClass("back-button"),this.__backButton.backgroundStyler.setImage(t.Icons.Standard.Left.path,!0).setImageHeight(80,"%").setImageWidth(80,"%"),this.__searchField.textHandler.setHorizontalAlignment("Left"),this.__searchField.backgroundStyler.setImage(t.Icons.Standard.Lens.path,!0),this.__searchField.setReadOnly(!1),this.__contentWindow.getHeader().append(this.__searchField.getElement()),this.__contextMenu.addRowEntry({controlsHorizontalAlignment:"Right",controls:[{type:t.Components.ComponentType.Combobox,callback:this.__cbUsedTitleChangedHandler,settings:{data:[{text:"InstDescription",value:t.BA.BaParameterId.eInstDescription},{text:"Description",value:t.BA.BaParameterId.eDescription},{text:"SymbolPath",value:t.BA.BaParameterId.eSymbolPath},{text:"ObjectName",value:t.BA.BaParameterId.eObjectName},{text:"InstObjectName",value:t.BA.BaParameterId.eInstObjectName}],layout:{maxWidth:130},readOnly:!1}},{type:t.Components.ComponentType.Button,callback:()=>{null!=this.baObjectHandler.baObject&&t.Charting.Trend.CollectionConfigurator.open({baView:this.baObjectHandler.baObject.Device.ProjectStructure})},settings:{layout:{maxWidth:120}},cbOnCreated:e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.NewTrendCollection,s=>{t.Logger.checkServerResult(t.Logger.Severity.warn,s)&&e.textHandler.setText(s.text)}))}},{type:t.Components.ComponentType.Button,callback:()=>{t.Charting.Trend.CollectionView.open()},settings:{layout:{maxWidth:120}},cbOnCreated:e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.TrendCollections,s=>{t.Logger.checkServerResult(t.Logger.Severity.warn,s)&&e.textHandler.setText(s.text)}))}}]})}__init(){super.__init()}__attach(){super.__attach(),this.__destroyersToCallOnDetach.push(this.__searchField.eventHandler.register(t.Components.InputBox.InputBoxEvents.onFocusOut,this.__searchFieldFocusOutHandler)),this.__destroyersToCallOnDetach.push(this.__searchField.eventHandler.register(t.Components.InputBox.InputBoxEvents.onFocusIn,()=>{let e=this.__searchField.getValue();(null==e||e.length<=0)&&this.__searchField.backgroundStyler.setImage(null)})),this.__destroyersToCallOnDetach.push(this.__searchField.eventHandler.register(t.Components.InputBox.InputBoxEvents.onUserInteractionFinished,()=>{let e=this.__searchField.getValue();null!=e&&e.length<=0&&this.__searchField.backgroundStyler.setImage(t.Icons.Standard.Lens.path,!0),this.__onFilterList()}))}__detach(){super.__detach()}destroy(){var e,t;this.__keepAlive||(null!=this.__destroyOnEntryOpened&&(this.__destroyOnEntryOpened(),delete this.__destroyOnEntryOpened),null!=this.__destroyOnEntryClosed&&(this.__destroyOnEntryClosed(),delete this.__destroyOnEntryClosed),null!=this.__destroyOnEntryContentViewButtonPressed&&(this.__destroyOnEntryContentViewButtonPressed(),delete this.__destroyOnEntryContentViewButtonPressed),null===(e=this.__rootView)||void 0===e||e.destroy(),this.__contentWindow.destroy(),this.__backButton.destroy(),this.__searchField.destroy(),this.__contextMenu.destroy(),null===(t=this.__comboboxUsedTitle)||void 0===t||t.destroy(),super.destroy())}__onObjectSelected(e){if(this.busyHandler.getIsBusy()||void 0===this.__currentView)return;let s=e.baObjectHandler.baObject,i=this.__currentView.baObjectHandler.baObject;if(null!=s&&null!=i&&s instanceof t.BA.BaView&&s.Children.size>0){if(this.__useNestedList&&i.InstancePath===s.InstancePath)return void this.__onNavigateBackward();i.InstancePath!==s.InstancePath&&(this.__navHistory.push(this.__currentView),this.__navHistory.length>0&&!this.__useNestedList&&null==this.__contentWindow.getHeader().find(".back-button")[0]&&(this.__contentWindow.getHeader().append(this.__backButton.getElement()),this.__destroyersToCallOnDestroy.push(this.__backButton.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,()=>this.__onNavigateBackward()))),this.__updateCurrentView(e.getSublist())),this.__editEntries(e.getSublist())}}__onNavigateBackward(){if(!this.busyHandler.getIsBusy()&&this.__navHistory.length>0){let e=this.__navHistory[this.__navHistory.length-1];this.__navHistory.pop(),this.__navHistory.length<1&&!this.__useNestedList&&this.__backButton.getElement().detach(),this.__useNestedList?this.__currentView=e:(e.closeAllEntries(),this.__updateCurrentView(e))}}__onFilterList(){var e;if(null==this.baObjectHandler.baObject)return;let s=null===(e=this.__searchField.getValue())||void 0===e?void 0:e.toString().toUpperCase();if(null==s||null==this.__baUsedTitle)return;if(this.__useNestedList&&this.__rootView&&null==this.__rootView.getCurrentFilter()&&s.length<=0)return;if(!this.__useNestedList&&this.__currentView&&null==this.__currentView.getCurrentFilter()&&s.length<=0)return;let i=this.busyHandler.setBusy("Loading attributes and children");this.baObjectHandler.baObject.loadAttributes(!0,!0).then(()=>{var e,t;null!=s&&null!=this.__baUsedTitle&&(this.__useNestedList?null===(e=this.__rootView)||void 0===e||e.filterChildren(s):null===(t=this.__currentView)||void 0===t||t.filterChildren(s)),i()}).catch(e=>__awaiter(this,void 0,void 0,(function*(){yield t.Components.DialogWindow.alert(this.logger.log(t.Logger.Severity.warn,"Loading attributes to filter list failed!",e)),this.__searchField.setValue(null),this.__searchFieldFocusOutHandler(),i()})))}__updateCurrentView(s){if(void 0===s||tchmi_equal(this.__currentView,s))return;let i=this.__listContainer.children(".parameter-list");if(this.__useNestedList)void 0===i[0]&&this.__listContainer.append(s.getElement()),s.getId()!==this.__id+"-rootView"&&s.getElement().addClass("sublist"),null==this.__currentView&&(this.__currentView=this.__rootView);else{i[0]&&i.detach(),null!=this.__destroyOnEntryOpened&&(this.__destroyOnEntryOpened(),delete this.__destroyOnEntryOpened),null!=this.__destroyOnEntryClosed&&(this.__destroyOnEntryClosed(),delete this.__destroyOnEntryClosed),null!=this.__destroyOnEntryContentViewButtonPressed&&(this.__destroyOnEntryContentViewButtonPressed(),delete this.__destroyOnEntryContentViewButtonPressed),this.__destroyOnEntryOpened=s.eventHandler.register(t.Navigation.BaseList.BaseListEvents.onEntryOpened,this.__entrySelectedHandler),this.__destroyOnEntryClosed=s.eventHandler.register(t.Navigation.BaseList.BaseListEvents.onEntryClosed,this.__entrySelectedHandler),this.__destroyOnEntryContentViewButtonPressed=s.eventHandler.register(t.Navigation.ProjectNavigationList.ProjectNavigationListEvents.onEntryContentViewButtonPressed,this.__contentViewButtonPressedHandler),s.getElement().removeClass("tchmi-ba-display-none sublist"),this.__listContainer.append(s.getElement()),this.__onFilterList(),this.__mostDisplayedEvents=s.getMostDisplayedEvents(),s.setMostEvents(this.__mostDisplayedEvents);let n=s.baObjectHandler.baObject;null!=n&&(n.tryReadBaVariable(t.BA.BaParameterId.eDescription).then(e=>this.__contentWindow.setHeadlineText(e)),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineText"})),this.__currentView=s}}__editEntries(e){return __awaiter(this,void 0,void 0,(function*(){null!=e&&e.baObjectHandler.isLoadingBaObject().then(()=>{let s=e.getEntries();null==this.__loadingCnt&&(this.__loadingCnt=0);for(let e of s.values())this.__loadingCnt++,e.baObjectHandler.isLoadingBaObject().then(()=>__awaiter(this,void 0,void 0,(function*(){var s;let i=e.baObjectHandler.baObject;null==i?this.logger.log(t.Logger.Severity.error,"BaObject is NULL!"):t.BA.Helper.hasSpecialVisu(i)||null!=(yield i.getContent())?e.addContentViewButton():e.removeContentViewButton(),null!=this.__loadingCnt&&(this.__loadingCnt--,0===this.__loadingCnt&&(null===(s=this.__rootView)||void 0===s||s.setContentViewButtonOffset(this.__rootView.hasEntryWithContentView()),delete this.__loadingCnt))})))})}))}processBaObject(){var s,i;if(null!=this.baObjectHandler.baObject){if(this.baObjectHandler.baObject.IsTop){let i=t.Locale.Localization.getText(t.Locale.LangKey.ProjectStructure);this.__contentWindow.setHeadlineText(i+" "+(null===(s=this.baObjectHandler.baObject)||void 0===s?void 0:s.Device.Description)),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineText"})}else this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eInstDescription,t=>{this.__contentWindow.setHeadlineText(t),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineText"})});null==this.__navigationProvider?(this.__navigationProvider=t.Navigation.createOrGetNavigationProvider(this.baObjectHandler.baObject),this.__rootView=this.__navigationProvider.createProjectNavigationListNavigation(this.__id+"-rootView",this,{valueHandler:{autoWrite:!0}})):this.__navigationProvider.setData(this.baObjectHandler.baObject),null!=this.__rootView&&(this.__rootView.setUseNestedList(this.__useNestedList).setShowValue(this.__showValue).setBaUsedTitle(this.__baUsedTitle),null!=this.__useNestedList&&!1===this.__useNestedList?this.__rootView.setSlideDuration(0):this.__rootView.setSlideDuration(200),this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eStructurize||this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eAggregate?this.__updateCurrentView(this.__rootView):this.__listContainer.append(this.__rootView.getElement()),this.__editEntries(this.__rootView),this.__destroyOnEntryOpened=this.__rootView.eventHandler.register(t.Navigation.BaseList.BaseListEvents.onEntryOpened,this.__entrySelectedHandler),this.__destroyOnEntryClosed=this.__rootView.eventHandler.register(t.Navigation.BaseList.BaseListEvents.onEntryClosed,this.__entrySelectedHandler),this.__destroyOnEntryContentViewButtonPressed=this.__rootView.eventHandler.register(t.Navigation.ProjectNavigationList.ProjectNavigationListEvents.onEntryContentViewButtonPressed,this.__contentViewButtonPressedHandler)),this.busyHandler.checkForBusyChildren()}else this.__contentWindow.setHeadlineText("null"),null===(i=this.__navigationProvider)||void 0===i||i.setData(null)}getBackButton(){return this.__backButton}closeAllEntries(){var e;null===(e=this.__currentView)||void 0===e||e.closeAllEntries()}getCurrentView(){return this.__currentView}setBaObject(e){return this.baObjectHandler.setBaObject(e),this}getBaObject(){return this.baObjectHandler.baObject}setBaUsedTitle(s){if(null==s&&(s=this.getAttributeDefaultValueInternal("BaUsedTitle")),void 0===s)return this;if("string"==typeof s)switch(s){case"Description":s=t.BA.BaParameterId.eDescription;break;case"SymbolPath":s=t.BA.BaParameterId.eSymbolPath;break;case"ObjectName":s=t.BA.BaParameterId.eObjectName;break;case"InstObjectName":s=t.BA.BaParameterId.eInstObjectName;break;default:s=t.BA.BaParameterId.eInstDescription}return s===this.__baUsedTitle||(this.__baUsedTitle=s,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"BaUsedTitle"}),this.__processBaUsedTitle()),this}__processBaUsedTitle(){var e,t;null===(e=this.__rootView)||void 0===e||e.setBaUsedTitle(this.__baUsedTitle),null===(t=this.__comboboxUsedTitle)||void 0===t||t.setSelectedValue(this.__baUsedTitle)}getBaUsedTitle(){return this.__baUsedTitle}setShowHeader(t){let s=e.ValueConverter.toBoolean(t);return null==s&&(s=this.getAttributeDefaultValueInternal("ShowHeader")),s===this.__showHeader||(this.__showHeader=s,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowHeader"}),this.__processShowHeader()),this}__processShowHeader(){this.__contentWindow.setShowHeader(this.__showHeader)}getShowHeader(){return this.__showHeader}setShowValue(t){let s=e.ValueConverter.toBoolean(t);return null==s&&(s=this.getAttributeDefaultValueInternal("ShowValue")),s===this.__showValue||(this.__showValue=s,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowValue"}),this.__processShowValue()),this}__processShowValue(){var e,t;null===(e=this.__rootView)||void 0===e||e.setShowValue(this.__showValue),null===(t=this.__toggleButtonShowValue)||void 0===t||t.setToggleState(this.__showValue)}getShowValue(){return this.__showValue}setShowEvents(t){let s=e.ValueConverter.toBoolean(t);return null==s&&(s=this.getAttributeDefaultValueInternal("ShowEvents")),s===this.__showEvents||(this.__showEvents=s,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowEvents"}),this.__processShowEvents()),this}__processShowEvents(){var e,t;null===(e=this.__rootView)||void 0===e||e.setShowEvents(this.__showEvents),null===(t=this.__toggleButtonShowEvents)||void 0===t||t.setToggleState(this.__showEvents)}getShowEvents(){return this.__showEvents}setShowObjectType(t){let s=e.ValueConverter.toBoolean(t);return null==s&&(s=this.getAttributeDefaultValueInternal("ShowObjectType")),s===this.__showObjectType||(this.__showObjectType=s,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowObjectType"}),this.__processShowObjectType()),this}__processShowObjectType(){var e,t;null===(e=this.__rootView)||void 0===e||e.setShowObjectType(this.__showObjectType),null===(t=this.__toggleButtonShowObjectTypeButton)||void 0===t||t.setToggleState(this.__showObjectType)}getShowObjectType(){return this.__showObjectType}setUseNestedList(t){let s=e.ValueConverter.toBoolean(t);return null==s&&(s=this.getAttributeDefaultValueInternal("UseNestedList")),s===this.__useNestedList||(this.__useNestedList=s,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"UseNestedList"}),this.__processUseNestedList()),this}__processUseNestedList(){var s,i;if(null===(s=this.__toggleButtonNestedList)||void 0===s||s.setToggleState(this.__useNestedList),!TCHMI_DESIGNER){if(void 0!==this.__rootView){let s=this.__rootView.baObjectHandler.baObject;null!=s&&(s.Purpose!==t.BA.ObjectPurpose.eStructurize&&s.Purpose!==t.BA.ObjectPurpose.eAggregate||(this.__navHistory=[],null===(i=this.__currentView)||void 0===i||i.getElement().detach(),this.__currentView=void 0,this.__rootView.setUseNestedList(this.__useNestedList),this.__rootView.getElement().removeClass("sublist tchmi-ba-display-none"),this.__rootView.closeAllEntries(),s.tryReadBaVariable(t.BA.BaParameterId.eDescription).then(e=>this.__contentWindow.setHeadlineText(e)),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeadlineText"}),this.__updateCurrentView(this.__rootView),this.__destroyOnEntryOpened=this.__rootView.eventHandler.register(t.Navigation.BaseList.BaseListEvents.onEntryOpened,this.__entrySelectedHandler),this.__destroyOnEntryClosed=this.__rootView.eventHandler.register(t.Navigation.BaseList.BaseListEvents.onEntryClosed,this.__entrySelectedHandler),this.__destroyOnEntryContentViewButtonPressed=this.__rootView.eventHandler.register(t.Navigation.ProjectNavigationList.ProjectNavigationListEvents.onEntryContentViewButtonPressed,this.__contentViewButtonPressedHandler)))}!0===this.__useNestedList&&this.__backButton.getElement().detach()}}getUseNestedList(){return this.__useNestedList}getHeadlineText(){return this.__contentWindow.getHeadlineText()}}i.ProjectNavigationTextual=n}(s.Management||(s.Management={}))}(t.Controls||(t.Controls={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("ProjectNavigationTextual","TcHmi.BuildingAutomation.Controls.Management",TcHmi.BuildingAutomation.Controls.Management.ProjectNavigationTextual);
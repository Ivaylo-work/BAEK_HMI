var TcHmi;!function(t){!function(e){!function(o){!function(i){!function(n){class s extends n.ControlUnit{constructor(t,e,o){super(t,e,o),this.__useCurrentPosition=!1}__init(t){super.__init(t),this.__positionFeedbackReady=[],this.baTemplateHandler.defaultBaTemplateDescription=i.Window.BaTemplateDescription,this.baInterfaceHandler.baInterfaceDefinition=i.Window.BaInterfaceDef,this.setBaInterfaceSymbolNames(i.Window.BaInterfaceSymbolNames)}__attach(){this.__isAttached||(this.__destroyersToCallOnDetach.push(t.EventProvider.register(o.BuildingGeneral.BuildingInformation.BuildingInformantionEvents.onBuildingInformationChanged,()=>this.__onBuildingInformationChanged())),this.__onBuildingInformationChanged(),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){var t;null===(t=this.__windowIcon)||void 0===t||t.destroy(),i.Sunblind.destroyBuildingInformationAlarms(this),super.destroy()}__onBuildingInformationChanged(){var t,o,n,s,a;null===(t=this.__sideControlContainer)||void 0===t||t.children(".alarm-container").detach();let r=i.Sunblind.handleBuildingInformation(this,this.__attrHandler.facadeName,null===(o=this.__sideControlContainer)||void 0===o?void 0:o.children(".alarm-container"));r?(null===(n=this.__sideControlContainer)||void 0===n||n.append(r),null===(s=this.__windowIcon)||void 0===s||s.backgroundStyler.setImageColor(e.Color.RGBAColor.Red)):null===(a=this.__windowIcon)||void 0===a||a.backgroundStyler.setImageColor(null)}createElement(){var t,o,n;super.createElement(),this.__windowIcon||(this.__windowIcon=new i.Window.Icon(this.__id+"-window",this,this.__attrHandler),this.__windowIcon.setReadOnly(!0).getElement().addClass("icon"),null===(t=this.__iconContainer)||void 0===t||t.append(this.__windowIcon.getElement())),(null===(o=this.__controlContainer)||void 0===o?void 0:o.getControl(s.__positionDisplayName))||null===(n=this.__controlContainer)||void 0===n||n.addControl({type:e.Components.ComponentType.Textblock,name:s.__positionDisplayName,settings:{order:2}})}getSideControl(){return this.__sideControlContainer=super.getSideControl(),this.__sideControlContainer.addClass("window"),"boolean"==typeof this.__attrHandler.position&&this.__sideControlContainer.addClass("boolean-position"),this.__sideControl&&(this.__sideControl.getElement(),this.__updateSideControl()),this.__sideControlContainer}writePosition(t){this.__processChangedPosition(t)}__processChangedPosition(o){if(1!=this.busyHandler.getIsBusy()&&void 0!==o&&(this.__useCurrentPosition=!0,this.setPosition(o),this.baObjectHandler.baObject&&this.baObjectHandler.baObject.checkTemplate(i.Window.BaTemplateDefinition,this.baTemplateHandler.baBaTemplateDescription)&&i.Window.writePositionToPlc(o,this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&i.Window.writePositionToPlc(o,this.baInterfaceHandler),this.__attrHandler.positionMapping&&t.Server.writeSymbol(this.__attrHandler.positionMapping,o,t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t)}),null!=this.__attrHandler.positionFeedback&&o!=this.__attrHandler.positionFeedback)){let t=()=>{this.__positionFeedbackReady.forEach(t=>t()),this.__positionFeedbackReady=[],this.setPosition(this.__attrHandler.positionFeedback)};this.__sideControlContainer&&0==this.busyHandler.getIsBusy()&&i.showBusyIndicator&&e.BusyHandler.appendBusyIndicator(this.__sideControlContainer);let o=this.logger.logPerformance(e.Logger.Severity.debug,"Brightness feedback response."),n=()=>{o(),this.__sideControlContainer&&e.BusyHandler.detachBusyIndicator(this.__sideControlContainer)};this.__positionFeedbackReady.push(this.busyHandler.setBusy("Waiting for PositionFeedback",{cbOnTimeout:t,cbOnReady:n,showIndicator:i.showBusyIndicator}))}}__updateElements(){var t,o;if(null==this.__attrHandler.position)return;let n=this.__attrHandler.position;if(null!=this.__attrHandler.positionFeedback&&0==this.__useCurrentPosition&&(n=this.__attrHandler.positionFeedback),this.__useCurrentPosition=!1,this.__elementCreated&&(null===(t=this.__windowIcon)||void 0===t||t.setPosition(n),i.Window.Icon.getPositionText(n,this.__attrHandler.closePosition,this.__attrHandler.openPosition,t=>{var e,o;null===(o=null===(e=this.__controlContainer)||void 0===e?void 0:e.getControl(s.__positionDisplayName))||void 0===o||o.textHandler.setText(t)})),this.__sideControl){let t=this.__sideControl.getControl(s.__positionCtrlName);"number"==typeof n?(t instanceof e.Components.Slider||(this.__sideControl.removeControl(s.__positionCtrlName),this.__updateSideControl(),t=this.__sideControl.getControl(s.__positionCtrlName)),null==t||t.setValue(this.__attrHandler.position),null!=this.__attrHandler.positionFeedback&&(null==t||t.setValueFeedback(this.__attrHandler.positionFeedback)),null===(o=this.__sideControl.getControl(s.__positionSwitchName))||void 0===o||o.setState(n>this.__attrHandler.closePosition)):"boolean"==typeof n&&(t instanceof e.Components.Checkbox||(this.__sideControl.removeControl(s.__positionCtrlName),this.__updateSideControl(),t=this.__sideControl.getControl(s.__positionCtrlName)),null==t||t.setState(n))}this.__processOperationState()}__updateSideControl(){if(this.__sideControl&&(this.__onBuildingInformationChanged(),this.__attrHandler)){let o=this.__sideControl.getControl(s.__positionCtrlName);if(!o){switch(typeof this.__attrHandler.position){case"number":if(1==i.Window.ShowQuickLinks){let o=e.Components.ContextMenu.createContextMenuAndButton({id:this.__id+"-context-menu",parent:this,rowEntryOptions:[{controls:[{type:e.Components.ComponentType.Button,callback:()=>{this.__processChangedPosition((this.__attrHandler.openPosition-this.__attrHandler.closePosition)/4+this.__attrHandler.closePosition),o.menu.close()}},{type:e.Components.ComponentType.Button,callback:()=>{this.__processChangedPosition((this.__attrHandler.openPosition-this.__attrHandler.closePosition)/2+this.__attrHandler.closePosition),o.menu.close()}},{type:e.Components.ComponentType.Button,callback:()=>{this.__processChangedPosition(3*(this.__attrHandler.openPosition-this.__attrHandler.closePosition)/4+this.__attrHandler.closePosition),o.menu.close()}}]}]});o.button.layoutHandler.setMaxWidth(30);for(let e=0;e<o.menu.getRowEntries()[0].controlContainer.getControls().length;e++){let i=o.menu.getRowEntries()[0].controlContainer.getControls()[e];switch(e){case 0:i.getElement().css("--tchmi-ba-window-position",10);break;case 1:i.getElement().css("--tchmi-ba-window-position",20);break;case 2:i.getElement().css("--tchmi-ba-window-position",30)}i.setAttributes({layout:{maxWidth:30,minWidth:30},background:{image:t.Controls.getBasePath("TcHmi.BuildingAutomation.Controls.RoomAutomation.Window")+"/Images/RoofDome_small.svg",imageHeight:90,imageHeightUnit:"%",imageWidth:90,imageWidthUnit:"%"}})}this.__sideControl.addControl(o.button)}this.__sideControl.addControls([{type:e.Components.ComponentType.Slider,name:s.__positionCtrlName,settings:{layout:{maxHeight:10,minHeight:10,maxWidth:90,minWidth:90},showBusyIndicator:i.showBusyIndicator,knobAppearance:e.Components.Slider.KnobAppearance.round},callback:t=>{this.__processChangedPosition(t)}},{type:e.Components.ComponentType.Checkbox,name:s.__positionSwitchName,settings:{appearance:e.Components.Checkbox.Appearance.toggleSlider,readOnly:!1,layout:{maxHeight:25,minHeight:25,maxWidth:35,minWidth:35}},callback:t=>{this.__processChangedPosition(1==t?this.__attrHandler.openPosition:this.__attrHandler.closePosition)}}]);break;case"boolean":this.__sideControl.addControl({type:e.Components.ComponentType.Checkbox,name:s.__positionCtrlName,settings:{cssClass:"fixed-size",readOnly:!1,layout:{maxHeight:25,minHeight:25,maxWidth:40,minWidth:40},appearance:e.Components.Checkbox.Appearance.toggleSlider},callback:t=>{this.__processChangedPosition(t)}})}o=this.__sideControl.getControl(s.__positionCtrlName),this.__updateElements()}switch(typeof this.__attrHandler.position){case"number":if(!(o instanceof e.Components.Slider))throw new Error("Position control should be a slider here!");o.setMinValue(this.__attrHandler.closePosition),o.setMaxValue(this.__attrHandler.openPosition)}}}setAttributes(t){return super.setAttributes(t),this.baObjectHandler.baObject||(this.__handleProperty(t,"position",this.setPosition,["number","boolean"]),this.__handleProperty(t,"positionFeedback",this.setPositionFeedback,["number","boolean"]),this.__handleProperty(t,"operationState",this.setOperationState,["number"]),void 0!==t.closePosition&&this.setClosePosition(t.closePosition),void 0!==t.openPosition&&this.setOpenPosition(t.openPosition),void 0!==t.displayMode&&this.setDisplayMode(t.displayMode),void 0!==t.iconRotation&&this.setIconRotation(t.iconRotation),void 0!==t.facadeName&&this.setFacadeName(t.facadeName)),this}getAttributes(){return this.__attrHandler.getRef()}__processBaInterface(){super.__processBaInterface(),i.Window.processBaInterface(this,{processPosition:t=>this.setPosition(t),processPositionFeedback:t=>this.setPositionFeedback(t),processOperationState:t=>this.setOperationState(t),processHasResetSymbol:t=>this.__hasResetSymbol=t})}setPosition(t){return this.__attrHandler.checkAttribute(t,"position",{validator:["number","boolean"]})?(this.__attrHandler.position=t,this.__processPosition(),this.__baParent.onWindowPositionChanged(),this):this}__processPosition(){this.__updateElements()}getPosition(){return this.__attrHandler.position}setPositionFeedback(t){return this.__attrHandler.checkAttribute(t,"positionFeedback",{validator:["number","boolean"]})?(this.__attrHandler.positionFeedback=t,this.__processPositionFeedback(),this):this}__processPositionFeedback(){null!=this.__attrHandler.positionFeedback&&(this.__positionFeedbackReady.forEach(t=>t()),this.__positionFeedbackReady=[],this.__updateElements(),this.__baParent.onWindowPositionChanged())}getPositionFeedback(){return this.__attrHandler.positionFeedback}setClosePosition(t){var e;return this.__attrHandler.checkAttribute(t,"closePosition",{validator:"number"})?(this.__attrHandler.closePosition=t,null===(e=this.__windowIcon)||void 0===e||e.setClosePosition(t),this.__updateSideControl(),this.__updateElements(),this):this}getClosePosition(){return this.__attrHandler.closePosition}setOpenPosition(t){var e;return this.__attrHandler.checkAttribute(t,"openPosition",{validator:"number"})?(this.__attrHandler.openPosition=t,null===(e=this.__windowIcon)||void 0===e||e.setOpenPosition(t),this.__updateSideControl(),this.__updateElements(),this):this}getOpenPosition(){return this.__attrHandler.openPosition}setOperationState(t){return this.__attrHandler.checkAttribute(t,"operationState",{validator:"number"})?(this.__attrHandler.operationState=t,this.__processOperationState(),this.__baParent.onOperationStateChanged(),this):this}__processOperationState(){var t,e,o,s;if(null==this.__attrHandler.operationState)this.__appendOperationStateDisplay(!1),this.__appendResetManualOperationStateButton(!1),this.__operationStateLegenIconHandler.hide();else{this.__appendOperationStateDisplay(!0),null===(e=null===(t=this.__controlContainer)||void 0===t?void 0:t.getControl(n.ControlUnit.__operationStateIconName))||void 0===e||e.backgroundStyler.setAttributes(i.Window.getOperationStateDisplayBackgroundAttributes(this.__attrHandler.operationState)),null===(s=null===(o=this.__sideControl)||void 0===o?void 0:o.getControl(n.ControlUnit.__operationStateIconName))||void 0===s||s.backgroundStyler.setAttributes(i.Window.getOperationStateDisplayBackgroundAttributes(this.__attrHandler.operationState));let a=i.Window.getOperationStateDisplayIcon(this.__attrHandler.operationState);null!=a?(this.__operationStateLegenIconHandler.icon=a,this.__isAttached&&this.__operationStateLegenIconHandler.show()):(this.__operationStateLegenIconHandler.icon=void 0,this.__operationStateLegenIconHandler.hide()),this.__attrHandler.operationState!=i.Window.OperationState.manual?this.__appendResetManualOperationStateButton(!1):this.__attrHandler.operationState===i.Window.OperationState.manual&&this.__hasResetSymbol&&this.__appendResetManualOperationStateButton(!0)}}getOperationState(){return this.__attrHandler.operationState}setDisplayMode(t){var e;return this.__attrHandler.checkAttribute(t,"displayMode",{validator:"number"})?(this.__attrHandler.displayMode=t,null===(e=this.__windowIcon)||void 0===e||e.setDisplayMode(t),this):this}getDisplayMode(){return this.__attrHandler.displayMode}setIconRotation(t){var e;return this.__attrHandler.checkAttribute(t,"iconRotation",{validator:"number"})?(this.__attrHandler.iconRotation=t,null===(e=this.__windowIcon)||void 0===e||e.backgroundStyler.setImageRotation(t),this):this}getIconRotation(){return this.__attrHandler.iconRotation}setFacadeName(t){return this.__attrHandler.checkAttribute(t,"facadeName",{validator:"string"})?(this.__attrHandler.facadeName=t,this):this}getFacadeName(){return this.__attrHandler.facadeName}processBaObject(){super.processBaObject(),null!=this.baObjectHandler.baObject&&(i.Window.processBaObject(this,{processPosition:t=>this.setPosition(t),processPositionFeedback:t=>this.setPositionFeedback(t),processOperationState:t=>this.setOperationState(t),processHasResetSymbol:t=>this.__hasResetSymbol=t}),this.busyHandler.checkForBusyChildren())}}s.__positionDisplayName="position-display",s.__positionCtrlName="position-ctrl",s.__positionSwitchName="position-switch",n.WindowControl=s}(i.RoomControl||(i.RoomControl={}))}(o.RoomAutomation||(o.RoomAutomation={}))}(e.Controls||(e.Controls={}))}(t.BuildingAutomation||(t.BuildingAutomation={}))}(TcHmi||(TcHmi={}));
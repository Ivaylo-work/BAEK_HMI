var TcHmi;!function(t){!function(e){!function(s){!function(s){!function(i){class n extends i.ControlUnit{constructor(t,e,s){super(t,e,s),this.__useCurrentBrightness=!1}__init(t){super.__init(t),this.__brightnessFeedbackReady=[],this.baTemplateHandler.defaultBaTemplateDescription=s.Light.BaTemplateDescription,this.baInterfaceHandler.baInterfaceDefinition=s.Light.BaInterfaceDef,this.setBaInterfaceSymbolNames(s.Light.BaInterfaceSymbolNames)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){var t;null===(t=this.__lightIcon)||void 0===t||t.destroy(),super.destroy()}createElement(){var t,i,r;super.createElement(),this.__lightIcon||(this.__lightIcon=new s.Light.Icon(this.__id+"-light",this,this.__attrHandler),this.__lightIcon.setReadOnly(!0).getElement().addClass("icon"),null===(t=this.__iconContainer)||void 0===t||t.append(this.__lightIcon.getElement())),(null===(i=this.__controlContainer)||void 0===i?void 0:i.getControl(n.__brightnessDisplayName))||null===(r=this.__controlContainer)||void 0===r||r.addControl({type:e.Components.ComponentType.Textblock,name:n.__brightnessDisplayName,settings:{order:2}}),this.__updateElements(),this.__processOperationState()}getSideControl(){return this.__sideControlContainer=super.getSideControl(),this.__sideControlContainer.addClass("light"),"boolean"==typeof this.__attrHandler.brightness&&this.__sideControlContainer.addClass("boolean-brightness"),this.__sideControl&&(this.__sideControl.getElement(),this.__updateSideControl()),this.__sideControlContainer}writeBrightness(t){this.__processChangedBrightness(t)}__processChangedBrightness(i){if(1!=this.busyHandler.getIsBusy()&&void 0!==i&&(this.__useCurrentBrightness=!0,this.setBrightness(i),this.baObjectHandler.baObject&&(this.baObjectHandler.baObject.checkTemplate(s.Light.BaTemplateDefinition,this.baTemplateHandler.baBaTemplateDescription)&&s.Light.writeBrightnessToPlc(i,this.baObjectHandler.baObject),this.baObjectHandler.baObject.checkAddParams(s.Light.BaInterfaceDef,s.Light.BaInterfaceSymbolNames)&&s.Light.writeBrightnessToPlc(i,this.baObjectHandler.baObject)),null!=this.baInterfaceHandler.getBaInterfaceSym()&&s.Light.writeBrightnessToPlc(i,this.baInterfaceHandler),this.__attrHandler.brightnessMapping&&t.Server.writeSymbol(this.__attrHandler.brightnessMapping,i,t=>{this.logger.checkServerResult(e.Logger.Severity.warn,t)}),null!=this.__attrHandler.brightnessFeedback&&i!=this.__attrHandler.brightnessFeedback)){let t=()=>{this.__brightnessFeedbackReady.forEach(t=>t()),this.__brightnessFeedbackReady=[],this.setBrightness(this.__attrHandler.brightnessFeedback)};this.__sideControlContainer&&0==this.busyHandler.getIsBusy()&&s.showBusyIndicator&&e.BusyHandler.appendBusyIndicator(this.__sideControlContainer);let i=this.logger.logPerformance(e.Logger.Severity.debug,"Brightness feedback response."),n=()=>{i(),this.__sideControlContainer&&e.BusyHandler.detachBusyIndicator(this.__sideControlContainer)};this.__brightnessFeedbackReady.push(this.busyHandler.setBusy("Waiting for BrightnessFeedback",{cbOnTimeout:t,cbOnReady:n,showIndicator:s.showBusyIndicator}))}}__updateElements(){var t,i;if(null==this.__attrHandler.brightness)return;let r=this.__attrHandler.brightness;if(null!=this.__attrHandler.brightnessFeedback&&0==this.__useCurrentBrightness&&(r=this.__attrHandler.brightnessFeedback),this.__useCurrentBrightness=!1,this.__elementCreated&&(null===(t=this.__lightIcon)||void 0===t||t.setBrightness(r),s.Light.Icon.getBrightnessText(r,this.__attrHandler.minBrightness,this.__attrHandler.maxBrightness,t=>{var e,s;null===(s=null===(e=this.__controlContainer)||void 0===e?void 0:e.getControl(n.__brightnessDisplayName))||void 0===s||s.textHandler.setText(t)})),this.__sideControl){let t=this.__sideControl.getControl(n.__brightnessCtrlName);"number"==typeof r?(t instanceof e.Components.Slider||(this.__sideControl.removeControl(n.__brightnessCtrlName),this.__updateSideControl(),t=this.__sideControl.getControl(n.__brightnessCtrlName)),0==s.Light.showFeedbackInSlider?null==t||t.setValue(r):(null==t||t.setValue(this.__attrHandler.brightness),null!=this.__attrHandler.brightnessFeedback&&(null==t||t.setValueFeedback(this.__attrHandler.brightnessFeedback))),null===(i=this.__sideControl.getControl(n.__lightSwitchName))||void 0===i||i.setState(r>this.__attrHandler.minBrightness)):"boolean"==typeof r&&(t instanceof e.Components.Checkbox||(this.__sideControl.removeControl(n.__brightnessCtrlName),this.__updateSideControl(),t=this.__sideControl.getControl(n.__brightnessCtrlName)),null==t||t.setState(r))}this.__processOperationState()}__updateSideControl(){if(null==this.__sideControl)return;if(null==this.__attrHandler)return;let t=this.__sideControl.getControl(n.__brightnessCtrlName);if(!t){switch(typeof this.__attrHandler.brightness){case"number":if(1==s.Light.ShowQuickLinks){let t=e.Components.ContextMenu.createContextMenuAndButton({id:this.__id,parent:this,rowEntryOptions:[{controls:[{type:e.Components.ComponentType.Button,callback:()=>{this.__processChangedBrightness((this.__attrHandler.maxBrightness-this.__attrHandler.minBrightness)/4+this.__attrHandler.minBrightness),t.menu.close()}},{type:e.Components.ComponentType.Button,callback:()=>{this.__processChangedBrightness((this.__attrHandler.maxBrightness-this.__attrHandler.minBrightness)/2+this.__attrHandler.minBrightness),t.menu.close()}},{type:e.Components.ComponentType.Button,callback:()=>{this.__processChangedBrightness(3*(this.__attrHandler.maxBrightness-this.__attrHandler.minBrightness)/4+this.__attrHandler.minBrightness),t.menu.close()}}]}]});t.button.layoutHandler.setMaxWidth(30),this.__sideControl.addControl(t.button),this.__sideControl.childrenHandler.addChild(t.menu)}this.__sideControl.addControls([{type:e.Components.ComponentType.Slider,name:n.__brightnessCtrlName,settings:{layout:{maxHeight:10,minHeight:10,maxWidth:90,minWidth:90},showBusyIndicator:s.showBusyIndicator,knobAppearance:e.Components.Slider.KnobAppearance.round},callback:t=>{this.__processChangedBrightness(t)}},{type:e.Components.ComponentType.Checkbox,name:n.__lightSwitchName,settings:{appearance:e.Components.Checkbox.Appearance.toggleSlider,readOnly:!1,layout:{maxHeight:25,minHeight:25,maxWidth:35,minWidth:35}},callback:t=>{this.__processChangedBrightness(1==t?this.__attrHandler.maxBrightness:this.__attrHandler.minBrightness)}}]);break;case"boolean":this.__sideControl.addControl({type:e.Components.ComponentType.Checkbox,name:n.__brightnessCtrlName,settings:{cssClass:"fixed-size",readOnly:!1,layout:{maxHeight:25,minHeight:25,maxWidth:40,minWidth:40},appearance:e.Components.Checkbox.Appearance.toggleSlider},callback:t=>{this.__processChangedBrightness(t)}})}t=this.__sideControl.getControl(n.__brightnessCtrlName),this.__updateElements()}if(null==t)throw new Error("Brightness control not found!");switch(typeof this.__attrHandler.brightness){case"number":if(!(t instanceof e.Components.Slider))throw new Error("Brightness control should be a slider here!");if(t.setMinValue(this.__attrHandler.minBrightness).setMaxValue(this.__attrHandler.maxBrightness),1==s.Light.ShowQuickLinks&&this.__attrHandler.lightColor&&null!=this.__attrHandler.minBrightness&&null!=this.__attrHandler.maxBrightness){let t=this.__sideControl.childrenHandler.getChildren().get(this.__id+"-context-menu");if(null==t)throw new Error("Context menu should be available here!");let s=this.__attrHandler.maxBrightness-this.__attrHandler.minBrightness;for(let i=0;i<t.getRowEntries()[0].controlContainer.getControls().length;i++){let n=t.getRowEntries()[0].controlContainer.getControls()[i],r=0;switch(i){case 0:r=s/4+this.__attrHandler.minBrightness;break;case 1:r=s/2+this.__attrHandler.minBrightness;break;case 2:r=3*s/4+this.__attrHandler.minBrightness}n.setAttributes({layout:{maxWidth:30,minWidth:30},background:{image:e.Icons.RoomAutomation.Lamp2.path,imageHeight:90,imageHeightUnit:"%",imageWidth:90,imageWidthUnit:"%",imageColor:e.Color.getFadeColor(e.Color.RGBAColor.Black,this.__attrHandler.minBrightness,this.__attrHandler.lightColor,this.__attrHandler.maxBrightness,r)}})}}}this.__processOperationState()}setAttributes(t){return super.setAttributes(t),this.baObjectHandler.baObject||(this.__handleProperty(t,"brightness",this.setBrightness,["number","boolean"]),this.__handleProperty(t,"brightnessFeedback",this.setBrightnessFeedback,["number","boolean"]),this.__handleProperty(t,"operationState",this.setOperationState,["number"]),void 0!==t.minBrightness&&this.setMinBrightness(t.minBrightness),void 0!==t.maxBrightness&&this.setMaxBrightness(t.maxBrightness),void 0!==t.lightColor&&this.setLightColor(t.lightColor)),this}getAttributes(){return this.__attrHandler.getRef()}__processBaInterface(){super.__processBaInterface(),s.Light.processBaInterface(this,{processBrightness:t=>this.setBrightness(t),processBrightnessFeedback:t=>this.setBrightnessFeedback(t),processOperationState:t=>this.setOperationState(t),processMaxBrightness:t=>this.setMaxBrightness(t),processMinBrightness:t=>this.setMinBrightness(t),processHasResetSymbol:t=>this.__hasResetSymbol=t})}setBrightness(t){return this.__attrHandler.checkAttribute(t,"brightness",{validator:["number","boolean"]})?(this.__attrHandler.brightness=t,this.__processBrightness(),this.__baParent.onBrightnessChanged(),this):this}__processBrightness(){this.__updateElements()}getBrightness(){return this.__attrHandler.brightness}setBrightnessFeedback(t){return this.__attrHandler.checkAttribute(t,"brightnessFeedback",{validator:["number","boolean"]})?(this.__attrHandler.brightnessFeedback=t,null!=t&&this.__processBrightnessFeedback(),this):this}__processBrightnessFeedback(){null!=this.__attrHandler.brightnessFeedback&&(this.__brightnessFeedbackReady.forEach(t=>t()),this.__brightnessFeedbackReady=[],this.__updateElements(),this.__baParent.onBrightnessChanged())}getBrightnessFeedback(){return this.__attrHandler.brightnessFeedback}setMinBrightness(t){var e;return this.__attrHandler.checkAttribute(t,"minBrightness",{validator:"number"})?(this.__attrHandler.minBrightness=t,null===(e=this.__lightIcon)||void 0===e||e.setMinBrightness(t),this.__updateSideControl(),this.__updateElements(),this):this}getMinBrightness(){return this.__attrHandler.minBrightness}setMaxBrightness(t){var e;return this.__attrHandler.checkAttribute(t,"maxBrightness",{validator:"number"})?(this.__attrHandler.maxBrightness=t,null===(e=this.__lightIcon)||void 0===e||e.setMaxBrightness(t),this.__updateSideControl(),this.__updateElements(),this):this}getMaxBrightness(){return this.__attrHandler.maxBrightness}setOperationState(t){return this.__attrHandler.checkAttribute(t,"operationState",{validator:"number"})?(this.__attrHandler.operationState=t,this.__processOperationState(),this.__baParent.onOperationStateChanged(),this):this}__processOperationState(){var t,e,n,r;if(null==this.__attrHandler.operationState)this.__appendOperationStateDisplay(!1),this.__appendResetManualOperationStateButton(!1),this.__operationStateLegenIconHandler.hide();else{this.__appendOperationStateDisplay(!0),null===(e=null===(t=this.__controlContainer)||void 0===t?void 0:t.getControl(i.ControlUnit.__operationStateIconName))||void 0===e||e.backgroundStyler.setAttributes(s.Light.getOperationStateDisplayBackgroundAttributes(this.__attrHandler.operationState)),null===(r=null===(n=this.__sideControl)||void 0===n?void 0:n.getControl(i.ControlUnit.__operationStateIconName))||void 0===r||r.backgroundStyler.setAttributes(s.Light.getOperationStateDisplayBackgroundAttributes(this.__attrHandler.operationState));let a=s.Light.getOperationStateDisplayIcon(this.__attrHandler.operationState);null!=a&&(this.__operationStateLegenIconHandler.icon=a,this.__isAttached&&this.__operationStateLegenIconHandler.show()),this.__attrHandler.operationState!=s.Light.OperationState.manual?this.__appendResetManualOperationStateButton(!1):this.__attrHandler.operationState===s.Light.OperationState.manual&&this.__hasResetSymbol&&this.__appendResetManualOperationStateButton(!0)}}getOperationState(){return this.__attrHandler.operationState}setLightColor(t){var e;return this.__attrHandler.checkColorAttribute(t,"lightColor")?(this.__attrHandler.lightColor=t,null===(e=this.__lightIcon)||void 0===e||e.setLightColor(t),this.__updateSideControl(),this):this}getLightColor(){return this.__attrHandler.lightColor}processBaObject(){super.processBaObject(),null!=this.baObjectHandler.baObject&&(s.Light.processBaObject(this,{processBrightness:t=>this.setBrightness(t),processBrightnessFeedback:t=>this.setBrightnessFeedback(t),processOperationState:t=>this.setOperationState(t),processMaxBrightness:t=>{this.__baParent.setMaxBrightness(t),this.setMaxBrightness(t)},processMinBrightness:t=>{this.__baParent.setMinBrightness(t),this.setMinBrightness(t)},processHasResetSymbol:t=>this.__hasResetSymbol=t}),this.busyHandler.checkForBusyChildren())}}n.__brightnessDisplayName="brightness-display",n.__brightnessCtrlName="brightness-ctrl",n.__lightSwitchName="light-switch",i.LightControl=n}(s.RoomControl||(s.RoomControl={}))}(s.RoomAutomation||(s.RoomAutomation={}))}(e.Controls||(e.Controls={}))}(t.BuildingAutomation||(t.BuildingAutomation={}))}(TcHmi||(TcHmi={}));
var TcHmi;!function(e){!function(t){!function(r){!function(i){class n extends r.System.BaseRoomControl{constructor(e,t,r){super(e,t,r),this.__defaultBaTemplateDescription=n.BaTemplateDescription,this.__tempAdjustFeedbackReady=[]}__previnit(){null==this.__baFc&&(this.__baFc=new n.Icon(this.__id+"-ba-fc",this)),super.__previnit(),this.__baFc.textHandler.setOverflow(t.Components.TextHandler.Overflow.marquee);let e={type:t.Components.ComponentType.Slider,name:n.__tempAdjustSliderName,callback:e=>{this.writeTempAdjustToPlc(e)},settings:{step:.1,layout:{maxHeight:10,minHeight:10},showBusyIndicator:i.showBusyIndicator,knobAppearance:t.Components.Slider.KnobAppearance.round,readOnly:this.__attrHandler.tempAdjustReadOnly}};this.__tempAdjustSlider=this.__addControl(n.__controlContainerName,e,1),this.baInterfaceHandler.baInterfaceDefinition=n.BaInterfaceDef,this.setBaInterfaceSymbolNames(n.BaInterfaceSymbolNames),void 0===this.__attrHandler.tempAdjustRange&&this.setTempAdjustRange(3)}__init(){super.__init(),this.__updateDisplay()}__attach(){super.__attach(),this.setTempAdjust(null!=this.__attrHandler.tempAdjustFeedback?this.__attrHandler.tempAdjustFeedback:this.__attrHandler.tempAdjust)}__detach(){super.__detach()}destroy(){this.__keepAlive||super.destroy()}__processChangedTempAdjust(e){if(this.setTempAdjust(e),null!=this.__attrHandler.tempAdjustFeedback&&this.__attrHandler.tempAdjust!=this.__attrHandler.tempAdjustFeedback){let e=()=>{this.__tempAdjustFeedbackReady.forEach(e=>e()),this.__tempAdjustFeedbackReady=[],this.setTempAdjust(this.__attrHandler.tempAdjustFeedback)};this.__tempAdjustFeedbackReady.push(this.busyHandler.setBusy("Waiting for TempAdjustFeedback",{cbOnTimeout:e,showIndicator:i.showBusyIndicator}))}}__createOrUpdateElements(){if(null==this.__attrHandler.tempAdjustRange)return;let e=this.__getControl(n.__controlContainerName,n.__tempAdjustSliderName);if(null==e)throw new Error("Temp adjust slider should be available here!");e.setRanges(null).setMinValue(-this.__attrHandler.tempAdjustRange).setMaxValue(this.__attrHandler.tempAdjustRange).setRanges([{start:-this.__attrHandler.tempAdjustRange,color:t.Color.RGBAColor.Blue},{start:this.__attrHandler.tempAdjustRange,color:t.Color.RGBAColor.Red}])}__updateDisplay(){this.__attributesInitialized&&(this.__attrHandler.showTemperatures?(this.__baFc.textHandler.setText(""),this.__element.addClass("show-displays"),this.__baFc.textHandler.setText(this.getTemperatureText())):(this.__element.removeClass("show-displays"),this.__baFc.textHandler.setText(null)))}static processBaObject(e,r){var a;let s=e.baObjectHandler;if(null==s)return;if(!(null===(a=s.baObject)||void 0===a?void 0:a.checkTemplate(n.BaTemplateDefinition,e.baTemplateHandler.baBaTemplateDescription,e,!0)))return;let o=s.baObject.getTemplateChild("currentTemperature");s.tryWatchChildrenBaVariable(o,t.BA.BaParameterId.ePresentValue,e=>{r.processCurrentTemperature(e)});let l=s.baObject.getTemplateChild("temperatureAdjust");s.tryWatchChildrenBaVariable(l,t.BA.BaParameterId.ePresentValue,e=>{r.processTempAdjust(e),r.processTempAdjustFeedback(e)}),i.ignoreBaObjectAccess?r.processTempAdjustReadOnly(!1):r.processTempAdjustReadOnly(1!=(null==l?void 0:l.checkManualValueWriteAccess()));let d=s.baObject.getTemplateChild("controlHeating");s.tryWatchChildrenBaVariable(d,t.BA.BaParameterId.eSetpoint,e=>{r.processHeatingSetpoint(e)}),s.tryWatchChildrenBaVariable(d,t.BA.BaParameterId.ePresentValue,e=>{"number"==typeof e&&(e=e>0),r.processHeatingActive(e)});let u=s.baObject.getTemplateChild("controlCooling");null!=u&&(s.tryWatchChildrenBaVariable(u,t.BA.BaParameterId.eSetpoint,e=>{r.processCoolingSetpoint(e)}),s.tryWatchChildrenBaVariable(u,t.BA.BaParameterId.ePresentValue,e=>{"number"==typeof e&&(e=e>0),r.processCoolingActive(e)}))}static writeTempAdjustToPlc(e,r){var i;null!=e&&(r instanceof t.BA.BaView?null===(i=r.getTemplateChild("temperatureAdjust"))||void 0===i||i.tryWriteBaVariableValue(t.BA.BaParameterId.ePresentValue,e,e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)}):r instanceof t.BaInterfaceHandler&&r.writeSubSymbol("roomTempAdj",e).then(e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)}))}writeTempAdjustToPlc(e){var t;1!=this.busyHandler.getIsBusy()&&null!=e&&((null===(t=this.baObjectHandler.baObject)||void 0===t?void 0:t.checkTemplate(n.BaTemplateDefinition,this.baTemplateHandler.baBaTemplateDescription))&&n.writeTempAdjustToPlc(e,this.baObjectHandler.baObject),null!=this.baInterfaceHandler.getBaInterfaceSym()&&n.writeTempAdjustToPlc(e,this.baInterfaceHandler),this.__processChangedTempAdjust(e))}static getTemperatureText(e,r){if(t.Server.UserManagement.checkAccess(t.BA.Role.eAdvanced)){const t=" &#x279E ",i=" "+e.unit;let a=null!=e.currentTemp?e.currentTemp.toFixed(1):"?";return a+=i,r===n.CurrentSetpoint.heating?a=a+t+(null!=e.heatingSetpoint?e.heatingSetpoint.toFixed(1):"?")+i:r===n.CurrentSetpoint.cooling&&(a=a+t+(null!=e.coolingSetpoint?e.coolingSetpoint.toFixed(1):"?")+i),a}return null!=e.tempAdjust?e.tempAdjust.toFixed(1)+" °K":"? °K"}getTemperatureText(){return n.getTemperatureText(this.__attrHandler,this.__baFc.currentSetpoint)}setBaObject(e){return this.baObjectHandler.setBaObject(e),this}getBaObject(){return this.baObjectHandler.baObject}setAttributes(e){return super.setAttributes(e),void 0!==e.currentTemp&&this.setCurrentTemperature(e.currentTemp),void 0!==e.tempAdjust&&this.setTempAdjust(e.tempAdjust),void 0!==e.tempAdjustFeedback&&this.setTempAdjustFeedback(e.tempAdjustFeedback),void 0!==e.tempAdjustRange&&this.setTempAdjustRange(e.tempAdjustRange),void 0!==e.heatingSetpoint&&this.setHeatingSetpoint(e.heatingSetpoint),void 0!==e.coolingSetpoint&&this.setCoolingSetpoint(e.coolingSetpoint),void 0!==e.heatingActive&&this.setHeatingActive(e.heatingActive),void 0!==e.coolingActive&&this.setCoolingActive(e.coolingActive),void 0!==e.showTemperatures&&this.setShowTemperatures(e.showTemperatures),void 0!==e.unit&&this.setUnit(e.unit),this}getAttributes(){return this.__attrHandler}setBaInterface(e){return super.setBaInterface(e),this.baInterfaceHandler.setBaInterfaceSym(e,()=>{n.processBaInterface(this,{processCurrentTemperature:e=>this.setCurrentTemperature(e),processTempAdjust:e=>this.setTempAdjust(e),processTempAdjustFeedback:e=>this.setTempAdjustFeedback(e),processTempAdjustReadOnly:e=>{var t;null===(t=this.__tempAdjustSlider)||void 0===t||t.setReadOnly(e),this.__attrHandler.tempAdjustReadOnly=e},processHeatingSetpoint:e=>this.setHeatingSetpoint(e),processHeatingActive:e=>this.setHeatingActive(e),processCoolingSetpoint:e=>this.setCoolingSetpoint(e),processCoolingActive:e=>this.setCoolingActive(e)})}),this}setCurrentTemperature(t){let r=e.ValueConverter.toNumber(t);return null==r&&(r=this.getAttributeDefaultValueInternal("CurrentTemperature")),r===this.__attrHandler.currentTemp||(this.__attrHandler.currentTemp=r,this.__processCurrentTemperature(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"CurrentTemperature"})),this}__processCurrentTemperature(){this.__updateDisplay()}getCurrentTemperature(){return this.__attrHandler.currentTemp}setTempAdjust(t){let r=e.ValueConverter.toNumber(t);return null==r&&(r=this.getAttributeDefaultValueInternal("TempAdjust")),r===this.__attrHandler.tempAdjust||(this.__attrHandler.tempAdjust=r,this.__processTempAdjust(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TempAdjust"}),e.EventProvider.raise(this.__id+".onTempAdjustChanged")),this}__processTempAdjust(){let e=this.__getControl(n.__controlContainerName,n.__tempAdjustSliderName);e&&e.setValue(this.__attrHandler.tempAdjust)}getTempAdjust(){return this.__attrHandler.tempAdjust}setTempAdjustFeedback(t){let r=e.ValueConverter.toNumber(t);return null==r&&(r=this.getAttributeDefaultValueInternal("TempAdjustFeedback")),r===this.__attrHandler.tempAdjustFeedback||(this.__attrHandler.tempAdjustFeedback=r,null!=this.__attrHandler.tempAdjustFeedback&&(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TempAdjustFeedback"}),this.__processTempAdjustFeedback(),this.__tempAdjustFeedbackReady.forEach(e=>e()),this.__tempAdjustFeedbackReady=[])),this}__processTempAdjustFeedback(){let e=this.__getControl(n.__controlContainerName,n.__tempAdjustSliderName);e&&e.setValue(this.__attrHandler.tempAdjustFeedback)}getTempAdjustFeedback(){return this.__attrHandler.tempAdjustFeedback}setTempAdjustRange(t){let r=e.ValueConverter.toNumber(t);return null==r&&(r=this.getAttributeDefaultValueInternal("TempAdjustRange")),r===this.__attrHandler.tempAdjustRange||(null==r&&(r=3),this.__attrHandler.tempAdjustRange=r,this.__processTempAdjustRange(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TempAdjustRange"})),this}__processTempAdjustRange(){this.__createOrUpdateElements()}getTempAdjustRange(){return this.__attrHandler.tempAdjustRange}setHeatingSetpoint(t){let r=e.ValueConverter.toNumber(t);return null==r&&(r=this.getAttributeDefaultValueInternal("HeatingSetpoint")),r===this.__attrHandler.heatingSetpoint||(this.__attrHandler.heatingSetpoint=r,this.__processHeatingSetpoint(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeatingSetpoint"})),this}__processHeatingSetpoint(){this.__updateDisplay()}getHeatingSetpoint(){return this.__attrHandler.heatingSetpoint}setCoolingSetpoint(t){let r=e.ValueConverter.toNumber(t);return null==r&&(r=this.getAttributeDefaultValueInternal("CoolingSetpoint")),r===this.__attrHandler.coolingSetpoint||(this.__attrHandler.coolingSetpoint=r,this.__processCoolingSetpoint(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"CoolingSetpoint"})),this}__processCoolingSetpoint(){this.__updateDisplay()}getCoolingSetpoint(){return this.__attrHandler.coolingSetpoint}setHeatingActive(t){"number"==typeof t&&(t=t>0);let r=e.ValueConverter.toBoolean(t);return null==r&&(r=this.getAttributeDefaultValueInternal("HeatingActive")),this.__baFc.setHeatingActive(r),this.__processHeatingActive(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeatingActive"}),this}__processHeatingActive(){this.__updateDisplay()}getHeatingActive(){return this.__attrHandler.heatingActive}setCoolingActive(t){"number"==typeof t&&(t=t>0);let r=e.ValueConverter.toBoolean(t);return null==r&&(r=this.getAttributeDefaultValueInternal("CoolingActive")),this.__baFc.setCoolingActive(r),this.__processCoolingActive(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"CoolingActive"}),this}__processCoolingActive(){this.__updateDisplay()}getCoolingActive(){return this.__attrHandler.coolingActive}setShowTemperatures(t){let r=e.ValueConverter.toBoolean(t);return null==r&&(r=this.getAttributeDefaultValueInternal("ShowTemperatures")),r===this.__attrHandler.showTemperatures||(this.__attrHandler.showTemperatures=r,this.__processShowTemperatures(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowTemperatures"})),this}__processShowTemperatures(){this.__updateDisplay()}getShowTemperatures(){return this.__attrHandler.showTemperatures}setUnit(t){let r=e.ValueConverter.toString(t);return null==r&&(r=this.getAttributeDefaultValueInternal("Unit")),r===this.__attrHandler.unit||(this.__attrHandler.unit=r,this.__processUnit(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Unit"})),this}__processUnit(){this.__updateDisplay()}getUnit(){return this.__attrHandler.unit}processBaObject(){super.processBaObject(),n.processBaObject(this,{processCurrentTemperature:e=>this.setCurrentTemperature(e),processTempAdjust:e=>this.setTempAdjust(e),processTempAdjustFeedback:e=>this.setTempAdjustFeedback(e),processTempAdjustReadOnly:e=>{var t;null===(t=this.__tempAdjustSlider)||void 0===t||t.setReadOnly(e),this.__attrHandler.tempAdjustReadOnly=e},processHeatingSetpoint:e=>this.setHeatingSetpoint(e),processHeatingActive:e=>this.setHeatingActive(e),processCoolingSetpoint:e=>this.setCoolingSetpoint(e),processCoolingActive:e=>this.setCoolingActive(e)})}static processBaInterface(e,t){e.baInterfaceHandler.watchSubSymbol("roomTemp",e=>{t.processCurrentTemperature(e)}),e.baInterfaceHandler.watchSubSymbol("roomTempAdj",e=>{t.processTempAdjust(e),t.processTempAdjustFeedback(e)}),t.processTempAdjustReadOnly(!1),e.baInterfaceHandler.watchSubSymbol("heatingSetpoint",e=>{t.processHeatingSetpoint(e)}),e.baInterfaceHandler.watchSubSymbol("heatingActive",e=>{"number"==typeof e&&(e=e>0),t.processHeatingActive(e)}),e.baInterfaceHandler.watchSubSymbol("coolingSetpoint",e=>{t.processCoolingSetpoint(e)}),e.baInterfaceHandler.watchSubSymbol("coolingActive",e=>{"number"==typeof e&&(e=e>0),t.processCoolingActive(e)})}}n.__tempAdjustSliderName="temp-adjust-slider",n.__controlContainerName="setting",i.HeatingCooling=n,function(e){let i;!function(e){e[e.invalid=0]="invalid",e[e.heating=1]="heating",e[e.cooling=2]="cooling"}(i=e.CurrentSetpoint||(e.CurrentSetpoint={})),e.BaInterfaceDef=Object.assign(Object.assign({},r.System.BaseRoomControl.BaInterfaceDef),{roomTemp:{type:"number"},roomTempAdj:{type:"number"},heatingSetpoint:{type:"number"},heatingActive:{type:["boolean","number"]},coolingSetpoint:{type:"number"},coolingActive:{type:["boolean","number"]}}),e.BaInterfaceSymbolNames=Object.assign(Object.assign({},r.System.BaseRoomControl.BaInterfaceSymbolNames),{roomTemp:{symbolName:"RoomTemp"},roomTempAdj:{symbolName:"RoomTempAdj"},heatingSetpoint:{symbolName:"HeatingSetpoint"},heatingActive:{symbolName:"HeatingActive"},coolingSetpoint:{symbolName:"CoolingSetpoint"},coolingActive:{symbolName:"CoolingActive"}}),e.BaTemplateDefinition={currentTemperature:{},temperatureAdjust:{},controlHeating:{},controlCooling:{optional:!0}},e.BaTemplateDescription={currentTemperature:{identifier:"RoomTempSen1"},temperatureAdjust:{identifier:"RoomTempAdj"},controlHeating:{identifier:"HeatCoolPID::ControlHeating"},controlCooling:{identifier:"HeatCoolPID::ControlCooling"}};class n extends t.Components.Button{constructor(t,r,i){super(t,r,i),this.currentSetpoint=e.CurrentSetpoint.invalid}__init(e){var r,i,n,a;super.__init(e),this.__legendIconHandler=new t.Components.LegendIconHandler,void 0===(null===(r=null==e?void 0:e.background)||void 0===r?void 0:r.image)&&(this.backgroundStyler.setImage(t.Icons.RoomAutomation.Temperature.path,!0),this.__legendIconHandler.icon=t.Icons.RoomAutomation.Temperature),void 0===(null===(i=null==e?void 0:e.background)||void 0===i?void 0:i.imageColor)&&this.backgroundStyler.setImageColor(t.Color.RGBAColor.White),void 0===(null===(n=null==e?void 0:e.background)||void 0===n?void 0:n.imageHeight)&&this.backgroundStyler.setImageHeight(90,"%"),void 0===(null===(a=null==e?void 0:e.background)||void 0===a?void 0:a.imageWidth)&&this.backgroundStyler.setImageWidth(90,"%")}__attach(){this.__isAttached||(null!=this.__legendIconHandler.icon&&this.__legendIconHandler.show(),super.__attach())}__detach(){this.__isAttached&&(this.__legendIconHandler.hide(),super.__detach())}destroy(){super.destroy()}__updateElements(){null==this.__attrHandler.coolingActive&&null==this.__attrHandler.heatingActive||(1==this.__attrHandler.heatingActive?(this.backgroundStyler.setImage(t.Icons.RoomAutomation.Heating.path,!0).setImageColor(t.Color.RGBAColor.Red),this.__legendIconHandler.icon=t.Icons.RoomAutomation.Heating,this.currentSetpoint=e.CurrentSetpoint.heating):1==this.__attrHandler.coolingActive?(this.backgroundStyler.setImage(t.Icons.RoomAutomation.Cooling.path,!0).setImageColor(t.Color.RGBAColor.Blue),this.__legendIconHandler.icon=t.Icons.RoomAutomation.Cooling,this.currentSetpoint=e.CurrentSetpoint.cooling):(this.backgroundStyler.setImage(t.Icons.RoomAutomation.Temperature.path,!0).setImageColor(t.Color.RGBAColor.White),this.__legendIconHandler.icon=t.Icons.RoomAutomation.Temperature,this.currentSetpoint=e.CurrentSetpoint.invalid),this.__isAttached&&this.__legendIconHandler.show())}setAttributes(e){return super.setAttributes(e),void 0!==e.heatingActive&&this.setHeatingActive(e.heatingActive),void 0!==e.coolingActive&&this.setCoolingActive(e.coolingActive),this}getAttributes(){return this.__attrHandler.getRef()}setHeatingActive(e){return this.__attrHandler.checkAttribute(e,"heatingActive",{validator:"boolean"})?(this.__attrHandler.heatingActive=e,this.__processHeatingActive(),this):this}__processHeatingActive(){this.__updateElements()}getHeatingActive(){return this.__attrHandler.heatingActive}setCoolingActive(e){return this.__attrHandler.checkAttribute(e,"coolingActive",{validator:"boolean"})?(this.__attrHandler.coolingActive=e,this.__processCoolingActive(),this):this}__processCoolingActive(){this.__updateElements()}getCoolingActive(){return this.__attrHandler.coolingActive}__processReadOnly(){super.__processReadOnly(),!0===this.__attrHandler.readOnly?this.__element.removeClass("button"):this.__element.addClass("button")}}e.Icon=n}(n=i.HeatingCooling||(i.HeatingCooling={}))}(r.RoomAutomation||(r.RoomAutomation={}))}(t.Controls||(t.Controls={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("HeatingCooling","TcHmi.BuildingAutomation.Controls.RoomAutomation",TcHmi.BuildingAutomation.Controls.RoomAutomation.HeatingCooling);
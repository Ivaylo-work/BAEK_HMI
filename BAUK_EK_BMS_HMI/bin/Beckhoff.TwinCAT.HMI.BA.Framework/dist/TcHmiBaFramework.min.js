!function(e){let t;!function(e){let t;!function(e){let t,a,i,n,s,r,o,l,d,_,h,c,u,g,p,v,m,b,y,f,D,C,H,w,S,T;!function(e){e[e.Invalid=0]="Invalid",e[e.eAlarm=1]="eAlarm",e[e.eDisturb=2]="eDisturb",e[e.eMaintenance=3]="eMaintenance",e[e.eNotification=4]="eNotification",e[e.eOther=5]="eOther"}(t=e.EventType||(e.EventType={})),function(e){e[e.Invalid=0]="Invalid",e[e.eTypeAlarm=1]="eTypeAlarm",e[e.eTypeDisturb=2]="eTypeDisturb",e[e.eTypeMaintenance=3]="eTypeMaintenance",e[e.eTypeNotification=4]="eTypeNotification",e[e.eTypeOther=5]="eTypeOther",e[e.eFlagOverridden=6]="eFlagOverridden",e[e.eFlagOutOfService=7]="eFlagOutOfService",e[e.eFlagFault=8]="eFlagFault",e[e.eFlagActiveEvent=9]="eFlagActiveEvent",e[e.ePrioLifeSafety=10]="ePrioLifeSafety",e[e.ePrioCritical=11]="ePrioCritical",e[e.ePrioManualLocal=12]="ePrioManualLocal",e[e.ePrioManualRemote=13]="ePrioManualRemote",e[e.eLockPrioLocalMedium=14]="eLockPrioLocalMedium",e[e.eLockPrioLocalHigh=15]="eLockPrioLocalHigh",e[e.eLockPrioMedium=16]="eLockPrioMedium",e[e.eLockPrioHigh=17]="eLockPrioHigh",e[e.eEventIconDisplayed=18]="eEventIconDisplayed"}(a=e.EventCondition||(e.EventCondition={})),function(e){e[e.Invalid=0]="Invalid",e[e.eNone=1]="eNone",e[e.eIndicatd=2]="eIndicatd",e[e.eGoneAcked=3]="eGoneAcked",e[e.eGone=4]="eGone",e[e.ePresentAcked=5]="ePresentAcked",e[e.ePresent=6]="ePresent"}(i=e.EventIconState||(e.EventIconState={})),function(e){e[e.Invalid=0]="Invalid",e[e.eVarInput=1]="eVarInput",e[e.eParameter=2]="eParameter"}(n=e.ProcessSignalSource||(e.ProcessSignalSource={})),function(e){e[e.Invalid=0]="Invalid",e[e.eSimple=1]="eSimple",e[e.eStandard=2]="eStandard",e[e.eExtended=3]="eExtended",e[e.First=1]="First",e[e.Last=3]="Last",e[e.Count=3]="Count"}(s=e.AlarmMode||(e.AlarmMode={})),function(e){e[e.Invalid=0]="Invalid",e[e.Undefined=1]="Undefined",e[e.eAnalogInput=10]="eAnalogInput",e[e.eAnalogOutput=11]="eAnalogOutput",e[e.eAnalogValue=12]="eAnalogValue",e[e.eBinaryInput=15]="eBinaryInput",e[e.eBinaryOutput=16]="eBinaryOutput",e[e.eBinaryValue=17]="eBinaryValue",e[e.eMultiStateInput=20]="eMultiStateInput",e[e.eMultiStateOutput=21]="eMultiStateOutput",e[e.eMultiStateValue=22]="eMultiStateValue",e[e.eObject=25]="eObject",e[e.eStructuredView=26]="eStructuredView",e[e.eProject=27]="eProject",e[e.eEventClass=28]="eEventClass",e[e.eCalendar=29]="eCalendar",e[e.eSchedule=30]="eSchedule",e[e.eLoop=31]="eLoop",e[e.eTrend=32]="eTrend"}(r=e.ObjectType||(e.ObjectType={})),function(e){e[e.Invalid=0]="Invalid",e[e.eNoLock=1]="eNoLock",e[e.eLocalMedium=2]="eLocalMedium",e[e.eLocalHigh=3]="eLocalHigh",e[e.eMedium=4]="eMedium",e[e.eHigh=5]="eHigh"}(o=e.LockPriority||(e.LockPriority={})),function(e){e[e.Invalid=0]="Invalid",e[e.eDefault=1]="eDefault",e[e.eProgram=2]="eProgram",e[e.eManualRemote=3]="eManualRemote",e[e.eManualLocal=4]="eManualLocal",e[e.eCritical=5]="eCritical",e[e.eLifeSafety=6]="eLifeSafety"}(l=e.Priority||(e.Priority={})),function(e){e[e.Invalid=0]="Invalid",e[e.eNone=1]="eNone",e[e.eStandard=2]="eStandard",e[e.eManual=3]="eManual",e[e.ePrioritized=4]="ePrioritized"}(d=e.ParamCOVMode||(e.ParamCOVMode={})),function(e){e[e.Invalid=0]="Invalid",e[e.eFix=1]="eFix",e[e.eTab=2]="eTab",e[e.eMaxIndc=3]="eMaxIndc"}(_=e.PosMod||(e.PosMod={})),function(e){e[e.Invalid=0]="Invalid",e[e.eTetragon=1]="eTetragon",e[e.eGlobe=2]="eGlobe"}(h=e.ShdObjType||(e.ShdObjType={})),function(e){e[e.Invalid=0]="Invalid",e[e.Unspecified=255]="Unspecified",e[e.eJanuary=1]="eJanuary",e[e.eFebruary=2]="eFebruary",e[e.eMarch=3]="eMarch",e[e.eApril=4]="eApril",e[e.eMay=5]="eMay",e[e.eJune=6]="eJune",e[e.eJuly=7]="eJuly",e[e.eAugust=8]="eAugust",e[e.eSeptember=9]="eSeptember",e[e.eOctober=10]="eOctober",e[e.eNovember=11]="eNovember",e[e.eDecember=12]="eDecember",e[e.odd=13]="odd",e[e.even=14]="even"}(c=e.Month||(e.Month={})),function(e){e[e.Invalid=0]="Invalid",e[e.Unspecified=255]="Unspecified",e[e.eDay01=1]="eDay01",e[e.eDay02=2]="eDay02",e[e.eDay03=3]="eDay03",e[e.eDay04=4]="eDay04",e[e.eDay05=5]="eDay05",e[e.eDay06=6]="eDay06",e[e.eDay07=7]="eDay07",e[e.eDay08=8]="eDay08",e[e.eDay09=9]="eDay09",e[e.eDay10=10]="eDay10",e[e.eDay11=11]="eDay11",e[e.eDay12=12]="eDay12",e[e.eDay13=13]="eDay13",e[e.eDay14=14]="eDay14",e[e.eDay15=15]="eDay15",e[e.eDay16=16]="eDay16",e[e.eDay17=17]="eDay17",e[e.eDay18=18]="eDay18",e[e.eDay19=19]="eDay19",e[e.eDay20=20]="eDay20",e[e.eDay21=21]="eDay21",e[e.eDay22=22]="eDay22",e[e.eDay23=23]="eDay23",e[e.eDay24=24]="eDay24",e[e.eDay25=25]="eDay25",e[e.eDay26=26]="eDay26",e[e.eDay27=27]="eDay27",e[e.eDay28=28]="eDay28",e[e.eDay29=29]="eDay29",e[e.eDay30=30]="eDay30",e[e.eDay31=31]="eDay31",e[e.eLastDayOfMonth=32]="eLastDayOfMonth",e[e.eOddDaysOfMonth=33]="eOddDaysOfMonth",e[e.eEvenDaysOfMonth=34]="eEvenDaysOfMonth"}(u=e.Day||(e.Day={})),function(e){e[e.Invalid=0]="Invalid",e[e.Unspecified=255]="Unspecified",e[e.eMonday=1]="eMonday",e[e.eTuesday=2]="eTuesday",e[e.eWednesday=3]="eWednesday",e[e.eThursday=4]="eThursday",e[e.eFriday=5]="eFriday",e[e.eSaturday=6]="eSaturday",e[e.eSunday=7]="eSunday"}(g=e.Weekday||(e.Weekday={})),function(e){e[e.Invalid=0]="Invalid",e[e.Unspecified=255]="Unspecified",e[e.eWeek1=1]="eWeek1",e[e.eWeek2=2]="eWeek2",e[e.eWeek3=3]="eWeek3",e[e.eWeek4=4]="eWeek4",e[e.eWeek5=5]="eWeek5"}(p=e.Week||(e.Week={})),function(e){e[e.Invalid=0]="Invalid",e[e.eDate=1]="eDate",e[e.eDateRange=2]="eDateRange",e[e.eWeekNDay=3]="eWeekNDay"}(v=e.DateValChoice||(e.DateValChoice={})),function(e){e[e.Invalid=0]="Invalid",e[e.eUndefined=1]="eUndefined",e[e.eValue=2]="eValue",e[e.eNull=3]="eNull"}(m=e.SchedEntryState||(e.SchedEntryState={})),function(e){e[e.eUndefined=0]="eUndefined",e[e.eInternal=1]="eInternal",e[e.eStructurize=2]="eStructurize",e[e.eDescriptive=3]="eDescriptive",e[e.eGeneral=10]="eGeneral",e[e.eOperation=11]="eOperation",e[e.eRawInput=12]="eRawInput",e[e.eRawOutput=13]="eRawOutput",e[e.eManagement=20]="eManagement",e[e.eAggregate=21]="eAggregate"}(b=e.ObjectPurpose||(e.ObjectPurpose={})),function(e){e[e.eOutOfService=1]="eOutOfService",e[e.eOverridden=2]="eOverridden"}(y=e.ObjectStateFlags||(e.ObjectStateFlags={})),function(e){e[e.Invalid=-1]="Invalid",e[e.eArea_SquareMeters=0]="eArea_SquareMeters",e[e.eArea_SquareFeet=1]="eArea_SquareFeet",e[e.eElectrical_Milliamperes=2]="eElectrical_Milliamperes",e[e.eElectrical_Amperes=3]="eElectrical_Amperes",e[e.eElectrical_Ohms=4]="eElectrical_Ohms",e[e.eElectrical_Volts=5]="eElectrical_Volts",e[e.eElectrical_Kilovolts=6]="eElectrical_Kilovolts",e[e.eElectrical_Megavolts=7]="eElectrical_Megavolts",e[e.eElectrical_VoltAmperes=8]="eElectrical_VoltAmperes",e[e.eElectrical_KilovoltAmperes=9]="eElectrical_KilovoltAmperes",e[e.eElectrical_MegavoltAmperes=10]="eElectrical_MegavoltAmperes",e[e.eElectrical_VoltAmperesReactive=11]="eElectrical_VoltAmperesReactive",e[e.eElectrical_KilovoltAmperesReactive=12]="eElectrical_KilovoltAmperesReactive",e[e.eElectrical_MegavoltAmperesReactive=13]="eElectrical_MegavoltAmperesReactive",e[e.eElectrical_DegreesPhase=14]="eElectrical_DegreesPhase",e[e.eElectrical_PowerFactor=15]="eElectrical_PowerFactor",e[e.eEnergy_Joules=16]="eEnergy_Joules",e[e.eEnergy_Kilojoules=17]="eEnergy_Kilojoules",e[e.eEnergy_WattHours=18]="eEnergy_WattHours",e[e.eEnergy_KilowattHours=19]="eEnergy_KilowattHours",e[e.eEnergy_Btus=20]="eEnergy_Btus",e[e.eEnergy_Therms=21]="eEnergy_Therms",e[e.eEnergy_TonHours=22]="eEnergy_TonHours",e[e.eEnthalpy_JoulesPerKilogramDryAir=23]="eEnthalpy_JoulesPerKilogramDryAir",e[e.eEnthalpy_BtusPerPoundDryAir=24]="eEnthalpy_BtusPerPoundDryAir",e[e.eFrequency_CyclesPerHour=25]="eFrequency_CyclesPerHour",e[e.eFrequency_CyclesPerMinute=26]="eFrequency_CyclesPerMinute",e[e.eFrequency_Hertz=27]="eFrequency_Hertz",e[e.eHumidity_GramsOfWaterPerKilogramDryAir=28]="eHumidity_GramsOfWaterPerKilogramDryAir",e[e.eHumidity_PercentRelativeHumidity=29]="eHumidity_PercentRelativeHumidity",e[e.eLength_Millimeters=30]="eLength_Millimeters",e[e.eLength_Meters=31]="eLength_Meters",e[e.eLength_Inches=32]="eLength_Inches",e[e.eLength_Feet=33]="eLength_Feet",e[e.eLight_WattsPerSquareFoot=34]="eLight_WattsPerSquareFoot",e[e.eLight_WattsPerSquareMeter=35]="eLight_WattsPerSquareMeter",e[e.eLight_Lumens=36]="eLight_Lumens",e[e.eLight_Luxes=37]="eLight_Luxes",e[e.eLight_FootCandles=38]="eLight_FootCandles",e[e.eMass_Kilograms=39]="eMass_Kilograms",e[e.eMass_PoundsMass=40]="eMass_PoundsMass",e[e.eMass_Tons=41]="eMass_Tons",e[e.eMassFlow_KilogramsPerSecond=42]="eMassFlow_KilogramsPerSecond",e[e.eMassFlow_KilogramsPerMinute=43]="eMassFlow_KilogramsPerMinute",e[e.eMassFlow_KilogramsPerHour=44]="eMassFlow_KilogramsPerHour",e[e.eMassFlow_PoundsMassPerMinute=45]="eMassFlow_PoundsMassPerMinute",e[e.eMassFlow_PoundsMassPerHour=46]="eMassFlow_PoundsMassPerHour",e[e.ePower_Watts=47]="ePower_Watts",e[e.ePower_Kilowatts=48]="ePower_Kilowatts",e[e.ePower_Megawatts=49]="ePower_Megawatts",e[e.ePower_BtusPerHour=50]="ePower_BtusPerHour",e[e.ePower_Horsepower=51]="ePower_Horsepower",e[e.ePower_TonsRefrigeration=52]="ePower_TonsRefrigeration",e[e.ePressure_Pascals=53]="ePressure_Pascals",e[e.ePressure_Kilopascals=54]="ePressure_Kilopascals",e[e.ePressure_Bars=55]="ePressure_Bars",e[e.ePressure_PoundsForcePerSquareInch=56]="ePressure_PoundsForcePerSquareInch",e[e.ePressure_CentimetersOfWater=57]="ePressure_CentimetersOfWater",e[e.ePressure_InchesOfWater=58]="ePressure_InchesOfWater",e[e.ePressure_MillimetersOfMercury=59]="ePressure_MillimetersOfMercury",e[e.ePressure_CentimetersOfMercury=60]="ePressure_CentimetersOfMercury",e[e.ePressure_InchesOfMercury=61]="ePressure_InchesOfMercury",e[e.eTemperature_DegreesCelsius=62]="eTemperature_DegreesCelsius",e[e.eTemperature_DegreesKelvin=63]="eTemperature_DegreesKelvin",e[e.eTemperature_DegreesFahrenheit=64]="eTemperature_DegreesFahrenheit",e[e.eTemperature_DegreeDaysCelsius=65]="eTemperature_DegreeDaysCelsius",e[e.eTemperature_DegreeDaysFahrenheit=66]="eTemperature_DegreeDaysFahrenheit",e[e.eTime_Years=67]="eTime_Years",e[e.eTime_Months=68]="eTime_Months",e[e.eTime_Weeks=69]="eTime_Weeks",e[e.eTime_Days=70]="eTime_Days",e[e.eTime_Hours=71]="eTime_Hours",e[e.eTime_Minutes=72]="eTime_Minutes",e[e.eTime_Seconds=73]="eTime_Seconds",e[e.eVelocity_MetersPerSecond=74]="eVelocity_MetersPerSecond",e[e.eVelocity_KilometersPerHour=75]="eVelocity_KilometersPerHour",e[e.eVelocity_FeetPerSecond=76]="eVelocity_FeetPerSecond",e[e.eVelocity_FeetPerMinute=77]="eVelocity_FeetPerMinute",e[e.eVelocity_MilesPerHour=78]="eVelocity_MilesPerHour",e[e.eVolume_CubicFeet=79]="eVolume_CubicFeet",e[e.eVolume_CubicMeters=80]="eVolume_CubicMeters",e[e.eVolume_ImperialGallons=81]="eVolume_ImperialGallons",e[e.eVolume_Liters=82]="eVolume_Liters",e[e.eVolume_UsGallons=83]="eVolume_UsGallons",e[e.eVolumetricFlow_CubicFeetPerMinute=84]="eVolumetricFlow_CubicFeetPerMinute",e[e.eVolumetricFlow_CubicMetersPerSecond=85]="eVolumetricFlow_CubicMetersPerSecond",e[e.eVolumetricFlow_ImperialGallonsPerMinute=86]="eVolumetricFlow_ImperialGallonsPerMinute",e[e.eVolumetricFlow_LitersPerSecond=87]="eVolumetricFlow_LitersPerSecond",e[e.eVolumetricFlow_LitersPerMinute=88]="eVolumetricFlow_LitersPerMinute",e[e.eVolumetricFlow_UsGallonsPerMinute=89]="eVolumetricFlow_UsGallonsPerMinute",e[e.eOther_DegreesAngular=90]="eOther_DegreesAngular",e[e.eOther_DegreesCelsiusPerHour=91]="eOther_DegreesCelsiusPerHour",e[e.eOther_DegreesCelsiusPerMinute=92]="eOther_DegreesCelsiusPerMinute",e[e.eOther_DegreesFahrenheitPerHour=93]="eOther_DegreesFahrenheitPerHour",e[e.eOther_DegreesFahrenheitPerMinute=94]="eOther_DegreesFahrenheitPerMinute",e[e.eOther_NoUnits=95]="eOther_NoUnits",e[e.eOther_PartsPerMillion=96]="eOther_PartsPerMillion",e[e.eOther_PartsPerBillion=97]="eOther_PartsPerBillion",e[e.eOther_Percent=98]="eOther_Percent",e[e.eOther_PercentPerSecond=99]="eOther_PercentPerSecond",e[e.eOther_PerMinute=100]="eOther_PerMinute",e[e.eOther_PerSecond=101]="eOther_PerSecond",e[e.eOther_PsiPerDegreeFahrenheit=102]="eOther_PsiPerDegreeFahrenheit",e[e.eOther_Radians=103]="eOther_Radians",e[e.eOther_RevolutionsPerMinute=104]="eOther_RevolutionsPerMinute",e[e.eCurrency_Currency1=105]="eCurrency_Currency1",e[e.eCurrency_Currency2=106]="eCurrency_Currency2",e[e.eCurrency_Currency3=107]="eCurrency_Currency3",e[e.eCurrency_Currency4=108]="eCurrency_Currency4",e[e.eCurrency_Currency5=109]="eCurrency_Currency5",e[e.eCurrency_Currency6=110]="eCurrency_Currency6",e[e.eCurrency_Currency7=111]="eCurrency_Currency7",e[e.eCurrency_Currency8=112]="eCurrency_Currency8",e[e.eCurrency_Currency9=113]="eCurrency_Currency9",e[e.eCurrency_Currency10=114]="eCurrency_Currency10",e[e.eArea_SquareInches=115]="eArea_SquareInches",e[e.eArea_SquareCentimeters=116]="eArea_SquareCentimeters",e[e.eEnthalpy_BtusPerPound=117]="eEnthalpy_BtusPerPound",e[e.eLength_Centimeters=118]="eLength_Centimeters",e[e.eMassFlow_PoundsMassPerSecond=119]="eMassFlow_PoundsMassPerSecond",e[e.eTemperature_DeltaDegreesFahrenheit=120]="eTemperature_DeltaDegreesFahrenheit",e[e.eTemperature_DeltaDegreesKelvin=121]="eTemperature_DeltaDegreesKelvin",e[e.eElectrical_Kilohms=122]="eElectrical_Kilohms",e[e.eElectrical_Megohms=123]="eElectrical_Megohms",e[e.eElectrical_Millivolts=124]="eElectrical_Millivolts",e[e.eEnergy_KilojoulesPerKilogram=125]="eEnergy_KilojoulesPerKilogram",e[e.eEnergy_Megajoules=126]="eEnergy_Megajoules",e[e.eEntropy_JoulesPerDegreeKelvin=127]="eEntropy_JoulesPerDegreeKelvin",e[e.eEntropy_JoulesPerKilogramDegreeKelvin=128]="eEntropy_JoulesPerKilogramDegreeKelvin",e[e.eFrequency_Kilohertz=129]="eFrequency_Kilohertz",e[e.eFrequency_Megahertz=130]="eFrequency_Megahertz",e[e.eFrequency_PerHour=131]="eFrequency_PerHour",e[e.ePower_Milliwatts=132]="ePower_Milliwatts",e[e.ePressure_Hectopascals=133]="ePressure_Hectopascals",e[e.ePressure_Millibars=134]="ePressure_Millibars",e[e.eVolumetricFlow_CubicMetersPerHour=135]="eVolumetricFlow_CubicMetersPerHour",e[e.eVolumetricFlow_LitersPerHour=136]="eVolumetricFlow_LitersPerHour",e[e.eOther_KilowattHoursPerSquareMeter=137]="eOther_KilowattHoursPerSquareMeter",e[e.eOther_KilowattHoursPerSquareFoot=138]="eOther_KilowattHoursPerSquareFoot",e[e.eOther_MegajoulesPerSquareMeter=139]="eOther_MegajoulesPerSquareMeter",e[e.eOther_MegajoulesPerSquareFoot=140]="eOther_MegajoulesPerSquareFoot",e[e.eOther_WattsPerSquareMeterDegreeKelvin=141]="eOther_WattsPerSquareMeterDegreeKelvin",e[e.eVolumetricFlow_CubicFeetPerSecond=142]="eVolumetricFlow_CubicFeetPerSecond",e[e.eOther_PercentObscurationPerFoot=143]="eOther_PercentObscurationPerFoot",e[e.eOther_PercentObscurationPerMeter=144]="eOther_PercentObscurationPerMeter",e[e.eElectrical_Milliohms=145]="eElectrical_Milliohms",e[e.eEnergy_MegawattHours=146]="eEnergy_MegawattHours",e[e.eEnergy_KiloBtus=147]="eEnergy_KiloBtus",e[e.eEnergy_MegaBtus=148]="eEnergy_MegaBtus",e[e.eEnthalpy_KilojoulesPerKilogramDryAir=149]="eEnthalpy_KilojoulesPerKilogramDryAir",e[e.eEnthalpy_MegajoulesPerKilogramDryAir=150]="eEnthalpy_MegajoulesPerKilogramDryAir",e[e.eEntropy_KilojoulesPerDegreeKelvin=151]="eEntropy_KilojoulesPerDegreeKelvin",e[e.eEntropy_MegajoulesPerDegreeKelvin=152]="eEntropy_MegajoulesPerDegreeKelvin",e[e.eForce_Newton=153]="eForce_Newton",e[e.eMassFlow_GramsPerSecond=154]="eMassFlow_GramsPerSecond",e[e.eMassFlow_GramsPerMinute=155]="eMassFlow_GramsPerMinute",e[e.eMassFlow_TonsPerHour=156]="eMassFlow_TonsPerHour",e[e.ePower_KiloBtusPerHour=157]="ePower_KiloBtusPerHour",e[e.eTime_HundredthsSeconds=158]="eTime_HundredthsSeconds",e[e.eTime_Milliseconds=159]="eTime_Milliseconds",e[e.eTorque_NewtonMeters=160]="eTorque_NewtonMeters",e[e.eVelocity_MillimetersPerSecond=161]="eVelocity_MillimetersPerSecond",e[e.eVelocity_MillimetersPerMinute=162]="eVelocity_MillimetersPerMinute",e[e.eVelocity_MetersPerMinute=163]="eVelocity_MetersPerMinute",e[e.eVelocity_MetersPerHour=164]="eVelocity_MetersPerHour",e[e.eVolumetricFlow_CubicMetersPerMinute=165]="eVolumetricFlow_CubicMetersPerMinute",e[e.eAcceleration_MetersPerSecondPerSecond=166]="eAcceleration_MetersPerSecondPerSecond",e[e.eElectrical_AmperesPerMeter=167]="eElectrical_AmperesPerMeter",e[e.eElectrical_AmperesPerSquareMeter=168]="eElectrical_AmperesPerSquareMeter",e[e.eElectrical_AmpereSquareMeters=169]="eElectrical_AmpereSquareMeters",e[e.eElectrical_Farads=170]="eElectrical_Farads",e[e.eElectrical_Henrys=171]="eElectrical_Henrys",e[e.eElectrical_OhmMeters=172]="eElectrical_OhmMeters",e[e.eElectrical_Siemens=173]="eElectrical_Siemens",e[e.eElectrical_SiemensPerMeter=174]="eElectrical_SiemensPerMeter",e[e.eElectrical_Teslas=175]="eElectrical_Teslas",e[e.eElectrical_VoltsPerDegreeKelvin=176]="eElectrical_VoltsPerDegreeKelvin",e[e.eElectrical_VoltsPerMeter=177]="eElectrical_VoltsPerMeter",e[e.eElectrical_Webers=178]="eElectrical_Webers",e[e.eLight_Candelas=179]="eLight_Candelas",e[e.eLight_CandelasPerSquareMeter=180]="eLight_CandelasPerSquareMeter",e[e.eTemperature_DegreesKelvinPerHour=181]="eTemperature_DegreesKelvinPerHour",e[e.eTemperature_DegreesKelvinPerMinute=182]="eTemperature_DegreesKelvinPerMinute",e[e.eOther_JouleSeconds=183]="eOther_JouleSeconds",e[e.eOther_RadiansPerSecond=184]="eOther_RadiansPerSecond",e[e.eOther_SquareMetersPerNewton=185]="eOther_SquareMetersPerNewton",e[e.eOther_KilogramsPerCubicMeter=186]="eOther_KilogramsPerCubicMeter",e[e.eOther_NewtonSeconds=187]="eOther_NewtonSeconds",e[e.eOther_NewtonsPerMeter=188]="eOther_NewtonsPerMeter",e[e.eOther_WattsPerMeterPerDegreeKelvin=189]="eOther_WattsPerMeterPerDegreeKelvin",e[e.eMicro_Siemens=190]="eMicro_Siemens",e[e.eCubic_FeetPerHour=191]="eCubic_FeetPerHour",e[e.eUs_GallonsPerHour=192]="eUs_GallonsPerHour",e[e.eKilometers=193]="eKilometers",e[e.eMicrometers=194]="eMicrometers",e[e.eGrams=195]="eGrams",e[e.eMilligrams=196]="eMilligrams",e[e.eMilliliters=197]="eMilliliters",e[e.eMillilitersPerSecond=198]="eMillilitersPerSecond",e[e.eDecibels=199]="eDecibels",e[e.eDecibelsMillivolt=200]="eDecibelsMillivolt",e[e.eDecibelsVolt=201]="eDecibelsVolt",e[e.eMillisiemens=202]="eMillisiemens",e[e.eWatt_HoursReactive=203]="eWatt_HoursReactive",e[e.eKilowattHoursReactive=204]="eKilowattHoursReactive",e[e.eMegawattHoursReactive=205]="eMegawattHoursReactive",e[e.eMillimetersOfWater=206]="eMillimetersOfWater",e[e.ePer_Mille=207]="ePer_Mille",e[e.eGrams_PerGram=208]="eGrams_PerGram",e[e.eKilograms_PerKilogram=209]="eKilograms_PerKilogram",e[e.eGrams_PerKilogram=210]="eGrams_PerKilogram",e[e.eMilligrams_PeGram=211]="eMilligrams_PeGram",e[e.eMilligrams_PeKilogram=212]="eMilligrams_PeKilogram",e[e.eGrams_PerMilliliter=213]="eGrams_PerMilliliter",e[e.eGrams_PerLiter=214]="eGrams_PerLiter",e[e.eMilligrams_PerLiter=215]="eMilligrams_PerLiter",e[e.eMicrograms_PerLiter=216]="eMicrograms_PerLiter",e[e.eGrams_PerCubicMeter=217]="eGrams_PerCubicMeter",e[e.eMilligrams_PerCubicMeter=218]="eMilligrams_PerCubicMeter",e[e.eMicrograms_PerCubicMeter=219]="eMicrograms_PerCubicMeter",e[e.eNanograms_PerCubicMeter=220]="eNanograms_PerCubicMeter",e[e.eGrams_PerCubicCentimeter=221]="eGrams_PerCubicCentimeter",e[e.eBecquerels=222]="eBecquerels",e[e.eKilobecquerels=223]="eKilobecquerels",e[e.eMegabecquerels=224]="eMegabecquerels",e[e.eGray=225]="eGray",e[e.eMilligray=226]="eMilligray",e[e.eMicrogray=227]="eMicrogray",e[e.eSieverts=228]="eSieverts",e[e.eMillisieverts=229]="eMillisieverts",e[e.eMicrosieverts=230]="eMicrosieverts",e[e.eMicrosievertsPerHour=231]="eMicrosievertsPerHour",e[e.eDecibels_A=232]="eDecibels_A",e[e.eNephelometric_TurbidityUnit=233]="eNephelometric_TurbidityUnit",e[e.ePH=234]="ePH",e[e.eGrams_PerSquareMeter=235]="eGrams_PerSquareMeter",e[e.eMinutes_PerDegreeKelvin=236]="eMinutes_PerDegreeKelvin"}(f=e.Unit||(e.Unit={})),function(e){e[e.Undefined=0]="Undefined",e[e.eGuest=1]="eGuest",e[e.eBasic=2]="eBasic",e[e.eAdvanced=3]="eAdvanced",e[e.eExpert=4]="eExpert",e[e.eInternal=5]="eInternal",e[e.eLocked=6]="eLocked"}(D=e.Role||(e.Role={})),function(e){e[e.read=0]="read",e[e.write=1]="write"}(C=e.Scope||(e.Scope={})),function(e){e[e.Invalid=0]="Invalid",e[e.eConfigurate=1]="eConfigurate",e[e.eToggleMode=2]="eToggleMode",e[e.eStepDelay=3]="eStepDelay",e[e.eCovIncrement=4]="eCovIncrement",e[e.eAction=5]="eAction",e[e.eMinOffTime=6]="eMinOffTime",e[e.eMinOnTime=7]="eMinOnTime",e[e.eStateChangeCount=11]="eStateChangeCount",e[e.eStateChangeTime=12]="eStateChangeTime",e[e.eStateChangeResetPoint=13]="eStateChangeResetPoint",e[e.eActiveTimeElapsed=14]="eActiveTimeElapsed",e[e.eActiveTimeResetPoint=15]="eActiveTimeResetPoint",e[e.eEventChangeTime=16]="eEventChangeTime",e[e.eInstructionText=20]="eInstructionText",e[e.eAckedTransitions=21]="eAckedTransitions",e[e.eAcknowledgeRm=22]="eAcknowledgeRm",e[e.eEnPlantLock=23]="eEnPlantLock",e[e.eAlarmValue=24]="eAlarmValue",e[e.eAlarmValues=25]="eAlarmValues",e[e.eFaultValues=26]="eFaultValues",e[e.eTimeDelay=27]="eTimeDelay",e[e.eLowLimit=28]="eLowLimit",e[e.eHighLimit=29]="eHighLimit",e[e.eLimitDeadband=30]="eLimitDeadband",e[e.eEventDetectionEnable=31]="eEventDetectionEnable",e[e.eEventEnable=32]="eEventEnable",e[e.eEventClassID=33]="eEventClassID",e[e.eEventMessage=34]="eEventMessage",e[e.eEventMessageFormat=35]="eEventMessageFormat",e[e.eEventTransitionText=36]="eEventTransitionText",e[e.eEventState=37]="eEventState",e[e.eStatusFlags=38]="eStatusFlags",e[e.eReliability=39]="eReliability",e[e.eEventAlgorithmInhibit=40]="eEventAlgorithmInhibit",e[e.eEnable=45]="eEnable",e[e.eOutOfService=46]="eOutOfService",e[e.eTrigger=47]="eTrigger",e[e.eInactiveText=55]="eInactiveText",e[e.eActiveText=56]="eActiveText",e[e.eStateText=57]="eStateText",e[e.eStateCount=58]="eStateCount",e[e.eUnit=59]="eUnit",e[e.ePresentValue=60]="ePresentValue",e[e.eDefaultValue=61]="eDefaultValue",e[e.eTag=62]="eTag",e[e.eAssignAsTrendReference=63]="eAssignAsTrendReference",e[e.eDeviceType=80]="eDeviceType",e[e.ePolarity=81]="ePolarity",e[e.eMappingMode=82]="eMappingMode",e[e.eFeedbackMappingMode=83]="eFeedbackMappingMode",e[e.eFeedbackPolarity=84]="eFeedbackPolarity",e[e.eOverriddenPolarity=85]="eOverriddenPolarity",e[e.eScaleOffset=86]="eScaleOffset",e[e.eResolution=87]="eResolution",e[e.eFeedbackValue=88]="eFeedbackValue",e[e.eRawValue=89]="eRawValue",e[e.eRawFeedback=90]="eRawFeedback",e[e.eRawOverride=91]="eRawOverride",e[e.eRawState=92]="eRawState",e[e.eTerminal=93]="eTerminal",e[e.eSensor=94]="eSensor",e[e.eAddress=95]="eAddress",e[e.eCommissioningState=96]="eCommissioningState",e[e.eSymbolPath=105]="eSymbolPath",e[e.eSymbolName=106]="eSymbolName",e[e.eInstanceID=107]="eInstanceID",e[e.eObjectName=108]="eObjectName",e[e.eDescription=109]="eDescription",e[e.eObjectType=110]="eObjectType",e[e.ePurpose=111]="ePurpose",e[e.eNodeType=112]="eNodeType",e[e.ePriorityArray=120]="ePriorityArray",e[e.eActivePriority=121]="eActivePriority",e[e.eProjectInfo=124]="eProjectInfo",e[e.eOperatorInfo=125]="eOperatorInfo",e[e.eTechnicalStaffInfo=126]="eTechnicalStaffInfo",e[e.eEngineerInfo=127]="eEngineerInfo",e[e.eRebuildSegments=134]="eRebuildSegments",e[e.eDateList=137]="eDateList",e[e.eEventType=140]="eEventType",e[e.eAlarmMode=141]="eAlarmMode",e[e.ePriority=142]="ePriority",e[e.eAcknowledgeRequired=143]="eAcknowledgeRequired",e[e.eSetpoint=145]="eSetpoint",e[e.eControlledValue=146]="eControlledValue",e[e.eCtrlDeviation=147]="eCtrlDeviation",e[e.eProportionalConstant=148]="eProportionalConstant",e[e.eIntegralConstant=149]="eIntegralConstant",e[e.eDerivativeConstant=150]="eDerivativeConstant",e[e.eDampConstant=151]="eDampConstant",e[e.eOutputUnit=152]="eOutputUnit",e[e.eOpMode=153]="eOpMode",e[e.eNeutralZone=154]="eNeutralZone",e[e.eSynchronizedLoop=155]="eSynchronizedLoop",e[e.eMinOutput=156]="eMinOutput",e[e.eMaxOutput=157]="eMaxOutput",e[e.eWeek=160]="eWeek",e[e.eCalendar=161]="eCalendar",e[e.eException=162]="eException",e[e.eReferencedParam=165]="eReferencedParam",e[e.eBufferSize=166]="eBufferSize",e[e.eLogBuffer=167]="eLogBuffer",e[e.eLoggingType=168]="eLoggingType",e[e.eLogInterval=169]="eLogInterval",e[e.eStartTime=170]="eStartTime",e[e.eStopTime=171]="eStopTime",e[e.eStopOnFull=172]="eStopOnFull",e[e.eNotificationThreshold=173]="eNotificationThreshold",e[e.eRecordCount=174]="eRecordCount",e[e.eTotalRecordCount=175]="eTotalRecordCount",e[e.eInstObjectName=1e3]="eInstObjectName",e[e.eInstDescription=1001]="eInstDescription",e[e.eActiveEvent=1002]="eActiveEvent",e[e.Additional=2e3]="Additional",e[e.eEnManualRm=1500]="eEnManualRm",e[e.eValManualRm=1501]="eValManualRm"}(H=e.BaParameterId||(e.BaParameterId={})),function(e){e[e.Invalid=-1]="Invalid",e[e.eNone=0]="eNone",e[e.eSetpoint=1]="eSetpoint",e[e.eDisplayValue=2]="eDisplayValue"}(w=e.OperationType||(e.OperationType={})),function(e){e[e.Undefined=0]="Undefined",e[e.eUnknown=10]="eUnknown",e[e.eOther=11]="eOther",e[e.eGeneral=12]="eGeneral",e[e.eLocation=13]="eLocation",e[e.eBuilding=14]="eBuilding",e[e.eBuildingElement=15]="eBuildingElement",e[e.eInformationFocus=16]="eInformationFocus",e[e.eControlCabinet=17]="eControlCabinet",e[e.eTrade=18]="eTrade",e[e.eFloor=19]="eFloor",e[e.eRoom=20]="eRoom",e[e.ePlant=21]="ePlant",e[e.eComponent=22]="eComponent",e[e.eAggregate=23]="eAggregate",e[e.eFunction=24]="eFunction"}(S=e.NodeType||(e.NodeType={})),function(e){let t;!function(e){e[e.Invalid=0]="Invalid",e[e.en_US=1]="en_US",e[e.de_DE=2]="de_DE"}(t=e.EChoice||(e.EChoice={}))}(T=e.LanguageManager||(e.LanguageManager={}))}(t=e.BA||(e.BA={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(e){let t;!function(t){function a(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("ObjectType","number"),i.set("InstanceID","number"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}function i(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("bVal","boolean"),i.set("rVal","number"),i.set("udiVal","number"),i.set("bByteVal","array"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}function n(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("nHour","number"),i.set("nMinute","number"),i.set("nSecond","number"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}function s(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("nYear","number"),i.set("eMonth","number"),i.set("nDay","number"),i.set("eDayOfWeek","number"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}t.isBaScope=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("Read","number"),i.set("Write","number"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},t.isBaIdentifier=a,t.isBaIdentifierEx=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("instancePath","string"),i.set("deviceName","string"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},t.isBaSubjectInfo=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("Identifier","string"),i.set("Index","number"),i.set("Hash","number"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},t.isBaObjectParameterAttributes=function(i){let n=!0;if(null!=i&&"object"==typeof i){let s=new Map;s.set("ReferenceObject",t.BaBasicObject.isIBaBasicObjectAttributes),s.set("ReferenceObjectIdentifier",a),s.set("ReferencedParameter",["string","number"]),s.set("OwnerObject",t.BaBasicObject.isIBaBasicObjectAttributes),e.TypeGuards.validateProperties(i,s)||(n=!1)}else n=!1;return n},t.isClassValue=i,t.getDefaultClassValue=function(){return{bVal:!1,rVal:0,udiVal:0}},t.isStatusFlagBits=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("InAlarm","boolean"),i.set("Fault","boolean"),i.set("Overridden","boolean"),i.set("OutOfService","boolean"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},t.isBaTime=n,t.isBaDate=s,t.isBaDateTime=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("stDate",s),i.set("stTime",n),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},t.isSchedEntry=function(t){let a=!0;if(null!=t&&"object"==typeof t){let s=new Map;s.set("eState","number"),s.set("stTime",n),s.set("uValue",i),e.TypeGuards.validateProperties(t,s)||(a=!1)}else a=!1;return a}}(t=e.BA||(e.BA={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(e){let t,a,i,n,s;!function(e){e[e.left=0]="left",e[e.top=1]="top",e[e.right=2]="right",e[e.bottom=3]="bottom"}(t=e.Position||(e.Position={})),e.isPosition=function(e){return"number"==typeof e&&(e>=t.left&&e<=t.bottom)},function(e){e[e.topRight=0]="topRight",e[e.bottomRight=1]="bottomRight",e[e.bottomLeft=2]="bottomLeft",e[e.topLeft=3]="topLeft"}(a=e.CornerPosition||(e.CornerPosition={})),e.isCornerPosition=function(e){return"number"==typeof e&&(e>=a.topLeft&&e<=a.bottomLeft)},function(e){e[e.vertical=0]="vertical",e[e.horizontal=1]="horizontal"}(i=e.Orientation||(e.Orientation={})),function(e){e[e.invalid=-1]="invalid",e[e.unknown=0]="unknown",e[e.string=1]="string",e[e.number=2]="number",e[e.integer=3]="integer",e[e.boolean=4]="boolean",e[e.object=5]="object",e[e.array=6]="array",e[e.enum=7]="enum",e[e.dateTime=8]="dateTime"}(n=e.DataType||(e.DataType={})),function(e){e[e.Collapsed=0]="Collapsed",e[e.Hidden=1]="Hidden",e[e.Visible=2]="Visible"}(s=e.Visibility||(e.Visibility={})),e.isFourSidedString=function(t){if(null==t||"object"!=typeof t)return!1;{let a=new Map;if(a.set("top","string"),a.set("right","string"),a.set("bottom","string"),a.set("left","string"),!e.TypeGuards.validateProperties(t,a))return!1}return!0}}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){let t,a;!function(t){t.BaDomainName="BaSite",t.BaProjectStructureName="Top",t.PrimitveBaObjects=[e.BA.ObjectType.eAnalogInput,e.BA.ObjectType.eAnalogOutput,e.BA.ObjectType.eAnalogValue,e.BA.ObjectType.eBinaryInput,e.BA.ObjectType.eBinaryOutput,e.BA.ObjectType.eBinaryValue,e.BA.ObjectType.eMultiStateInput,e.BA.ObjectType.eMultiStateOutput,e.BA.ObjectType.eMultiStateValue,e.BA.ObjectType.eSchedule,e.BA.ObjectType.eLoop],t.ImplementedNonPrimitiveValues=[e.BA.BaParameterId.eStateText,e.BA.BaParameterId.eLogBuffer,e.BA.BaParameterId.eReferencedParam,e.BA.BaParameterId.eStatusFlags],t.CreatedBaseNodes=new Map,t.HostRegionName="TargetRegion",t.HTMLSymbols={Link:"&#x1F517"}}(t=e.Globals||(e.Globals={})),function(e){e.onWebSocketOpened="onWebSocketOpened",e.onInitialized="onInitialized",e.onWebSocketClosed="onWebSocketClosed",e.onCustomBaNewPulse="onCustomBaNewPulse"}(a=e.GlobalEvents||(e.GlobalEvents={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),setInterval(()=>{TcHmi.EventProvider.raise(TcHmi.BuildingAutomation.GlobalEvents.onCustomBaNewPulse)},1300),function(e){!function(e){!function(e){class t{static init(){this.__mutationOberserverHandler||(this.__mutationOberserverHandler=(e,t)=>{this.__filterMutations(e)}),this.__mutationObserver||(this.__mutationObserver=new MutationObserver(this.__mutationOberserverHandler),this.__mutationObserver.observe(document,{childList:!0,subtree:!0}))}static add(e,t){let a=this.__nodes.get(e.getId());null==a&&(a=new Map,this.__nodes.set(e.getId(),a));let i=0;for(;a.has(i);)i++;return a.set(i,t),!t.omitCbWhenAlreadyAttached&&this.getIsAttached(e)&&t.attachedCb&&t.attachedCb(),i}static remove(e,t){let a=this.__nodes.get(e.getId());if(null==a)return!1;let i=a.get(t);return!!i&&(i.detachedCb&&i.detachedCb(),a.delete(t),a.size<=0&&this.__nodes.delete(e.getId()),!0)}static getIsAttached(e){return e.getElement()[0].isConnected}static __filterMutations(e){e.forEach(e=>{switch(e.type){case"childList":e.addedNodes.forEach(e=>{this.__filterNode(e,!0)}),e.removedNodes.forEach(e=>{this.__filterNode(e,!1)})}})}static __filterNode(e,t){e.childNodes.forEach(e=>{this.__filterNode(e,t)}),e instanceof HTMLElement&&this.__invokeCallbacks(e.id,t)}static __invokeCallbacks(e,t){let a=this.__nodes.get(e);if(null!=a)for(let e of a.values())t?e.attachedCb&&e.attachedCb():e.detachedCb&&e.detachedCb()}}t.__nodes=new Map,e.AttachObserver=t}(e.System||(e.System={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),window.onload=()=>{TcHmi.BuildingAutomation.System.AttachObserver.init()};var __awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(e){!function(t){class a{static checkAvailability(){try{var e="__storage_test__";return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&window.localStorage&&0!==window.localStorage.length}}static getItem(t){if(!this.isAvailable)return;let a=window.localStorage.getItem(this.namespace);if(!a)return;let i=JSON.parse(a),n=e.Helper.Array.clone(t);if(n.length<=0)return i;let s=n.shift();for(;n.length>=0&&null!=i;){if(i=i[s],0===n.length)return i;s=n.shift()}}static setItem(t,a){this.isAvailable||this.__unavailablityLogged||(new e.Logger({name:"DataStorage"}).log(e.Logger.Severity.warn,"Local storage is not available in this browser."),this.__unavailablityLogged=!0);let i=e.Helper.Array.clone(t);if(i.length<=0)return;let n,s=window.localStorage.getItem(this.namespace);n=s?JSON.parse(s):{};let r=i.shift(),o=n[r],l=n;for(;i.length>1&&null!=o;)r=i.shift(),l=o,o=o[r];if(1===i.length&&null!=o)o[i.shift()]=a;else if(i.length>0&&null==o){l[r]={};let e=l[r];for(;i.length>1;)r=i.shift(),e[r]={},e=e[r];e[i.shift()]=a}else 0===i.length&&(l[r]=a);window.localStorage.setItem(this.namespace,JSON.stringify(n))}static deleteItem(t){if(!this.isAvailable)return!1;let a=window.localStorage.getItem(this.namespace);if(!a)return!1;let i=JSON.parse(a),n=e.Helper.Array.clone(t);if(n.length<=0)return!1;let s=n.shift();if(0===n.length)return delete i[s],window.localStorage.setItem(this.namespace,JSON.stringify(i)),!0;let r=i[s];for(;n.length>1&&null!=r;)s=n.shift(),r=r[s];return 1===n.length&&null!=r&&(s=n.shift(),delete r[s],window.localStorage.setItem(this.namespace,JSON.stringify(i)),!0)}static clear(){return __awaiter(this,void 0,void 0,(function*(){(yield e.Components.DialogWindow.confirm("Do you want to clear the complete TcHmiBa locale storage?"))&&window.localStorage.removeItem(this.namespace)}))}}a.namespace="TcHmiBa_LocalStorage",a.isAvailable=a.checkAvailability(),t.LocalStorage=a;class i{constructor(e){this.__storagePath=e}saveData(t=i.Location.local){switch(t){case i.Location.local:this.data&&a.setItem(this.__storagePath,this.data);break;default:new e.Logger({name:"DataStorage"}).log(e.Logger.Severity.warn,"Invalid location passed to save data was set.")}}readData(t=i.Location.local){return new Promise((n,s)=>{switch(t){case i.Location.local:this.data=a.getItem(this.__storagePath),n(!0);break;default:s(new e.Logger({name:"DataStorage"}).log(e.Logger.Severity.warn,"Invalid location passed to read data was set."))}})}deleteData(t=i.Location.local){switch(t){case i.Location.local:return!!a.deleteItem(this.__storagePath)&&(delete this.data,!0);default:return new e.Logger({name:"DataStorage"}).log(e.Logger.Severity.warn,"Invalid location passed to read data was set."),!1}}}t.DataStorage=i,function(e){let t;!function(e){e[e.invalid=-1]="invalid",e[e.local=0]="local"}(t=e.Location||(e.Location={}))}(i=t.DataStorage||(t.DataStorage={}))}(e.System||(e.System={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(e){class t{static set(e,t){return null==this.__container.children(".tchmi-ba-overlay-backdrop")[0]&&(this.__container.append(this.__backdrop),this.__backdrop.on("click touchstart",this.__backdropPressedHandler),$("body").on("click touchstart pointerdown",this.__preventHandler),$(window).on("click touchstart pointerdown",this.__preventHandler)),(null==t?void 0:t.onBackdropPressed)&&e.data("onBackdropPressedCallback",t.onBackdropPressed),null==$("body").children(".tchmi-ba-overlay-container")[0]&&$("body").append(this.__container),this.__backdrop.append(e),void 0!==(null==t?void 0:t.dimBackground)&&!0!==t.dimBackground||this.__backdrop.addClass("dim-background"),this.__backdrop}static remove(e){if(e){if(e.detach(),e.data("onBackdropPressedCallback")&&e.data("onBackdropPressedCallback",null),this.__backdrop.children().length>0)return}this.__container.empty(),this.__container.detach(),this.__backdrop.removeClass("dim-background"),this.__backdrop.off("click touchstart",this.__backdropPressedHandler),$("body").off("click touchstart pointerdown",this.__preventHandler),$(window).off("click touchstart pointerdown",this.__preventHandler)}}t.__container=$("<div>").addClass("tchmi-ba-overlay-container"),t.__backdrop=$("<div>").addClass("tchmi-ba-overlay-backdrop"),t.__backdropPressedHandler=e=>{if("mousedown"===e.type&&0!==e.button)return;let a=t.__backdrop.children();for(let t=0;t<a.length;t++){let i=$(a[t]).data("onBackdropPressedCallback");i&&"function"==typeof i&&i(e)}},t.__preventHandler=e=>{e.stopPropagation()},e.OverlayContainer=t}(e.System||(e.System={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a{static get(t){return new Promise((i,n)=>{let s=this.__loadedSVGs.get(t);if(s){if(s.content)return void i(s.content);s.resolver.push(i)}else{this.__loadedSVGs.set(t,{resolver:[i]});let n=new e.Logger({name:"SVGLoader"}).logPerformance(e.Logger.Severity.debug,"Loading SVG: "+t);a.__readSVGFile(t).then(a=>{n();let i=this.__loadedSVGs.get(t);if(i)return i.content=a,i.resolver.forEach(e=>e(a)),void(i.resolver=[]);throw new Error(new e.Logger({name:"SVGLoader"}).log(e.Logger.Severity.warn,"Finished loading of not requested SVG image? What happened?"))}).catch(t=>e.Logger.log(e.Logger.Severity.warn,t))}})}static __readSVGFile(e){return new Promise((t,a)=>{let i=new XMLHttpRequest;i.open("GET",e),i.setRequestHeader("Content-Type","image/svg+xml"),i.addEventListener("load",n=>{null!=n.currentTarget&&n.currentTarget instanceof XMLHttpRequest&&200==i.status?t(n.currentTarget.responseText):a(`Reading of svg file ${e} failed! Status: ${i.status} | Status text: ${i.statusText}`)}),i.send()})}}a.__loadedSVGs=new Map,t.SVGLoader=a}(e.System||(e.System={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){a.ValueHandler=class{constructor(e,a){this.__parent=e,this.logger=new t.Logger({name:"ValueHandler: "+e.getId()}),this.__attrHandler=new t.AttrHandler(this),null!=a&&this.setAttributes(a)}__removeValueSubscription(){null!=this.__valueSubscriptionId&&(t.Server.subscriptionCollector.remove(this.__valueSubscriptionId),delete this.__valueSubscriptionId)}processChangedValue(a){if(this.__parent.getAttributes().readOnly)return;let i;if(t.BaObjectHandler.isIUsesBaObject(this.__parent)&&(i=this.__parent.baObjectHandler.baObject),this.__attrHandler.baVariable)this.__attrHandler.autoWrite?this.__attrHandler.baVariable.write(a):this.__attrHandler.baVariable.editedValue=a;else if(null!=i&&this.__attrHandler.autoWrite)switch(i.OperationType){case t.BA.OperationType.eSetpoint:let e=i.tryGetBaVariable(t.BA.BaParameterId.ePresentValue);null!=e?e.Access.Write!=t.BA.Role.eLocked?e.write(a):this.logger.log(t.Logger.Severity.warn,"PresentValue is not editable!"):this.logger.log(t.Logger.Severity.warn,`Writing of BaVariable '${t.BA.BaParameterId[t.BA.BaParameterId.ePresentValue]}' failed because BaVariable was not found in BaObject!`,i);break;case t.BA.OperationType.eNone:let n=i.tryGetBaVariable(t.BA.BaParameterId.eEnManualRm);null!=n?n.read().then(()=>{!1===(null==n?void 0:n.Value)&&n.write(!0);let e=null==i?void 0:i.tryGetBaVariable(t.BA.BaParameterId.eValManualRm);null!=e?e.write(a):this.logger.log(t.Logger.Severity.warn,`Writing of BaVariable '${t.BA.BaParameterId[t.BA.BaParameterId.eValManualRm]}' failed because BaVariable was not found in BaObject!`,i)}):this.logger.log(t.Logger.Severity.warn,`Writing of BaVariable '${t.BA.BaParameterId[t.BA.BaParameterId.eEnManualRm]}' failed because BaVariable was not found in BaObject!`,i);break;case t.BA.OperationType.eDisplayValue:this.logger.log(t.Logger.Severity.warn,`Writing of BaVariable '${t.BA.BaParameterId[t.BA.BaParameterId.eEnManualRm]}' failed because of operation type ${t.BA.OperationType[i.OperationType]}!`,i);break;default:this.logger.log(t.Logger.Severity.warn,`BaObject has unknown operation type '${i.OperationType}!`)}else this.__valueMapping&&this.__attrHandler.autoWrite&&e.Server.writeSymbol(this.__valueMapping,a,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)})}setAttributes(e){return null==e||(void 0!==e.autoWrite&&(this.__attrHandler.autoWrite=e.autoWrite),void 0!==e.symbolExpression&&this.setSymbolExpression(e.symbolExpression),void 0!==e.baVariable&&this.setBaVariable(e.baVariable)),this}getAttributes(){return this.__attrHandler.getRef()}setSymbolExpression(a){if(!this.__attrHandler.checkAttribute(a,"symbolExpression",{validator:()=>a instanceof e.SymbolExpression}))return this;if(this.__attrHandler.symbolExpression=a,this.__removeValueSubscription(),null!=a){if(a.getType()!=e.SymbolType.Server)return this.logger.log(t.Logger.Severity.warn,"Passed symbol expression is not a server symbol expression!",a),this;this.__valueMapping=a.getName(),this.__valueSubscriptionId=t.Server.subscriptionCollector.add(this.__valueMapping,e=>{this.__parent.onValueChanged(e)})}return this}getSymbolExpression(){return this.__attrHandler.symbolExpression}setBaVariable(e){return this.__attrHandler.checkAttribute(e,"baVariable",{validator:()=>e instanceof t.BA.BaVariable})?(null!=this.__attrHandler.baVariable&&null!=this.__baVarWatchId&&this.__attrHandler.baVariable.stopWatch(this.__baVarWatchId),this.__attrHandler.baVariable=e,null!=this.__attrHandler.baVariable&&(this.__baVarWatchId=this.__attrHandler.baVariable.watch(e=>{this.__parent.onValueChanged(e)})),this):this}getBaVariable(){return this.__attrHandler.baVariable}destroy(){var e;this.__removeValueSubscription(),null!=this.__attrHandler.baVariable&&null!=this.__baVarWatchId&&(null===(e=this.__attrHandler.baVariable)||void 0===e||e.stopWatch(this.__baVarWatchId))}}}(t.System||(t.System={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(e){class t{constructor(e){this.__owner=e}getRef(){return this}getCopy(){const e={};for(let a in this){if(a.indexOf("__")>-1)continue;const i=this[a];"function"!=typeof i&&(e[a]=i instanceof t?i.getCopy():i)}return e}invalidAttribute(e,t){this.__owner.logger.invalidAttribute(e,t)}equalAttribute(e,t){this.__owner.logger.equalAttribute(e,t)}checkAttribute(t,a,i){if(void 0===t)return!1;if(null!=t&&null!=i&&!e.TypeGuards.validateAttribute(t,i.validator))return i.doNotlogError||this.invalidAttribute(String(a),t),!1;if(null!=i&&!i.skipEqualityCheck){let e=this[a];if(void 0===e&&i.oldVal&&(e=i.oldVal),void 0!==e&&a&&!this.checkEquality(t,e,String(a)))return!1}return!0}checkColorAttribute(t,a,i){return null==i&&(i={validator:[e.Color.isRGBAColor,e.Color.isILinearGradient]}),a?(i.validator?i.validator instanceof Array?i.validator.push(e.Color.isRGBAColor,e.Color.isILinearGradient):i.validator=[i.validator,e.Color.isRGBAColor,e.Color.isILinearGradient]:i.validator=[e.Color.isRGBAColor,e.Color.isILinearGradient],!!this.checkAttribute(t,a,i)&&(null==t||!e.Color.isRGBAColor(t)||t instanceof e.Color.RGBAColor?null==t||!e.Color.isILinearGradient(t)||t instanceof e.Color.LinearGradient||(t=new e.Color.LinearGradient(t)):t=new e.Color.RGBAColor(t),!0)):(i.doNotlogError||this.__owner.logger.log(e.Logger.Severity.warn,"The name of the attributes must be passed to check RGBAColor attribute"),!1)}checkEquality(e,t,a){return!tchmi_equal(e,t)||(this.equalAttribute(a,e),!1)}}e.AttrHandler=t}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){class a{constructor(a){this.__baInterfaceSymNames=null,this.logger=new t.Logger({name:"BaInterfaceHandler of "+a.getId(),className:this.constructor.name}),this.__parent=a;let i=e=>{e.destroy(),this.destroy()};this.__parent instanceof e.Controls.System.baseTcHmiControl?e.EventProvider.register(this.__parent.getId()+".onDestroyed",i):t.isIEventHandler(this.__parent)&&this.__parent.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,i)}watchSubSymbol(a,i,n=!0){var s;if(null==this.__baInterfaceSym||null==this.__baInterface)return;if(null==this.__baInterface[a])throw new Error(`Property '${String(a)}' does not exist in BaInterfaceDescription`);let r=this.__baInterface[a].symbolName;(-1==r.indexOf("::")||r.indexOf("::")>0)&&(r="::"+r);let o=this.__baInterfaceSym.getExpression();this.__baInterfaceWatches||(this.__baInterfaceWatches=new Map);let l=this.__baInterfaceWatches.get(r);null==l&&(l={sym:new e.Symbol(o.getSubSymbolExpression(r).toString())},this.__baInterfaceWatches.set(r,l));let d=null===(s=this.__baInterfaceWatches.get(r))||void 0===s?void 0:s.watchDf;null!=d&&(d(),null!=l.readyFunction&&(l.readyFunction(),delete l.readyFunction)),n&&(l.readyFunction=this.__parent.busyHandler.setBusy(`Watching '${r}' of BaInterface`)),l.watchDf=l.sym.watch(e=>{null!=l&&(null!=l.readyFunction&&(l.readyFunction(),delete l.readyFunction),this.logger.checkServerResult(t.Logger.Severity.warn,e)&&i(e.value))})}writeSubSymbol(a,i){return new Promise((n,s)=>{if(null==this.__baInterfaceSym||null==this.__baInterface)return;if(null==this.__baInterface[a])return void s(`Property '${String(a)}' does not exist in BaInterfaceDescription`);let r=this.__baInterface[a].symbolName;(-1==r.indexOf("::")||r.indexOf("::")>0)&&(r="::"+r);let o=this.__baInterfaceSym.getExpression();this.__baInterfaceWatches||(this.__baInterfaceWatches=new Map);let l=this.__baInterfaceWatches.get(r);null==l&&(l={sym:new e.Symbol(o.getSubSymbolExpression(r).toString())},this.__baInterfaceWatches.set(r,l)),l.sym.write(i,e=>{this.logger.checkServerResult(t.Logger.Severity.error,e),n(e)})})}hasSubSymbol(e){if(null==this.__schema||null==this.__schema.properties||null==this.__baInterface)return!1;if(null==this.__baInterface[e])return!1;let t=this.__baInterface[e].symbolName;return null!=a.getTargetProp(this.__schema,t.split("::"))}getSubSymbol(t){return null==this.__baInterfaceSym||null==this.__baInterface?null:new e.Symbol(this.getSubSymbolExpression(t).toString())}getSubSymbolExpression(e){if(null!=this.__baInterfaceSym&&null!=this.__baInterface){if(null==this.__baInterface[e])throw new Error(`Property '${String(e)} does not exist in BaInterfaceDescription`);return this.__baInterfaceSym.getExpression().getSubSymbolExpression(this.__baInterface[e].symbolName)}}__updateSymbolNames(e){if(null==this.__baInterfaceDefinition)throw new Error("Default BaInterfaceDescription was not set");null==this.__baInterface&&(this.__baInterface=a.joinDefAndDesc(this.baInterfaceDefinition,e,this.logger));for(let t in this.__baInterface)null!=e[t]&&e[t].symbolName!==this.__baInterface[t].symbolName&&(this.__baInterface[t].symbolName=e[t].symbolName);this.__processBaInterfaceSym()}destroy(){var e;if(this.__baInterfaceWatches)for(let t of null===(e=this.__baInterfaceWatches)||void 0===e?void 0:e.values())t.sym.destroy(),t.watchDf&&(t.watchDf(),null!=t.readyFunction&&(t.readyFunction(),delete t.readyFunction))}setBaInterfaceSym(t,a){if(void 0===t||!(t instanceof e.Symbol)||tchmi_equal(t,this.__baInterfaceSym))return this;if(null!=this.__baInterfaceSym&&null!=this.__baInterfaceWatches){for(let e of this.__baInterfaceWatches.values())e.sym.destroy(),e.watchDf&&(e.watchDf(),null!=e.readyFunction&&(e.readyFunction(),delete e.readyFunction));delete this.__baInterfaceWatches}return null==t||(this.__baInterfaceSym=t,this.__processor=a,this.__processBaInterfaceSym()),this}__processBaInterfaceSym(){null!=this.__baInterfaceSym&&null!=this.__baInterface&&this.__baInterfaceSym.resolveSchema(e=>{if(null!=this.__baInterfaceSym&&null!=this.__baInterface&&this.logger.checkServerResult(t.Logger.Severity.warn,e)){if(null==e.schema)return void this.logger.log(t.Logger.Severity.warn,"No schema resolved!");if(!a.validateSchema(e.schema,this.__baInterface,this.logger))return void this.logger.log(t.Logger.Severity.warn,"Passed symbol does not match to the interface!",{schema:e.schema,baInterfaceDescription:this.__baInterface});this.__schema=e.schema,this.__processor&&!TCHMI_DESIGNER&&this.__processor(this.__baInterfaceSym,this.__baInterface)}})}getBaInterfaceSym(){return this.__baInterfaceSym}set baInterfaceDefinition(e){tchmi_equal(e,this.__baInterfaceDefinition)||(this.__baInterfaceDefinition=e,delete this.__baInterface)}get baInterfaceDefinition(){if(null==this.__baInterfaceDefinition)throw new Error("BaInterfaceDescription not set!");return this.__baInterfaceDefinition}get baInterfaceDescription(){return this.__baInterface}set baInterfaceSymNames(e){this.__baInterfaceSymNames=e,null!=e&&this.__updateSymbolNames(e)}get baInterfaceSymNames(){return this.__baInterfaceSymNames}static validateSchema(e,a,i){if(null==e.properties)return null==i||i.log(t.Logger.Severity.warn,"Schema to be validated does not have any properties!",{schema:e,baInterface:a}),!1;for(let n in a){if(1==a[n].optional)continue;let s=a[n].symbolName;if(null==s)return null==i||i.log(t.Logger.Severity.warn,"Symbol name of BaInterface not set!"),!1;let r=this.getTargetProp(e,s.split("::"));return null==r?(null==i||i.log(t.Logger.Severity.warn,`Property '${s}' not found!`,{schema:e,baInterface:a}),!1):!!this.compareType(r,a[n].type,i)||(null==i||i.log(t.Logger.Severity.warn,`Schema of property '${a[n].symbolName}' does not fit to the type.`,{schema:r,expectedType:a[n].type}),!1)}return!0}static joinDefAndDesc(e,a,i){let n={};for(let s in e)if(null==a[s]){if(0==e[s].optional)return void(null==i||i.log(t.Logger.Severity.warn,`Symbol name of property '${s}' was not set!`))}else{let t={symbolName:a[s].symbolName,type:e[s].type,optional:e[s].optional};n[s]=t}return n}static convertToBaInterfaceSymbolNames(e){let t={};for(let a in e)null!=e[a].symbolName?t[a]=e[a]:t[a]={symbolName:e[a]};return t}static getTargetProp(e,t){let a=0,i=e;do{if(null==i.properties||null==i.properties[t[a]])return null;i=i.properties[t[a]],a++}while(a<t.length);return i}static compareType(e,a,i){if(null!=e.type){let t=!1;if(a instanceof Array){for(let i=0;i<a.length;i++)if(e.type===a[i]){t=!0;break}}else e.type===a&&(t=!0);return t}if(null!=e.anyOf){let t=!1;for(let n=0;n<e.anyOf.length;n++)if(this.compareType(e.anyOf[n],a,i)){t=!0;break}return t}return null==i||i.log(t.Logger.Severity.warn,"This kind of JsonSchema is not known.",e),!1}}t.BaInterfaceHandler=a,function(e){e.isBaInterfaceDefinition=function(e){if(null==e||"object"!=typeof e)return!1;let a=new Map;a.set("type",["string","array"]);for(let i in e)if(!t.TypeGuards.validateProperties(e[i],a))return!1;return!0},e.isBaInterfaceSymbolNames=function(e){if(null==e||"object"!=typeof e)return!1;let a=new Map;a.set("symbolName","string");for(let i in e)if(!t.TypeGuards.validateProperties(e[i],a))return!1;return!0}}(a=t.BaInterfaceHandler||(t.BaInterfaceHandler={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){class a{constructor(e){this.__name=e.name,e.className?this.__prefixEx=`[${e.className}] ${this.__name}\n`:this.__prefixEx=this.__name+"\n"}static log(t,i,...n){let s;switch("string"==typeof i?(s=i,i=this.__prefixEx?this.__prefixEx+i:a.__prefixEx+i):s=this.__prefixEx?this.__prefixEx:a.__prefixEx,"string"!=typeof i&&n.push(i),t){case a.Severity.debug:e.Log.debugEx(i,...n);break;case a.Severity.info:e.Log.infoEx(i,...n);break;case a.Severity.warn:e.Log.warnEx(i,...n);break;case a.Severity.error:e.Log.errorEx(i,...n);break;default:throw new Error("Invalid severity")}return s}log(e,t,...i){return a.log.bind(this)(e,t,...i)}static logPerformance(e,t){if(a.TcHmiBaLogPerformance){let i=performance.now();return(...n)=>{a.TcHmiBaLogPerformance&&a.log(e,a.hourGlass+`Operation took ${((performance.now()-i)/1e3).toFixed(2)} seconds\n`+t,...n)}}return()=>{}}logPerformance(e,t){return a.logPerformance.bind(this)(e,t)}static checkServerResult(e,a,i){return t.Server.checkServerResult(e,a,i)}static checkServerCommand(e,a,i){return t.Server.checkServerCommand(e,a,i)}checkServerResult(e,t){return a.checkServerResult(e,t,this)}checkServerCommand(e,t){return a.checkServerCommand(e,t,this)}invalidAttribute(e,i){this.log(a.Severity.warn,a.crossMark+`Invalid value was set for attribute '${t.Helper.String.capitalizeFirstLetter(String(e))} ': `+a.arrowRight,i)}equalAttribute(e,t){}}a.__prefixEx="\n",a.checkMark="✅ ",a.crossMark="❌ ",a.warning="⚠ ",a.arrowRight="→ ",a.arrowLeft="← ",a.arrowTop="↑ ",a.arrowBottom="↓ ",a.hourGlass="⌛ ",t.Logger=a,function(e){let t;!function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error"}(t=e.Severity||(e.Severity={})),e.isILogger=function(t){return null!=t&&"object"==typeof t&&t.logger instanceof e},e.TcHmiBaLogPerformance=!0}(a=t.Logger||(t.Logger={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;function a(e){let a=!0;if(null!=e&&"object"==typeof e){let i=new Map;i.set("top","number"),i.set("right","number"),i.set("bottom","number"),i.set("left","number"),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a}function i(e){return"Solid"===e||"Dashed"===e||"Dotted"===e||"None"===e}!function(e){let t;!function(e){function t(e,t,i){return a(e[t],i)}function a(e,t){if(t instanceof Array){for(let a=0;a<t.length;a++)if(i(e,t[a]))return!0;return!1}return i(e,t)}function i(e,t){if("function"==typeof t){if(t(e))return!0}else if("any"===t&&null!=e||typeof e===t||null===t&&null===e||"date"===t&&e instanceof Date||"array"===t&&e instanceof Array||"function"===t&&e instanceof globalThis.Function||"object"===t&&e instanceof globalThis.Object)return!0;return!1}e.validateProperties=function(e,a){for(let[i,n]of a)if(n instanceof Array){let a=!1;for(let s=0;s<n.length;s++){if(t(e,i,n[s])){a=!0;break}}if(0==a)return!1}else if(!t(e,i,n))return!1;return!0},e.validateAttribute=a}(t=e.TypeGuards||(e.TypeGuards={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={})),e.isDimensionUnit=function(e){return"px"===e||"%"===e},e.isHorizontalAlignment=function(e){return"Left"===e||"Center"===e||"Right"===e},e.isVerticalAlignment=function(e){return"Top"===e||"Center"===e||"Bottom"===e},e.isFourSidedCss=a,e.isBorderStyleValue=i,e.isBorderStyle=function(e){let a=!0;if(null!=e&&"object"==typeof e){let n=new Map;n.set("top",i),n.set("right",i),n.set("bottom",i),n.set("left",i),t.TypeGuards.validateProperties(e,n)||(a=!1)}else a=!1;return a},e.isBorderWidth=function(e){let t=!0;if(null!=e&&"object"==typeof e){if(!a(e))return!1;if(e.leftUnit&&"px"!=e.leftUnit)return!1;if(e.topUnit&&"px"!=e.topUnit)return!1;if(e.rightUnit&&"px"!=e.rightUnit)return!1;if(e.bottomUnit&&"px"!=e.bottomUnit)return!1}else t=!1;return t},e.isBorderRadius=function(e){let a=!0;if(null!=e&&"object"==typeof e){let i=new Map;i.set("topLeft","number"),i.set("topRight","number"),i.set("bottomRight","number"),i.set("bottomLeft","number"),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a},e.isJsonDataTypeNames=function(e){return null!=e&&"string"==typeof e&&("string"===e||"number"===e||"object"===e||"array"===e||"boolean"===e||"null"===e||"integer"===e)},e.isFontWeight=function(e){return"Normal"===e||"Bold"===e||"Auto"===e},e.isFontStyle=function(e){return"Normal"===e||"Italic"===e||"Oblique"===e||"Auto"===e}}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a{constructor(e){r(e)?e?r(e)&&(this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a):(this.r=0,this.g=0,this.b=0,this.a=1):console.warn("Passed color has not the right format",e)}static fromSolidColor(e){return null==e?null:o(e)&&null!=e.color?"None"===e.color?null:a.fromCssString(e.color):null}static fromCssString(e){try{let t;if(e.indexOf("rgba(")>-1){t=e,t=t.replace("rgba(","").replace(")","");let i=t.split(",");return new a({r:Number(i[0]),g:Number(i[1]),b:Number(i[2]),a:Number(i[3])})}if(e.indexOf("rgb(")>-1){t=e,t=t.replace("rgb(","").replace(")","");let i=t.split(",");return new a({r:Number(i[0]),g:Number(i[1]),b:Number(i[2]),a:1})}if(e.indexOf("#")>-1){t=e.replace("#","");let i={r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16),a:1};return t.length>6&&(i.a=parseInt(t.slice(6,8),16)),new a(i)}throw"failed"}catch(e){throw new Error("Converting CSS string into RGBAColor failed! "+e)}}static fromHexString(e){if(0!==e.indexOf("#"))throw new Error('Hex color strings must start with "#"!');return a.fromCssString(e)}toString(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a})`}toSolidColor(){return{color:this.toString()}}}t.RGBAColor=a,function(e){e.Black=e.fromHexString("#000000"),e.Gray=e.fromHexString("#B0B0B0"),e.MetallicSilver=e.fromHexString("#BCC6CC"),e.White=e.fromHexString("#FFFFFF"),e.Red=e.fromHexString("#FF0000"),e.Blue=e.fromHexString("#0000FF"),e.Goldenrod=e.fromHexString("#EDDA74"),e.Yellow=e.fromHexString("#FFFF00"),e.CornYellow=e.fromHexString("#FFF380"),e.Cantaloupe=e.fromHexString("#FFA62F"),e.Gold=e.fromHexString("#FFD700"),e.DarkOrange=e.fromHexString("#F88017"),e.FirebrickRed=e.fromHexString("#B22222"),e.PurpurRed=e.fromHexString("#DC143C"),e.RedFox=e.fromHexString("#C35817"),e.ChilliPepper=e.fromHexString("#C11B17"),e.LimeGreen=e.fromHexString("#41A317"),e.GreenApple=e.fromHexString("#4CC417"),e.Green=e.fromHexString("#00FF00"),e.DarkSeaGreen=e.fromHexString("#8FBC8F"),e.LightSkyBlue=e.fromHexString("#87CeFa"),e.PowderBlue=e.fromHexString("#b0E0E6"),e.PlumVelvet=e.fromHexString("#7D0552"),e.BurntPink=e.fromHexString("#C12267"),e.MediumTurquoise=e.fromHexString("#48d1CC"),e.TcHmiBlue=e.fromHexString("#4794da"),e.TcHmiGreen=e.fromHexString("#00AE40")}(a=t.RGBAColor||(t.RGBAColor={}));let i;function n(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("color",r),i.set("stop","number"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}function s(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;if(i.set("direction",["number","string"]),i.set("type","number"),i.set("stops","array"),e.TypeGuards.validateProperties(t,i)||(a=!1),a)for(let e=0;e<t.stops.length;e++)if(!n(t.stops[e]))return!1}else a=!1;return a}function r(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("r","number"),i.set("g","number"),i.set("b","number"),i.set("a","number"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}function o(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("color","string"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}t.LinearGradient=class{constructor(e){this.type=i.linear,e?(null!=e.type?this.type=e.type:this.type=i.linear,this.stops=e.stops):(this.type=i.linear,this.stops=[])}toString(){let e="linear-gradient(";"string"==typeof this.direction?e+=this.direction:e=e+this.direction+"deg";for(let t=0;t<this.stops.length;t++)e=`${e}, ${this.stops[t].color} ${this.stops[t].stop}${this.stops[t].stopUnit?this.stops[t].stopUnit:"px"}`;return e+")"}},function(e){e[e.invalid=-1]="invalid",e[e.linear=0]="linear",e[e.repeatingLinear=1]="repeatingLinear",e[e.radial=2]="radial"}(i=t.GradientType||(t.GradientType={})),t.isIGradientStop=n,t.isILinearGradient=s,t.isIFourSidedColor=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;null!=t.top&&i.set("top",[r,s,null]),null!=t.right&&i.set("right",[r,s,null]),null!=t.bottom&&i.set("bottom",[r,s,null]),null!=t.left&&i.set("left",[r,s,null]),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},t.isRGBAColor=r,t.isSolidColor=o,t.getPastelColor=function(e){let t=(e=Number(e.toFixed(0))).toString();return e=parseInt(t[t.length-1]),[a.FirebrickRed,a.LimeGreen,a.DarkOrange,a.LightSkyBlue,a.PlumVelvet,a.MediumTurquoise,a.PurpurRed,a.PowderBlue,a.Gold,a.DarkSeaGreen][e]},t.convertHSVToRGB=function(e,t,a){let i=a*t,n=e/60,s=i*(1-Math.abs(n%2-1)),r=0,o=0,l=0;n>=0&&n<=1?[r,o,l]=[i,s,0]:n>=1&&n<=2?[r,o,l]=[s,i,0]:n>=2&&n<=3?[r,o,l]=[0,i,s]:n>=3&&n<=4?[r,o,l]=[0,s,i]:n>=4&&n<=5?[r,o,l]=[s,0,i]:n>=5&&n<=6&&([r,o,l]=[i,0,s]);let d=a-i,[_,h,c]=[r+d,o+d,l+d];return[255*_,255*h,255*c]},t.getFadeColor=function(e,t,i,n,s){s<t&&(s=t),s>n&&(s=n);let r=n-t,o=new a({r:0,g:0,b:0,a:1});for(let a in e){let n=e[a],l=i[a];o[a]=(l-n)/r*(s-t)+n,isNaN(o[a])&&(o[a]=0)}return o}}(e.Color||(e.Color={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){let a,i;!function(e){class a{constructor(e){e?(this.nHour=e.nHour,this.nMinute=e.nMinute,this.nSecond=e.nSecond):(this.nHour=0,this.nMinute=0,this.nSecond=0)}static fromSeconds(e){return new a(t.Helper.DateTime.convertSecondsToSTTime(e))}static fromDate(e){return new a({nHour:e.getHours(),nMinute:e.getMinutes(),nSecond:e.getSeconds()})}fromSeconds(e){let t=a.fromSeconds(e);return this.nHour=t.nHour,this.nMinute=t.nMinute,this.nSecond=t.nSecond,this}toSeconds(){return t.Helper.DateTime.convertSTTimeToSeconds(this)}toDate(){return new Date(0,0,0,this.nHour,this.nMinute,this.nSecond,0)}toString(e){switch(e){case a.TimeStringFormat.milliSeconds:return("00"+this.nHour).slice(-2)+":"+("00"+this.nMinute).slice(-2)+":"+("00"+this.nSecond).slice(-2)+".000Z";case a.TimeStringFormat.seconds:return("00"+this.nHour).slice(-2)+":"+("00"+this.nMinute).slice(-2)+":"+("00"+this.nSecond).slice(-2);default:return("00"+this.nHour).slice(-2)+":"+("00"+this.nMinute).slice(-2)}}compare(e){if(this.nHour<e.nHour)return-1;if(this.nHour>e.nHour)return 1;if(this.nHour===e.nHour){if(this.nMinute<e.nMinute)return-1;if(this.nMinute>e.nMinute)return 1;if(this.nMinute===e.nMinute){if(this.nSecond<e.nSecond)return-1;if(this.nSecond>e.nSecond)return 1}}return 0}equals(e){return null!=e&&0===this.compare(e)}snapToPeriode(e){return this.fromSeconds(t.Helper.Number.snapToPeriode(this.toSeconds(),e))}addSeconds(e){return this.fromSeconds(this.toSeconds()+e)}subtractSeconds(e){let t=this.toSeconds()-e;if(t<0)throw new Error("Can not subtract the amount of seconds, because result will be smaller than 0 which is not allowed!");return this.fromSeconds(t)}}e.BaTime=a,function(e){let t;!function(e){e[e.minutes=0]="minutes",e[e.seconds=1]="seconds",e[e.milliSeconds=2]="milliSeconds"}(t=e.TimeStringFormat||(e.TimeStringFormat={}))}(a=e.BaTime||(e.BaTime={}));class i{constructor(t){t?(this.nYear=t.nYear,this.eMonth=t.eMonth,this.nDay=t.nDay,this.eDayOfWeek=t.eDayOfWeek):(this.nYear=0,this.eMonth=e.Month.eJanuary,this.nDay=1,this.eDayOfWeek=e.Weekday.eMonday)}toDate(){return this.nYear===e.BaDate.YearUnspecified||this.eMonth>e.Month.odd||this.nDay>e.Day.eLastDayOfMonth?new Date:new Date(this.nYear+i.YearOffset,this.eMonth-1,this.nDay,0,0,0,0)}static fromDate(e){let a=t.Helper.Date.getWeekday(e);return new i({nYear:e.getFullYear()-i.YearOffset,eMonth:e.getMonth()+1,nDay:e.getDate(),eDayOfWeek:a})}toString(a=i.Format.din5008){let n,s,r;switch(n=this.nYear===e.BaDate.YearUnspecified?"*":(this.nYear+i.YearOffset).toString(),this.eMonth){case e.Month.Unspecified:s="*";break;case e.Month.odd:case e.Month.even:s="?";break;default:if(this.eMonth>e.Month.eDecember||this.eMonth<e.Month.Invalid)s="?";else switch(a){case i.Format.din1355_1:case i.Format.din5008:s=("00"+this.eMonth).slice(-2);break;case i.Format.din5008_long:s=t.Components.CalendarList.MonthNames[this.eMonth-1];break;case i.Format.din5008_short:s=t.Components.CalendarList.MonthNamesShort[this.eMonth-1]+"."}}switch(this.nDay){case e.Day.Unspecified:r="*";break;case e.Day.eLastDayOfMonth:r=this.nYear===e.BaDate.YearUnspecified||this.eMonth>e.Month.eDecember||this.eMonth<e.Month.Invalid?"?":new Date(this.nYear+i.YearOffset,this.eMonth,0).getDate().toString();break;case e.Day.eOddDaysOfMonth:case e.Day.eEvenDaysOfMonth:r="?";break;default:r=this.nDay>e.Day.eDay31||this.nDay<e.Day.Invalid?"?":("00"+this.nDay).slice(-2)}switch(a){case i.Format.din1355_1:return`${r}.${s}.${n}`;case i.Format.din5008_long:case i.Format.din5008_short:return`${r}. ${s} ${n}`;default:return`${n}-${s}-${r}`}}}e.BaDate=i,function(e){let t;e.YearOffset=1900,e.YearUnspecified=255,function(e){e[e.din1355_1=0]="din1355_1",e[e.din5008=1]="din5008",e[e.din5008_long=2]="din5008_long",e[e.din5008_short=3]="din5008_short"}(t=e.Format||(e.Format={}))}(i=e.BaDate||(e.BaDate={}));class n{constructor(e){e?(this.stDate=new i(e.stDate),this.stTime=new a(e.stTime)):(this.stDate=new i,this.stTime=new a)}toDate(){return new Date(this.stDate.nYear+i.YearOffset,this.stDate.eMonth-1,this.stDate.nDay,this.stTime.nHour,this.stTime.nMinute,this.stTime.nSecond,0)}static fromDate(e){let t=i.fromDate(e),s=a.fromDate(e);return new n({stDate:t,stTime:s})}toString(){return this.stDate.toString()+"T"+this.stTime.toString(a.TimeStringFormat.milliSeconds)}}e.BaDateTime=n}(a=t.BA||(t.BA={})),function(t){let i,n;!function(e){function i(e){return("00"+e.nHour).slice(-2)+":"+("00"+e.nMinute).slice(-2)+":"+("00"+e.nSecond).slice(-2)+".000Z"}function n(e){return e.nYear+a.BaDate.YearOffset+"-"+("00"+e.eMonth).slice(-2)+"-"+("00"+e.nDay).slice(-2)}e.getCurrentWeek=function(e){let t=new globalThis.Date;t.setHours(0,0,0,0);let a=t.getDay(),i="Monday"===e?1:0,n=new globalThis.Date(t.getTime()-86400*(a-i)*1e3),s=new globalThis.Date(n.getTime()+6048e5-1);return{start:n,end:s}},e.createTimeString=function(e){return null==e?"":("00"+e.nHour).slice(-2)+":"+("00"+e.nMinute).slice(-2)},e.convertSecondsToSTTime=function(e){if(e<0)throw Error("Seconds to be converted to BaTime must be greater than or equal to 0!");let t,a={nHour:0,nMinute:0,nSecond:0};return 0===e||(a.nHour=Math.floor(e/3600),t=e-60*a.nHour*60,a.nMinute=Math.floor(t/60),a.nSecond=t-60*a.nMinute),a},e.convertSTTimeToSeconds=function(e){return 60*e.nHour*60+60*e.nMinute+e.nSecond},e.convertBaTimeToDate=function(e){return new globalThis.Date(0,0,0,e.nHour,e.nMinute,e.nSecond,0)},e.convertDateToBaTime=function(e){return{nHour:e.getHours(),nMinute:e.getMinutes(),nSecond:e.getSeconds()}},e.convertBaTimeToString=i,e.convertBaDateToString=n,e.convertBaDateToDate=function(e){let i=new globalThis.Date,n=e.nDay>=a.Day.eDay01&&e.nDay<=a.Day.eDay31?e.nDay:i.getDate(),s=e.eMonth>=1&&e.eMonth<=t.Date.MonthsMax?e.eMonth-1:i.getMonth(),r=e.nYear!==a.BaDate.YearUnspecified?e.nYear+a.BaDate.YearOffset:i.getFullYear();return new globalThis.Date(r,s,n,0,0,0,0)},e.convertBaDateTimeToDate=function(e){return new globalThis.Date(e.stDate.nYear+a.BaDate.YearOffset,e.stDate.eMonth-1,e.stDate.nDay,e.stTime.nHour,e.stTime.nMinute,e.stTime.nSecond,0)},e.convertDateToBaDateTime=function(e){return{stDate:{nYear:e.getFullYear()-a.BaDate.YearOffset,eMonth:e.getMonth()+1,nDay:e.getDate(),eDayOfWeek:e.getDay()},stTime:{nHour:e.getHours(),nMinute:e.getMinutes(),nSecond:e.getSeconds()}}},e.convertBaDateTimeToString=function(e){return n(e.stDate)+"T"+i(e.stTime)},e.convertTimeStampToSeconds=function(e){let t={};return t.nHour=parseInt(e.slice(0,e.indexOf(":"))),e=e.slice(e.indexOf(":")+1,e.length),t.nMinute=parseInt(e.slice(0,e.indexOf(":"))),t.nSecond=parseInt(e.slice(e.lastIndexOf(":")+1,e.length)),60*t.nHour*60+60*t.nMinute+t.nSecond},e.convertDaysToMilliseconds=function(e){return e<=0?0:24*e*60*60*1e3},e.convertMillisecondsToDays=function(e){return e<=0?0:e/1e3/60/60/24},e.compareBaTime=function(e,t){if(e.nHour<t.nHour)return-1;if(e.nHour>t.nHour)return 1;if(e.nHour===t.nHour){if(e.nMinute<t.nMinute)return-1;if(e.nMinute>t.nMinute)return 1;if(e.nMinute===t.nMinute){if(e.nSecond<t.nSecond)return-1;if(e.nSecond>t.nSecond)return 1}}return 0}}(i=t.DateTime||(t.DateTime={})),function(i){i.WeekdaysMax=7,i.DaysMax=31,i.MonthsMax=12,i.getWeekday=function(e){return 0===e.getDay()?a.Weekday.eSunday:e.getDay()},i.getWeeksOfMonth=function(e,a){if(!t.Date.isDate(e))return 0;let i=0,n=0,s=t.Date.getMaxDaysOfMonth(e),r=new globalThis.Date(e.getTime());return a=t.Date.validateDow(a),r.setDate(s),n=t.Date.adjustDayOfWeek(r.getDay()),n-=a-1,0===n?n=t.Date.WeekdaysMax:n<0&&(n=t.Date.WeekdaysMax+n),n!=t.Date.WeekdaysMax&&(s-=n,i++),r.setDate(1),n=t.Date.adjustDayOfWeek(r.getDay()),n-=a-1,0===n?n=t.Date.WeekdaysMax:n<0&&(n=t.Date.WeekdaysMax+n),1!=n&&(s-=t.Date.WeekdaysMax- --n,i++),i+=s/t.Date.WeekdaysMax,i},i.getMaxDaysOfMonth=function(e){let a=0,i=1904,n=0;if(e instanceof globalThis.Date){if(!t.Date.isDate(e))return 0;a=e.getMonth(),i=e.getFullYear()}else{if(null==e.month)return 0;if(e.month<1||e.month>t.Date.MonthsMax)return 0;a=e.month-1,e.year&&(i=e.year)}switch(a){case 1:n=28,29===new globalThis.Date(i,a,29).getDate()&&n++;break;case 3:case 5:case 8:case 10:n=30;break;default:n=t.Date.DaysMax}return n},i.adjustDayOfWeek=function(t){return 0===t?e.BuildingAutomation.Helper.Date.WeekdaysMax:t},i.validateDow=function(e){if(null==e||isNaN(e))return a.Weekday.eMonday;let t=e;return t<a.Weekday.eMonday&&(t=a.Weekday.eMonday),t>a.Weekday.eSunday&&(t=a.Weekday.eSunday),t},i.isDate=function(e){if(null==e)return!1;let t=null;return e instanceof globalThis.Date||"string"==typeof e||"number"==typeof e?t=new globalThis.Date(e):"object"==typeof e&&e.year&&e.month&&e.day&&(t=new globalThis.Date(e.year,e.month-1,e.day)),!!t&&!isNaN(t.getTime())}}(n=t.Date||(t.Date={}))}(i=t.Helper||(t.Helper={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){let a;!function(t){let a;!function(e){e.onElementMoved="onElementMoved"}(a=t.DragableElementEvents||(t.DragableElementEvents={})),t.makeDragable=function(t,a,n){let s;s=t instanceof e.Components.Base?t.getElement():t,s.off("mousedown touchstart",i),void 0!==a?(a.off("mousedown touchstart",i),a.on("mousedown touchstart",{element:t,options:n},i)):s.on("mousedown touchstart",{element:t,options:n},i)},t.resetDragable=function(t,a){let n;n=t instanceof e.Components.Base?t.getElement():t,n.off("mousedown touchstart",i),void 0!==a?a.off("mousedown touchstart",i):n.off("mousedown touchstart",i)};const i=e=>{if("mousedown"===e.type&&0!=e.button)return;let t=0,a=0;"mousedown"===e.type?0===e.button&&(t=e.pageX,a=e.pageY):"touchstart"===e.type&&void 0!==e.touches&&(t=e.touches[0].pageX,a=e.touches[0].pageY),$(document).on("mousemove touchmove",{element:e.data.element,options:e.data.options,originalX:t,originalY:a},n),$(document).on("mouseup touchend",s)},n=t=>{let i=0,n=0;if("mousemove"===t.type)i=t.pageX-t.data.originalX,n=t.pageY-t.data.originalY,t.data.originalX=t.pageX,t.data.originalY=t.pageY;else{if("touchmove"!==t.type)return;void 0!==t.touches&&(i=t.touches[0].pageX-t.data.originalX,n=t.touches[0].pageY-t.data.originalY,t.data.originalX=t.touches[0].pageX,t.data.originalY=t.touches[0].pageY)}!function(t,i,n){let s,r=n.data.options,o=n.data.element;s=o instanceof e.Components.Base?o.getElement():o;if(void 0!==r){if(void 0===r.limitingContainer&&(r.limitingContainer=s.parent()),void 0!==r.limitingContainer&&(void 0===r.allowHorizontalMovement||void 0!==r.allowHorizontalMovement&&!0===r.allowHorizontalMovement)){let a=s.position().left+t,n=r.limitingContainer.width(),l=s.width();if(void 0!==r.limitXExtension&&null!==r.limitXExtension?a<=-r.limitXExtension?a=-r.limitXExtension:void 0!==n&&void 0!==l&&a>=n-l+r.limitXExtension&&(a=n-l+r.limitXExtension):void 0!==n&&void 0!==l&&a>=n-l&&(a=n-l),a<0&&(a=0),o instanceof e.Components.Base?o.layoutHandler.setLeft(a):o.css("left",a+"px"),void 0===r.allowVerticalMovement||void 0!==r.allowVerticalMovement&&!0===r.allowVerticalMovement){let t=s.position().top+i,a=r.limitingContainer.height(),n=s.height();void 0!==r.limitYExtension&&null!==r.limitYExtension?t<=-r.limitYExtension?t=-r.limitYExtension:void 0!==a&&void 0!==n&&t>=a-n+r.limitYExtension&&(t=a-n+r.limitYExtension):void 0!==a&&void 0!==n&&t>=a-n&&(t=a-n),t<0&&(t=0),o instanceof e.Components.Base?o.layoutHandler.setTop(t):o.css("top",t+"px")}}}else o instanceof e.Components.Base?(o.layoutHandler.setLeft(s.position().left+t),o.layoutHandler.setTop(s.position().top+i)):(o.css("left",o.position().left+t+"px"),o.css("top",o.position().top+i+"px"));s.trigger(a.onElementMoved,[n,t,i])}(i,n,t)},s=()=>{$(document).off("mousemove touchmove",n),$(document).off("mouseup touchend",s)}}(a=t.DragableElement||(t.DragableElement={}))}(e.Helper||(e.Helper={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){class a{constructor(e){this.__owner=e}register(t,a){return e.EventProvider.register(this.__owner.getId()+"."+t,a)}raise(t,...a){e.EventProvider.raise(this.__owner.getId()+"."+t,this.__owner,...a)}}t.EventHandler=a,t.isIEventHandler=function(e){return null!=e&&(null!=e.eventHandler&&e.eventHandler instanceof a)},function(e){e.stopPropagationHandler=function(e){e.stopPropagation()}}(a=t.EventHandler||(t.EventHandler={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let a;!function(a){let i,n,s,r,o,l;a.convertUnitToString=function(e){if(null==e)return null;if(void 0!==t.Globals.Units){if(e==t.BA.Unit.eOther_NoUnits)return"";let a=t.Globals.Units.get(e);if(void 0!==a)return a}return"No unit found"},a.detectDataType=function(e){if(e instanceof globalThis.Date)return t.DataType.dateTime;if(e instanceof globalThis.Array)return t.DataType.array;switch(typeof e){case"number":return t.DataType.number;case"boolean":return t.DataType.boolean;case"string":return t.DataType.string}return globalThis.Object.keys(e).length>0?t.DataType.object:t.DataType.unknown},a.convertToType=function(t,a){switch(a){case"string":return e.ValueConverter.toString(t);case"bigint":case"number":return e.ValueConverter.toNumber(t);case"boolean":let i=e.ValueConverter.toBoolean(t);return"boolean"==typeof i?i:(i=e.ValueConverter.toNumber(t),null!=i?(i=i>0,i):null);case"date":return"string"!=typeof t||"number"!=typeof t?null:new globalThis.Date(t);default:return console.warn("[TODO] implement converting of type "+a+"!"),null}},a.PressAndHoldAnimationColor=t.Color.RGBAColor.TcHmiBlue.toString(),a.pressAndHold=function(e,t){const i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=i;const n=2*Math.PI,s=Math.PI/2,r=$("<canvas>").css({position:"absolute","z-index":"5000"}),o=r[0].getContext("2d");o.canvas.width=40,o.canvas.height=40;let l,d=0,_=0,h=0,c=!1;const u=u=>{c=!0,l=setTimeout(()=>{c?(d=u.clientX,_=u.clientY,$("body").append(r),function e(l){c?(r.css({top:_-20+"px",left:d-20+"px"}),o.clearRect(0,0,r[0].width,r[0].height),o.lineWidth=5,o.strokeStyle=a.PressAndHoldAnimationColor,o.beginPath(),o.arc(20,20,17.5,-s,n*l-s,!1),o.stroke(),h+=2,h<100?i((function(){e(h/100)})):(p(),t())):p()}(0)):p()},500),e.on("pointermove",g),e.on("pointerup",p)},g=e=>{d=e.clientX,_=e.clientY,r.css({top:_-20+"px",left:d-20+"px"})},p=()=>{c=!1,d=0,_=0,h=0,clearTimeout(l),l=void 0,r.off("pointerup",p),r.off("pointermove",g),e.off("pointerup",p),r.detach()};return e.on("pointerdown",u),{release:p,stop:()=>{p(),e.off("pointerdown",u)},resume:()=>{e.on("pointerdown",u)},isPressed:()=>c}},a.appendSourroundingElements=function(e,a,i){a instanceof globalThis.Array||(a=[a]);let n=new t.Logger({name:"Helper.appendSourroundingElements"});a.length>4&&n.log(t.Logger.Severity.warn,"You tried to append more than four elements around the target. Only four elements will be appended.",{target:e,elements:a}),null==i&&(i={}),null==i.distance&&(i.distance=15);let s=[];for(let r=0;r<a.length;r++){let o=a[r];if(s.indexOf(o.position)>-1)n.log(t.Logger.Severity.warn,`An element was already appended on position '${t.CornerPosition[o.position]}'. Make sure to only use every position only once.`);else{switch(null!=i.positioning&&o.element.css({position:i.positioning}),o.element.css({right:"",bottom:"",left:"",top:""}),o.position){case t.CornerPosition.topRight:o.element.css({right:-i.distance,top:-i.distance});break;case t.CornerPosition.bottomRight:o.element.css({right:-i.distance,bottom:-i.distance});break;case t.CornerPosition.bottomLeft:o.element.css({left:-i.distance,bottom:-i.distance});break;case t.CornerPosition.topLeft:o.element.css({left:-i.distance,top:-i.distance})}if(e.append(o.element),s.push(o.position),3===r)break}}},a.ShowSourroundingElementsDimensionRectangle=!0,a.appendSourroundingElementsDimensionRectangle=function(e,t){if(TCHMI_DESIGNER&&a.ShowSourroundingElementsDimensionRectangle){let a=$("<div>").addClass("tchmi-ba-sourrounding-elements-dimensions-rectangle");a.css("--tchmi-ba-sourrounding-elements-distance",t+"px"),e.append(a)}},function(t){t.replaceEx=function(e,t,a,i){let n=e;return n=e.slice(0,t),n+=i,n+=e.slice(a),n},t.toSymbolExpression=function(e){return e.indexOf("%s%")>-1?e:"%s%"+e+"%/s%"},t.toLanguageKey=function(e){return e.indexOf("%l%")>-1?e:"%l%"+e+"%/l%"},t.toServerMapping=function(t){if(!e.Symbol.isSymbolExpression(t))throw new Error(`Passed string '${t}' is not a symbol expression!`);let a=new e.SymbolExpression(t);a.getType()!=e.SymbolType.Server&&console.warn(`Passed string '${t}' is not a server symbol!`);let i=a.getName();if(null==i)throw new Error("Unknown error!");return i},t.removeAllWhiteSpaces=function(e){return e.replace(/\s+/g,"")},t.capitalizeFirstLetter=function(e){return e.length>0&&(e=e[0].toUpperCase()+e.slice(1)),e},t.lowercaseFirstLetter=function(e){return e[0].toLowerCase()+e.slice(1)},t.hasLowerCaseLetter=function(e){for(let t=0;t<e.length;t++)if(isNaN(parseInt(e[t]))&&-1==="~`!#$%^&*+=-[]\\';,/{}|\":<>?_".indexOf(e[t])&&e[t]===e[t].toLowerCase())return!0;return!1},t.hasUpperCaseLetter=function(e){for(let t=0;t<e.length;t++)if(isNaN(parseInt(e[t]))&&-1==="~`!#$%^&*+=-[]\\';,/{}|\":<>?_".indexOf(e[t])&&e[t]===e[t].toUpperCase())return!0;return!1},t.hasSpecialChar=function(e){for(let t=0;t<e.length;t++)if(-1!=="~`!#$%^&*+=-[]\\';,/{}|\":<>?_".indexOf(e[t]))return!0;return!1},t.hasNumber=function(e){return/\d/.test(e)},t.hasOnlyNumbers=function(e){if(null==e)return!1;for(let t=0;t<e.length;t++)if(isNaN(parseInt(e[t])))return!1;return!0},t.validateFilePath=function(e,t){if(t instanceof globalThis.Array||(t=[t]),null!=e&&"string"==typeof e){e=e.toLowerCase();for(let a=0;a<t.length;a++){let i=t[a].toLowerCase();if(e.indexOf("."+i)==e.length-(i.length+1))return!0}}return!1}}(i=a.String||(a.String={})),function(e){e.calcLinearFunctionValue=function(e,t,a,i,n){let s=(t-e)/(i-a);return s*n+(t-s*i)},e.toPercentage=function(e,t,a){return(e-t)/(a-t)*100},e.snapToPeriode=function(e,t){if(t<=0)return e;let a=Math.floor(e/t)*t,i=a+t;return Math.abs(e-a)>=Math.abs(e-i)?i:a},e.addStep=function(e,t,a,i){let n=e.valueOf();return null!=a&&null!=t&&null!=i&&(a>t&&e<a?n=e+i:a<t&&e>a&&(n=e-i),a>=t?(n>a&&(n=a),n<t&&(n=t)):(n<a&&(n=a),n>t&&(n=t))),n},e.removeStep=function(e,t,a,i){let n=e.valueOf();return null!=a&&null!=t&&null!=i&&(a>t&&e>t?n=e-i:a<t&&e<t&&(n=e+i),a>=t?(n>a&&(n=a),n<t&&(n=t)):(n<a&&(n=a),n>t&&(n=t))),n}}(n=a.Number||(a.Number={})),function(e){e.toNumberDictionary=function(e){let t=new globalThis.Map;for(let a in e){let i=globalThis.Number(a);isNaN(i)?console.warn(`Key ${a} of property ${e[a]} is NaN! It was not added to the number dictionary!`):t.set(i,e[a])}return t},e.clone=function e(t){if(null==t)return t;if("object"==typeof t){const e=t.constructor.name;if("Object"!=e)throw new Error(`It's only possible to clone plain objects. You tried to clone the class ${e}.\nPlease create a dedicated method or constructor that creates a clone of ${e}.`)}let a={};if(globalThis.Object.keys(t).length>0)for(let i in t){let n=t[i];n instanceof globalThis.Array?a[i]=r.clone(n):a[i]="object"==typeof n?e(n):n}else a=t;return a},e.merge=function(e,t,a){if(null!=e&&null!=t)for(let i in e)a&&a.indexOf(i)>-1||void 0!==e[i]&&(t[i]=e[i])},e.deleteProperties=function(e,t){return t.forEach(t=>{void 0!==e[t]&&delete e[t]}),e}}(s=a.Object||(a.Object={})),function(e){function t(e,t,a){return e[t]=e.splice(a,1,e[t])[0],e}e.clone=function e(t){if("object"!=typeof t[0])return t.slice(0);{let a=[];for(let i=0;i<t.length;i++){let n=t[i];n instanceof globalThis.Array?a.push(e(n)):n instanceof globalThis.Object?a.push(s.clone(n)):a.push(n)}return a}},e.verifyEntries=function(e){for(let t=0;t<e.length;t++)if(void 0===e[t])return!1;return!0},e.equals=function(e,t){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!tchmi_equal(e[a],t[a]))return!1;return!0},e.swapItems=t,e.selectionSort=function(e,a,i){let n=0,s=e.length;for(var r=0;r<s;r++){n=r;for(var o=r+1;o<s;o++)(a&&!i(e[o],e[n])||!a&&i(e[o],e[n]))&&(n=o);t(e,r,n)}return e},e.bubbleSort=function(e,a,i){for(let n=e.length-1;n>=0;n--)for(let s=1;s<=n;s++)a&&i(e[s-1],e[s])?t(e,s-1,s):a||i(e[s-1],e[s])||t(e,s,s-1);return e},e.mergeSort=function e(t,a,i){let n=t.length;if(n<2)return t;let s=Math.floor(n/2),r=t.slice(0,s),o=t.slice(s);return function(e,t,a,i){let n=[],s=e.length,r=t.length,o=0,l=0;for(;o<s&&l<r;)a&&i(e[o],t[l])?n.push(e[o++]):a||i(e[o],t[l])?n.push(t[l++]):n.push(e[o++]);return n.concat(e.slice(o)).concat(t.slice(l))}(e(r,a,i),e(o,a,i),a,i)}}(r=a.Array||(a.Array={})),function(e){e.filter=function(e,t){let a=new globalThis.Map;for(let[i,n]of e)t(i,n)&&a.set(i,n);return a},e.findByValue=function(e,t){for(let[a,i]of e)if(t(i))return{key:a,value:i};return null},e.findByKey=function(e,t){for(let[a,i]of e)if(t(a))return{key:a,value:i};return null},e.indexOf=function(e,t){let a=0;for(let i of e.keys()){if(i===t)return a;a++}return-1},e.first=function(e){for(let[t,a]of e)return{key:t,value:a}},e.last=function(e){let t=void 0;for(let[a,i]of e)t={key:a,value:i};return t},e.getPrevious=function(e,t){let a=void 0;for(let[i,n]of e){if(t===i)break;a={key:i,value:n}}return a},e.getNext=function(e,t){let a,i=void 0,n=!1,s=0;for(let[r,o]of e)if(t===r&&(n=!0),a={key:r,value:o},n&&(s++,s>1)){i=a;break}return i}}(o=a.Map||(a.Map={})),function(e){e.registerEvent=function(e,t,a){return e.on(t,a),()=>{e.off(t,a)}}}(l=a.Dom||(a.Dom={}))}(a=t.Helper||(t.Helper={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={})),e.SymbolExpression.prototype.getSubSymbolExpression=function(t){if(this.getType()!=e.SymbolType.Server)throw new Error("Only server symbol expressions are allowed!");return(-1==t.indexOf("::")||t.indexOf("::")>0)&&(t="::"+t),new e.SymbolExpression(`%${this.getTag()}%${this.getName()}${t}%/${this.getTag()}%`)}}(TcHmi||(TcHmi={})),TcHmi.EventProvider.register("onThemeDataChanged",()=>{"Base-Dark"===TcHmi.Theme.get()?TcHmi.BuildingAutomation.Helper.PressAndHoldAnimationColor=TcHmi.BuildingAutomation.Color.RGBAColor.White.toString():TcHmi.BuildingAutomation.Helper.PressAndHoldAnimationColor=TcHmi.BuildingAutomation.Color.RGBAColor.TcHmiBlue.toString()}),function(e){let t;!function(t){let a;!function(a){let i;!function(a){function i(e){return e="data-tchmi-"+(e=(e=e.slice(e.lastIndexOf(":")+1)).slice(0,e.indexOf("%"))).toLowerCase()}a.getSymExpFromBoundedUcParameter=function(a,n){if(TCHMI_DESIGNER)return n;let s,r="",o=a.getParent();if(null===o)return;if("TcHmi.Controls.System.TcHmiContainer"===a.getType()||"TcHmi.Controls.System.TcHmiContainer"===o.getType())return void t.Logger.log(t.Logger.Severity.error,"Placing controls into a container is currently not supported in a UserControl. Please place controls outside of containers.");let l,d=n.toString(),_=d.split("::");if(_.length<3)l=i(d);else{for(let e=_.length-1;e>1;e--)r=e===_.length-1?"::"+_[e].slice(0,_[e].indexOf("%"))+r:"::"+_[e]+r;l="data-tchmi-"+_[1].toLowerCase()}let h=void 0;for(;"TcHmi.Controls.System.TcHmiUserControl"===a.getType()&&(o=a.getParent(),null!==o);){if("TcHmi.Controls.System.TcHmiUserControlHost"===o.getType()){s=o.getAttrs();let e=s[l];if(void 0===e)return;h=e,d=h.value}let e=o.getParent();if(null!==e&&"TcHmi.Controls.System.TcHmiUserControl"===e.getType()&&(o=e,null!==o))if(_=d.split("::"),_.length<3)l=i(d);else{for(let e=_.length-1;e>1;e--)r=e===_.length-1?"::"+_[e].slice(0,_[e].indexOf("%"))+r:"::"+_[e]+r;l="data-tchmi-"+_[1].toLowerCase()}a=o}if(void 0!==h)return r.length>0&&(d=function(e,t){let a=e.lastIndexOf("%",e.length-2),i=e.slice(a,e.length),n=e.slice(0,a);return n=n+t+i,n}(d,r)),-1===d.indexOf("%s%")?void t.Logger.log(t.Logger.Severity.warn,"PLC symbol expression was not found correctly.",{foundSymbolExpression:d,userControl:a,symbolExpression:d}):new e.SymbolExpression(d);t.Logger.log(t.Logger.Severity.warn,`Attribute with name '${l}' was not found for UserControl '${a.getId()}'`,{userControl:a,symbolExpression:d})}}(i=a.Mapping||(a.Mapping={}))}(a=t.Helper||(t.Helper={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){a.ResizeHandler=class{constructor(e,a){this.__resizeObserver=new ResizeObserver(()=>{this.__ctrl.onResized()}),this.__ctrl=e,this.__element=a,this.__attachId=t.System.AttachObserver.add(e,{attachedCb:()=>this.__attach(),detachedCb:()=>this.__detach()})}__attach(){if(this.__element)this.__resizeObserver.observe(this.__element[0]);else try{this.__resizeObserver.observe(this.__ctrl.getElement()[0])}catch(e){t.Logger.log(t.Logger.Severity.error,`Observing element of control ${this.__ctrl.getId()} failed! Did you forget to destroy the resize handler before detaching?`)}this.__destroyOnThemeDataChanged=e.EventProvider.register("onThemeDataChanged",()=>{this.__ctrl.onResized()})}__detach(){if(this.__element)this.__resizeObserver.unobserve(this.__element[0]);else try{this.__resizeObserver.unobserve(this.__ctrl.getElement()[0])}catch(e){t.Logger.log(t.Logger.Severity.error,`Unobserving element of control ${this.__ctrl.getId()} failed! Did you forget to destroy the resize handler before detaching?`)}null!=this.__destroyOnThemeDataChanged&&(this.__destroyOnThemeDataChanged(),delete this.__destroyOnThemeDataChanged)}destroy(){t.System.AttachObserver.remove(this.__ctrl,this.__attachId),null!=this.__destroyOnThemeDataChanged&&(this.__destroyOnThemeDataChanged(),delete this.__destroyOnThemeDataChanged)}}}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(t){!function(a){function i(a,i,n){return void 0===n&&(n=new t.Logger({name:"Check server result"})),i.error===e.Errors.NONE&&null==i.details||(i.error===e.Errors.E_WEBSOCKET_CLOSED||(null==n||n.log(a,t.Logger.crossMark+e.Log.buildMessage(i.details),i),!1))}function n(a,i,n){return void 0===n&&(n=new t.Logger({name:"Check server command"})),null==i.error||(i.error.code===e.Errors.NONE||(i.error.code===e.Errors.E_WEBSOCKET_CLOSED||(null==n||n.log(a,t.Logger.crossMark+e.Log.buildMessage(i.error),i),!1)))}function s(e){return new Promise((t,i)=>{TCHMI_DESIGNER&&t(null),a.readRequestCollector.add(e).then(e=>{t(e)}).catch(t=>i({msg:`Executing server function "${e}" failed!`,result:t}))})}function r(e,t,i,n){return new Promise((s,r)=>{TCHMI_DESIGNER&&s(null),a.readRequestCollector.add(e,t).then(e=>{s(e),null==n&&"function"!=typeof n||n(e)}).catch(e=>{null==i&&"function"!=typeof i||i(e),r(e)})})}let o,l;function d(e,a,i){var n,s;if(null==t.Globals.BaStandardParameterInformation)throw new Error("BaStandardParameterInformation must be loaded before!");let r=new Map;if(null!=e)for(let o in e){let l=t.Globals.BaStandardParameterInformation.get(o);if(null==l){if(null!=t.Globals.BaExtensionTypes){if(null==a||null==i)throw new Error("No device name or type name passed!");l=null===(s=null===(n=t.Globals.BaExtensionTypes.get(a))||void 0===n?void 0:n.get(i))||void 0===s?void 0:s.AdditionalParameters.get(o)}if(null==l)throw new Error(`No parameter information found for BaParameter '${o}'!`)}let d={DataType:e[o].DT,Access:{Read:e[o].A[0],Write:e[o].A[1]},Info:l};void 0!==e[o].V&&(d.Value=e[o].V),void 0!==e[o].AT&&(d.ArrayType=e[o].AT),void 0!==e[o].C&&(d.Children=new Map,d.Children=e[o].C),r.set(o,d)}return r}function _(e,t){let a={SubjectInfo:e.SI,Identifier:e.Id,Purpose:e.Pu,OperationType:e.OT,NodeType:e.NT,InstancePath:e.IP,DataType:e.DT};return null!=e.P&&(a.Params=d(e.P)),null!=e.AP&&(a.AddParams=d(e.AP,t,e.T),a.TypeName=e.T),e.texts&&(a.texts=e.texts),a}function h(e,t){return Object.assign(Object.assign({},_(e,t)),{IsEventEnabled:null!=e.IsEvt&&e.IsEvt,Event:e.Ev})}function c(e,t){let a=Object.assign({},_(e,t));if(null!=e.Evts&&(a.Events=e.Evts),null!=e.EvPI&&(a.EventsPerIcon=e.EvPI),null!=e.C){a.Children=new Map;for(let i in e.C)x(e.C[i])?a.Children.set(i,h(e.C[i],t)):B(e.C[i])?a.Children.set(i,c(e.C[i],t)):a.Children.set(i,_(e.C[i],t))}return a}function u(e){if(!k(e))throw new Error("Is not IBaEvent!");return{TimeStamp:null!=e.ts?new Date(e.ts):null,Type:e.e.t,State:e.e.s,IsActive:e.a,IsHistorical:e.h,LockPriority:e.l,Identifier:e.id,DeviceName:e.d,EventClassId:e.ecID,EventClassInstanceDescription:e.ecDesc,EventClassDescription:e.ecDesc}}function g(e){let t=[];for(let a=0;a<e.length;a++)t.push(u(e[a]));return t}a.suppressBaSiteExtensionNotAvailableLog=!1,a.checkServerResult=i,a.checkServerCommand=n,a.callServerFunctionEx=r,a.ConfirmBaFunction=t.Globals.BaDomainName+".ConfirmBaObject",a.confirmBaObject=function(e){let i={DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath};r(a.ConfirmBaFunction,i).catch(a=>t.Logger.log(t.Logger.Severity.warn,"Confirming BaObject failed",{baObject:e,reason:a}))},a.getUnits=function(){let e=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading units.");return new Promise((a,i)=>{s(t.Globals.BaDomainName+".GetUnits").then(n=>{if(null==n)return void i({msg:`No units were returned from ${t.Globals.BaDomainName}!`});let s=t.Helper.Object.toNumberDictionary(n);s&&s.size<=0?i({msg:`No units were returned from ${t.Globals.BaDomainName}!`}):(e(),a(s))}).catch(e=>i({msg:`Getting units from ${t.Globals.BaDomainName} failed!`,reason:e}))})},a.getBaStandardParameterInformation=function(){let e=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading BaStandardParameterInformation.");return new Promise((a,i)=>{s(t.Globals.BaDomainName+".GetBaStandardParameterInformation").then(n=>{if(null==n||null==n)return void i({msg:`No BaStandardParameterInformation were returned from ${t.Globals.BaDomainName}!`});let s=new Map;for(let e in n)s.set(e,n[e]);e(),a(s)}).catch(e=>i({msg:`Getting BaStandardParameterInformation from ${t.Globals.BaDomainName} failed!`,reason:e}))})},a.getBaExtensionTypes=function(){let e=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading BaExtensionTypes.");return new Promise((a,i)=>{s(t.Globals.BaDomainName+".GetBaExtensionTypes").then(n=>{if(null==n||null==n)return void i({msg:`No BaExtensionTypes were returned from ${t.Globals.BaDomainName}!`});let s=new Map;for(let e in n){let t=n[e],a=new Map;for(let e in t){let i=t[e],n=new Map;for(let e in i.AdditionalParameters)n.set(e,i.AdditionalParameters[e]);a.set(e,{AdditionalParameters:n})}s.set(e,a)}e(),a(s)}).catch(e=>i({msg:`Getting BaStandardParameterInformation from ${t.Globals.BaDomainName} failed!`,reason:e}))})},a.getPeriodicallyUpdatedVariableIDs=function(){let e=t.Logger.logPerformance(t.Logger.Severity.debug,"Getting periodically updated variable IDs.");return new Promise((a,i)=>{s(t.Globals.BaDomainName+".GetPeriodicallyUpdatedVariableIDs").then(n=>{null==n||n.length<=0?i({msg:`No periodically updated variable IDs returned from ${t.Globals.BaDomainName}!`}):(e(),n.push(t.BA.BaParameterId.eSymbolPath),n.push(t.BA.BaParameterId.eInstanceID),a(n))}).catch(e=>i({msg:`Getting periodically updated variable IDs from ${t.Globals.BaDomainName} failed!`,reason:e}))})},a.getValueRange=function(e){return new Promise((a,i)=>{if(e.RefObject instanceof t.BA.BaVariable)return void i("Child of a BaVariable was passed!");let n={DeviceName:e.RefObject.Device.Description,BaObjectInstancePath:e.RefObject.InstancePath,BaVarId:e.ID,BaVarInstName:e.InstanceName};r(t.Globals.BaDomainName+".GetValueRange",n).then(s=>{null!=s?a(t.Helper.Object.toNumberDictionary(s)):i({msg:"No value range was returned!",requested:Object.assign(Object.assign({},n),{baVar:t.BA.BaParameterId[e.Info.ID]})})}).catch(a=>i({msg:`Getting value range from ${t.Globals.BaDomainName} for BaVariable '${e.Mapping}' failed!`,baVar:e,reason:a}))})},a.updateValueRange=function(e){return new Promise((a,i)=>{null!=o&&null!=l||(o=[],l=new Map,setTimeout(()=>{r(t.Globals.BaDomainName+".UpdateValueRanges",o).then(e=>{if(null!=e){if(null==l)throw new Error("Resolvers must be avaibale here.");for(let a in e){let i=l.get(a);if(null==i)throw new Error("No resolver found for BaVariable!");i(t.Helper.Object.toNumberDictionary(e[a]))}o=void 0,l=void 0}else i({msg:"No value ranges were returned!",requested:o})}).catch(e=>i({msg:`Getting value ranges from ${t.Globals.BaDomainName} failed!`,baVars:o,reason:e}))},500)),o.push({DeviceName:e.RefObject.Device.Description,BaObjectInstancePath:e.RefObject.InstancePath,BaVarId:e.ID,BaVarInstName:e.InstanceName}),l.set(e.RefObject.Device.Description+"."+e.RefObject.InstancePath+"."+e.InstanceName,a)})},a.getDecoratingInfo=function(e){return new Promise((a,i)=>{if(e.RefObject instanceof t.BA.BaVariable)return void i("Child of a BaVariable was passed!");let n={DeviceName:e.RefObject.Device.Description,BaObjectInstancePath:e.RefObject.InstancePath,BaVarId:e.ID,BaVarInstName:e.InstanceName};r(t.Globals.BaDomainName+".GetDecoratingInfo",n).then(s=>{null!=s?a(s):i({msg:"No decorating info was returned from BA!",requested:Object.assign(Object.assign({},n),{baVar:t.BA.BaParameterId[e.Info.ID]})})}).catch(a=>i({msg:`Getting decorating info from ${t.Globals.BaDomainName} for BaVariable '${e.Mapping}' failed!`,baVar:e,reason:a}))})},a.GetBaDeviceProjectStructureFunction=t.Globals.BaDomainName+".GetBaDeviceProjectStructure",a.getBaDeviceProjectStructure=function(e){let i=t.Logger.logPerformance(t.Logger.Severity.debug,`Reading BaDevice '${e}'.`);return new Promise((n,s)=>{r(a.GetBaDeviceProjectStructureFunction,e).then(e=>{null!=e?(i(),n(e)):s({msg:"No device was returned from BA!"})}).catch(a=>s({msg:`Reading device '${e}' from ${t.Globals.BaDomainName} failed!`,reason:a}))})},a.GetBaDeviceFunction=t.Globals.BaDomainName+".GetBaDevice",a.getBaDevice=function(e){let i=t.Logger.logPerformance(t.Logger.Severity.debug,"Read BaDevice.");return new Promise((n,s)=>{a.readRequestCollector.add(a.GetBaDeviceFunction,e).then(t=>{if(null==t)return void s({msg:"No device was returned from BA"});let a={ProjectStructure:c(t.PS,e.DeviceName)};i(),n(a)}).catch(a=>s({msg:`Reading of device '${e.DeviceName}' from ${t.Globals.BaDomainName} failed!`,reason:a}))})},a.GetBaDevicesFunction=t.Globals.BaDomainName+".GetBaDevices",a.getBaDevices=function(e){let i=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading BaDevices.");return new Promise((n,s)=>{a.readRequestCollector.add(a.GetBaDevicesFunction,e).then(e=>{if(null==e)return void s({msg:"No devices were returned from BA"});let t={};for(let a in e)t[a]={ProjectStructure:c(e[a].PS,a)};i(),n(t)}).catch(e=>s({msg:`Reading of devices from ${t.Globals.BaDomainName} failed!`,reason:e}))})},a.CheckBaDeviceMapping=t.Globals.BaDomainName+".CheckBaDeviceMapping",a.checkBaDeviceMapping=function(e){return new Promise((t,i)=>{a.readRequestCollector.add(a.CheckBaDeviceMapping,e).then(e=>{t(!!e)}).catch(e=>i({msg:"Checking of BaDevice mapping failed!",reason:e}))})},a.GetBaObjectFunction=t.Globals.BaDomainName+".GetBaObject",a.getBaObject=function(e,i=!1,n=!1){let s,r=t.Logger.logPerformance(t.Logger.Severity.debug,"Reading BaObject.");return s=e instanceof t.BA.BaBasicObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath,IncludeChildren:i,IncludeTexts:n}:e,new Promise((e,o)=>{a.readRequestCollector.add(a.GetBaObjectFunction,s).then(a=>{var l;if(null==a)return o({msg:"No BaObject was returned",passedObject:s});let d;if(d=B(a)?c(a,s.DeviceName):x(a)?h(a,s.DeviceName):_(a,s.DeviceName),!t.BA.BaBasicObject.isIBaBasicObjectAttributes(d))return o({msg:"Error in Server.getBaObject() | Result does not fit to interface IBaBasicObjectAttributes!",result:d});let u=null===(l=t.BA.BaDevices)||void 0===l?void 0:l.get(s.DeviceName);if(!u)return o({msg:`Error in Server.getBaObject() | Load BaDevice '${s.DeviceName}' before accessing BaObjects in it!`});let g=u.findBaObject(s.BaObjectInstancePath);return g?(g.setAttributes(d),0==g.getIsValid(i,n)?o({msg:`Error in Server.getBaObject() | BaObject '${s.BaObjectInstancePath}' was not loaded correctly!`}):(r(g),void e(g))):o({msg:`Error in Server.getBaObject() | Could not find BaObject '${s.BaObjectInstancePath}' in ${s.DeviceName}!`})}).catch(e=>o(e))})},a.GetBaObjectTextsFunction=t.Globals.BaDomainName+".GetBaObjectTexts",a.getBaObjectTexts=function(e,i=!1){let n;return n=e instanceof t.BA.BaBasicObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath,IncludeChildren:i}:e,new Promise((e,t)=>{a.readRequestCollector.add(a.GetBaObjectTextsFunction,n).then(a=>{if(null==a)return void t({msg:"No BaObject texts were returned",passedObject:n});let i=function e(t){let a={description:t.description,instDescription:t.instDescription,instObjectName:t.instObjectName,objectName:t.objectName};if(null!=t.children){a.children=new Map;for(let i in t.children)a.children.set(i,e(t.children[i]))}return a}(a);e(i)}).catch(e=>t(e))})},a.GetRefferingObjectsFunction=t.Globals.BaDomainName+".GetReferringObjects",a.getReferringObjects=function(e){let i,n=t.Logger.logPerformance(t.Logger.Severity.debug,"Getting referring objects.");return i=e instanceof t.BA.BaObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath}:e,new Promise((e,s)=>{r(a.GetRefferingObjectsFunction,i).then(a=>{if(!a)return;let i=[],s=0,r=t=>{i.push(t),0===s&&(n(i),e(i))};if(Object.keys(a).length>0)for(let e in a){s++;let i=a[e];t.BA.BaVariable.processBaObjectParameter(i).then(e=>{s--,null!=e&&r(e)})}else e(i)}).catch(e=>s({msg:"Getting referring objects failed!",reason:e}))})},a.AssignBaObjectToUnusedTrendFunction=t.Globals.BaDomainName+".AssignBaObjectToUnusedTrend",a.assignBaObjectToUnusedTrend=function(e){let i;return i=e instanceof t.BA.BaObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath}:e,new Promise((n,s)=>{r(a.AssignBaObjectToUnusedTrendFunction,i).then(a=>{var i,r;if(a){let a;a=e instanceof t.BA.BaObject?e:null===(r=null===(i=t.BA.BaDevices)||void 0===i?void 0:i.get(e.DeviceName))||void 0===r?void 0:r.findBaObject(e.BaObjectInstancePath),null!=a&&a instanceof t.BA.BaObject?a.getReferringObjects().then(e=>{if(e.length<=0)return void s(`BaObject '${null==a?void 0:a.InstancePath}' has no referring objects, which should not be possible at this stage!`);let i=e[0].OwnerObject;i.tryReadBaVariable(t.BA.BaParameterId.eEnable).then(e=>__awaiter(this,void 0,void 0,(function*(){e?n(!0):(yield t.Components.DialogWindow.confirm(`You assigned BaObject '${null==a?void 0:a.InstancePath}' to a new trend which is not yet enabled.\nDo you want to enable the trend?`))?i.tryWriteBaVariableValue(t.BA.BaParameterId.eEnable,!0,e=>{n(!0)}):n(!0)}))).catch(e=>s({msg:`Checking if trend object '${i.InstancePath}' is enabled failed!`,reason:e}))}):s("BaObject should be an instance of BaObject here.")}else s("Assigning of BaObject to unused trend failed! No unused trend found!")}).catch(e=>s({msg:t.Logger.crossMark+"Could not assign BaObject to unused trend!",reason:e}))})},a.RemoveBaObjectFromAssignedTrendsFunction=t.Globals.BaDomainName+".RemoveBaObjectFromAssignedTrends",a.removeBaObjectFromAssignedTrends=function(e){let i;i=e instanceof t.BA.BaObject?{DeviceName:e.Device.Description,BaObjectInstancePath:e.InstancePath}:e,r(a.RemoveBaObjectFromAssignedTrendsFunction,i).then(a=>__awaiter(this,void 0,void 0,(function*(){a||(yield t.Components.DialogWindow.alert(t.Logger.log(t.Logger.Severity.warn,"Removing BaObject from trend failed!",e)))}))).catch(e=>t.Logger.log(t.Logger.Severity.warn,t.Logger.crossMark+"Could not remove BaObject from assigned trends!",e))},a.convertIBaEventServerResult=u,a.convertIBaEventServerResults=g;const p=t.Globals.BaDomainName+".Events";a.EventsSymbols={List:p+"::List",Count:p+"::Count",AcknowledgeableCount:p+"::AcknowledgeableCount"},a.getEventList=function(){return new Promise((e,i)=>{r(a.EventsSymbols.List).then(t=>__awaiter(this,void 0,void 0,(function*(){let a;a=null==t?null:g(t),e(a)}))).catch(e=>i(t.Logger.log(t.Logger.Severity.warn,t.Logger.crossMark+`Reading events from ${t.Globals.BaDomainName} failed!`,e)))})};const v=t.Globals.BaDomainName+".EventHistory";a.EventHistorySymbols={List:v+"::List",Count:v+"::Count"},a.getEventHistory=function(){return new Promise((e,i)=>{r(a.EventHistorySymbols.List).then(t=>__awaiter(this,void 0,void 0,(function*(){let a;a=null==t?null:g(t),e(a)}))).catch(e=>i(t.Logger.log(t.Logger.Severity.warn,t.Logger.crossMark+`Reading event history from ${t.Globals.BaDomainName} failed!`,e)))})},a.EventCountPerTypeSymbol=t.Globals.BaDomainName+".EventCountPerType",a.watchEventCountPerType=function(i,n,s){let r={History:i};null!=n&&(r=n instanceof t.BA.BaBasicObject?Object.assign(Object.assign({},r),{DeviceName:n.Device.Description,BaObjectInstancePath:n.InstancePath}):Object.assign(Object.assign({},r),n));const o={commandOptions:["SendErrorMessage"],symbol:a.EventCountPerTypeSymbol,writeValue:r};return e.Server.subscribeEx([o],b.Interval,{parallel:!0},e=>{var i;if(a.checkServerResult(t.Logger.Severity.warn,e)){if(null!=(null===(i=e.response)||void 0===i?void 0:i.commands)){let t=new Map;for(let a in e.response.commands[0].readValue)t.set(Number(a),e.response.commands[0].readValue[a]);s(t)}}else t.Logger.log(t.Logger.Severity.warn,"Loading event count per event type counts failed!")})},a.AcknowledgeableEventCountPerTypeSymbol=t.Globals.BaDomainName+".AcknowledgeableEventCountPerType",a.watchAcknowledgeableEventCountPerType=function(i,n){let s=void 0;null!=i&&(s=i instanceof t.BA.BaBasicObject?{DeviceName:i.Device.Description,BaObjectInstancePath:i.InstancePath}:i);const r={commandOptions:["SendErrorMessage"],symbol:a.AcknowledgeableEventCountPerTypeSymbol,writeValue:s};return e.Server.subscribeEx([r],b.Interval,{parallel:!0},e=>{var i;if(a.checkServerResult(t.Logger.Severity.warn,e)){if(null!=(null===(i=e.response)||void 0===i?void 0:i.commands)){let t=new Map;for(let a in e.response.commands[0].readValue)t.set(Number(a),e.response.commands[0].readValue[a]);n(t)}}else t.Logger.log(t.Logger.Severity.warn,"Loading acknowledgeable event count per event type failed!")})};class m{constructor(e){this.__requests=[],this.__wait=e}add(e,t){return null==this.__timeoutId&&0==TCHMI_DESIGNER&&(this.__timeoutId=setTimeout(()=>{this.__doRequests(this.__requests),this.__requests=[],this.__timeoutId=void 0},this.__wait)),new Promise((a,i)=>{TCHMI_DESIGNER&&a(null);let n=this.__requests.find(t=>t.symbol===e);null==n&&(n={symbol:e,resolver:[],rejecter:[]},this.__requests.push(n)),null!=t?null!=n.writeValue?tchmi_equal(n.writeValue,t)?n.resolver.push(a):this.__requests.push({symbol:e,writeValue:t,resolver:[a],rejecter:[i]}):(n.writeValue=t,n.resolver.push(a),n.rejecter.push(i)):(n.resolver.push(a),n.rejecter.push(i))})}__doRequests(a){if(!e.Server.isWebsocketReady())throw Error("Websocket should be ready!");let s=t.Logger.logPerformance(t.Logger.Severity.debug,"Executing request"),r=[];a.forEach(e=>r.push({symbol:e.symbol,writeValue:e.writeValue,commandOptions:["SendErrorMessage"]}));let o={requestType:"ReadWrite",commands:r};e.Server.requestEx(o,{parallel:!0},e=>{var r,o;if(i(t.Logger.Severity.warn,e)){if(null!=(null===(r=e.response)||void 0===r?void 0:r.commands)){let i=null===(o=e.response)||void 0===o?void 0:o.commands;for(let e=0;e<i.length;e++){let s=a[e];if(n(t.Logger.Severity.warn,i[e],null)){if(!s){t.Logger.log(t.Logger.Severity.warn,`Got result for '${i[e]}' but did not find read request!`,i[e]);continue}i[e].writeValue=a[e].writeValue;for(let t=0;t<s.resolver.length;t++)s.resolver[t](i[e].readValue)}else{let t={msg:"Read request failed!",reason:i[e]};for(let i=0;i<s.rejecter.length;i++)a[e].rejecter[i](t)}}s({results:i})}}else{let t={msg:"Server request failed!",reason:e};for(let e=0;e<a.length;e++)for(let i=0;i<a[e].rejecter.length;i++)a[e].rejecter[i](t)}})}}a.ReadRequestCollector=m,a.readRequestCollector=new m(100);class b{constructor(e){this.__requests=[],this.__logger=new t.Logger({name:"SubscriptionCollector"}),this.__wait=e}add(e,t){null==this.__timeoutId&&0==TCHMI_DESIGNER&&(this.__timeoutId=setTimeout(()=>{this.__updateSubscription(),this.__timeoutId=void 0},this.__wait));let a=this.__requests.find(t=>t.symbol===e);return null==a?(a={symbol:e,commandOptions:["SendErrorMessage"],callbacks:[]},this.__requests.push(a)):void 0!==a.oldResult&&t(a.oldResult),a.callbacks.push(t),{id:a.callbacks.length-1,mapping:e}}remove(t){null==this.__timeoutId&&(this.__timeoutId=setTimeout(()=>{this.__updateSubscription(),this.__timeoutId=void 0},this.__wait));let a=this.__requests.find(e=>e.symbol===t.mapping);null!=a&&(a.callbacks.splice(t.id,1),0===(null==a?void 0:a.callbacks.length)&&(this.__requests=this.__requests.filter(e=>e.symbol!==t.mapping),0===this.__requests.length&&null!=this.__subscriptionId&&(e.Server.unsubscribeEx(this.__subscriptionId,{parallel:!0}),delete this.__subscriptionId)))}__updateSubscription(){if(this.__requests.length<=0)return;let a=this.__logger.logPerformance(t.Logger.Severity.debug,"Executing request");null!=this.__subscriptionId&&(e.Server.unsubscribeEx(this.__subscriptionId,{parallel:!0}),delete this.__subscriptionId),this.__subscriptionId=e.Server.subscribeEx(this.__requests,b.Interval,{parallel:!0},e=>{var i;if(this.__logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=(null===(i=e.response)||void 0===i?void 0:i.commands)){let i=e.response.commands;for(let e=0;e<i.length;e++)if(this.__logger.checkServerCommand(t.Logger.Severity.warn,i[e])){let a=this.__requests.find(t=>t.symbol===i[e].symbol),n=i[e].readValue;if(!a){t.Logger.log(t.Logger.Severity.warn,`Got result for '${i[e]}' but did not find request!`,i[e]);continue}if(tchmi_equal(a.oldResult,n))continue;a.oldResult=n;for(let e=0;e<a.callbacks.length;e++)a.callbacks[e](n)}a({results:i})}})}}let y;function f(e){let a=!0;if(null!=e&&"object"==typeof e){let i=new Map;i.set("deviceName","string"),i.set("address","string"),i.set("connectionStateDescription","string"),i.set("connectionState","number"),i.set("nameSpace","string"),i.set("components","object"),i.set("statistics","object"),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a}a.SubscriptionCollector=b,function(e){e.Interval=500}(b=a.SubscriptionCollector||(a.SubscriptionCollector={})),a.subscriptionCollector=new b(100),function(e){e.onAvailable="BaExtensionAvailable",e.onDiagnosticsChanged="BaExtensionDiagnosticsChanged",e.onRuntimeDiagnosticsChanged="BaExtensionRuntimeDiagnosticsChanged"}(y=a.DiagnosticsEvents||(a.DiagnosticsEvents={})),a.isIDeviceDiagnostics=f,a.baSiteExtensionAvailable=!1;let D,C=()=>{e.EventProvider.register(t.GlobalEvents.onInitialized,i=>{i.destroy();let n=!0;const s=e.Server.subscribeEx([{symbol:t.Globals.BaDomainName+".Diagnostics"}],b.Interval,{parallel:!0},i=>{var s;if(null==i.results||1!=i.results.length)throw t.Logger.log(t.Logger.Severity.error,"Server request failed",i),new Error("Server request failed!");const r=i.results[0];if(0!=r.error)return 1==a.baSiteExtensionAvailable&&(e.EventProvider.raise(a.Events.onBaSiteExtensionUnloaded),a.baSiteExtensionAvailable=!1),void(0==a.suppressBaSiteExtensionNotAvailableLog&&t.Logger.log(t.Logger.Severity.info,t.Globals.BaDomainName+" is not available.\nWorking with BaObjects of TF8040 will not be possible."));0==a.baSiteExtensionAvailable&&(e.EventProvider.raise(a.Events.onBaSiteExtensionLoaded),a.baSiteExtensionAvailable=!0);const o=r.value;if(!o.devices||Object.keys(o.devices).length<=0)return;if("string"!=typeof o.siteApiVersion)return void t.Logger.log(t.Logger.Severity.error,`SiteApi version of ${t.Globals.BaDomainName} diagnostics has invalid type`,o);if("string"!=typeof o.adsDllVersion)return void t.Logger.log(t.Logger.Severity.error,`ADS Dll version of ${t.Globals.BaDomainName} diagnostics has invalid type`,o);let l=!1,d=o.devices;if(a.Diagnostics?a.Diagnostics.siteApiVersion!==o.siteApiVersion&&(a.Diagnostics.siteApiVersion=o.siteApiVersion,l=!0):(a.Diagnostics={siteApiVersion:o.siteApiVersion,compatibleSiteServerVersion:o.compatibleSiteServerVersion,adsDllVersion:o.adsDllVersion},l=!0),null!=t.BA.BaDevices)for(let e in a.Diagnostics.devices)if(null==d[e]){const i=t.BA.BaDevices.get(e);null!=i&&(i.destroy(),delete a.Diagnostics.devices[e],t.BA.BaDevices.delete(e))}for(let i in d)if(f(d[i])){a.Diagnostics.devices||(a.Diagnostics.devices={});let s=a.Diagnostics.devices[i];s?tchmi_equal(s,d[i])||(l=!0,s.connectionState!=t.BA.BaDevice.ConnectionState.connected&&d[i].connectionState==t.BA.BaDevice.ConnectionState.connected&&S(),a.Diagnostics.devices[i]=d[i],e.EventProvider.raise(y.onRuntimeDiagnosticsChanged,d[i])):(a.Diagnostics.devices[i]=d[i],t.BA.BaDevices||(t.BA.BaDevices=new Map),t.BA.BaDevices.has(i)||t.BA.BaDevices.set(i,new t.BA.BaDevice(i)),e.EventProvider.raise(y.onRuntimeDiagnosticsChanged,d[i]),n||S(),l=!0)}else t.Logger.log(t.Logger.Severity.error,"Runtimes diagnostics do not fit to IDeviceDiagnostics interface!");if(null!=t.BA.BaDevices&&(null===(s=t.BA.BaDevices)||void 0===s?void 0:s.size)>0&&e.EventProvider.raise(T.onBaDeviesLoaded),n)return e.EventProvider.raise(y.onAvailable),t.Logger.log(t.Logger.Severity.debug,t.Logger.checkMark+(t.Globals.BaDomainName+" available."),a.Diagnostics),e.EventProvider.raise(y.onDiagnosticsChanged,a.Diagnostics),void(n=!1);l&&(t.Logger.log(t.Logger.Severity.debug,t.Globals.BaDomainName+" diagnostics have changed.",a.Diagnostics),e.EventProvider.raise(y.onDiagnosticsChanged,a.Diagnostics))});let o,l=!0,d=e.EventProvider.register(y.onAvailable,()=>{if(d(),a.getPeriodicallyUpdatedVariableIDs().then(e=>{t.Globals.PeriodicallyUpdatedVariableIds=e}),l){let t=e.Locale.get();null!=t&&H(t),w(),S()}o=e.EventProvider.register("onLocaleChanged",a=>__awaiter(this,void 0,void 0,(function*(){let a=e.Locale.get();var i;null!=a&&(yield(i=E(a),new Promise((a,n)=>{if(!e.Server.isWebsocketReady())return n("Changing locale failed because web socket is not ready!");r(t.Globals.BaDomainName+".ChangeLocale",i).then(()=>a(!0)).catch(e=>n({msg:`Changing local in ${t.Globals.BaDomainName} failed!`,locale:t.BA.LanguageManager.EChoice[i],reason:e}))})),l?l=!1:(H(a),w(),S()))})))});e.EventProvider.register(t.GlobalEvents.onWebSocketClosed,t=>{t.destroy(),o&&o(),null!=s&&e.Server.unsubscribeEx(s,{parallel:!0}),C()})})};0==TCHMI_DESIGNER&&C(),a.openDiagnosticsWindow=function(){var i;if(null!=D)return void D.open();const n=t.Globals.BaDomainName+"DiagnosticsList",s=new t.Logger({name:"OpenDiagnosticsWindow"}),r=[];function o(e){if(!e)return;let a={DataType:t.DataType.object,Children:new Map([[n+"-site-api-version",{DataType:t.DataType.string,Value:e.siteApiVersion,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.SiteApiVersion,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[n+"-compatible-site-server-version",{DataType:t.DataType.string,Value:e.compatibleSiteServerVersion,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.CompatibleSiteServerVersion,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[n+"-ads-dll-version",{DataType:t.DataType.string,Value:e.adsDllVersion,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.AdsDllVersion,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}]])},i={DataType:t.DataType.object,Children:new Map,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Devices,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]};for(let a in e.devices){let o=e.devices[a];i.Children.set(a,{Title:o.deviceName,DataType:t.DataType.object,Children:new Map([[`${n}-${a}-device-name`,{DataType:t.DataType.string,Value:o.deviceName,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.DeviceName,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}-address`,{DataType:t.DataType.string,Value:o.address,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Address,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}-connection-state`,{DataType:t.DataType.string,Value:o.connectionStateDescription,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.ConnectionState,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}-namespace`,{DataType:t.DataType.string,Value:o.nameSpace,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Namespace,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}-components`,{DataType:t.DataType.object,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Components,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}],Children:new Map([[`${n}-${a}components-bacnetRevision`,{DataType:t.DataType.string,Value:o.components.bacnetRevision,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.BACnetRevision,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}components-bacnetStackVersion`,{DataType:t.DataType.string,Value:o.components.bacnetStackVersion,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.BACnetStackVersion,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}components-tc3XBaVersion`,{DataType:t.DataType.string,Value:o.components.tc3XBaVersion,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Tc3XBaVersion,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}components-tc3Ba2CommonVersion`,{DataType:t.DataType.string,Value:o.components.tc3Ba2CommonVersion,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Tc3Ba2CommonVersion,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}components-tc3BACnetRev14Version`,{DataType:t.DataType.string,Value:o.components.tc3BACnetRev14Version,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Tc3BACnetRev14Version,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}components-siteServerVersion`,{DataType:t.DataType.string,Value:o.components.siteServerVersion,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.SiteServerVersion,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}]])}],[`${n}-${a}-statistics`,{DataType:t.DataType.object,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Statistics,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}],Children:new Map([[`${n}-${a}statistics-object-cnt`,{DataType:t.DataType.integer,Value:o.statistics.objectCount,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.AmmountBaObjects,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}statistics-plant-cnt`,{DataType:t.DataType.integer,Value:o.statistics.plantCount,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.AmmountPlants,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}-unused-trends`,{DataType:t.DataType.integer,Value:o.statistics.unusedTrendObjects,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.AmmountUnusedTrendObjects,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}],[`${n}-${a}statistics-watched-ba-variables`,{DataType:t.DataType.integer,Value:o.statistics.watchedVariables,cbOnCreated:[e=>{r.push(t.Locale.Localization.watchText(t.Locale.LangKey.AmmountWatchedVariables,a=>{s.checkServerResult(t.Logger.Severity.warn,a)&&e.setTitle(a.text)}))}]}]])}]])})}return a.Children.set(n+"-devices",i),a}let l=new t.Navigation.ParameterList(n,null,{data:o(a.Diagnostics),layout:{height:100,heightUnit:"%",width:100,widthUnit:"%"}}),d=e.EventProvider.register(y.onDiagnosticsChanged,()=>{l.setData(o(a.Diagnostics))}),_={appearance:{content:l.getElement(),buttons:t.Components.DialogWindow.Buttons.CancelSize,layout:{width:500,height:500}},callbacks:{cbClosed:()=>{d(),l.destroy(),null==D||D.destroy(),D=void 0,r.forEach(e=>e())}}};D=null===(i=t.Components.DialogWindow.createDialogWindow(_))||void 0===i?void 0:i.open(),r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Diagnostics,e=>{s.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(null==D||D.setHeadlineText(tchmi_format_string(e.text,t.Globals.BaDomainName)))}))},a.OnUnitsLoadedEvent="CustomBA.onUnitsLoaded";let H=i=>{a.getUnits().then(i=>{t.Globals.Units=i,t.Logger.log(t.Logger.Severity.info,t.Logger.checkMark+`Units were loaded from ${t.Globals.BaDomainName}.`,t.Globals.Units),e.EventProvider.raise(a.OnUnitsLoadedEvent)}).catch(e=>t.Logger.log(t.Logger.Severity.error,"Updating units failed!",e))};function w(){a.getBaStandardParameterInformation().then(i=>{t.Globals.BaStandardParameterInformation=i,t.Logger.log(t.Logger.Severity.info,t.Logger.checkMark+"BaStandardParameterInformation were loaded from "+t.Globals.BaDomainName,t.Globals.BaStandardParameterInformation),e.EventProvider.raise(a.OnBaStandardParameterInformationLoaded)}).catch(e=>t.Logger.log(t.Logger.Severity.error,"Updating BaStandardParameterInformation failed!",e))}function S(){a.getBaExtensionTypes().then(i=>{t.Globals.BaExtensionTypes=i,t.Logger.log(t.Logger.Severity.info,t.Logger.checkMark+"BaExtensionTypes were loaded from "+t.Globals.BaDomainName,t.Globals.BaExtensionTypes),e.EventProvider.raise(a.OnBaExtensionTypesLoaded)}).catch(e=>t.Logger.log(t.Logger.Severity.error,"Updating BaExtensionTypes failed!",e))}a.OnBaStandardParameterInformationLoaded="CustomBA.onBaStandardParameterInformationLoaded",a.OnBaExtensionTypesLoaded="CustomBA.onBaExtensionTypesLoaded",a.updateBaStandardParameterInformation=w,a.updateBaExtensionTypes=S;let T,E=e=>e.indexOf("de")>-1&&e.indexOf("DE")>1?t.BA.LanguageManager.EChoice.de_DE:e.indexOf("en")>-1&&e.indexOf("US")>1?t.BA.LanguageManager.EChoice.en_US:t.BA.LanguageManager.EChoice.Invalid;function x(e){return null!=e.IsEvt||null!=e.Ev}function B(e){return null!=e.Evts||null!=e.EvPI||null!=e.C}function k(e){let a=!0;if(null!=e&&"object"==typeof e){let i=new Map;i.set("ts",["string",null]),i.set("a","boolean"),i.set("h","boolean"),i.set("l","number"),i.set("d","string"),i.set("id",t.BA.isBaIdentifier),i.set("ip","string"),i.set("desc","string"),i.set("o","string"),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a}a.isIBaEventServerResult=k,function(e){e.onBaSiteExtensionLoaded="onBaSiteExtensionLoaded",e.onBaSiteExtensionUnloaded="onBaSiteExtensionUnloaded",e.onBaDeviesLoaded="onBaDevicesLoaded"}(T=a.Events||(a.Events={}))}(t.Server||(t.Server={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(t){!function(a){!function(i){const n=t.Globals.BaDomainName+".SaveUserData",s=t.Globals.BaDomainName+".LoadUserData",r=t.Globals.BaDomainName+".DeleteUserData";function o(i){return __awaiter(this,void 0,void 0,(function*(){const s=Object.assign(Object.assign({},i),{userName:e.Server.getCurrentUserConfig().name});return a.callServerFunctionEx(n,s).catch(e=>{t.Logger.log(t.Logger.Severity.warn,`Saving user data for user "${s.userName}" with subject "${s.subject}" failed!`,e)})}))}function l(t){return __awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},t),{userName:e.Server.getCurrentUserConfig().name});return new Promise((e,t)=>{a.callServerFunctionEx(s,i).then(t=>null==t||"string"==typeof t&&0==t.length?e(null):void e(t)).catch(e=>{t({msg:`Loading user data for user "${i.userName}" with subject "${i.subject}" failed!`,reason:e})})})}))}function d(e){return __awaiter(this,void 0,void 0,(function*(){return o({subject:"TrendCollectionSelection",data:{selectedTrendCollection:e}})}))}i.saveLastContent=function(e){return __awaiter(this,void 0,void 0,(function*(){return o({subject:"LastContent",data:{lastContentPath:e}})}))},i.loadLastContent=function(){return __awaiter(this,void 0,void 0,(function*(){return l({subject:"LastContent"})}))},i.saveLastTheme=function(e){return __awaiter(this,void 0,void 0,(function*(){return o({subject:"LastTheme",data:{lastTheme:e}})}))},i.loadLastTheme=function(){return __awaiter(this,void 0,void 0,(function*(){return l({subject:"LastTheme"})}))},i.saveTrendSettings=function(e,t){return __awaiter(this,void 0,void 0,(function*(){return o({subject:"TrendSettings",data:{trendName:e,settings:t}})}))},i.loadTrendSettings=function(e){return __awaiter(this,void 0,void 0,(function*(){return l({subject:"TrendSettings",data:{trendName:e}})}))},i.saveAxisSettings=function(e,t){return __awaiter(this,void 0,void 0,(function*(){return o({subject:"AxisOptions",data:{axisName:e,options:t}})}))},i.loadAxisSettings=function(e){return __awaiter(this,void 0,void 0,(function*(){return l({subject:"AxisOptions",data:{axisName:e}})}))},i.saveTrendCollectionSelection=d,i.loadTrendCollectionSelection=function(){return __awaiter(this,void 0,void 0,(function*(){return l({subject:"TrendCollectionSelection"})}))},i.deleteTrendCollectionSelection=function(i){return __awaiter(this,void 0,void 0,(function*(){return function(i){return __awaiter(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},i),{userName:e.Server.getCurrentUserConfig().name});return a.callServerFunctionEx(r,n).catch(e=>{t.Logger.log(t.Logger.Severity.warn,`Deleting user data for user "${n.userName}" with subject "${n.subject}" failed!`,e)})}))}({subject:"TrendCollectionSelection",data:{selectedTrendCollection:i}})}))};const _=t.Globals.BaDomainName+".SaveTrendCollection";function h(i,n){return __awaiter(this,void 0,void 0,(function*(){return a.callServerFunctionEx(_,{trendCollectionName:i,userName:e.Server.getCurrentUserConfig().name,root:n.root,baObjects:n.baObjects}).catch(e=>{t.Logger.log(t.Logger.Severity.warn,`Saving trend collection "${i}" failed!`,e)})}))}i.saveTrendCollection=h;const c=t.Globals.BaDomainName+".LoadTrendCollections";i.loadTrendCollections=function(){return __awaiter(this,void 0,void 0,(function*(){return new Promise((i,n)=>{a.callServerFunctionEx(c,{userName:e.Server.getCurrentUserConfig().name}).then(e=>{if(null==e)return n(`No trend collections have been returned from ${t.Globals.BaDomainName}!`);i(e)}).catch(e=>{n({msg:"Loading trend collections failed!",reason:e})})})}))};const u=t.Globals.BaDomainName+".DeleteTrendCollection";i.deleteTrendCollection=function(i){return __awaiter(this,void 0,void 0,(function*(){return a.callServerFunctionEx(u,{trendCollectionName:i,userName:e.Server.getCurrentUserConfig().name}).catch(e=>{t.Logger.log(t.Logger.Severity.warn,`Deleting trend collection "${i}" failed!`,e)})}))},i.saveOldLocalUserData=function(){return __awaiter(this,void 0,void 0,(function*(){const e=new t.System.DataStorage(["charting","trends","baTrendCollectionStorage"]);e.readData().then(t=>__awaiter(this,void 0,void 0,(function*(){for(let t in e.data){let a=e.data[t];yield h(t,a)}})));const a=new t.System.DataStorage(["charting","trends","baTrendCollectionSelection"]);a.readData().then(e=>__awaiter(this,void 0,void 0,(function*(){var e;null===(e=a.data)||void 0===e||e.forEach(e=>__awaiter(this,void 0,void 0,(function*(){yield d(e)})))})))}))},i.removeOldLocalUserData=function(){return __awaiter(this,void 0,void 0,(function*(){t.System.LocalStorage.clear()}))}}(a.UserData||(a.UserData={}))}(t.Server||(t.Server={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let a;!function(a){let i;!function(a){let i;!function(e){e.observe="observe",e.operate="operate"}(i=a.AccessRight||(a.AccessRight={}));let n=!0;function s(){let a=e.Server.getCurrentUserConfig().userIsInGroups,i=t.BA.Role.Undefined;return a.includes("Internal")||a.includes("__SystemAdministrators")?i=t.BA.Role.eInternal:a.includes("Expert")?i=t.BA.Role.eExpert:a.includes("Advanced")?i=t.BA.Role.eAdvanced:a.includes("Basic")?i=t.BA.Role.eBasic:a.includes("Guest")?i=t.BA.Role.eGuest:TCHMI_DESIGNER||TCHMI_LIVEVIEW?i=t.BA.Role.eInternal:(i=t.BA.Role.eGuest,n&&(console.warn(`Current user has undefined group / access level! Please login a user! \nUser is now in group ${t.BA.Role[i]}!`),n=!1)),i}a.checkAccess=function(e){return s()>=e},a.getBaRole=s}(i=a.UserManagement||(a.UserManagement={}))}(a=t.Server||(t.Server={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){let t;!function(t){let a;!function(a){class i{constructor(e,a,i,n){this.IsTop=!1,this.__watchedBaVariables=[],this.__propertyWatches=new Map,this.__isLoadingAttributes={includeChildren:!1,excludeChildren:!1},this.__loadingAttributesReady={},this.logger=new t.Logger({name:a,className:this.constructor.name}),this.Mapping=a,this.Device=i,this.IsTop=1==n&&n,this.IsTop||null!=e.InstancePath||this.logger.log(t.Logger.Severity.error,"Instance path of BaBasicObject was not set",this),this.InstancePath=e.InstancePath,null==e.Identifier&&this.logger.log(t.Logger.Severity.error,"Identifier of BaBasicObject was not set",this),this.Identifier=e.Identifier,this.IdentifierEx={deviceName:this.Device.Description,instancePath:this.InstancePath},this.setAttributes(e)}get AllParams(){let e=[];if(null!=this.Params)for(let t of this.Params.values())e.push(t);if(null!=this.AddParams)for(let t of this.AddParams.values())e.push(t);return e}setAttributes(e){if(null!=e.SubjectInfo&&(this.SubjectInfo=e.SubjectInfo),null!=e.Purpose&&(this.Purpose=e.Purpose),null!=e.OperationType&&(this.OperationType=e.OperationType),null!=e.NodeType&&(this.NodeType=e.NodeType),null!=e.DataType&&(this.DataType=e.DataType),null!=e.TypeName&&(this.TypeName=e.TypeName),null!=e.texts&&this.setTexts(e.texts),null!=e.Params){null==this.Params&&(this.Params=new Map);for(let[t,i]of e.Params)this.Params.has(i.Info.ID)||this.Params.set(i.Info.ID,new a.BaVariable(t,i,this))}if(null!=e.AddParams){null==this.AddParams&&(this.AddParams=new Map);for(let[t,i]of e.AddParams)this.AddParams.has(t)||this.AddParams.set(t,new a.BaVariable(t,i,this))}}setTexts(e){if(this.texts={description:e.description,instDescription:e.instDescription,objectName:e.objectName,instObjectName:e.instObjectName},this instanceof a.BaView&&null!=e.children)for(let[t,a]of this.Children){let i=e.children.get(t);if(null==i)throw new Error("Invalid texts have been set!");a.setTexts(i)}}getContent(){return __awaiter(this,void 0,void 0,(function*(){return new Promise((i,n)=>{if(null==this.__content){let n=e.Config.get().content,s=this.tryGetBaVariable(a.BaParameterId.eSymbolPath);if(null!=s){const e=()=>{var e,a;this.__content=null===(e=n.find(e=>e.url.indexOf(s.Value+".content")>-1))||void 0===e?void 0:e.url,null==this.__content&&(this.__content=null===(a=n.find(e=>e.url.indexOf(s.Value.replaceAll(".","_")+".content")>-1))||void 0===a?void 0:a.url,null!=this.__content&&this.logger.log(t.Logger.Severity.warn,"Underscores in names of contents regarding to BaObjects in the project structure must be replaced with dots.\nOld approach: MyProject_MAIN_MyObject.content\nNew approch: MyProject.MAIN.MyObject.content"),i(void 0)),i(this.__content)};null==s.Value?s.read().then(()=>{e()}):e()}}else i(this.__content)})}))}acknowledge(){t.Server.confirmBaObject(this)}getSymbolExpression(){return new e.SymbolExpression(`%s%${this.Mapping}%/s%`)}getIsValid(e=!1,t=!1){if(!i.isIBaBasicObjectAttributes(this))return!1;if(e&&this instanceof a.BaView&&this.Children.size>0)for(let a of this.Children.values())if(!a.getIsValid(e,t))return!1;return!t||null!=this.texts}get isNotValidText(){return`BaBasicObject '${this.InstancePath}' is not valid!`}checkAddParams(e,a){if(!this.getIsValid(!1,!1))return this.logger.log(t.Logger.Severity.warn,"Checking for additional parameters is only possible if attributes have been loaded before. Please call loadAttributes() before."),!1;if(null==this.AddParams)return!1;for(let t in e){let i=a[t],n=e[t];if(null==i||!n.optional&&!this.AddParams.has(i.symbolName))return!1}return this.__baInterfaceSymName=a,!0}checkTemplate(e,t,i,n=!0){return this instanceof a.BaView?!!a.BaView.verifyTemplate(this,e,t)||(null!=i&&(this.logIncorrectTemplate(i.logger),n&&this.alertInvalidTemplate(i.getId())),!1):(null!=i&&(this.logIsNotBaView(i.logger),n&&this.alertInvalidTemplate(i.getId())),!1)}logIsNotBaView(e){e.log(t.Logger.Severity.warn,"Invalid template! BaObject was not a BaView!",this)}alertInvalidTemplate(e,a=!0){let i=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.InvalidTemplateBound),e);t.Components.DialogWindow.alert(i,{skipLog:a})}logInvalidBaObject(e,a=!0){let i=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.InvalidBaObjectBound),e);a&&t.Components.DialogWindow.alert(i,{skipLog:!0}),this.logger.log(t.Logger.Severity.warn,i)}loadAttributes(e=!1,a=!1){return __awaiter(this,void 0,void 0,(function*(){let n=()=>{e?(this.__isLoadingAttributes.includeChildren=!1,this.__loadingAttributesReady.includeChildren&&(this.__loadingAttributesReady.includeChildren.resolver.forEach(e=>e(this)),delete this.__loadingAttributesReady.includeChildren)):(this.__isLoadingAttributes.excludeChildren=!1,this.__loadingAttributesReady.excludeChildren&&(this.__loadingAttributesReady.excludeChildren.resolver.forEach(e=>e(this)),delete this.__loadingAttributesReady.excludeChildren))},s=t=>{e?(this.__isLoadingAttributes.includeChildren=!1,this.__loadingAttributesReady.includeChildren&&(this.__loadingAttributesReady.includeChildren.rejecter.forEach(e=>e(t)),delete this.__loadingAttributesReady.includeChildren)):(this.__isLoadingAttributes.excludeChildren=!1,this.__loadingAttributesReady.excludeChildren&&(this.__loadingAttributesReady.excludeChildren.rejecter.forEach(e=>e(t)),delete this.__loadingAttributesReady.excludeChildren))};return new Promise((r,o)=>{if(e){if(this.__isLoadingAttributes.includeChildren)return this.__loadingAttributesReady.includeChildren||(this.__loadingAttributesReady.includeChildren={resolver:[],rejecter:[]}),this.__loadingAttributesReady.includeChildren.resolver.push(r),void this.__loadingAttributesReady.includeChildren.rejecter.push(o);this.__isLoadingAttributes.includeChildren=!0}else{if(this.__isLoadingAttributes.excludeChildren)return this.__loadingAttributesReady.excludeChildren||(this.__loadingAttributesReady.excludeChildren={resolver:[],rejecter:[]}),this.__loadingAttributesReady.excludeChildren.resolver.push(r),void this.__loadingAttributesReady.excludeChildren.rejecter.push(o);this.__isLoadingAttributes.excludeChildren=!0}i.isIBaBasicObjectAttributes(this)&&this.getIsValid(e)?this.getIsValid(e,a)?(r(this),n()):this.loadTexts(e).then(()=>{r(this),n()}).catch(e=>{o(e),s(e)}):t.Server.getBaObject(this,e,a).then(t=>{try{if(!this.getIsValid(e,a)||!i.isIBaBasicObjectAttributes(this))throw new Error;r(this),n()}catch(e){let a={msg:`Loading attributes of BaBasicObject with mapping '${this.Mapping}' was not successfull.`,info:{baObj:this,requestResult:t}};o(a),s(a)}}).catch(e=>{o(e={msg:"Getting BaObject failed!",reason:e}),s(e)})})}))}loadTexts(e=!1){return __awaiter(this,void 0,void 0,(function*(){return new Promise((a,i)=>{null!=this.texts&&a(),t.Server.getBaObjectTexts(this,e).then(e=>{this.setTexts(e),a()}).catch(e=>i({msg:`Loading texts of BaObject ${this.InstancePath} failed!`,reason:e}))})}))}updateObjectInfo(){return new Promise((e,i)=>{var n;if(this.IsTop||!this.getIsValid())return e();let s=0;null===(n=t.Globals.PeriodicallyUpdatedVariableIds)||void 0===n||n.forEach(t=>{let a=this.tryGetBaVariable(t);a&&null!=a.Value&&(s++,a.read().then(()=>{null==a||a.invokeNoWatchCallbacks(),s--,0==s&&0==r&&e()}).catch(e=>i(e)))});let r=0;for(let t=0;t<this.AllParams.length;t++)if(a.BaVariable.isIBaEnumeratingParameterInfo(this.AllParams[t].Info)){let a=this.AllParams[t];r++,a.updateValueRange().then(()=>{r--,0==s&&0==r&&e()})}0==s&&0==r&&e()})}watchProperty(e,a){let i=this.__propertyWatches.get(e);null==i&&(i={callbacks:new Map},i.subscriptionId=t.Server.subscriptionCollector.add(this.Mapping+"::"+e,a=>{if(this[e]="Event"==e?t.Server.convertIBaEventServerResult(a):"Events"==e||"EventHistory"==e?t.Server.convertIBaEventServerResults(a):a,i)for(let t of i.callbacks.values())t(this[e])}),this.__propertyWatches.set(e,i)),i=this.__propertyWatches.get(e);let n=0;for(;i.callbacks.has(n);)n++;i.callbacks.set(n,a);let s=this[e];return null!=s&&a(s),n}stopWatchProperty(e,t){let a=this.__propertyWatches.get(e);null!=a&&(a.callbacks.delete(t),0===a.callbacks.size&&this.stopAllWatchesProperty(e))}stopAllWatchesProperty(e){let a=this.__propertyWatches.get(e);null!=a&&(null!=a.subscriptionId&&t.Server.subscriptionCollector.remove(a.subscriptionId),this.__propertyWatches.delete(e))}tryGetBaVariable(e){var a;if(this.getIsValid()){let i;if("number"==typeof e)i=this.Params.get(e);else{for(let t of this.Params.values())if(t.InstanceName===e){i=t;break}if(null==i){if(null==this.__baInterfaceSymName)return void this.logger.log(t.Logger.Severity.warn,"Getting an additional parameter is only possible after calling checkAddParams()!");i=null===(a=this.AddParams)||void 0===a?void 0:a.get(this.__baInterfaceSymName[e].symbolName)}}return i}this.logger.log(t.Logger.Severity.warn,"BaBasicObject is not valid. Please load attributes first!")}tryReadBaVariable(e){return new Promise((a,i)=>{let n=this.tryGetBaVariable(e);void 0!==n?n.read().then(e=>a(e)).catch(e=>i(e)):i(this.logger.log(t.Logger.Severity.warn,`BaVariable '${String(e)}' was not found.`))})}tryWriteBaVariableValue(e,t,a){let i=this.tryGetBaVariable(e);return null!=i&&(i.write(t,a),!0)}tryWatchBaVariable(e,i){let n=this.tryGetBaVariable(e);if(void 0!==n)return this.__watchedBaVariables.includes(n.InstanceName)||this.__watchedBaVariables.push(n.InstanceName),{InstanceName:n.InstanceName,WatchId:n.watch(i)};{let n;return n="number"==typeof e?a.BaParameterId[e]:e,this.logger.log(t.Logger.Severity.warn,`Variable with id '${n}' is not available!`,this),void i(void 0)}}stopWatchBaVariable(e){if(this.__watchedBaVariables.includes(e.InstanceName)){let t=this.tryGetBaVariable(e.InstanceName);t.stopWatch(e.WatchId),t.watchesCount()||(this.__watchedBaVariables=this.__watchedBaVariables.filter(t=>t!==e.InstanceName))}}stopAllWatchesBaVariable(e){let t=this.tryGetBaVariable(e);if(null!=t&&this.__watchedBaVariables.includes(t.InstanceName)){let t=this.tryGetBaVariable(e);t.stopAllWatches(),this.__watchedBaVariables=this.__watchedBaVariables.filter(e=>e!==t.InstanceName)}}stopAllWatches(){for(let e=0;e<this.__watchedBaVariables.length;e++){this.tryGetBaVariable(this.__watchedBaVariables[e]).stopAllWatches()}this.__watchedBaVariables=[];for(let e of this.__propertyWatches.keys())this.stopAllWatchesProperty(e),this.__propertyWatches.delete(e)}openParameterDialog(i="Parameter"){var n,s,r,o,l,d,_;if(this.__parameterDialog){switch(i){case"Parameter":this.__parameterDialog.setContent(null===(d=this.__baVarList)||void 0===d?void 0:d.getElement());break;case"Events":this.__eventList&&this.__parameterDialog.setContent(null===(_=this.__eventList)||void 0===_?void 0:_.getElement())}let e=this.__parameterDialog.controlContainer.getControl("special-visu-toggle");e&&e.setToggleState(!1),this.__parameterDialog.open()}else{if(!this.getIsValid())return this.logger.log(t.Logger.Severity.warn,"Opening of BaBasicObjects parameter dialog failed, because it is not valid. Make sure to call loadAttributes() before.",this),null;this.IsTop&&this.logger.log(t.Logger.Severity.warn,`Project structure of device '${this.Device.Description}' does not have any parameter. Parameter window will not have any entries!`),this.__baVarList||(this.__baVarList=new t.Navigation.ParameterList(this.InstancePath+"-ba-var-list",null,{valueHandler:{autoWrite:!1}})),this.__baVarList.getElement().css({position:"relative",height:"100%",width:"100%"});let d={DataType:t.DataType.object,Title:this.InstancePath,Children:new Map};for(let e of this.AllParams)e.HasPrimitiveValue&&e.DataType!=t.DataType.array&&e.DataType!=t.DataType.object&&d.Children.set(e.InstanceName,e);this.__baVarList.setData(d);let _,h=[];if(a.Helper&&a.Helper.hasSpecialVisu(this)){let e;h.push({name:"special-visu-toggle",type:t.Components.ComponentType.ToggleButton,callback:t=>{var i,n,s,r;null===(n=null===(i=this.__parameterDialog)||void 0===i?void 0:i.controlContainer.getControl("event-list-toggle"))||void 0===n||n.setToggleState(!1),t?(e||(e=a.Helper.getSpecialVisu(this,null,this.__parameterDialog,!0)),this.__baVarList.getElement().detach(),null===(s=this.__parameterDialog)||void 0===s||s.setContent(e)):(null==e||e.detach(),null===(r=this.__parameterDialog)||void 0===r||r.setContent(this.__baVarList.getElement()))},settings:{background:{image:t.Icons.Standard.Right_Arrow.path,useSVG:!0}}})}if((this instanceof a.BaObject&&1==this.IsEventEnabled||this instanceof a.BaView)&&(t.Controls.Management.EventList?(this.__eventList=e.ControlFactory.createEx("TcHmi.BuildingAutomation.Controls.Management.EventList",this.InstancePath+"-event-list",null,e.View.get()),this.__eventList&&(null===(n=this.__eventList)||void 0===n||n.getElement().detach(),this.__eventList.getElement().css({position:"relative",height:"100%",width:"100%"}),this.__eventList.setBaObject(this),h.push({name:"event-list-toggle",type:t.Components.ComponentType.ToggleButton,callback:e=>{var t,a,i,n;null===(a=null===(t=this.__parameterDialog)||void 0===t?void 0:t.controlContainer.getControl("special-visu-toggle"))||void 0===a||a.setToggleState(!1),e?(this.__baVarList.getElement().detach(),null===(i=this.__parameterDialog)||void 0===i||i.setContent(this.__eventList.getElement())):(this.__eventList.getElement().detach(),null===(n=this.__parameterDialog)||void 0===n||n.setContent(this.__baVarList.getElement()))},settings:{background:{image:t.Icons.Events.Event.Alarm.path,useSVG:!0},toggleState:"Events"===i}}))):this.logger.log(t.Logger.Severity.debug,"Control BuildingAutomation.Controls.EventList is not available. If you want to use EventLists include TcHmiBaControls.")),this.isTrendable()||this.isTrendObject()||this instanceof a.BaView&&(this.getTrendableObjects().length>0||this.getBaTrendObjects().length>0)){if(_=t.Components.ContextMenu.createContextMenuAndButton({id:this.InstancePath+"-context-menu",rowEntryOptions:[]}),_.button.backgroundStyler.setAttributes({image:"/"+t.Icons.Standard.Graph.path,imageHeight:80,imageWidth:80}),_.menu.addRowEntry([{onPressed:()=>{this instanceof a.BaView?t.Charting.Trend.CollectionConfigurator.open({baView:this,modal:!1}):t.Charting.Trend.CollectionConfigurator.open({modal:!1}),null==_||_.menu.close()},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.NewTrendCollection,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})}},{onPressed:()=>{null!=t.Charting.Trend.CollectionView.showsTrendCollections()?t.Charting.Trend.CollectionView.open():t.Charting.Trend.CollectionConfigurator.selectCollection().then(e=>{null!=e&&t.Charting.Trend.CollectionView.open(e)}),null==_||_.menu.close()},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.TrendCollections,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})}}]),this instanceof a.BaView&&this.getTrendableObjects().length>0||this.isTrendable()){let e=null;_.menu.addRowEntry({cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.NewLiveTrend,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})},onPressed:()=>{let i,n=t.Charting.Trend.createBaOnlineTrend(this);if(n){n.getElement().addClass("tchmi-ba-trend-in-dialog").css({position:"relative",height:"100%",width:"100%"});let s={appearance:{content:n.getElement(),buttons:t.Components.DialogWindow.Buttons.CancelSize,layout:{height:250,width:450,right:0,bottom:0}},callbacks:{cbClosed:()=>{n.destroy(),null!=i&&this.stopWatchBaVariable(i)}},behaviour:{destroyOnClose:!0}};e||(e=t.Components.DialogWindow.createDialogWindow(s),i=this.tryWatchBaVariable(a.BaParameterId.eDescription,t=>{null==e||e.getHeadline().textHandler.setText("Online Trend | "+t)}),null==e||e.controlContainer.addControl(n.getMenuButton())),null==e||e.open()}null==_||_.menu.close()}})}if(this instanceof a.BaView&&this.getBaTrendObjects().length>0)_.menu.addRowEntry({cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.Trends,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})},onPressed:()=>{let e=new t.Charting.Trend(this.InstancePath+"-trends",null);e.getElement().css({position:"relative",height:"100%",width:"100%"}),e.baObjectHandler.setBaObject(this),t.Components.DialogWindow.openDialogWindow({appearance:{content:e.getElement(),controls:e.getMenuButton(),modal:!0,buttons:t.Components.DialogWindow.Buttons.Cancel},callbacks:{cbClosed:()=>{e.destroy()}},behaviour:{destroyOnClose:!0}}),e.getElement().addClass("tchmi-ba-trend-in-dialog"),null==_||_.menu.close()}});else if(this.isTrendObject()){let e=this.tryGetBaVariable(a.BaParameterId.eReferencedParam);e&&e.read().then(e=>{null!=e&&(null==_||_.menu.addRowEntry({cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.ReferredObject,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text+" "+t.Globals.HTMLSymbols.Link)})},onPressed:()=>{e.ReferenceObject.openParameterDialog("Parameter"),null==_||_.menu.close()}}))})}else this.isTrendable()&&this.isTrendable()&&this.getIsValid()&&(_.menu.layoutHandler.setAttributes({width:150,widthUnit:"px"}),_.menu.addRowEntry([{name:"AssignedToTrendEntry",controls:{type:t.Components.ComponentType.Checkbox,name:"AssignedToTrendCb",settings:{readOnly:!1,textAttributes:{horizontalAlignment:"Center"}},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.AssignedToTrend,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&(e.setActiveText(a.text),e.setInactiveText(a.text))})},callback:e=>__awaiter(this,void 0,void 0,(function*(){var a;let i=null===(a=null==_?void 0:_.menu.getRowEntry("AssignedToTrendEntry"))||void 0===a?void 0:a.controlContainer.getControl("AssignedToTrendCb");if(e)if(yield t.Components.DialogWindow.confirm(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmAssignToTrend))){let e=_.menu.busyHandler.setBusy("Assigning to trend.");t.Server.assignBaObjectToUnusedTrend(this).then(()=>{e()}).catch(a=>{this.logger.log(t.Logger.Severity.warn,"Assign to unused trend failed",a),e()})}else null==i||i.setState(!e);else(yield t.Components.DialogWindow.confirm(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmRemoveFromTrend)))?t.Server.removeBaObjectFromAssignedTrends(this):null==i||i.setState(!e);null==_||_.menu.close()}))}}]),this.getReferringObjects().then(e=>{var i;let n=null===(i=null==_?void 0:_.menu.getRowEntry("AssignedToTrendEntry"))||void 0===i?void 0:i.controlContainer.getControl("AssignedToTrendCb");n&&(n.setState(e.length>0),e.length>0&&(null==_||_.menu.addRowEntry([{cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.ReferringTrend,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text+" "+t.Globals.HTMLSymbols.Link)})},onPressed:()=>__awaiter(this,void 0,void 0,(function*(){var i;if(e.length>0){e.length>1&&(yield t.Components.DialogWindow.alert(`Object has ${e.length} referring objects. Only the first will be shown.`));let n=e[0].OwnerObject;if(n.isTrendObject()){let e=n.InstancePath+"-trend",s=1;for(;t.Globals.CreatedBaseNodes.has(e);)e=n.InstancePath+"-trend-"+s,s++;let r=new t.Charting.Trend(e,null);r.baObjectHandler.setBaObject(n);let o=null===(i=t.Components.DialogWindow.createDialogWindow({appearance:{content:r.getElement(),controls:r.getMenuButton(),modal:!1,buttons:t.Components.DialogWindow.Buttons.CancelSize},callbacks:{cbClosed:()=>{r.destroy()}},behaviour:{destroyOnClose:!0}}))||void 0===i?void 0:i.open();n.tryReadBaVariable(a.BaParameterId.eDescription).then(e=>null==o?void 0:o.setHeadlineText(e)),r.getElement().addClass("tchmi-ba-trend-in-dialog")}null==_||_.menu.close()}}))}])))}).catch(e=>this.logger.log(t.Logger.Severity.warn,e)));h.push(_.button)}let c,u=()=>{for(let e of this.AllParams)void 0!==e.editedValue&&(e.write(e.editedValue),delete e.editedValue)},g=()=>{var e,t;this.__baVarList.closeAllEntries(),this.__baVarList.destroy(),delete this.__baVarList,null===(e=this.__eventList)||void 0===e||e.destroy(),delete this.__eventList,null==_||_.menu.destroy(),null==_||_.button.destroy(),null===(t=this.__parameterDialog)||void 0===t||t.destroy(),delete this.__parameterDialog,null!=c&&this.stopWatchBaVariable(c)},p={appearance:{content:"Events"===i?null===(s=this.__eventList)||void 0===s?void 0:s.getElement():null===(r=this.__baVarList)||void 0===r?void 0:r.getElement(),buttons:t.Components.DialogWindow.Buttons.OkCancelSize,layout:{width:800},modal:!1,controls:h},callbacks:{cbClosed:g,cbConfirmed:u}};if(this.__parameterDialog=null===(o=t.Components.DialogWindow.createDialogWindow(p))||void 0===o?void 0:o.open(),this.IsTop){let e=t.Locale.Localization.getText(t.Locale.LangKey.ProjectStructure);null===(l=this.__parameterDialog)||void 0===l||l.getHeadline().textHandler.setText(e+" "+this.Device.Description)}else c=this.tryWatchBaVariable(a.BaParameterId.eInstDescription,e=>{var t;null===(t=this.__parameterDialog)||void 0===t||t.getHeadline().textHandler.setText(e)})}return this.__parameterDialog}matchesFilter(e,i){if(this.texts){0===i.length&&i.push(a.BaParameterId.eInstDescription,a.BaParameterId.eDescription,a.BaParameterId.eInstObjectName,a.BaParameterId.eObjectName,a.BaParameterId.eSymbolPath);for(let t=0;t<i.length;t++)switch(i[t]){case a.BaParameterId.eInstDescription:if(this.texts.instDescription.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;case a.BaParameterId.eDescription:if(this.texts.description.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;case a.BaParameterId.eInstObjectName:if(this.texts.instObjectName.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;case a.BaParameterId.eObjectName:if(this.texts.objectName.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;case a.BaParameterId.eSymbolPath:if(this.InstancePath.toUpperCase().indexOf(e.toUpperCase())>-1)return!0;break;default:console.warn("Filter option not implemented yet!")}return!1}return this.logger.log(t.Logger.Severity.warn,"BaBasicObject texts have not been loaded. Please looad text first by calling loadTexts()!"),!1}hasSpecialVisu(){return!this.IsTop&&!(!this.isTrendObject()&&this.Identifier.ObjectType!==a.ObjectType.eSchedule&&this.Identifier.ObjectType!==a.ObjectType.eCalendar)}checkParameterAccess(e,a){let i=this.tryGetBaVariable(e);return null==i?(this.logger.log(t.Logger.Severity.warn,`´BaObject does not has a variable with id or name '${String(e)}'`,this),!1):i.checkUserAccess(a)}checkManualValueWriteAccess(){if(this.getIsValid()){if(this.OperationType===a.OperationType.eDisplayValue)return!1;if(this.Params.has(a.BaParameterId.eEnManualRm)&&this.checkParameterAccess(a.BaParameterId.eEnManualRm,a.Scope.write)){if(this.checkParameterAccess(a.BaParameterId.eValManualRm,a.Scope.write))return!0}else{if(this.Params.has(a.BaParameterId.eOutOfService)&&this.checkParameterAccess(a.BaParameterId.eOutOfService,a.Scope.write))return!1;if(this.Params.has(a.BaParameterId.ePresentValue)&&this.checkParameterAccess(a.BaParameterId.ePresentValue,a.Scope.write))return!0}}return!1}destroy(){this.stopAllWatches();for(let e of this.AllParams.values())e.destroy()}static getNodeTypeIcon(e){let i=a.NodeType[e];return t.Icons.NodeType[i.slice(1,i.length)]}static convertToMap(e){if(!(e instanceof Map)){let t=new Map;if(e instanceof Array)for(let a=0;a<e.length;a++)t.set(a.toString(),e[a]);else for(let a in e)t.set(a,e[a]);return t}return e}}a.BaBasicObject=i,function(e){function i(e){let t=!0;if(null!=e&&"object"==typeof e){if(e instanceof Map){for(let i of e.values())if(!a.BaVariable.isIBaVariableAttributes(i)){t=!1;break}}else for(let i in e)if(!a.BaVariable.isIBaVariableAttributes(e[i])){t=!1;break}}else t=!1;return t}e.isIBaBasicObjectAttributes=function(e){let n=!0;if(null!=e&&"object"==typeof e){let s=new Map;s.set("Identifier",a.isBaIdentifier),s.set("Purpose",["number",()=>e.Purpose>0]),s.set("OperationType",["number",()=>e.OperationType>-1]),s.set("NodeType",["number",()=>e.NodeType>-1]),s.set("DataType",["number",()=>e.DataType>-1]),null!=e.Params&&s.set("Params",i),t.TypeGuards.validateProperties(e,s)||(n=!1)}else n=!1;return n},e.isBaObjectVariables=i}(i=a.BaBasicObject||(a.BaBasicObject={}))}(a=t.BA||(t.BA={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(e){let t;!function(t){class a extends t.BaBasicObject{constructor(e,t,a,i){super(e,t,a,i)}setAttributes(t){super.setAttributes(t),null!=t.IsEventEnabled&&(this.IsEventEnabled=t.IsEventEnabled),t.IsEventEnabled&&null!=t.Event&&(e.Server.isIBaEventServerResult(t.Event)&&(t.Event=e.Server.convertIBaEventServerResult(t.Event)),t.Event instanceof a.BaEvent?this.Event=t.Event:this.Event=new a.BaEvent(t.Event,this))}watchEventsPerIcon(e){if(!this.IsEventEnabled)return console.warn("Watching of EventPerIcon only possible for event enabled BaObjects",this),null;if(!this.__eventWatches){let e;this.__eventWatches={};let a=this.tryGetBaVariable(t.BaParameterId.eStatusFlags);a&&(this.__eventWatches.statusFlags=a.watch(a=>{var n;null==this.__activeEvents&&(this.__activeEvents=new Map),null!=a&&(e=this.__activeEvents.get(t.EventCondition.eFlagOutOfService),a.OutOfService?e||this.__activeEvents.set(t.EventCondition.eFlagOutOfService,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1}):this.__activeEvents.delete(t.EventCondition.eFlagOutOfService),e=this.__activeEvents.get(t.EventCondition.eFlagOverridden),a.Overridden?e||this.__activeEvents.set(t.EventCondition.eFlagOverridden,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1}):this.__activeEvents.delete(t.EventCondition.eFlagOverridden),null!=(null===(n=this.__eventWatches)||void 0===n?void 0:n.callbacks)&&i.invokeEventCallbacks(this.__activeEvents,this.__eventWatches.callbacks))})),this.Event&&(this.__eventWatches.event=this.Event.watch(a=>{var n;if(null==this.__activeEvents&&(this.__activeEvents=new Map),null!=a){if(a.IsActive&&a.Type>t.EventType.Invalid){e=this.__activeEvents.get(a.Type),e?e.eMostPriorisedState=a.State:this.__activeEvents.set(a.Type,{eMostPriorisedState:a.State,nCount:1});for(let e=t.EventCondition.eLockPrioLocalMedium;e<=t.EventCondition.eLockPrioHigh;e++)this.__activeEvents.delete(e);switch(a.LockPriority){case t.LockPriority.eLocalMedium:this.__activeEvents.set(t.EventCondition.eLockPrioLocalMedium,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.LockPriority.eLocalHigh:this.__activeEvents.set(t.EventCondition.eLockPrioLocalHigh,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.LockPriority.eMedium:this.__activeEvents.set(t.EventCondition.eLockPrioMedium,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.LockPriority.eLocalHigh:this.__activeEvents.set(t.EventCondition.eLockPrioHigh,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1})}}else{for(let e=t.EventCondition.eTypeAlarm;e<=t.EventCondition.eTypeOther;e++)this.__activeEvents.delete(e);for(let e=t.EventCondition.eLockPrioLocalMedium;e<=t.EventCondition.eLockPrioHigh;e++)this.__activeEvents.delete(e)}null!=(null===(n=this.__eventWatches)||void 0===n?void 0:n.callbacks)&&i.invokeEventCallbacks(this.__activeEvents,this.__eventWatches.callbacks)}}));let n=this.tryGetBaVariable(t.BaParameterId.eActivePriority);n&&(this.__eventWatches.activePrio=n.watch(e=>{var a;if(null==this.__activeEvents&&(this.__activeEvents=new Map),null!==e){for(let e=t.EventCondition.ePrioLifeSafety;e<=t.EventCondition.ePrioManualRemote;e++)this.__activeEvents.delete(e);switch(e){case t.Priority.eCritical:this.__activeEvents.set(t.EventCondition.ePrioCritical,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.Priority.eLifeSafety:this.__activeEvents.set(t.EventCondition.ePrioLifeSafety,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.Priority.eManualLocal:this.__activeEvents.set(t.EventCondition.ePrioManualLocal,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1});break;case t.Priority.eManualRemote:this.__activeEvents.set(t.EventCondition.ePrioManualRemote,{eMostPriorisedState:t.EventIconState.ePresent,nCount:1})}null!=(null===(a=this.__eventWatches)||void 0===a?void 0:a.callbacks)&&i.invokeEventCallbacks(this.__activeEvents,this.__eventWatches.callbacks)}}))}return null!=this.__activeEvents&&e(this.__activeEvents),null!=this.__eventWatches.activePrio||null!=this.__eventWatches.event||null!=this.__eventWatches?(this.__eventWatches.callbacks||(this.__eventWatches.callbacks=[]),this.__eventWatches.callbacks.push(e),this.__eventWatches.callbacks.length-1):null}stopWatchEventsPerIcon(e){var t;let a=null===(t=this.__eventWatches)||void 0===t?void 0:t.callbacks;null!=a&&(a.splice(e,1),0===a.length&&this.stopAllEventsPerIconWatches())}stopAllEventsPerIconWatches(){if(!this.__eventWatches)return;let e=this.tryGetBaVariable(t.BaParameterId.eStatusFlags);e&&null!=this.__eventWatches.statusFlags&&e.stopWatch(this.__eventWatches.statusFlags),this.Event&&null!=this.__eventWatches.event&&this.Event.stopWatchEvent(this.__eventWatches.event);let a=this.tryGetBaVariable(t.BaParameterId.eActivePriority);a&&null!=this.__eventWatches.activePrio&&a.stopWatch(this.__eventWatches.activePrio),delete this.__eventWatches}getReferringObjects(){return e.Server.getReferringObjects(this)}destroy(){super.destroy(),this.stopAllEventsPerIconWatches(),null!=this.Event&&this.Event.destroy()}}let i;t.BaObject=a,function(a){a.isIBaObjectAttributes=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("IsEventEnabled","boolean"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},a.isBaEvent=function(a){let i=!0;if(null!=a&&"object"==typeof a){let n=new Map;n.set("TimeStamp","date"),n.set("Type","number"),n.set("State","number"),n.set("IsActive","boolean"),n.set("IsHitorical","boolean"),n.set("LockPriority","number"),n.set("Identifier",t.isBaIdentifier),n.set("DeviceName","string"),e.TypeGuards.validateProperties(a,n)||(i=!1)}else i=!1;return i};a.BaEvent=class{constructor(t,a){this.__watchEventCallbacks=[],this.TimeStamp=t.TimeStamp,this.Type=t.Type,this.State=t.State,this.IsHistorical=t.IsHistorical,this.LockPriority=t.LockPriority,this.Identifier=t.Identifier,this.DeviceName=t.DeviceName,this.IsActive=t.IsActive,this.EventClassId=t.EventClassId,this.EventClassInstanceDescription=t.EventClassInstanceDescription,this.EventClassDescription=t.EventClassDescription,this.RefObject=a,this.__logger=new e.Logger({name:this.RefObject.Mapping+e.Logger.arrowRight+"Event"})}watch(t){return null==this.__eventSubscriptionId&&(this.__eventSubscriptionId=e.Server.subscriptionCollector.add(this.RefObject.Mapping+"::Events",t=>{if(0!=t.length){if(1!=t.length)throw new Error("Length of Events of an BaObject must be 1!");for(let a=0;a<this.__watchEventCallbacks.length;a++)this.__watchEventCallbacks[a](e.Server.convertIBaEventServerResult(t[0]))}})),this.__watchEventCallbacks.push(t),this.__watchEventCallbacks.length-1}stopWatchEvent(e){this.__watchEventCallbacks.splice(e,1),0===this.__watchEventCallbacks.length&&this.stopAllEventsPerIconWatches()}stopAllEventsPerIconWatches(){null!=this.__eventSubscriptionId&&(e.Server.subscriptionCollector.remove(this.__eventSubscriptionId),delete this.__eventSubscriptionId),this.__watchEventCallbacks=[]}acknowledge(){this.RefObject.getIsValid()&&this.State>=t.EventCondition.eTypeAlarm&&this.State<=t.EventCondition.eTypeOther&&e.Server.confirmBaObject(this.RefObject)}destroy(){this.stopAllEventsPerIconWatches()}__getImagePath(a,i){let n,s;switch(a){case t.EventCondition.eTypeAlarm:n="alarm";break;case t.EventCondition.eTypeDisturb:n="disturbance";break;case t.EventCondition.eTypeMaintenance:n="maintenance";break;case t.EventCondition.eTypeNotification:n="notification";break;case t.EventCondition.eTypeOther:n="other";break;default:n=""}switch(i){case t.EventIconState.eNone:s="";break;case t.EventIconState.eIndicatd:s="Indicated";break;case t.EventIconState.eGoneAcked:case t.EventIconState.eGone:s="Gone";break;case t.EventIconState.ePresentAcked:case t.EventIconState.ePresent:s="Present";break;default:s=""}if(n.length>0&&s.length>0&&"None"!==s)return e.Icons.Events.Event.Path+"/"+n+"/"+s+".svg"}}}(a=t.BaObject||(t.BaObject={})),function(e){e.MaximumEventCondition=t.EventCondition.eEventIconDisplayed,e.invokeEventCallbacks=function(a,i){if(null!=a){const n=new Map;for(let i=t.EventCondition.eTypeAlarm;i<=e.MaximumEventCondition;i++){const e=a.get(i);null!=e&&n.set(i,e)}for(let e=0;e<i.length;e++)i[e](n)}}}(i=t.EventHelper||(t.EventHelper={}))}(t=e.BA||(e.BA={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i{constructor(e,n,s,r){if(this.Value=n.Value,this.Info=n.Info,this.DataType=n.DataType,null!=n.ArrayType&&(this.ArrayType=n.ArrayType),this.Access=n.Access,this.RefObject=s,null!=this.RefObject)if(this.RefObject instanceof i)this.__originalMapping=this.RefObject.Mapping+"::"+this.InstanceName;else{let e="Params";this.ID==a.BaParameterId.Additional&&(e="AddParams"),this.__originalMapping=`${this.RefObject.Mapping}::${e}::${this.InstanceName}`}if(null!=this.RefObject&&(this.HasPrimitiveValue||t.Globals.ImplementedNonPrimitiveValues.indexOf(this.ID)>-1?this.Mapping=this.__originalMapping+"::Value":this.Mapping=null==r?this.__originalMapping+"::Value":r.Mapping+"::"+this.InstanceName),this.logger=new t.Logger({name:this.Mapping}),null!=n.Children){let e=a.BaObject.convertToMap(n.Children);this.Children=new Map;for(let[t,a]of e)this.Children.set(t,new i(t,a,s,this))}}get ID(){return this.Info.ID}get InstanceName(){return this.Info.InstanceName}get HasPrimitiveValue(){return this.Info.HasPrimitiveValue}checkUserAccess(e){switch(e){case a.Scope.read:return t.Server.UserManagement.checkAccess(this.Access.Read);case a.Scope.write:return t.Server.UserManagement.checkAccess(this.Access.Write);default:throw new Error("Invalid scope!")}}watchValueRange(e){null==this.__valueRangeCallbacks&&(this.__valueRangeCallbacks=new Map);let a=0;for(;this.__valueRangeCallbacks.has(a);)a++;return this.__valueRangeCallbacks.set(a,e),t.Server.getValueRange(this).then(t=>{e(t)}),a}updateValueRange(){return new Promise((e,a)=>{null!=this.__valueRangeCallbacks?t.Server.updateValueRange(this).then(t=>{if(null!=this.__valueRangeCallbacks)for(let e of this.__valueRangeCallbacks.values())e(t);e()}):e()})}stopWatchValueRange(e){var t;this.__valueRangeCallbacks&&this.__valueRangeCallbacks.delete(e),0===(null===(t=this.__valueRangeCallbacks)||void 0===t?void 0:t.size)&&delete this.__valueRangeCallbacks}getDecoratingInfo(){return t.Server.getDecoratingInfo(this)}getPropertyMapping(e){return this.__originalMapping+"::"+e}toExpression(){return t.Helper.String.toSymbolExpression(this.Mapping)}static periodicallyUpdatedVariables(e){return null!=t.Globals.PeriodicallyUpdatedVariableIds&&t.Globals.PeriodicallyUpdatedVariableIds.indexOf(e)>-1}watch(e){void 0===this.__subscriptionIdentifier&&(i.periodicallyUpdatedVariables(this.ID)?null==this.Value&&this.read().then(e=>{if(this.Value=e,this.__noWatchCallbacks)for(let e of this.__noWatchCallbacks.values())e(this.Value)}):this.__subscriptionIdentifier=t.Server.subscriptionCollector.add(this.Mapping,e=>{this.__processValue(e).then(e=>{if(this.Value=e,this.__watchCallbacks)for(let e of this.__watchCallbacks.values())e(this.Value)})})),null!=this.Value&&e(this.Value);let a=0;if(i.periodicallyUpdatedVariables(this.ID)){for(this.__noWatchCallbacks||(this.__noWatchCallbacks=new Map);this.__noWatchCallbacks.has(a);)a++;this.__noWatchCallbacks.set(a,e)}else{for(this.__watchCallbacks||(this.__watchCallbacks=new Map);this.__watchCallbacks.has(a);)a++;this.__watchCallbacks.set(a,e)}return a}invokeNoWatchCallbacks(){if(null!=this.__noWatchCallbacks)for(let e of this.__noWatchCallbacks.values())e(this.Value)}stopWatch(e){var t,a;if(i.periodicallyUpdatedVariables(this.ID))this.__noWatchCallbacks&&this.__noWatchCallbacks.delete(e),0===(null===(a=this.__noWatchCallbacks)||void 0===a?void 0:a.size)&&this.stopAllWatches();else{if(!this.__watchCallbacks)return;this.__watchCallbacks.delete(e),0===(null===(t=this.__watchCallbacks)||void 0===t?void 0:t.size)&&this.stopAllWatches()}delete this.__valueRangeCallbacks}stopAllWatches(){this.__subscriptionIdentifier&&(t.Server.subscriptionCollector.remove(this.__subscriptionIdentifier),delete this.__subscriptionIdentifier),i.periodicallyUpdatedVariables(this.ID)?delete this.__noWatchCallbacks:delete this.__watchCallbacks}watchesCount(){var e;return null===(e=this.__watchCallbacks)||void 0===e?void 0:e.size}read(){return new Promise((e,i)=>{this.RefObject instanceof a.BaBasicObject&&t.Server.readRequestCollector.add(this.Mapping).then(t=>{this.__processValue(t).then(t=>{this.Value=t,e(this.Value)}).catch(e=>i(e))}).catch(e=>i({msg:`Reading variable '${this.Mapping} failed!'`,reason:e}))})}write(n,s){e.Server.writeSymbol(this.Mapping,n,e=>{this.logger.checkServerResult(t.Logger.Severity.error,e),s&&s(e),i.periodicallyUpdatedVariables(this.ID)&&this.RefObject instanceof a.BaBasicObject&&this.RefObject.updateObjectInfo()})}destroy(){this.stopAllWatches()}__processValue(e){return new Promise((n,s)=>{if(null!=e)switch(this.ID){case a.BaParameterId.eLogBuffer:let r=[];for(let a=0;a<e.length;a++){let i=e[a];"string"==typeof i.TimeStamp&&(i.TimeStamp=new Date(i.TimeStamp)),r.push(i),null==i.Value||this.DataType===t.DataType.boolean&&!1!==i.Value&&!0!==i.Value&&console.error("Log buffer with data class binary has invalid value entry!")}return void n(r);case a.BaParameterId.eReferencedParam:return void i.processBaObjectParameter(e).then(e=>{n(e)}).catch(e=>s(e));default:return void n(e)}else n(void 0)})}static processBaObjectParameter(e){return new Promise((i,n)=>{var s,r;let o=null===(s=null===a.BaDevices||void 0===a.BaDevices?void 0:a.BaDevices.get(e.ReferenceObject.D))||void 0===s?void 0:s.findBaObject(e.ReferenceObject.Id),l=null===(r=null===a.BaDevices||void 0===a.BaDevices?void 0:a.BaDevices.get(e.OwnerObject.D))||void 0===r?void 0:r.findBaObject(e.OwnerObject.Id);if(!o)return t.Logger.log(t.Logger.Severity.warn,`BaObject was found in device ${e.ReferenceObject.D}!`,{identifier:e.ReferenceObject.Id}),void i(void 0);if(!l)return t.Logger.log(t.Logger.Severity.warn,`BaObject was found in device ${e.OwnerObject.D}!`,{identifier:e.OwnerObject.Id}),void i(void 0);let d=!1,_=!1,h=()=>{if(d&&_){if((null==o?void 0:o.getIsValid())&&(null==l?void 0:l.getIsValid())){let t={ReferenceObject:o,ReferenceObjectIdentifier:e.ReferenceObjectIdentifier,ReferencedParameter:e.ReferencedParameter,OwnerObject:l};return void i(t)}i(void 0)}else;};o.loadAttributes().then(()=>{d=!0,h()}),l.loadAttributes().then(()=>{_=!0,h()})})}static jsonReplacer(e,t){if(t instanceof Map){let e=Object.create(null);for(let[a,i]of t)e[a]=i;return e}if(t instanceof i||t instanceof a.BaObject.BaEvent){let e=Object.create(null);for(let a in t)"RefObject"!==a&&(e[a]=t[a]);return e}if(!(t instanceof a.BaDevice))return t}}a.BaVariable=i,function(e){function i(e){let a=!0;if(null!=e&&"object"==typeof e){let i=new Map;i.set("Title","string"),i.set("ID","number"),i.set("HasPrimitiveValue","boolean"),i.set("InstanceName","string"),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a}e.isIBaParameterInfo=i,e.isIBaDecoratedParameterInfo=function(e){let a=!0;if(i(e)){let i=new Map;i.set("Decorated",["string","number"]),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a},e.isIBaDecoratingParameterInfo=function(e){let a=!0;if(i(e)){let i=new Map;i.set("Decorating","boolean"),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a},e.isIBaEnumeratedParameterInfo=function(e){let a=!0;if(i(e)){let i=new Map;i.set("Enumerated","object"),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a},e.isIBaEnumeratingParameterInfo=function(e){let a=!0;if(i(e)){let i=new Map;i.set("Enumerating","boolean"),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a},e.isIBaVariableAttributes=function(e){let n=!0;if(null!=e&&"object"==typeof e){let s=new Map;s.set("Access",a.isBaScope),s.set("DataType","number"),s.set("Info",i),t.TypeGuards.validateProperties(e,s)||(n=!1)}else n=!1;return n}}(i=a.BaVariable||(a.BaVariable={}))}(t.BA||(t.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){let t;!function(e){let t;!function(t){class a extends t.BaBasicObject{constructor(e,t,a,i){super(e,t,a,i),this.__template={isVerified:!1,verificationResult:!1}}setAttributes(i){var n;if(super.setAttributes(i),null!=i.Children){null==this.Children&&(this.Children=new Map);for(let[e,n]of i.Children){let i=this.Children.get(e);i?i.setAttributes(n):(i=t.BaObject.isIBaObjectAttributes(n)?new t.BaObject(n,this.Mapping+"::Children::"+e,this.Device):a.isIBaViewAttributes(n)?new a(n,this.Mapping+"::Children::"+e,this.Device):new t.BaBasicObject(n,this.Mapping+"::Children::"+e,this.Device),this.Children.set(e,i))}}if(null!=i.Events&&i.Events.length>0){if(e.Server.isIBaEventServerResult(i.Events[0])){let a=[];for(let s=0;s<i.Events.length;s++){let r=e.Server.convertIBaEventServerResult(i.Events[s]),o=null===(n=t.BaDevices)||void 0===n?void 0:n.get(r.DeviceName);if(!o)throw new Error("Device should be available at this point!");let l=o.findBaObject(r.Identifier);a.push(new t.BaObject.BaEvent(r,l))}i.Events=a}this.Events=i.Events}if(null!=i.EventsPerIcon)for(let e in i.EventsPerIcon){let t=Number(e);isNaN(t)||(this.__activeEvents=new Map,this.__activeEvents.set(t,i.EventsPerIcon[e]))}}getIsValid(e=!1,t=!1){return super.getIsValid(e,t)}updateObjectInfo(){return new Promise((e,t)=>{let a=0;for(let i of this.Children.values())a++,i.updateObjectInfo().then(()=>{a--,0===a&&e()}).catch(e=>t(e));a++,super.updateObjectInfo().then(()=>{a--,0===a&&e()}).catch(e=>t(e))})}filterChildren(e,t){let i=[];for(let n of this.Children.values())n instanceof a&&n.Children.size>0&&(i=i.concat(n.filterChildren(e,t))),n.matchesFilter(e,t)&&i.push(n);return this.matchesFilter(e,t)&&i.push(this),i}watchEventsPerIcon(a){var i;return this.__eventSubscriptions||(this.__eventSubscriptions={callbacks:[]},this.__eventSubscriptions.subscriptionId=e.Server.subscriptionCollector.add(this.Mapping+"::EventsPerIcon",e=>{var a;this.__activeEvents=new Map;for(let t in e){let a=Number(t);isNaN(a)||this.__activeEvents.set(a,e[t])}null!=(null===(a=this.__eventSubscriptions)||void 0===a?void 0:a.callbacks)&&t.EventHelper.invokeEventCallbacks(this.__activeEvents,this.__eventSubscriptions.callbacks)})),null!=this.__activeEvents&&null!=(null===(i=this.__eventSubscriptions)||void 0===i?void 0:i.callbacks)&&t.EventHelper.invokeEventCallbacks(this.__activeEvents,[a]),this.__eventSubscriptions.callbacks.push(a),this.__eventSubscriptions.callbacks.length-1}stopWatchEventsPerIcon(e){var t;let a=null===(t=this.__eventSubscriptions)||void 0===t?void 0:t.callbacks;null!=a&&(a.splice(e,1),0===a.length&&this.stopAllEventsPerIconWatches())}stopAllEventsPerIconWatches(){this.__eventSubscriptions&&(this.__eventSubscriptions.subscriptionId&&e.Server.subscriptionCollector.remove(this.__eventSubscriptions.subscriptionId),delete this.__eventSubscriptions)}findChildBySubjectInfoIdentifier(t){if(!this.getIsValid())return this.logger.log(e.Logger.Severity.warn,e.Logger.crossMark+"BaObject is not valid yet.\nLoad attributes including children before looking for children."),null;for(let a of this.Children.values()){if(!a.getIsValid())return this.logger.log(e.Logger.Severity.warn,e.Logger.crossMark+"BaObject is not valid yet.\nLoad attributes including children before looking for children."),null;if(a.SubjectInfo.Identifier===t)return a}return null}getTemplateChild(t){if(null==this.__template.description)return null;let i=this.__template.description[t],n=null==i?void 0:i.identifier;if(null==n)return null;let s=n.split("::"),r=0,o=this;do{if(!(o instanceof a))return this.logger.log(e.Logger.Severity.warn,`BaObject can not have children.\nDo not use parameter name in BaTemplateDescription (${i.identifier}).\n`,{rootBaView:this,baObject:o}),null;if(o=o.Children.get(s[r]),null==o)return null;r++}while(r<s.length);return o}static verifyTemplate(t,n,s){if(tchmi_equal(n,t.__template.definition)||(t.__template.definition=n,t.__template.isVerified=!1),!tchmi_equal(s,t.__template.description)){t.__template.isVerified=!1,t.__template.description={};for(let a in t.__template.definition){if(!t.__template.definition[a].optional&&null==s[a])return t.logger.log(e.Logger.Severity.warn,`Template description does not fit to template definition! Element '${a}' is missing in template description!`,{templateDefinition:t.__template.definition,passedDescription:s}),t.__template.description=void 0,!1;{let e=s[a];null!=e&&(t.__template.description[a]=e)}}}if(t.__template.isVerified)return t.__template.verificationResult;if(null==t.__template.definition)return t.logger.log(e.Logger.Severity.warn,"Template definition must be set before verifying a template."),!1;if(null==t.__template.description)return t.logger.log(e.Logger.Severity.warn,"Template description must be set before verifying a template."),!1;t.__template.isVerified=!0,t.__template.verificationResult=!0;for(let n in t.__template.definition){let s=t.__template.definition[n];if(s.optional)continue;let r=t.__template.description[n];if(!r){t.__template.verificationResult=!1,t.logger.log(e.Logger.Severity.warn,`Template definition defines element '${n}' which is not known in template description.`,{templateDescription:t.__template.description,templateDefintion:t.__template.definition});break}let o=t.getTemplateChild(n);if(!o){t.__template.verificationResult=!1,t.__template.verificationErrorMessage=e.Locale.LangKey.TemplateChildNotFound,t.__template.incorrectObjectKey=n;break}if(i(s)&&a.isBaTemplateDescriptionWithSubTemplate(r)){if(!(o instanceof a)){t.__template.verificationResult=!1,t.__template.verificationErrorMessage=e.Locale.LangKey.TemplateChildNotABaView,t.__template.incorrectObjectKey=n;break}if(!a.verifyTemplate(o,s.subTemplate,r.subTemplate)){t.__template.verificationResult=!1;break}}else o instanceof a&&(t.__template.verificationResult=!1,t.__template.verificationErrorMessage=e.Locale.LangKey.TemplateChildNotABaObject,t.__template.incorrectObjectKey=n)}return t.__template.verificationResult}static getTemplates(t,i,n){if(e.BaInterfaceHandler.isBaInterfaceDefinition(i)&&e.BaInterfaceHandler.isBaInterfaceSymbolNames(n)){let e=[];for(let[a,s]of t.Children)s.checkAddParams(i,n)&&e.push(s);return e}if(e.BaInterfaceHandler.isBaInterfaceDefinition(i)||e.BaInterfaceHandler.isBaInterfaceSymbolNames(n))throw new Error("Invalid combination of function parameters was passed into BaView.getTemplates()!");{let e=[];for(let[s,r]of t.Children)r instanceof a&&(a.verifyTemplate(r,i,n)&&e.push(r),e=e.concat(a.getTemplates(r,i,n)));return e}}logIncorrectTemplate(t){return __awaiter(this,void 0,void 0,(function*(){let a={templateDescription:this.__template.description,boundTemplate:this,templateDefinition:this.__template.definition};null!=this.__template.verificationErrorMessage&&null!=this.__template.incorrectObjectKey&&(a.verificationResult=tchmi_format_string(e.Locale.Localization.getText(this.__template.verificationErrorMessage),this.__template.incorrectObjectKey)),t.log(e.Logger.Severity.warn,"Bound BaView does not fit to the given BaTemplateDefinition.",a)}))}destroy(){super.destroy(),this.stopAllEventsPerIconWatches();for(let e of this.Children.values())e.destroy()}}function i(e){return"object"==typeof e.subTemplate}t.BaView=a,function(a){a.isIBaViewAttributes=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("Children",[()=>t.Children instanceof Map]),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},a.isBaViewChildren=function(e){let a=!0;if(null!=e&&"object"==typeof e){if(e instanceof Map){for(let i of e.values())if(!t.BaBasicObject.isIBaBasicObjectAttributes(i)){a=!1;break}}else for(let i in e)if(!t.BaBasicObject.isIBaBasicObjectAttributes(e[i])){a=!1;break}}else a=!1;return a},a.isBaTemplateDescriptionWithSubTemplate=function(e){return i(e)},a.isBaTemplateDescription=function(e){if("object"!=typeof e)return!1;for(let t in e)if("string"!=typeof e[t].identifier)return!1;return!0}}(a=t.BaView||(t.BaView={}))}(t=e.BA||(e.BA={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){let t;!function(t){let a;!function(a){let i;!function(e){e.onDeviceLoaded="onBaDeviceLoaded",e.onAllDevicesLoaded="onAllBaDevicesLoaded"}(i=a.Events||(a.Events={}));class n{constructor(i){this.__eventDestroyFunctions={},this.projectStructureLoaded=n.ProjectStructureLoadingStatus.invalid,this.__disconnectedReported=!1,this.__connectedReported=!1,this.logger=new t.Logger({name:i}),(null===a.BaDevices||void 0===a.BaDevices?void 0:a.BaDevices.has(i))?this.logger.log(t.Logger.Severity.error,"Device was already created"):(this.Description=i,this.eventNames={onConnectionStateChanged:this.Description+"ConnectionStateChangedEvent",onDiagnosticsChanged:this.Description+"DiagnosticsChangedEvent",onProjectStructureLoaded:this.Description+"ProjectStructureLoadedEvent"},this.__eventDestroyFunctions.destroyOnRuntimeDiagnosticsChanged=e.EventProvider.register(t.Server.DiagnosticsEvents.onRuntimeDiagnosticsChanged,(e,t)=>this.__onDiagnosticsChanged(t)))}findBaObject(e,i){if(this.diagnostics.connectionState<n.ConnectionState.connected)return this.logger.log(t.Logger.Severity.warn,`Can not find BaObject because connection state is '${n.ConnectionState[this.diagnostics.connectionState]}'!`),null;if(!this.projectStructureLoaded)return this.logger.log(t.Logger.Severity.warn,"Unable to find BaObject because the ProjectStructure has not been loaded yet. Wait for eventNames.onProjectStructureLoaded!"),null;let s=null;if(i||(i=this.ProjectStructure),"string"==typeof e){if(e.indexOf("::")>-1){if(i.Mapping===e)return i}else if(i.InstancePath===e)return i}else{if(!a.isBaIdentifier(e))throw new Error("Invalid instance was passed to findBaObject!");if(i.Identifier.InstanceID===e.InstanceID&&i.Identifier.ObjectType===e.ObjectType)return i}if(i instanceof a.BaView)for(let[t,a]of i.Children)if(s=this.findBaObject(e,a),s)return s;return s}validate(){return!(this.diagnostics.connectionState<n.ConnectionState.connected)&&(!!a.BaView.isIBaViewAttributes(this.ProjectStructure)&&n.validateProjectStructure(this.ProjectStructure))}static validateProjectStructure(e){if(e instanceof a.BaView){if(e.Children.size>0)return!0}else if(null!=e.Children&&e.Children.size>0)return!0;return t.Logger.log(t.Logger.Severity.error,t.Logger.crossMark+"Project strucutre is empty!"),!1}checkMapping(){return t.Server.checkBaDeviceMapping(this.Description)}updateObjectInfo(){return new Promise((e,t)=>{this.projectStructureLoaded!=n.ProjectStructureLoadingStatus.loaded&&t("Project structure not loaded!"),this.ProjectStructure.updateObjectInfo().then(()=>{e()}).catch(e=>t({msg:`Updating object info of device '${this.Description}' failed!`,reason:e}))})}__onDiagnosticsChanged(s){var r,o;return __awaiter(this,void 0,void 0,(function*(){if(null!=s){if(s.deviceName==this.Description){if(e.EventProvider.raise(this.eventNames.onDiagnosticsChanged,s),s.connectionState!=(null===(r=this.diagnostics)||void 0===r?void 0:r.connectionState))switch(e.EventProvider.raise(this.eventNames.onConnectionStateChanged,s),s.connectionState){case n.ConnectionState.disconnected:TCHMI_DESIGNER||this.__disconnectedReported||(this.__disconnectedReported=!0,this.__connectedReported=!1,yield t.Components.DialogWindow.alert(t.Logger.crossMark+`Device '${this.Description}' is not available. Connection state: ${n.ConnectionState[s.connectionState]}`));break;case n.ConnectionState.connecting:this.logger.log(t.Logger.Severity.warn,t.Logger.crossMark+`Device '${this.Description}' is not available. Connection state: ${n.ConnectionState[s.connectionState]}`);break;case n.ConnectionState.connected:if(null!=(null===(o=this.diagnostics)||void 0===o?void 0:o.connectionState)){if(!TCHMI_DESIGNER&&!this.__connectedReported){this.__connectedReported=!0,this.__disconnectedReported=!1;let e=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmDeviceAvailableReloadPage),this.Description,n.ConnectionState[s.connectionState]);(yield t.Components.DialogWindow.confirm(this.logger.log(t.Logger.Severity.info,e)))&&location.reload()}}else this.logger.log(t.Logger.Severity.info,t.Logger.checkMark+`Device '${this.Description}' is available. Connection state: ${n.ConnectionState[s.connectionState]}.`),this.__disconnectedReported=!1;break;default:this.logger.log(t.Logger.Severity.error,"INVALID_CONNECTION_STATE")}this.diagnostics=s,null==this.ProjectStructure&&s.connectionState===n.ConnectionState.connected&&(this.projectStructureLoaded=n.ProjectStructureLoadingStatus.loading,this.checkMapping().then(s=>{s?t.Server.getBaDevice({DeviceName:this.Description,LoadChildren:!1}).then(s=>{if(null!=s&&null!=s.ProjectStructure&&void 0!==s.ProjectStructure.Children){if(null==this.ProjectStructure){n.validateProjectStructure(s.ProjectStructure)?(this.ProjectStructure=new a.BaView(s.ProjectStructure,this.Description+"::"+t.Globals.BaProjectStructureName,this,!0),this.validate()?(this.projectStructureLoaded=n.ProjectStructureLoadingStatus.loaded,this.logger.log(t.Logger.Severity.info,t.Logger.checkMark+`ProjectStructure of device '${this.Description}' loaded.`,this.ProjectStructure)):this.projectStructureLoaded=n.ProjectStructureLoadingStatus.failed):(this.logger.log(t.Logger.Severity.error,"Device is not valid!"),this.projectStructureLoaded=n.ProjectStructureLoadingStatus.failed),e.EventProvider.raise(this.eventNames.onProjectStructureLoaded,this),e.EventProvider.raise(i.onDeviceLoaded,this);let r=!0;a.BaDevices.forEach(e=>{e.projectStructureLoaded<=n.ProjectStructureLoadingStatus.invalid&&(r=!1)}),r&&e.EventProvider.raise(i.onAllDevicesLoaded)}}else this.logger.log(t.Logger.Severity.error,`Passed ProjectStructure for device ${this.Description} is not a BaView!`)}).catch(e=>this.logger.log(t.Logger.Severity.error,`Reading 'BaDevice' ${this.Description} failed!`,e)):console.error(`No mapping was created for device ${this.Description}! Make sure to map the complete device ${this.Description}!`)}).catch(e=>this.logger.log(t.Logger.Severity.error,`Checking mapping of 'BaDevice' ${this.Description} failed`,e)))}}else this.logger.log(t.Logger.Severity.error,t.Logger.crossMark+"No device diagnostics send from server. Check server log!")}))}destroy(){for(let e in this.__eventDestroyFunctions)this.__eventDestroyFunctions[e]()}}a.BaDevice=n,function(e){let t,a;!function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t=e.ConnectionState||(e.ConnectionState={})),function(e){e[e.invalid=-1]="invalid",e[e.loading=0]="loading",e[e.loaded=1]="loaded",e[e.failed=2]="failed"}(a=e.ProjectStructureLoadingStatus||(e.ProjectStructureLoadingStatus={}))}(n=a.BaDevice||(a.BaDevice={}))}(a=t.BA||(t.BA={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){let t;!function(t){class a{constructor(e){this.__baObject=null,this.__loadBaChildren=!1,this.__loadTexts=!1,this.__enableParentBaObjectProcessor=!1,this.__baObjectSymbolExpression=null,this.__ctrl=e}isLoadingBaObject(){return new Promise((e,t)=>{this.__isLoadingBaObject?(null==this.__loadingReadyResolver&&(this.__loadingReadyResolver=[]),this.__loadingReadyResolver.push(e)):e(!1)})}destroy(){if(this.__baChildrenWatchIdentifier)for(let[e,t]of this.__baChildrenWatchIdentifier)t.forEach(t=>{t&&e.stopWatchBaVariable(t)});this.__stopAllWatches()}set loadChildren(e){this.__loadBaChildren=e}set loadTexts(e){this.__loadTexts=e}set enableParentBaObjectProcessor(e){this.__enableParentBaObjectProcessor=e}get baObject(){return this.__baObject}get baObjectSymbolExpression(){return this.__baObjectSymbolExpression}setBaObject(i){if(null!=i&&TCHMI_DESIGNER){let a;if(this.__ctrl instanceof t.Components.BaseNode){let t=this.__ctrl.getBaParent();for(;null!=t;){if(t instanceof e.Controls.System.baseTcHmiControl){a=t;break}t=t.getBaParent()}}else{if(!(this.__ctrl instanceof e.Controls.System.baseTcHmiControl))throw new Error("Unknown control type!");a=this.__ctrl.getParent()}if(a instanceof e.Controls.System.baseTcHmiControl)for(;null!=a;){if("TcHmi.Controls.System.TcHmiUserControl"==(null==a?void 0:a.getType())){let e=t.Locale.Localization.getText(t.Locale.LangKey.WarnBaObjectInUserControl);t.Components.DialogWindow.alert(e);break}a=a.getParent()}}if(TCHMI_DESIGNER)return this;if(void 0===i||tchmi_equal(i,this.__baObject))return this;let n;if(this.__isLoadingBaObject=!0,i instanceof e.Symbol){let a=i.getExpression();if("s"!==i.getExpression().getTag()&&this.__ctrl instanceof e.Controls.System.baseTcHmiControl){let e=this.__ctrl.getParent();if(null!=e&&(a=t.Helper.Mapping.getSymExpFromBoundedUcParameter(e,a),void 0===a))return this}a.getType()!=e.SymbolType.Server&&this.__ctrl.logger.log(t.Logger.Severity.warn,"Mapped BaObject must be a server symbol!"),this.__baObject||(n=this.__ctrl.busyHandler.setBusy("Reading BaObject",{cbOnTimeout:()=>{n&&n(),this.__ctrl.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.fault)},optionalOutput:{symbolName:a.getName()}})),i=new e.Symbol(a.toString())}return a.resolveBaObject(i,this.__loadBaChildren,this.__loadTexts,this.__ctrl).then(e=>{n&&n(),this.__setBaObjectInternal(e)}).catch(()=>{n&&n()}),this}static resolveBaObject(i,n=!1,s=!1,r){return new Promise((o,l)=>{if(null==i)return o(i);if("string"==typeof i&&(i.length<=0?l("Symbol expression was empty!"):e.Symbol.isSymbolExpression(i)&&(i=new e.Symbol(i))),i instanceof e.Symbol)a.readBaObject(i.getExpression().getName(),n,s).then(e=>__awaiter(this,void 0,void 0,(function*(){if(null==e||t.BA.BaBasicObject.isIBaBasicObjectAttributes(e))return null==r||r.errorIndicator.reset(),o(e);if(TCHMI_DESIGNER)return o(null);{let e="Passed BaObject is not a BaObject or BA.BaView!";null!=r&&t.Components.DialogWindow.alert(`${null==r?void 0:r.getId()}: ${e}`),l({msg:e})}}))).catch(e=>(null==r||r.logger.log(t.Logger.Severity.error,e),null==r||r.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.fault),l(e)));else if(i instanceof t.BA.BaBasicObject)i.loadAttributes(n,s).then(()=>i instanceof t.BA.BaBasicObject&&i.getIsValid()?o(i):l({msg:"BaObject is not valid!"})).catch(e=>__awaiter(this,void 0,void 0,(function*(){return null==r||r.logger.log(t.Logger.Severity.error,e),yield t.Components.DialogWindow.alert(e),l(e)})));else if(t.BA.BaBasicObject.isIBaBasicObjectAttributes(i)){let a,d=()=>{if(t.BA.BaBasicObject.isIBaBasicObjectAttributes(i)&&t.BA.BaDevices){let _=t.BA.BaDevices.get(null!=i.DeviceName?i.DeviceName:"");if(!_)return void(null==r||r.logger.log(t.Logger.Severity.error,t.Logger.crossMark+`Device with name ${i.DeviceName} could not found in BaDevices! Check mapping and make sure to only use subsymbols of the mapping of the device!`));switch(_.diagnostics.connectionState<t.BA.BaDevice.ConnectionState.connected?null==r||r.errorIndicator.set(t.Components.ErrorIndicator.ErrorLevel.fault):null==r||r.errorIndicator.reset(),_.projectStructureLoaded){case t.BA.BaDevice.ProjectStructureLoadingStatus.loading:a&&a(),a=e.EventProvider.register(_.eventNames.onProjectStructureLoaded,()=>{d(),a&&a()});break;case t.BA.BaDevice.ProjectStructureLoadingStatus.loaded:let h=_.findBaObject(i.Identifier);if(!h){const e=t.Logger.crossMark+`BaObject could not be found in BaDevice ${i.DeviceName}!`;return null==r||r.logger.log(t.Logger.Severity.error,e,{instancePath:i.InstancePath,baDevice:_}),l({msg:e,info:{instancePath:i.InstancePath,baDevice:_}})}h.loadAttributes(n,s).then(()=>(null==h?void 0:h.getIsValid())?o(h):l("BaObject was not valid!")).catch(e=>(null==r||r.logger.log(t.Logger.Severity.warn,"Loading attributes of BaObject failed!",e),l(e))),a&&a();break;default:const c=`Loading of project structure of device ${_.Description} failed!`;return null==r||r.logger.log(t.Logger.Severity.error,`Loading of project structure of device ${_.Description} failed!`),l({msg:c})}}};t.BA.BaDevices?d():a=e.EventProvider.register(t.BA.Events.onAllDevicesLoaded,d)}else TCHMI_DESIGNER||t.Components.DialogWindow.alert(`Passed BaObject of control with id ${null==r?void 0:r.getId()} is not a BaObject or BA.BaView!`)})}static readBaObject(a,i=!1,n=!1){return new Promise((s,r)=>{let o,l=()=>{let d;if(a.indexOf(":")>-1)d=a.substring(0,a.indexOf(":"));else{if(!(a.indexOf(".")>-1))return r({msg:t.Logger.crossMark+`Device name could not be found in symbol expression '${a}'. Make sure to only use subsymbols of the mapping of the device!`});d=a.substring(0,a.indexOf("."))}if(t.BA.BaDevices){let _=t.BA.BaDevices.get(d);if(!_)return r({msg:t.Logger.crossMark+`Device with name '${d}' could not found in BaDevices! Check mapping and make sure to only use subsymbols of the mapping of the device!`});if(_.diagnostics.connectionState<t.BA.BaDevice.ConnectionState.connected)return r({msg:t.Logger.crossMark+`Device with name ${d} is not connected!`});switch(_.projectStructureLoaded){case t.BA.BaDevice.ProjectStructureLoadingStatus.loading:o&&o(),o=e.EventProvider.register(_.eventNames.onProjectStructureLoaded,()=>{l(),o&&o()});break;case t.BA.BaDevice.ProjectStructureLoadingStatus.loaded:let h=_.findBaObject(a);if(!h)return r({msg:t.Logger.crossMark+`BaObject could not be found in BaDevice '${d}'!`,info:{symExp:a,baDevice:_}});h.loadAttributes(i,n).then(()=>{h.getIsValid(i,n)?s(h):r({msg:`BaObject '${null==h?void 0:h.InstancePath}' was not loaded correctly!`})}).catch(e=>r(e)),o&&o();break;default:return r({msg:`Cannot read BaObject because project structure of device '${_.Description}' was not loaded!`,symbol:a})}}};t.BA.BaDevices?l():o=e.EventProvider.register(t.BA.Events.onAllDevicesLoaded,l)})}watchBaVariable(e,t,a=!0){let i;a&&(i=this.__ctrl.busyHandler.setBusy(`Watching BaVariable '${e.Mapping}'`));let n={InstanceName:e.InstanceName,WatchId:e.watch(e=>{null!=i&&(i(),i=void 0),t(e)})};return this.__baVarWatchIdentifier||(this.__baVarWatchIdentifier=[]),this.__baVarWatchIdentifier.push(n),n}tryWatchBaVariable(e,a,i=!0){var n;let s;i&&(s=this.__ctrl.busyHandler.setBusy(`Watching BaVariable '${t.BA.BaParameterId[e]}'`));let r=null===(n=this.__baObject)||void 0===n?void 0:n.tryWatchBaVariable(e,e=>{null!=s&&(s(),s=void 0),a(e)});return null!=r&&(this.__baVarWatchIdentifier||(this.__baVarWatchIdentifier=[]),this.__baVarWatchIdentifier.push(r)),r}tryWatchChildrenBaVariable(e,a,i,n=!0){if(!e)return!1;if(this.__baChildrenWatchIdentifier||(this.__baChildrenWatchIdentifier=new Map),e.tryGetBaVariable(a)){let s,r=this.__baChildrenWatchIdentifier.get(e);r||(this.__baChildrenWatchIdentifier.set(e,[]),r=this.__baChildrenWatchIdentifier.get(e)),n&&(s=this.__ctrl.busyHandler.setBusy(`Watching BaVariable '${t.BA.BaParameterId[a]}' of BaObject '${null==e?void 0:e.Mapping}'`));let o=e.tryWatchBaVariable(a,e=>{null!=s&&(s(),s=void 0),i(e)});if(null!=o)return r.push(o),!0}return!1}watchValueRange(e,a,i=!0){var n;let s,r;if("number"==typeof e){if(r=null===(n=this.__baObject)||void 0===n?void 0:n.tryGetBaVariable(e),null==r)return this.__ctrl.logger.log(t.Logger.Severity.warn,"BaObject does not contain a BaParameter "+t.BA.BaParameterId[e]),!1}else r=e;i&&(s=this.__ctrl.busyHandler.setBusy(`Watching value range of '${t.BA.BaParameterId[r.ID]}'`));let o=r.watchValueRange(e=>{null!=s&&(s(),s=void 0),a(e)});this.__baValueRangeWatchIdentifier||(this.__baValueRangeWatchIdentifier=new Map);let l=this.__baValueRangeWatchIdentifier.get(r);return l||(this.__baValueRangeWatchIdentifier.set(r,[]),l=this.__baValueRangeWatchIdentifier.get(r)),null!=o&&(l.push(o),!0)}onBaObjectChanged(t){return e.EventProvider.register(this.__ctrl.getId()+"."+a.Events.onBaObjectChanged,(e,...a)=>{t(this.__baObject)})}__setBaObjectInternal(t){if(this.__baObject=t,null!=this.__baObject?this.__baObjectSymbolExpression=this.__baObject.getSymbolExpression():this.__baObjectSymbolExpression=null,this.__isLoadingBaObject=!1,this.__loadingReadyResolver&&(this.__loadingReadyResolver.forEach(e=>e(!0)),delete this.__loadingReadyResolver),this.__ctrl.processBaObject(),this.__enableParentBaObjectProcessor){let t=this.__ctrl.getBaParent();null!=t&&t!==this.__ctrl&&a.isIUsesBaObject(t)&&(t.processBaObject(),e.EventProvider.raise(t.getId()+".onPropertyChanged",{propertyName:"getBaObject"}))}this.__triggerBaObjectChanged(),e.EventProvider.raise(this.__ctrl.getId()+".onPropertyChanged",{propertyName:"getBaObject"})}__stopAllWatches(){var e;if(null===(e=this.__baVarWatchIdentifier)||void 0===e||e.forEach(e=>{e&&this.__baObject&&this.__baObject.stopWatchBaVariable(e)}),delete this.__baVarWatchIdentifier,null!=this.__baChildrenWatchIdentifier){for(let[e,t]of this.__baChildrenWatchIdentifier)t.forEach(t=>e.stopWatchBaVariable(t));delete this.__baChildrenWatchIdentifier}if(null!=this.__baValueRangeWatchIdentifier){for(let[e,t]of this.__baValueRangeWatchIdentifier)t.forEach(t=>e.stopWatchValueRange(t));delete this.__baValueRangeWatchIdentifier}}__triggerBaObjectChanged(){e.EventProvider.raise(this.__ctrl.getId()+"."+a.Events.onBaObjectChanged,this.__baObject)}}t.BaObjectHandler=a,function(e){let a;!function(e){e.onBaObjectChanged="onbaobjectchanged"}(a=e.Events||(e.Events={})),e.isIUsesBaObject=function(a){let i=!1;if(null!=a&&"object"==typeof a){let n=new Map;a.baObjectHandler instanceof e&&"function"==typeof a.processBaObject&&(i=!0),t.TypeGuards.validateProperties(a,n)||(i=!1)}return i}}(a=t.BaObjectHandler||(t.BaObjectHandler={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i{constructor(e,a){this.__ctrl=e,this.logger=new t.Logger({name:this.__ctrl.getId()}),this.__attrHandler=new t.AttrHandler(this),this.__ctrl.getElement().addClass("tchmi-ba-background-styler"),a&&this.setAttributes(a)}__processBackground(){var e;let t="",a="",i="",n=null===(e=this.__attrHandler.color)||void 0===e?void 0:e.toString();null!=n&&n.length>0?-1===n.indexOf("gradient")?(t=n,a=n,i=""):(t=a,a=n.slice(n.lastIndexOf(",")+1,n.lastIndexOf(")")),i=n):(t="",a="",i=""),t.length>0&&a.length>0?(this.__ctrl.getElement().css("--tchmi-ba-background-styler-background",t),this.__ctrl.getElement().css("--tchmi-ba-background-styler-background-color",a)):(this.__ctrl.getElement().css("--tchmi-ba-background-styler-background",""),this.__ctrl.getElement().css("--tchmi-ba-background-styler-background-color","")),i.length>0?this.__ctrl.getElement().css("--tchmi-ba-background-styler-background-gradient",i):this.__ctrl.getElement().css("--tchmi-ba-background-styler-background-gradient","")}__processImageSize(){null==this.__attrHandler.imageHeight&&null==this.__attrHandler.imageWidth?(this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-size",""),!0===this.__attrHandler.useSVG&&(this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-width",""),this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-height",""))):(null==this.__attrHandler.imageHeight?null!=this.__attrHandler.imageWidth&&this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-size",this.__attrHandler.imageWidth+this.__attrHandler.imageWidthUnit+", cover"):null==this.__attrHandler.imageWidth?null!=this.__attrHandler.imageHeight&&this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-size",this.__attrHandler.imageHeight+this.__attrHandler.imageHeightUnit+", cover"):this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-size",this.__attrHandler.imageWidth+this.__attrHandler.imageWidthUnit+" "+this.__attrHandler.imageHeight+this.__attrHandler.imageHeightUnit+", cover"),!0===this.__attrHandler.useSVG&&(this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-width",this.__attrHandler.imageWidth+this.__attrHandler.imageWidthUnit),this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-height",this.__attrHandler.imageHeight+this.__attrHandler.imageHeightUnit)))}__processImagePosition(){if(null==this.__attrHandler.imageHorizontalAlignment&&null==this.__attrHandler.imageVerticalAlignment)this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-position",""),this.__attrHandler.useSVG&&(this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-position-left",""),this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-position-top",""));else{let e,t;switch(this.__attrHandler.imageHorizontalAlignment){case"Left":e="0%",this.__attrHandler.useSVG&&this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-position-left","0px");break;case"Right":e="100%",this.__attrHandler.useSVG&&this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-position-left","calc((100% - var(--tchmi-ba-background-styler-image-svg-width)))");break;default:e="50%",this.__attrHandler.useSVG&&this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-position-left","")}switch(this.__attrHandler.imageVerticalAlignment){case"Top":t="0%",this.__attrHandler.useSVG&&this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-position-top","0px");break;case"Bottom":t="100%",this.__attrHandler.useSVG&&this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-position-top","calc((100% - var(--tchmi-ba-background-styler-image-svg-height)))");break;default:t="50%",this.__attrHandler.useSVG&&this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-svg-position-top","")}this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-position",e+" "+t)}}getControl(){return this.__ctrl}getSvg(){return this.__svg?this.__svg:null}static createImageConfig(e,t=80){return{image:e,imageHeight:t,imageHeightUnit:"%",imageWidth:t,imageWidthUnit:"%"}}setAttributes(e){return null==e&&this.logger.log(t.Logger.Severity.warn,t.Logger.crossMark+"Passed attributes object was null!"),void 0!==e.color&&this.setColor(e.color,e.colorChangeDuration),void 0!==e.image&&(void 0===e.useSVG&&null!=e.image&&e.image.indexOf(".svg")>0&&(e.useSVG=!0),this.setImage(e.image,e.useSVG)),void 0!==e.imageColor&&this.setImageColor(e.imageColor,e.imageColorChangeDuration),void 0!==e.imageHeight&&(void 0===e.imageHeightUnit&&this.__attrHandler.imageHeightUnit&&(e.imageHeightUnit=this.__attrHandler.imageHeightUnit),this.setImageHeight(e.imageHeight,e.imageHeightUnit)),void 0!==e.imageHorizontalAlignment&&this.setImageHorizontalAlignment(e.imageHorizontalAlignment),void 0!==e.imageRotation&&this.setImageRotation(e.imageRotation),void 0!==e.imageRotationDirection&&this.setImageRotationDirection(e.imageRotationDirection),void 0!==e.imageRotationSpeed&&this.setImageRotationSpeed(e.imageRotationSpeed),void 0!==e.imageVerticalAlignment&&this.setImageVerticalAlignment(e.imageVerticalAlignment),e.imageWidth&&(void 0===e.imageWidthUnit&&this.__attrHandler.imageWidthUnit&&(e.imageWidthUnit=this.__attrHandler.imageWidthUnit),this.setImageWidth(e.imageWidth,e.imageWidthUnit)),this}getAttributes(){return this.__attrHandler.getRef()}setColor(e,t=200){return this.__attrHandler.checkColorAttribute(e,"color")?(t!==this.__attrHandler.colorChangeDuration&&(this.__attrHandler.colorChangeDuration=t,null!=this.__attrHandler.colorChangeDuration?this.__ctrl.getElement().css("--tchmi-ba-background-styler-background-color-transition-duration",this.__attrHandler.colorChangeDuration+"ms"):this.__ctrl.getElement().css("--tchmi-ba-background-styler-background-color-transition-duration","")),this.__attrHandler.color=e,this.__processColor(),this):this}__processColor(){this.__processBackground()}getColor(){return this.__attrHandler.color}setImage(e,a=!1){return 0===(null==e?void 0:e.length)&&(e=null),this.__attrHandler.checkAttribute(e,"image",{validator:()=>t.Helper.String.validateFilePath(e,i.ImageFileEndings)})?(this.__attrHandler.image=e,this.__attrHandler.useSVG=(null!=a||"boolean"==typeof a)&&a,this.__processImage(),this):this}__processImage(){let e=this.__ctrl.getElement().children(".background-image-svg");if(null!=this.__attrHandler.image&&this.__attrHandler.image.length>0)if(!0===this.__attrHandler.useSVG&&this.__attrHandler.image.indexOf(".svg")>-1){null!=e[0]&&e.detach();let a=this.__attrHandler.image;t.System.SVGLoader.get(this.__attrHandler.image).then(t=>{a===this.__attrHandler.image&&(e=this.__ctrl.getElement().children(".background-image-svg"),null!=e[0]&&e.detach(),this.__svg=$(t).addClass("background-image-svg"),this.__ctrl.getElement().append(this.__svg),this.__processImageSize(),this.__processImageColor(),this.__ctrl.eventHandler.raise(i.Events.onSvgLoaded))}).catch(e=>this.logger.log(t.Logger.Severity.warn,"Loading SVG failed! Path: "+this.__attrHandler.image,e)),this.__ctrl.getElement().removeClass("use-image")}else this.__ctrl.getElement().addClass("use-image"),e.detach(),this.__attrHandler.useSVG=!1,this.__ctrl.getElement().css("--tchmi-ba-background-styler-image","url("+this.__attrHandler.image+")");else e.detach(),this.__ctrl.getElement().removeClass("use-image"),this.__ctrl.getElement().css("--tchmi-ba-background-styler-image","")}getImage(){return this.__attrHandler.image}setImageHeight(e,t="px"){return a.LayoutHandler.dimensionSetter(this.__attrHandler,"imageHeight",e,t)?(this.__processImageSize(),this):this}getImageHeight(){return this.__attrHandler.imageHeight}getImageHeightUnit(){return this.__attrHandler.imageHeightUnit}setImageWidth(e,t="px"){return a.LayoutHandler.dimensionSetter(this.__attrHandler,"imageWidth",e,t)?(this.__processImageSize(),this):this}getImageWidth(){return this.__attrHandler.imageWidth}getImageWidthUnit(){return this.__attrHandler.imageWidthUnit}setImageHorizontalAlignment(t){return this.__attrHandler.checkAttribute(t,"imageHorizontalAlignment",{validator:e.isHorizontalAlignment})?(this.__attrHandler.imageHorizontalAlignment=t,this.__processImagePosition(),this):this}getImageHorizontalAlignment(){return this.__attrHandler.imageHorizontalAlignment}setImageVerticalAlignment(t){return this.__attrHandler.checkAttribute(t,"imageVerticalAlignment",{validator:e.isVerticalAlignment})?(this.__attrHandler.imageVerticalAlignment=t,this.__processImagePosition(),this):this}getImageVerticalAlignment(){return this.__attrHandler.imageVerticalAlignment}setImageColor(e,t=200){return this.__attrHandler.checkColorAttribute(e,"imageColor")?(this.__attrHandler.imageColor=e,t!==this.__attrHandler.imageColorChangeDuration&&(this.__attrHandler.imageColorChangeDuration=t,null!=this.__attrHandler.imageColorChangeDuration?this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-color-transition-duration",this.__attrHandler.imageColorChangeDuration+"ms"):this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-color-transition-duration","")),this.__processImageColor(),this):this}__processImageColor(){this.__attrHandler.useSVG&&this.__svg&&(null!=this.__attrHandler.imageColor?this.__ctrl.getElement().css("--tchmi-ba-global-icon-color",this.__attrHandler.imageColor.toString()):this.__ctrl.getElement().css("--tchmi-ba-global-icon-color",""))}getImageColor(){return this.__attrHandler.imageColor}setImageRotation(e){return this.__attrHandler.checkAttribute(e,"imageRotation",{validator:"number"})?(this.__attrHandler.imageRotation=e,this.__processImageRotation(),this):this}__processImageRotation(){null==this.__attrHandler.imageRotation?this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-rotation",""):this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-rotation",this.__attrHandler.imageRotation+"deg")}getImageRotation(){return this.__attrHandler.imageRotation}setImageRotationSpeed(e){return this.__attrHandler.checkAttribute(e,"imageRotationSpeed",{validator:"number"})?(this.__attrHandler.imageRotationSpeed=e,this.__processImageRotationSpeed(),this):this}__processImageRotationSpeed(){null!=this.__attrHandler.imageRotationDirection||null!=this.__attrHandler.imageRotationSpeed?(this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-rotation-speed",this.__attrHandler.imageRotationSpeed+"s"),this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-rotation",""),this.__attrHandler.imageRotationDirection===i.RotationDirection.left?(this.__ctrl.getElement().addClass("rotate-left"),this.__ctrl.getElement().removeClass("rotate-right")):(this.__ctrl.getElement().addClass("rotate-right"),this.__ctrl.getElement().removeClass("rotate-left"))):(this.__processImageRotation(),this.__ctrl.getElement().removeClass("rotate-right"),this.__ctrl.getElement().removeClass("rotate-left"),this.__ctrl.getElement().css("--tchmi-ba-background-styler-image-rotation-speed",""))}getImageRotationSpeed(){return this.__attrHandler.imageRotationSpeed}setImageRotationDirection(e){return this.__attrHandler.checkAttribute(e,"imageRotationDirection",{validator:"number"})?(this.__attrHandler.imageRotationDirection=e,this.__processImageRotationDirection(),this):this}__processImageRotationDirection(){this.__processImageRotationSpeed()}getImageRotationDirection(){return this.__attrHandler.imageRotationDirection}}a.BackgroundStyler=i,function(e){let t,a;!function(e){e[e.left=0]="left",e[e.right=1]="right"}(t=e.RotationDirection||(e.RotationDirection={})),function(e){e.onSvgLoaded="onSvgLoaded"}(a=e.Events||(e.Events={})),e.ImageFileEndings=["svg","png","jpg","jpeg"]}(i=a.BackgroundStyler||(a.BackgroundStyler={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){a.BorderStyler=class{constructor(e,a){this.__ctrl=e,this.logger=new t.Logger({name:this.__ctrl.getId()}),this.__attrHandler=new t.AttrHandler(this),this.__ctrl.getElement(),a&&this.setAttributes(a)}getControl(){return this.__ctrl}setAttributes(e){return null==e||(void 0!==e.border&&this.setBorder(e.border),void 0!==e.color&&this.setColor(e.color),void 0!==e.radius&&this.setRadius(e.radius,e.radiusUnit),void 0!==e.style&&this.setStyle(e.style),void 0!==e.width&&this.setWidth(e.width,e.widthUnit)),this}getAttributes(){return this.__attrHandler.getRef()}setBorder(e){return this.__attrHandler.checkAttribute(e,"border",{validator:"string"})?(this.__attrHandler.border=e,this.__processBorder(),this):this}__processBorder(){null==this.__attrHandler.border?(this.__ctrl.getElement().css("border",""),this.__processColor(),this.__processRadius(),this.__processStyle(),this.__processWidth()):this.__ctrl.getElement().css("border",this.__attrHandler.border)}getBorder(){return this.__attrHandler.border}setColor(e){return this.__attrHandler.checkAttribute(e,"color",{validator:["string",t.isFourSidedString]})?(this.__attrHandler.color=e,this.__processColor(),this):this}__processColor(){null==this.__attrHandler.color?this.__ctrl.getElement().css("border-color",""):t.isFourSidedString(this.__attrHandler.color)?this.__ctrl.getElement().css("border-color",this.__attrHandler.color.top+" "+this.__attrHandler.color.left+" "+this.__attrHandler.color.bottom+" "+this.__attrHandler.color.left):this.__ctrl.getElement().css("border-color",this.__attrHandler.color)}getColor(){return this.__attrHandler.color}setWidth(t,i="px"){if(!this.__attrHandler.checkAttribute(t,"width",{validator:["number",e.isBorderWidth]}))return this;if("number"==typeof t){if(!a.LayoutHandler.dimensionSetter(this.__attrHandler,"width",t,i))return this}else this.__attrHandler.width=t;return this.__processWidth(),this}__processWidth(){if(null==this.__attrHandler.width)this.__ctrl.getElement().css("border-width","");else{let t=this.__attrHandler.width;e.isBorderWidth(t)?this.__ctrl.getElement().css("border-width",t.top+(void 0===t.topUnit?"px":t.topUnit)+" "+t.right+(void 0===t.rightUnit?"px":t.rightUnit)+" "+t.bottom+(void 0===t.bottomUnit?"px":t.bottomUnit)+" "+t.left+(void 0===t.leftUnit?"px":t.leftUnit)):this.__ctrl.getElement().css("border-width",t+(this.__attrHandler.widthUnit?this.__attrHandler.widthUnit:"px"))}}getWidth(){return this.__attrHandler.width}getWidthUnit(){return this.__attrHandler.widthUnit}setStyle(t){return this.__attrHandler.checkAttribute(t,"style",{validator:["object",e.isBorderStyle,e.isBorderStyleValue]})?(this.__attrHandler.style=t,this.__processStyle(),this):this}__processStyle(){if(null==this.__attrHandler.style)this.__ctrl.getElement().css("border-style","");else{let t=this.__attrHandler.style;e.isBorderStyle(t)?this.__ctrl.getElement().css("border-style",t.top+" "+t.right+" "+t.bottom+" "+t.left):this.__ctrl.getElement().css("border-style",t)}}getStyle(){return this.__attrHandler.style}setRadius(t,i){if(!this.__attrHandler.checkAttribute(t,"radius",{validator:["number",e.isBorderRadius]}))return this;if("number"==typeof t){if(!a.LayoutHandler.dimensionSetter(this.__attrHandler,"radius",t,i))return this}else this.__attrHandler.radius=t;return this.__processRadius(),this}__processRadius(){if(null==this.__attrHandler.radius)this.__ctrl.getElement().css("border-radius","");else{let t=this.__attrHandler.radius;e.isBorderRadius(t)?this.__ctrl.getElement().css("border-radius",t.topLeft+(void 0===t.topLeftUnit?"px":t.topLeftUnit)+" "+t.topRight+(void 0===t.topRightUnit?"px":t.topRightUnit)+" "+t.bottomRight+(void 0===t.bottomRightUnit?"px":t.bottomRightUnit)+" "+t.bottomLeft+(void 0===t.bottomLeftUnit?"px":t.bottomLeftUnit)):this.__ctrl.getElement().css("border-radius",t+(this.__attrHandler.radiusUnit?this.__attrHandler.radiusUnit:"px"))}}getRadius(){return this.__attrHandler.radius}getRadiusUnit(){return this.__attrHandler.radiusUnit}}}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){class a{constructor(e){this.__isBusy=!1,this.__timerResults=[],this.__ctrl=e,this.__logger=new t.Logger({name:this.__ctrl.getId(),className:this.__ctrl.constructor.name})}get timerResults(){return this.__timerResults}logTimerResults(){if(1==a.RecordTimerResults)if(t.Components.Base.isIBase(this.__ctrl)){let e=function e(a){let i={timerResults:a.busyHandler.timerResults};if(a.childrenHandler.getChildCount()>0){i.children={};for(let n of a.childrenHandler.getChildren().values())t.Components.Base.isIBase(n)&&n.busyHandler.timerResults.length>0&&(i.children[n.getId()]=e(n))}return i}(this.__ctrl);console.log(`Timer results of '${this.__ctrl.getId()}'`,e)}else console.log("Timer results:",this.timerResults);else console.warn("Recording of timer results is disabled. Activate it in onInitialize of TcHmi with TcHmi.BuildingAutomation.BusyHandler.RecordTimerResults = true")}getControl(){return this.__ctrl}static appendBusyIndicator(e){let t=e.children(".tchmi-ba-busy-indicator");null==t[0]&&(t=$("<div>").addClass("tchmi-ba-busy-indicator"),t.append($('\n\t\t\t\t\t<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t<circle cx="50" cy="50" r="45"/>\n\t\t\t\t\t</svg>')),e.append(t))}__getBusyChildren(){let e=[];for(let a of this.__ctrl.childrenHandler.getChildren().values())t.Components.Base.isIBase(a)&&a.busyHandler.getIsBusy()&&(e||(e=[]),e.push(a));return e}__hasBusyParent(){let e=this.__ctrl.getBaParent();for(;e;){if(t.Components.Base.isIBase(e)&&e.busyHandler.getIsBusy())return!0;e=e.getBaParent()}return!1}static detachBusyIndicator(e){let t=e.children(".tchmi-ba-busy-indicator");void 0!==t[0]&&t.detach()}setBusy(e,i){if(!this.__isBusy){if(!this.__hasBusyParent()){let e=!1;if(this.__ctrl instanceof t.Components.Base?(0!=this.__ctrl.getShowBusyIndicator()&&(e=!0),0==(null==i?void 0:i.showIndicator)&&(e=!1)):0!=(null==i?void 0:i.showIndicator)&&(e=!0),e){a.appendBusyIndicator(this.__ctrl.getElement());let e=this.__getBusyChildren();if(e.length>0)for(let t=0;t<e.length;t++)a.detachBusyIndicator(e[t].getElement())}}this.__isBusy=!0}this.__timeoutIds||(this.__timeoutIds=new Map);let n,s=setTimeout(()=>{if(!0===this.__isBusy){let n={timeoutMessage:e,type:this.__ctrl.constructor.name,busyHandler:this,instance:this.__ctrl};t.Components.Base.isIBase(this.__ctrl)&&t.BaObjectHandler.isIUsesBaObject(this.__ctrl)&&(n.baObject=this.__ctrl.baObjectHandler.baObject),(null==i?void 0:i.optionalOutput)&&(n.optionalOutput=i.optionalOutput),this.__logger.log(t.Logger.Severity.warn,t.Logger.hourGlass+"Still not ready!",n),(null==i?void 0:i.cbOnTimeout)&&i.cbOnTimeout(i.cbTimeoutParams),this.__ctrl.eventHandler.raise(a.Events.onIsBusyTimeOut,this)}},null!=(null==i?void 0:i.timeout)?i.timeout:a.DefaultTimeout),r=(new Date).getTime(),o=i||{};o.id=s,o.timeoutMessage=e,this.__timeoutIds.set(r,o);let l=!0;1==a.RecordTimerResults&&(n=performance.now(),l=!1);let d=this.__ctrl.getBaParent();return(null==i?void 0:i.notifyParent)&&t.Components.Base.isIBase(d)&&d.busyHandler.childBusy(this.__ctrl),()=>{0==l&&null!=n&&(l=!0,this.__timerResults.push({requiredTime:((performance.now()-n)/1e3).toFixed(2)+" s",action:e})),this.__timeoutIds&&t.Helper.Map.findByValue(this.__timeoutIds,e=>e.id===s)&&this.__setReady(r),(null==i?void 0:i.cbOnReady)&&i.cbOnReady(i.cbReadyParams)}}getIsBusy(){return this.__isBusy}__setReady(e){if(this.__isBusy){if(null!=e&&this.__timeoutIds){let t=this.__timeoutIds.get(e);if(null==t)return void console.warn("What!?");clearTimeout(t.id),this.__timeoutIds.delete(e),0===this.__timeoutIds.size&&delete this.__timeoutIds}if(this.checkForBusyChildren()||null!=e&&this.__timeoutIds||(a.detachBusyIndicator(this.__ctrl.getElement()),this.__isBusy=!1),!this.__isBusy){let e=this.__ctrl.getBaParent();t.Components.Base.isIBase(e)&&e.busyHandler.childReady(this.__ctrl)}}}childBusy(e){this.__busyChildrenReady||(this.__busyChildrenReady=[]),this.__busyChildrenReady.push({ctrl:e,rf:this.setBusy("Waiting for busy children",{optionalOutput:e})})}childReady(e){if(this.__busyChildrenReady){for(let t=0;t<this.__busyChildrenReady.length;t++)if(e.getId()===this.__busyChildrenReady[t].ctrl.getId()){let e=this.__busyChildrenReady[t].rf;e&&(e(),this.__busyChildrenReady.splice(t,1),t--)}if(0===this.__busyChildrenReady.length){if(delete this.__busyChildrenReady,this.__busyChildrenReadyCallbacks){for(let e=0;e<this.__busyChildrenReadyCallbacks.length;e++)this.__busyChildrenReadyCallbacks[e]();delete this.__busyChildrenReadyCallbacks}this.__setReady()}}}checkForBusyChildren(e){let t=this.__getBusyChildren();if(t.length>0){for(let e=0;e<t.length;e++)this.__busyChildrenReady||(this.__busyChildrenReady=[]),this.__busyChildrenReady.find(a=>a.ctrl===t[e])||this.__busyChildrenReady.push({ctrl:t[e],rf:this.setBusy("Waiting for busy children",{optionalOutput:{busyChild:t[e]}})});return e&&(this.__busyChildrenReadyCallbacks||(this.__busyChildrenReadyCallbacks=[]),this.__busyChildrenReadyCallbacks.push(e)),!0}return!1}destroy(){if(null!=this.__timeoutIds)for(let e of this.__timeoutIds.values())clearTimeout(e.id)}}t.BusyHandler=a,function(a){function i(e){return null!=e&&(null!=e.busyHandler&&e.busyHandler instanceof a)}let n;a.DefaultTimeout=1e4,a.RecordTimerResults=!1,a.ShowEventLoading=!0,a.isIBusyHandler=i,function(e){e.onIsBusyTimeOut="onIsBusyTimeOut"}(n=a.Events||(a.Events={})),a.logTimerResultsOfControl=function(a){let n=e.Controls.get(a);i(n)?n.busyHandler.logTimerResults():t.Logger.log(t.Logger.Severity.warn,`Control with id '${a}' is not a BA control!`)}}(a=t.BusyHandler||(t.BusyHandler={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i{constructor(e,a){this.__ctrl=e,this.logger=new t.Logger({name:this.__ctrl.getId()}),this.__attrHandler=new t.AttrHandler(this),a&&this.setAttributes(a)}static dimensionSetter(t,a,i,n="px"){return!!t.checkAttribute(i,a,{validator:"number",skipEqualityCheck:!0})&&(!(null!=i&&!t.checkAttribute(n,String(a)+"Unit",{validator:e.isDimensionUnit,skipEqualityCheck:!0}))&&(i===t[a]&&n===t[String(a)+"Unit"]?(t.equalAttribute(String(a)),!1):(t[String(a)]=i,t[String(a)+"Unit"]=n,!0)))}__dimensionProcessor(e){null==this.__attrHandler[e]?this.__ctrl.getElement().css(e,""):this.__ctrl.getElement().css(e,this.__attrHandler[e]+this.__attrHandler[e+"Unit"])}getControl(){return this.__ctrl}reset(){let e=this.__attrHandler.getCopy();return this.setAttributes({bottom:null,left:null,top:null,right:null,height:null,maxHeight:null,maxWidth:null,minHeight:null,minWidth:null,width:null}),e}destroy(){null!=this.__attachId&&t.System.AttachObserver.remove(this.__ctrl,this.__attachId)}setAttributes(e){return null==e?(this.__attrHandler.invalidAttribute("Attributes",e),this):(void 0!==e.bottom&&this.setBottom(e.bottom,e.bottomUnit),void 0!==e.left&&this.setLeft(e.left,e.leftUnit),void 0!==e.top&&this.setTop(e.top,e.topUnit),void 0!==e.right&&this.setRight(e.right,e.rightUnit),void 0!==e.height&&this.setHeight(e.height,e.heightUnit),void 0!==e.width&&this.setWidth(e.width,e.widthUnit),void 0!==e.minHeight&&this.setMinHeight(e.minHeight,e.minHeightUnit),void 0!==e.minWidth&&this.setMinWidth(e.minWidth,e.minWidthUnit),void 0!==e.maxHeight&&this.setMaxHeight(e.maxHeight,e.maxHeightUnit),void 0!==e.maxWidth&&this.setMaxWidth(e.maxWidth,e.maxWidthUnit),void 0!==e.zIndex&&this.setZindex(e.zIndex),void 0!==e.autoUpdateAttributes&&this.setAutoUpdateAttributes(e.autoUpdateAttributes),this)}getAttributes(){return this.__attrHandler.getRef()}setHeight(e,t="px"){return i.dimensionSetter(this.__attrHandler,"height",e,t)?(this.__dimensionProcessor("height"),this):this}getHeight(){return this.__attrHandler.height}getHeightUnit(){return this.__attrHandler.heightUnit}setWidth(e,t="px"){return i.dimensionSetter(this.__attrHandler,"width",e,t)?(this.__dimensionProcessor("width"),this):this}getWidth(){return this.__attrHandler.width}getWidthUnit(){return this.__attrHandler.widthUnit}setRight(e,t="px"){return i.dimensionSetter(this.__attrHandler,"right",e,t)?(this.__dimensionProcessor("right"),this):this}getRight(){return this.__attrHandler.right}getRightUnit(){return this.__attrHandler.rightUnit}setLeft(e,t="px"){return i.dimensionSetter(this.__attrHandler,"left",e,t)?(this.__dimensionProcessor("left"),this):this}getLeft(){return this.__attrHandler.left}getLeftUnit(){return this.__attrHandler.leftUnit}setTop(e,t="px"){return i.dimensionSetter(this.__attrHandler,"top",e,t)?(this.__dimensionProcessor("top"),this):this}getTop(){return this.__attrHandler.top}getTopUnit(){return this.__attrHandler.topUnit}setBottom(e,t="px"){return i.dimensionSetter(this.__attrHandler,"bottom",e,t)?(this.__dimensionProcessor("bottom"),this):this}getBottom(){return this.__attrHandler.bottom}getBottomUnit(){return this.__attrHandler.bottomUnit}setMaxWidth(e,t="px"){return i.dimensionSetter(this.__attrHandler,"maxWidth",e,t)?(this.__dimensionProcessor("maxWidth"),this):this}getMaxWidth(){return this.__attrHandler.maxWidth}getMaxWidthUnit(){return this.__attrHandler.maxWidthUnit}setMaxHeight(e,t="px"){return i.dimensionSetter(this.__attrHandler,"maxHeight",e,t)?(this.__dimensionProcessor("maxHeight"),this):this}getMaxHeight(){return this.__attrHandler.maxHeight}getMaxHeightUnit(){return this.__attrHandler.maxHeightUnit}setMinWidth(e,t="px"){return i.dimensionSetter(this.__attrHandler,"minWidth",e,t)?(this.__dimensionProcessor("minWidth"),this):this}getMinWidth(){return this.__attrHandler.minWidth}getMinWidthUnit(){return this.__attrHandler.minWidthUnit}setMinHeight(e,t="px"){return i.dimensionSetter(this.__attrHandler,"minHeight",e,t)?(this.__dimensionProcessor("minHeight"),this):this}getMinHeight(){return this.__attrHandler.minHeight}getMinHeightUnit(){return this.__attrHandler.minHeightUnit}setZindex(e){return this.__attrHandler.checkAttribute(e,"zIndex",{validator:"number"})?(this.__attrHandler.zIndex=e,this.__processZindex(),this):this}__processZindex(){null==this.__attrHandler.zIndex?this.__ctrl.getElement().css("z-index",""):this.__ctrl.getElement().css("z-index",this.__attrHandler.zIndex)}getZindex(){return this.__attrHandler.zIndex}setAutoUpdateAttributes(e){return this.__attrHandler.checkAttribute(e,"autoUpdateAttributes",{validator:"array"})?(this.__attrHandler.autoUpdateAttributes=e,this.__processAutoUpdateAttributes(),this):this}__processAutoUpdateAttributes(){var e;if(null==this.__attrHandler.autoUpdateAttributes)null===(e=this.__mutationObserver)||void 0===e||e.disconnect(),delete this.__mutationObserver;else if(!this.__mutationObserver){let e=()=>{var e,t;if(this.__attrHandler.autoUpdateAttributes){if(this.__attrHandler.autoUpdateAttributes.indexOf("width")>-1){let e=this.__ctrl.getElement().width();null!=e&&e!==this.__attrHandler.width&&(this.__attrHandler.width=e)}if(this.__attrHandler.autoUpdateAttributes.indexOf("height")>-1){let e=this.__ctrl.getElement().height();null!=e&&e!==this.__attrHandler.height&&(this.__attrHandler.height=e)}if(this.__attrHandler.autoUpdateAttributes.indexOf("left")>-1){let t=null===(e=this.__ctrl.getElement().offset())||void 0===e?void 0:e.left;null!=t&&t!==this.__attrHandler.left&&(this.__attrHandler.left=t)}if(this.__attrHandler.autoUpdateAttributes.indexOf("top")>-1){let e=null===(t=this.__ctrl.getElement().offset())||void 0===t?void 0:t.top;null!=e&&e!==this.__attrHandler.top&&(this.__attrHandler.top=e)}}};this.__mutationObserver=new MutationObserver(e),null!=this.__attachId&&t.System.AttachObserver.remove(this.__ctrl,this.__attachId),this.__attachId=t.System.AttachObserver.add(this.__ctrl,{attachedCb:()=>{var t;null===(t=this.__mutationObserver)||void 0===t||t.observe(this.__ctrl.getElement()[0],{attributes:!0,attributeFilter:["style"]}),e()},detachedCb:()=>{var e;null===(e=this.__mutationObserver)||void 0===e||e.disconnect()}})}}getAutoUpdateAttributes(){return this.__attrHandler.autoUpdateAttributes}}a.LayoutHandler=i}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){let t;!function(t){class a{constructor(t,i,n){this.childrenHandler=new a.ChildrenHandler(this),this.__destroyersToCallOnDetach=[],this.__destroyersToCallOnDestroy=[],this.__isAttached=!1,this.__isDestroyed=!1,this.__element=$("<div>").addClass("tchmi-ba-base-node"),"string"==typeof t?t.length<=0?console.error("ID cannot be an empty string!","Passed ID:",t):(e.Globals.CreatedBaseNodes.has(t)&&console.error(`A class instance with id ${t} has already been created! Did you forgot to destroy the class?`),this.__id=t,this.__attrHandler=new e.AttrHandler(this),this.logger=new e.Logger({name:t,className:this.constructor.name}),this.eventHandler=new e.EventHandler(this),this.__element.attr("id",t),e.Globals.CreatedBaseNodes.set(t,this),null!=i&&(this.__baParent=i,this.__baParent.childrenHandler.addChild(this)),this.__attachId=e.System.AttachObserver.add(this,{attachedCb:()=>this.__attach(),detachedCb:()=>this.__detach()}),null==n&&(n={}),this.__init(n),this.setAttributes(n)):console.error("ID must be a string!","Passed ID:",t)}__init(e){}__attach(){this.__isAttached||(this.__isAttached=!0,this.eventHandler.raise(a.BaseNodeEvents.onAttached))}__detach(){if(this.__isAttached){this.__isAttached=!1,this.eventHandler.raise(a.BaseNodeEvents.onDetached);for(let e=0;e<this.__destroyersToCallOnDetach.length;e++)this.__destroyersToCallOnDetach[e]();this.__destroyersToCallOnDetach=[]}}destroy(){var t;if(!this.__isDestroyed){this.__element.detach(),e.Globals.CreatedBaseNodes.delete(this.__id),e.System.AttachObserver.remove(this,this.__attachId),this.eventHandler.raise(a.BaseNodeEvents.onDestroyed);for(let e=0;e<this.__destroyersToCallOnDestroy.length;e++)this.__destroyersToCallOnDestroy[e]();this.__destroyersToCallOnDestroy=[],null===(t=this.__baParent)||void 0===t||t.childrenHandler.removeChild(this),this.__isDestroyed=!0}}getId(){return this.__id}getBaParent(){return this.__baParent}getElement(){return this.__element}hide(){return this.__element.css("display","none"),this}show(){return this.__element.css("display",""),this}getIsAttached(){return this.__isAttached}setAttributes(t){return null==t&&this.logger.log(e.Logger.Severity.warn,e.Logger.crossMark+"Passed attributes object was null!"),void 0!==t.visibility&&this.setVisibility(t.visibility),void 0!==t.hide&&this.setHide(t.hide),void 0!==t.cssClass&&this.setCssClass(t.cssClass),this}getAttributes(){return this.__attrHandler.getRef()}setVisibility(e){return this.__attrHandler.checkAttribute(e,"visibility",{validator:"number"})?(this.__attrHandler.visibility=e,this.__processVisibility(),this):this}__processVisibility(){switch(this.__attrHandler.visibility){case null:this.__element.css("visibility","");break;case e.Visibility.Collapsed:this.__element.css("visibility","collapse");break;case e.Visibility.Hidden:this.__element.css("visibility","hidden");break;case e.Visibility.Visible:this.__element.css("visibility","visible");break;default:this.logger.log(e.Logger.Severity.warn,`Visibility of ${this.__id} has invalid value!`)}}getVisibility(){return this.__attrHandler.visibility}setHide(e){return this.__attrHandler.checkAttribute(e,"hide",{validator:"boolean"})?(this.__attrHandler.hide=e,this.__processHide(),this):this}__processHide(){1==this.__attrHandler.hide?this.hide():this.show()}getHide(){return this.__attrHandler.hide}setCssClass(e){return this.__attrHandler.checkAttribute(e,"cssClass",{validator:"string"})?(this.__attrHandler.cssClass&&this.__element.removeClass(this.__attrHandler.cssClass),this.__attrHandler.cssClass=e,this.__processCssClass(),this):this}__processCssClass(){this.__attrHandler.cssClass&&this.__element.addClass(this.__attrHandler.cssClass)}getCssClass(){return this.__attrHandler.cssClass}}t.BaseNode=a,function(t){let a;!function(e){e.onAttached="onAttached",e.onDetached="onDetached",e.onDestroyed="onDestroyed"}(a=t.BaseNodeEvents||(t.BaseNodeEvents={}));t.ChildrenHandler=class{constructor(e){this.__children=new Map,this.__ctrl=e}addChild(t){if(null==t)return!1;if(this.__children.get(t.getId())){const a=`A child with id ${t.getId()} does already exists on ${this.__ctrl.getId()}!`;return e.Logger.isILogger(this.__ctrl)?this.__ctrl.logger.log(e.Logger.Severity.error,a):console.error(a),!1}return this.__children.set(t.getId(),t),!0}removeChild(e){if(null==e)return!1;return null!=this.__children.get(e.getId())&&(this.__children.delete(e.getId()),!0)}getChildCount(){return this.__children.size}getChildren(){return this.__children}getChild(e){return this.__children.get(e)}}}(a=t.BaseNode||(t.BaseNode={}))}(t=e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i extends a.BaseNode{constructor(e,t,a){super(e,t,a)}__init(e){this.busyHandler=new t.BusyHandler(this),this.layoutHandler=new a.LayoutHandler(this),this.backgroundStyler=new a.BackgroundStyler(this),this.borderStyler=new a.BorderStyler(this),this.errorIndicator=new n(this),this.__element.addClass("tchmi-ba-base"),void 0===e.isEnabled&&(e.isEnabled=!0),this.__attrHandler.layout=this.layoutHandler.getAttributes(),this.__attrHandler.background=this.backgroundStyler.getAttributes(),this.__attrHandler.border=this.borderStyler.getAttributes()}__attach(){this.__isAttached||(super.__attach(),this.busyHandler.checkForBusyChildren())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy(),this.busyHandler.destroy(),this.layoutHandler.destroy(),this.__deviceDiagEventDf&&this.__deviceDiagEventDf()}__getNextAttachedParent(){let e=this.__baParent;for(;e;){if(e.getIsAttached())return e;e=e.getBaParent()}return null}checkAccess(t){let a=this.__baParent;for(;null!=(null==a?void 0:a.getBaParent());)a=a.getBaParent();return a instanceof e.Controls.System.TcHmiControl?e.Access.checkAccess(a,t):null}setAttributes(e){return super.setAttributes(e),null!=e.layout&&this.layoutHandler.setAttributes(e.layout),null!=e.background&&this.backgroundStyler.setAttributes(e.background),null!=e.border&&this.borderStyler.setAttributes(e.border),void 0!==e.contentPadding&&this.setContentPadding(e.contentPadding),void 0!==e.boxShadow&&this.setBoxShadow(e.boxShadow),void 0!==e.isEnabled&&this.setIsEnabled(e.isEnabled),void 0!==e.readOnly&&this.setReadOnly(e.readOnly),void 0!==e.showBusyIndicator&&this.setShowBusyIndicator(e.showBusyIndicator),this}getAttributes(){return this.__attrHandler.getRef()}setReadOnly(e){return this.__attrHandler.checkAttribute(e,"readOnly",{validator:"boolean"})?(this.__attrHandler.readOnly=e,this.__processReadOnly(),this):this}__processReadOnly(){null!=this.__attrHandler.readOnly&&!1===this.__attrHandler.readOnly?this.__element.removeClass("read-only"):this.__element.addClass("read-only")}getReadOnly(){return this.__attrHandler.readOnly}setShowBusyIndicator(e){return this.__attrHandler.checkAttribute(e,"showBusyIndicator",{validator:"boolean"})?(this.__attrHandler.showBusyIndicator=e,this.__processShowBusyIndicator(),this):this}__processShowBusyIndicator(){}getShowBusyIndicator(){return this.__attrHandler.showBusyIndicator}setIsEnabled(e){return this.__attrHandler.checkAttribute(e,"isEnabled",{validator:"boolean"})?(this.__attrHandler.isEnabled=e,this.__processIsEnabled(),this):this}__processIsEnabled(){this.__attrHandler.isEnabled?this.__element.removeClass("tchmi-control-disabled"):this.__element.addClass("tchmi-control-disabled")}getIsEnabled(){return this.__attrHandler.isEnabled}setBoxShadow(e){return this.__attrHandler.checkAttribute(e,"boxShadow",{validator:"string"})?(this.__attrHandler.boxShadow=e,this.__processBoxShadow(),this):this}__processBoxShadow(){null==this.__attrHandler.boxShadow?this.__element.css("box-shadow",""):this.__element.css("box-shadow",this.__attrHandler.boxShadow)}getBoxShadow(){return this.__attrHandler.boxShadow}setContentPadding(t){return this.__attrHandler.checkAttribute(t,"contentPadding",{validator:[e.isFourSidedCss,()=>"number"==typeof t]})?(this.__attrHandler.contentPadding=t,this.__processContentPadding(),this):this}__processContentPadding(){if(null==this.__attrHandler.contentPadding)this.__element.css("--tchmi-ba-base-content-padding","");else{let t;t=e.isFourSidedCss(this.__attrHandler.contentPadding)?this.__attrHandler.contentPadding:{top:this.__attrHandler.contentPadding,right:this.__attrHandler.contentPadding,bottom:this.__attrHandler.contentPadding,left:this.__attrHandler.contentPadding},this.__element.css("--tchmi-ba-base-content-padding",""+t.top+(t.topUnit?t.topUnit:"px")+" "+t.right+(t.rightUnit?t.rightUnit:"px")+" "+t.bottom+(t.bottomUnit?t.bottomUnit:"px")+" "+t.left+(t.leftUnit?t.leftUnit:"px"))}}getContentPadding(){return this.__attrHandler.contentPadding}}a.Base=i,function(e){e.isIBase=function(e){let a=!0;if(null!=e&&"object"==typeof e){let i=new Map;e.busyHandler instanceof t.BusyHandler||(a=!1),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a}}(i=a.Base||(a.Base={}));class n{constructor(e){this.__ctrl=e}getControl(){return this.__ctrl}static appendErrorIndicator(e,a){let i=e.children(".tchmi-ba-error-indicator");if(null!=i[0])return!1;switch(i=$("<div>").addClass("tchmi-ba-error-indicator"),a){case n.ErrorLevel.error:i.addClass("level-error"),t.System.SVGLoader.get(t.Icons.Events.Priority.Critical.path).then(e=>{i.append(e)});break;case n.ErrorLevel.fault:i.addClass("level-fault"),t.System.SVGLoader.get(t.Icons.Events.Flag.Fault.path).then(e=>{i.append(e)})}return e.append(i),!0}static detachErrorIndicator(e){let t=e.children(".tchmi-ba-error-indicator");void 0!==t[0]&&t.detach()}set(e){n.appendErrorIndicator(this.__ctrl.getElement(),e)&&(null==this.__wasEnabledBefore&&(this.__wasEnabledBefore=this.__ctrl.getIsEnabled()),this.__ctrl.setIsEnabled(!1))}reset(){this.__ctrl.setIsEnabled(null==this.__wasEnabledBefore||this.__wasEnabledBefore),n.detachErrorIndicator(this.__ctrl.getElement())}}a.ErrorIndicator=n,function(e){let t;!function(e){e[e.error=0]="error",e[e.fault=1]="fault"}(t=e.ErrorLevel||(e.ErrorLevel={}))}(n=a.ErrorIndicator||(a.ErrorIndicator={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i{constructor(e,a){this.__textElement=$("<span>").addClass("text-element"),this.__ctrl=e,this.logger=new t.Logger({name:this.__ctrl.getId()}),this.__attrHandler=new t.AttrHandler(this),this.__ctrl.getElement().addClass("tchmi-ba-text-handler"),this.setOverflow(i.Overflow.ellipsis),a&&this.setAttributes(a)}destroy(){var e;null===(e=this.__textSymbol)||void 0===e||e.destroy()}__onResized(){switch(this.__attrHandler.overflow){case i.Overflow.marquee:this.__textElement.width(()=>{var e;let t=this.__textElement[0].scrollWidth,a=null===(e=this.__textElement[0].parentElement)||void 0===e?void 0:e.clientWidth;return t&&a&&t-a>0?(this.__ctrl.getElement().addClass("overflow-marquee"),t-a):(this.__ctrl.getElement().removeClass("overflow-marquee"),"")});break;default:this.__textElement.width("")}}getControl(){return this.__ctrl}getTextElement(){return this.__textElement}setAttributes(e){return null==e?(this.__attrHandler.invalidAttribute("Attributes",e),this):(void 0!==e.text&&this.setText(e.text),void 0!==e.color&&this.setColor(e.color),void 0!==e.horizontalAlignment&&this.setHorizontalAlignment(e.horizontalAlignment),void 0!==e.verticalAlignment&&this.setVerticalAlignment(e.verticalAlignment),void 0!==e.fontSize&&this.setFontSize(e.fontSize,e.fontSizeUnit),void 0!==e.fontStyle&&this.setFontStyle(e.fontStyle),void 0!==e.fontWeight&&this.setFontWeight(e.fontWeight),void 0!==e.fontFamily&&this.setFontFamily(e.fontFamily),void 0!==e.overflow&&this.setOverflow(e.overflow),void 0!==e.userSelect&&this.setUserSelect(e.userSelect),void 0!==e.decorationColor&&this.setDecorationColor(e.decorationColor),void 0!==e.decorationLine&&this.setDecorationLine(e.decorationLine),void 0!==e.decorationStyle&&this.setDecorationStyle(e.decorationStyle),void 0!==e.wordWrap&&this.setWordWrap(e.wordWrap),this)}getAttributes(){return this.__attrHandler.getRef()}setText(a){return this.__attrHandler.checkAttribute(a,"text",{validator:"string"})?(this.__attrHandler.text=a,null!=this.__attrHandler.text&&e.Symbol.isSymbolExpression(this.__attrHandler.text)?(null!=this.__textSymbol&&this.__textSymbol.destroy(),this.__textSymbol=new e.Symbol(this.__attrHandler.text),this.__textSymbol.watch(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.value&&(this.__attrHandler.text=e.value,this.__processText())})):this.__processText(),this.__ctrl.onTextChanged(this.__attrHandler.text),this):this}__processText(){null==this.__attrHandler.text?this.__textElement.html(""):this.__textElement.html(this.__attrHandler.text),this.__onResized()}getText(){return this.__attrHandler.text}setColor(e){return this.__attrHandler.checkColorAttribute(e,"color")?(this.__attrHandler.color=e,this.__processColor(),this):this}__processColor(){null==this.__attrHandler.color?this.__ctrl.getElement().css("--tchmi-ba-text-color",""):this.__ctrl.getElement().css("--tchmi-ba-text-color",this.__attrHandler.color.toString())}getColor(){return this.__attrHandler.color}setHorizontalAlignment(t){return this.__attrHandler.checkAttribute(t,"horizontalAlignment",{validator:e.isHorizontalAlignment})?(this.__attrHandler.horizontalAlignment=t,this.__processHorizontalAlignment(),this):this}__processHorizontalAlignment(){null==this.__attrHandler.horizontalAlignment?this.__ctrl.getElement().css("--tchmi-ba-text-horizontal-alignment",""):this.__ctrl.getElement().css("--tchmi-ba-text-horizontal-alignment",this.__attrHandler.horizontalAlignment.toLowerCase())}getHorizontalAlignment(){return this.__attrHandler.horizontalAlignment}setVerticalAlignment(t){return this.__attrHandler.checkAttribute(t,"verticalAlignment",{validator:e.isVerticalAlignment})?(this.__attrHandler.verticalAlignment=t,this.__processVerticalAlignment(),this):this}__processVerticalAlignment(){let e;switch(this.__attrHandler.verticalAlignment){case null:e="";break;case"Top":e="flex-start";break;case"Center":e="center";break;case"Bottom":e="flex-end";break;default:return}this.__ctrl.getElement().css("--tchmi-ba-text-vertical-alignment",e)}getVerticalAlignment(){return this.__attrHandler.verticalAlignment}setFontSize(e,t){return a.LayoutHandler.dimensionSetter(this.__attrHandler,"fontSize",e,t)?(this.__processFontSize(),this):this}__processFontSize(){null==this.__attrHandler.fontSize?this.__ctrl.getElement().css("--tchmi-ba-font-size",""):this.__ctrl.getElement().css("--tchmi-ba-font-size",this.__attrHandler.fontSize+(this.__attrHandler.fontSizeUnit?this.__attrHandler.fontSizeUnit:"px"))}getFontSize(){return this.__attrHandler.fontSize}getFontSizeUnit(){return this.__attrHandler.fontSizeUnit}setFontWeight(t){return this.__attrHandler.checkAttribute(t,"fontWeight",{validator:e.isFontWeight})?(this.__attrHandler.fontWeight=t,this.__processFontWeight(),this):this}__processFontWeight(){null==this.__attrHandler.fontWeight?this.__ctrl.getElement().css("--tchmi-ba-font-weight",""):this.__ctrl.getElement().css("--tchmi-ba-font-weight",this.__attrHandler.fontWeight.toLowerCase())}getFontWeight(){return this.__attrHandler.fontWeight}setFontStyle(t){return this.__attrHandler.checkAttribute(t,"fontStyle",{validator:e.isFontStyle})?(this.__attrHandler.fontStyle=t,this.__processFontStyle(),this):this}__processFontStyle(){null==this.__attrHandler.fontStyle?this.__ctrl.getElement().css("--tchmi-ba-font-style",""):this.__ctrl.getElement().css("--tchmi-ba-font-style",this.__attrHandler.fontStyle.toLowerCase())}getFontStyle(){return this.__attrHandler.fontStyle}setFontFamily(e){return this.__attrHandler.checkAttribute(e,"fontFamily",{validator:"string"})?(this.__attrHandler.fontFamily=e,this.__processFontFamily(),this):this}__processFontFamily(){null==this.__attrHandler.fontFamily?this.__ctrl.getElement().css("--tchmi-ba-font-family",""):this.__ctrl.getElement().css("--tchmi-ba-font-family",this.__attrHandler.fontFamily)}getFontFamily(){return this.__attrHandler.fontFamily}setDecorationColor(e){return this.__attrHandler.checkColorAttribute(e,"decorationColor")?(this.__attrHandler.decorationColor=e,this.__processDecorationColor(),this):this}__processDecorationColor(){null==this.__attrHandler.decorationColor?this.__ctrl.getElement().css("--tchmi-ba-text-decoration-color",""):this.__ctrl.getElement().css("--tchmi-ba-text-decoration-color",this.__attrHandler.decorationColor.toString())}getDecorationColor(){return this.__attrHandler.decorationColor}setDecorationLine(e){return this.__attrHandler.checkAttribute(e,"decorationLine",{validator:i.isTextDecorationLine})?(this.__attrHandler.decorationLine=e,this.__processDecorationLine(),this):this}__processDecorationLine(){null==this.__attrHandler.decorationLine?this.__ctrl.getElement().css("--tchmi-ba-text-decoration-line",""):this.__ctrl.getElement().css("--tchmi-ba-text-decoration-line",this.__attrHandler.decorationLine)}getDecorationLine(){return this.__attrHandler.decorationLine}setDecorationStyle(e){return this.__attrHandler.checkAttribute(e,"decorationStyle",{validator:i.isTextDecorationStyle})?(this.__attrHandler.decorationStyle=e,this.__processDecorationStyle(),this):this}__processDecorationStyle(){null==this.__attrHandler.decorationStyle?this.__ctrl.getElement().css("--tchmi-ba-text-decoration-style",""):this.__ctrl.getElement().css("--tchmi-ba-text-decoration-style",this.__attrHandler.decorationStyle)}getDecorationStyle(){return this.__attrHandler.decorationStyle}setUserSelect(e){return this.__attrHandler.checkAttribute(e,"userSelect",{validator:i.isUserSelect})?(this.__attrHandler.userSelect=e,this.__processUserSelect(),this):this}__processUserSelect(){null==this.__attrHandler.userSelect?this.__ctrl.getElement().css("--tchmi-ba-user-select",""):this.__ctrl.getElement().css("--tchmi-ba-user-select",this.__attrHandler.userSelect)}getUserSelect(){return this.__attrHandler.userSelect}setOverflow(e){return this.__attrHandler.checkAttribute(e,"overflow",{validator:"number"})?(this.__attrHandler.overflow=e,this.__processOverflow(),this):this}__processOverflow(){var e;switch(null===(e=this.__resizeObserver)||void 0===e||e.unobserve(this.__ctrl.getElement()[0]),this.__attrHandler.overflow){case i.Overflow.ellipsis:this.__ctrl.getElement().addClass("overflow-ellipsis"),this.__ctrl.getElement().removeClass("overflow-marquee");break;case i.Overflow.marquee:this.__ctrl.getElement().removeClass("overflow-ellipsis"),this.__resizeObserver||(this.__resizeObserver=new ResizeObserver(()=>this.__onResized())),this.__resizeObserver.observe(this.__ctrl.getElement()[0]);break;default:this.__ctrl.getElement().removeClass("overflow-ellipsis"),this.__ctrl.getElement().removeClass("overflow-marquee")}this.__onResized()}getOverflow(){return this.__attrHandler.overflow}setWordWrap(e){return this.__attrHandler.checkAttribute(e,"wordWrap",{validator:"boolean"})?(this.__attrHandler.wordWrap=e,this.__processWordWrap(),this):this}__processWordWrap(){this.__attrHandler.wordWrap?(this.__ctrl.getElement().css("--tchmi-ba-text-white-space","normal"),this.__ctrl.getElement().css("word-break","break-word")):(this.__ctrl.getElement().css("--tchmi-ba-text-white-space",""),this.__ctrl.getElement().css("word-break",""))}getWordWrap(){return this.__attrHandler.wordWrap}}a.TextHandler=i,function(e){let t;e.isTextDecorationLine=function(e){return"none"===e||"underline"===e||"overline"===e||"line-through"===e||"initial"===e||"inherit"===e},e.isTextDecorationStyle=function(e){return"solid"===e||"double"===e||"dotted"===e||"dashed"===e||"wavy"===e||"initial"===e||"inherit"===e},e.isUserSelect=function(e){return"auto"===e||"none"===e||"text"===e||"all"===e},function(e){e[e.none=0]="none",e[e.ellipsis=1]="ellipsis",e[e.marquee=2]="marquee"}(t=e.Overflow||(e.Overflow={})),e.calculateTextSize=function(e,t){let a=$("<span>").css({position:"absolute",height:"auto",width:t?t+"px":"auto","font-weight":e.fontWeight?e.fontWeight.toLowerCase():"normal","font-size":e.fontSize+"px","white-space":e.wordWrap?"normal":"nowrap","word-break":"break-word","text-align":e.horizontalAlignment?e.horizontalAlignment:"left","z-index":5e3});a.html(e.text),$("body").append(a);let i=Number(a.innerHeight()),n=Number(a.innerWidth());return a.detach(),{width:n,height:i}}}(i=a.TextHandler||(a.TextHandler={}));class n extends a.Base{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.textHandler=new i(this),this.__element.addClass("text-control"),this.__attrHandler.textAttributes=this.textHandler.getAttributes()}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}onTextChanged(e){}setAttributes(e){return super.setAttributes(e),this.textHandler||(this.textHandler=new i(this)),null!=e.textAttributes&&this.textHandler.setAttributes(e.textAttributes),this}getAttributes(){return this.__attrHandler.getRef()}}a.TextControl=n,function(e){e.isITextControl=function(e){return null!=e&&"object"==typeof e&&(!(e.textHandler instanceof i)&&"function"==typeof e.onTextChanged)}}(n=a.TextControl||(a.TextControl={}));a.Textblock=class extends n{constructor(e,t,a){super(e,t,a),this.__element.append(this.textHandler.getTextElement()).addClass("textblock")}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}}}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){let a;!function(e){e[e.Invalid=-1]="Invalid",e[e.Button=0]="Button",e[e.ToggleButton=1]="ToggleButton",e[e.Combobox=2]="Combobox",e[e.Checkbox=3]="Checkbox",e[e.InputBox=4]="InputBox",e[e.DateTimeField=5]="DateTimeField",e[e.Slider=6]="Slider",e[e.Textblock=7]="Textblock",e[e.Image=8]="Image"}(a=t.ComponentType||(t.ComponentType={}));class i extends t.BaseNode{constructor(e,t,a){super(e,t,a),this.__controlInteractionHandler=(e,t)=>{if(null==this.__controls)return;let a;for(let e=0;e<this.__controls.length;e++)if(this.__controls[e].control.getId()===t.getId()){a=this.__controls[e].options;break}a&&a.internalCallback&&a.internalCallback()},this.__element.addClass("tchmi-ba-control-container")}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){var e;null===(e=this.__controls)||void 0===e||e.forEach(e=>{var t,a;null!=(null===(t=e.options)||void 0===t?void 0:t.destroyOnUserInteractionFinished)&&e.options.destroyOnUserInteractionFinished(),(null===(a=e.options)||void 0===a?void 0:a.omitDestroy)||e.control.destroy()}),super.destroy()}__addControl(n){let s,r;if(this.__controls||(this.__controls=[]),n instanceof t.Base)s=n,r={control:s,options:{type:a.Invalid,omitDestroy:!0}};else{let t=0,a=this.__id+"-control-"+t;for(;e.Globals.CreatedBaseNodes.has(a);)t++,a=this.__id+"-control-"+t;s=i.createControl(a,n,this),r={control:s,options:n}}let o=this.__getEvent(s);return null!=o&&null!=r.options&&(r.options.destroyOnUserInteractionFinished=s.eventHandler.register(o,this.__controlInteractionHandler)),this.__controls.push(r),s}__getEvent(e){switch(e.constructor){case t.Button:return t.Button.ButtonEvents.onPressed;case t.ToggleButton:return t.ToggleButton.ToggleButtonEvents.onToggleStateChanged;case t.Checkbox:return t.Checkbox.CheckboxEvents.onUserInteractionFinished;case t.Combobox:return t.Combobox.ComboboxEvents.onUserInteractionFinished;case t.InputBox:return t.InputBox.InputBoxEvents.onUserInteractionFinished;case t.Slider:return t.Slider.SliderEvents.onUserInteractionFinished;case t.DateTimeField:return t.DateTimeField.DateTimeFieldEvents.onUserInteractionFinished;default:return null}}__appendControlsInOrder(){if(this.__controls){this.__controls=e.Helper.Array.mergeSort(this.__controls,!0,(e,t)=>{var a,i,n,s;return null==(null===(i=null===(a=e.options)||void 0===a?void 0:a.settings)||void 0===i?void 0:i.order)||null!=(null===(s=null===(n=t.options)||void 0===n?void 0:n.settings)||void 0===s?void 0:s.order)&&e.options.settings.order<t.options.settings.order});for(let e=0;e<this.__controls.length;e++)this.__element.append(this.__controls[e].control.getElement())}}static createControl(e,i,n){let s;switch(i.type){case a.Button:s=new t.Button(e,n),i.internalCallback=()=>{var e;i.callback&&i.callback(void 0,null===(e=i.settings)||void 0===e?void 0:e.callbackParams,s)};break;case a.ToggleButton:s=new t.ToggleButton(e,n),i.internalCallback=()=>{var e;i.callback&&i.callback(s.getToggleState(),null===(e=i.settings)||void 0===e?void 0:e.callbackParams,s)};break;case a.Checkbox:s=new t.Checkbox(e,n),i.internalCallback=()=>{var e;i.callback&&i.callback(s.getState(),null===(e=i.settings)||void 0===e?void 0:e.callbackParams,s)},void 0===i.settings&&(i.settings={}),void 0===i.settings.activeText&&(i.settings.activeText=null),void 0===i.settings.inactiveText&&(i.settings.inactiveText=null);break;case a.Combobox:s=new t.Combobox(e,n),i.internalCallback=()=>{var e;i.callback&&i.callback(s.getSelectedValue(),null===(e=i.settings)||void 0===e?void 0:e.callbackParams,s)};break;case a.DateTimeField:s=new t.DateTimeField(e,n),i.internalCallback=()=>{var e;i.callback&&i.callback(s.getDate(),null===(e=i.settings)||void 0===e?void 0:e.callbackParams,s)};break;case a.InputBox:s=new t.InputBox(e,n),i.internalCallback=()=>{var e;i.callback&&i.callback(s.getValue(),null===(e=i.settings)||void 0===e?void 0:e.callbackParams,s)};break;case a.Slider:s=new t.Slider(e,n),i.internalCallback=()=>{var e;i.callback&&i.callback(s.getValue(),null===(e=i.settings)||void 0===e?void 0:e.callbackParams,s)},s instanceof t.Slider&&(s.setShowScale(!1),s.setShowValue(!1));break;case a.Textblock:s=new t.Textblock(e,n);break;case a.Image:s=new t.Base(e,n);break;default:throw new Error("Implement other Menu control types!")}return i.settings&&s instanceof t.Base&&s.setAttributes(i.settings),i.cbOnCreated&&i.cbOnCreated(s),s}addControl(e){var t;let a=this.__addControl(e);return this.__appendControlsInOrder(),null===(t=this.__controlCollectionChangedCBs)||void 0===t||t.forEach(e=>e(a,"added")),a}addControls(e){let t=[];if(e instanceof Array)for(let a=0;a<e.length;a++)t.push(this.__addControl(e[a]));return this.__appendControlsInOrder(),t.forEach(e=>{var t;return null===(t=this.__controlCollectionChangedCBs)||void 0===t?void 0:t.forEach(t=>t(e,"added"))}),t}removeControl(e){var t,a;if(null==e)return!1;if(this.__controls){if("string"==typeof e&&(e=this.getControl(e)),null==e)return!1;let i;for(let n=0;n<this.__controls.length;n++)if(i=this.__controls[n],i.control.getId()===e.getId())return null!=(null===(t=i.options)||void 0===t?void 0:t.destroyOnUserInteractionFinished)&&i.options.destroyOnUserInteractionFinished(),i.control.destroy(),this.__controls.splice(n,1),null===(a=this.__controlCollectionChangedCBs)||void 0===a||a.forEach(e=>e(i.control,"removed")),!0}return!1}removeAllControls(){if(this.__controls){for(;this.__controls.length>0;)this.removeControl(this.__controls[this.__controls.length-1].control);delete this.__controls}}getElement(){return this.__element}getControls(){var e;let t=[];return null===(e=this.__controls)||void 0===e||e.forEach(e=>t.push(e.control)),t}getControl(e){var a;let i;if(this.__controls)for(let n=0;n<this.__controls.length;n++)if("string"==typeof e){if((null===(a=this.__controls[n].options)||void 0===a?void 0:a.name)===e){i=this.__controls[n].control;break}}else if(e instanceof t.Base&&this.__controls[n].control.getId()===e.getId()){i=this.__controls[n].control;break}return i}onControlsCollectionChanged(e){this.__controlCollectionChangedCBs||(this.__controlCollectionChangedCBs=[]),this.__controlCollectionChangedCBs.push(e)}setControlsHorizonzalAlignment(e){switch(e){case"Left":this.__element.css("justify-content","flex-start");break;case"Right":this.__element.css("justify-content","flex-end");break;default:this.__element.css("justify-content","")}return this}setControlsVerticalAlignment(e){switch(e){case"Top":this.__element.css("align-items","flex-start");break;case"Bottom":this.__element.css("align-items","flex-end");break;default:this.__element.css("align-items","center")}return this}}t.ControlContainer=i,function(t){t.isIControlOptions=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("type","number"),void 0!==t.callback&&i.set("callback","function"),void 0!==t.name&&i.set("name","string"),void 0!==t.settings&&i.set("settings","object"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},t.createIControlOptions=function(){return{type:a.Textblock,callback:()=>null,settings:{}}}}(i=t.ControlContainer||(t.ControlContainer={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.TextControl{constructor(e,t,a){super(e,t,a),this.__isPressed=!1}__init(e){var t,a,i;super.__init(e),this.__pressCnt=0,this.__element.addClass("button"),this.switchColorOnDown=!0,void 0===(null===(t=null==e?void 0:e.textAttributes)||void 0===t?void 0:t.userSelect)&&this.textHandler.setUserSelect("none"),void 0===(null==e?void 0:e.isEnabled)&&this.setIsEnabled(!0),void 0===(null===(a=null==e?void 0:e.background)||void 0===a?void 0:a.imageHeight)&&this.backgroundStyler.setImageHeight(80,"%"),void 0===(null===(i=null==e?void 0:e.background)||void 0===i?void 0:i.imageWidth)&&this.backgroundStyler.setImageWidth(80,"%"),this.__downHandler=e=>this.__onDown(e),this.__pointerleaveHandler=e=>this.__onPointerLeave(e),this.__pointerenterHandler=e=>this.__onPointerEnter(e),this.__releasedHandler=e=>this.__onReleased(e)}__attach(){this.__isAttached||(this.__attrHandler.readOnly||(this.__element.on("pointerdown",this.__downHandler),this.__destroyersToCallOnDetach.push(this.eventHandler.register(a.ButtonEvents.onPressed,(e,t)=>this.__onPressed(e,t)))),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown",this.__downHandler),super.__detach())}destroy(){super.destroy()}onTextChanged(e){super.onTextChanged(e);let t=this.__element.children(".text-element");null==e?(t[0]&&this.textHandler.getTextElement().detach(),this.textHandler.getTextElement().html("")):(t[0]||this.__element.append(this.textHandler.getTextElement()),this.textHandler.getTextElement().html(e))}__onDown(t){0!=this.checkAccess(e.Server.UserManagement.AccessRight.operate)&&0!=this.__attrHandler.isEnabled&&0===t.button&&($(document).on("pointerup",this.__releasedHandler),this.__element.on("pointerleave",this.__pointerleaveHandler),this.__element.addClass("down"),this.__isPressed=!0)}__onPointerLeave(e){this.__element.removeClass("down"),this.__element.off("pointerleave",this.__pointerleaveHandler),this.__element.on("pointerenter",this.__pointerenterHandler),this.__isPressed=!1}__onPointerEnter(e){this.__element.addClass("down"),this.__element.on("pointerleave",this.__pointerleaveHandler),this.__element.off("pointerenter",this.__pointerenterHandler),this.__isPressed=!0}__onReleased(e){this.__element.removeClass("down"),this.__element.off("pointerleave",this.__pointerleaveHandler),this.__element.off("pointerenter",this.__pointerenterHandler),$(document).off("pointerup",this.__releasedHandler),!0===this.__isPressed&&this.eventHandler.raise(a.ButtonEvents.onPressed),this.__isPressed=!1}__onPressed(e,t){switch(this.__pressCnt){case 0:setTimeout(()=>this.__pressCnt=0,a.DoublePressDuration),this.__pressCnt++;break;case 1:this.eventHandler.raise(a.ButtonEvents.onDoublePressed),this.__pressCnt=0;break;default:this.__pressCnt=0}}static addBadge(e,t){let a=e.children(".tchmi-ba-badge");null!=t&&t>0?(a[0]||(a=$("<div>").addClass("tchmi-ba-badge"),e.append(a)),t<100?a.html(String(t)):a.html(String("99+"))):a[0]&&a.detach()}disableInteraction(){this.__element.off("pointerdown",this.__downHandler)}enableInteraction(){this.__element.on("pointerdown",this.__downHandler)}set switchColorOnDown(e){1==e?this.__element.addClass("switch-color-on-down"):this.__element.removeClass("switch-color-on-down")}setAttributes(e){var t;return super.setAttributes(e),void 0!==(null===(t=e.textAttributes)||void 0===t?void 0:t.colorPressed)&&this.setTextColorPressed(e.textAttributes.colorPressed),this}getAttributes(){return this.__attrHandler.getRef()}setTextColorPressed(t){var a;return void 0===t?this:null==t||e.Color.isRGBAColor(t)?(!e.Color.isRGBAColor(t)||t instanceof e.Color.RGBAColor||(t=new e.Color.RGBAColor(t)),tchmi_equal(t,null===(a=this.__attrHandler.textAttributes)||void 0===a?void 0:a.colorPressed)?(this.__attrHandler.equalAttribute("TextColorPressed"),this):(this.__attrHandler.textAttributes||(this.__attrHandler.textAttributes={}),this.__attrHandler.textAttributes.colorPressed=t,this.__processTextColorPressed(),this)):(this.__attrHandler.invalidAttribute("TextColorPressed",t),this)}__processTextColorPressed(){null!=this.__attrHandler.textAttributes&&(null==this.__attrHandler.textAttributes.colorPressed?this.__element.css("--tchmi-ba-global-button-text-color-pressed",""):this.__element.css("--tchmi-ba-global-button-text-color-pressed",this.__attrHandler.textAttributes.colorPressed.toString()))}getTextColorPressed(){var e;return null===(e=this.__attrHandler.textAttributes)||void 0===e?void 0:e.colorPressed}__processReadOnly(){super.__processReadOnly(),this.__attrHandler.readOnly?this.__element.off("pointerdown",this.__downHandler):this.__isAttached&&this.__element.on("pointerdown",this.__downHandler)}}t.Button=a,function(e){let t;!function(e){e.onPressed="onButtonPressed",e.onDoublePressed="onButtonDoublePressed"}(t=e.ButtonEvents||(e.ButtonEvents={})),e.DoublePressDuration=200}(a=t.Button||(t.Button={}));class i extends a{constructor(e,t,a){super(e,t,a)}__init(t){super.__init(t),this.__element.addClass("toggle-button"),this.baObjectHandler=new e.BaObjectHandler(this),void 0===(null==t?void 0:t.toggleState)&&this.setToggleState(!1)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__onDown(t){0!=this.checkAccess(e.Server.UserManagement.AccessRight.operate)&&0!=this.__attrHandler.isEnabled&&0===t.button&&($(document).on("pointerup",this.__releasedHandler),this.__element.on("pointerleave",this.__pointerleaveHandler),this.__attrHandler.toggleState?this.__element.removeClass("down"):this.__element.addClass("down"),this.__isPressed=!0)}__onPointerLeave(e){this.__attrHandler.toggleState?this.__element.addClass("down"):this.__element.removeClass("down"),this.__element.off("pointerleave",this.__pointerleaveHandler),this.__element.on("pointerenter",this.__pointerenterHandler),this.__isPressed=!1}__onPointerEnter(e){this.__attrHandler.toggleState?this.__element.removeClass("down"):this.__element.addClass("down"),this.__element.on("pointerleave",this.__pointerleaveHandler),this.__element.off("pointerenter",this.__pointerenterHandler),this.__isPressed=!0}__onReleased(e){this.__element.off("pointerleave",this.__pointerleaveHandler),this.__element.off("pointerenter",this.__pointerenterHandler),$(document).off("pointerup",this.__releasedHandler),this.__isPressed&&(this.__attrHandler.toggleState?this.__element.removeClass("down"):this.__element.addClass("down"),this.__attrHandler.toggleState=!this.__attrHandler.toggleState,this.eventHandler.raise(i.ToggleButtonEvents.onToggleStateChanged)),this.__isPressed=!1}setAttributes(e){return super.setAttributes(e),void 0!==e.toggleState&&this.setToggleState(e.toggleState),this}getAttributes(){return this.__attrHandler.getRef()}setToggleState(e){return this.__attrHandler.checkAttribute(e,"toggleState",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.toggleState=e,this.__processToggleState(),this):this}__processToggleState(){this.__attrHandler.toggleState?this.__element.addClass("down"):this.__element.removeClass("down")}getToggleState(){return this.__attrHandler.toggleState}processBaObject(){this.baObjectHandler.baObject&&this.baObjectHandler.baObject.DataType===e.DataType.boolean&&(this.baObjectHandler.tryWatchBaVariable(e.BA.BaParameterId.ePresentValue,e=>{this.setToggleState(e)}),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess()))}}t.ToggleButton=i,function(e){let t;!function(e){e.onToggleStateChanged="onToggleStateChanged"}(t=e.ToggleButtonEvents||(e.ToggleButtonEvents={}))}(i=t.ToggleButton||(t.ToggleButton={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(t){let a,i;!function(a){class n extends a.Base{constructor(e,a,i){super(e,a,i),this.baObjectHandler=new t.BaObjectHandler(this)}__init(e){super.__init(e),this.__element.addClass("calendar-list"),this.__list=new t.Navigation.ControlList(this.__id+"-list",this,{layout:{width:100,widthUnit:"%",height:100,heightUnit:"%"}}),this.__element.append(this.__list.getElement())}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}processBaObject(){if(null!=this.baObjectHandler.baObject)if(this.baObjectHandler.baObject instanceof i.BaView){let e=this.baObjectHandler.baObject.getBaCalendarObjects();e.length>0?e.forEach(e=>{e.loadAttributes().then(()=>{e.getIsValid()&&this.addBaCalendar(e)})}):a.DialogWindow.alert(`No calendar objects found in bound BaView '${this.baObjectHandler.baObject.InstancePath}'!`,{header:"No calendar objects found"})}else this.baObjectHandler.baObject instanceof i.BaBasicObject&&(this.baObjectHandler.baObject.Identifier.ObjectType===i.ObjectType.eCalendar?this.baObjectHandler.baObject.loadAttributes().then(()=>{var e;(null===(e=this.baObjectHandler.baObject)||void 0===e?void 0:e.getIsValid())&&this.addBaCalendar(this.baObjectHandler.baObject)}):a.DialogWindow.alert(`Bound BaObject '${this.baObjectHandler.baObject.InstancePath}' is not a calendar object!`,{header:"No calendar object"}))}static calendarEntryToString(e){switch(e.eType){case i.DateValChoice.eDate:return new i.BaDate(e.uDate.stDate).toString(i.BaDate.Format.din1355_1);case i.DateValChoice.eDateRange:return new i.BaDate(e.uDate.stDateRange.stDateFrom).toString(i.BaDate.Format.din1355_1)+" - "+new i.BaDate(e.uDate.stDateRange.stDateTo).toString(i.BaDate.Format.din1355_1);case i.DateValChoice.eWeekNDay:let t,a,s;switch(e.uDate.stWeekNDay.eWeekday){case i.Weekday.Unspecified:t="Any day";break;default:t=e.uDate.stWeekNDay.eWeekday>i.Weekday.eSunday||e.uDate.stWeekNDay.eWeekday<i.Weekday.eMonday?"?":n.WeekDays[e.uDate.stWeekNDay.eWeekday-1]}switch(e.uDate.stWeekNDay.eWeekOfMonth){case i.Week.Unspecified:a="any week";break;case i.Week.eWeek1:a="days numbered 1-7";break;case i.Week.eWeek2:a="days numbered 8-14";break;case i.Week.eWeek3:a="days numbered 15-21";break;case i.Week.eWeek4:a="days numbered 22-28";break;case i.Week.eWeek5:a="days numbered 29-31";break;default:a="invalid"}switch(e.uDate.stWeekNDay.eMonth){case i.Month.Unspecified:s="any month";break;case i.Month.odd:s="odd month";break;case i.Month.even:s="even month";break;default:s=e.uDate.stWeekNDay.eMonth>i.Month.eDecember||e.uDate.stWeekNDay.eMonth<i.Month.Invalid?"?":n.MonthNames[e.uDate.stWeekNDay.eMonth-1]}return`${t} in ${a} in ${s}`;default:return"Invalid calendar entry"}}static createMonthCbData(){let e=[];for(let t=i.Month.eJanuary;t<=i.Month.eDecember;t++)e.push({text:n.MonthNames[t-1],value:t});return e=e.concat([{text:"Odd",value:i.Month.odd},{text:"Even",value:i.Month.even},{text:"Every",value:i.Month.Unspecified}]),e}static createWeekOfMonthCbData(){return[{text:"First",value:i.Week.eWeek1},{text:"Second",value:i.Week.eWeek2},{text:"Third",value:i.Week.eWeek3},{text:"Fouth",value:i.Week.eWeek4},{text:"Fifth",value:i.Week.eWeek5},{text:"Every",value:i.Week.Unspecified}]}static createDayOfWeekCbData(){let e=[];for(let t=i.Weekday.eMonday;t<=i.Weekday.eSunday;t++)e.push({text:n.WeekDays[t-1],value:t});return e.push({text:"Every",value:i.Weekday.Unspecified}),e}addBaCalendar(e){return __awaiter(this,void 0,void 0,(function*(){e.tryReadBaVariable(i.BaParameterId.eDescription).then(s=>{if(e.Identifier.ObjectType!==i.ObjectType.eCalendar)return;let r=e.tryGetBaVariable(i.BaParameterId.eDateList);if(null==r)return;if(null==this.__attrHandler.calendars&&(this.__attrHandler.calendars=new Map),this.__attrHandler.calendars.has(e.InstancePath))return void this.logger.log(t.Logger.Severity.warn,`Calendar with instance path ${e.InstancePath} has already been added!`);let o=new Map,l=new Map,d=this.__list.addEntry(e.InstancePath,{Title:s,controls:[{type:a.ComponentType.Button,settings:{background:{image:t.Icons.Standard.Confirm.path,imageHeight:80,imageHeightUnit:"%",imageWidth:80,imageWidthUnit:"%"},layout:{maxWidth:25}},callback:()=>{let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmSaveChangesOfCalendar),e.InstancePath);confirm(a)&&(null==r||r.write(r.editedValue))}},{type:a.ComponentType.Button,settings:{background:{image:t.Icons.Standard.Plus.path,imageHeight:80,imageHeightUnit:"%",imageWidth:80,imageWidthUnit:"%"},layout:{maxWidth:25}},callback:()=>{let e,t={eType:i.DateValChoice.Invalid,uDate:{stDate:i.BaDate.fromDate(new Date),stDateRange:{stDateFrom:i.BaDate.fromDate(new Date),stDateTo:i.BaDate.fromDate(new Date)},stWeekNDay:{eMonth:i.Month.Unspecified,eWeekOfMonth:i.Week.Unspecified,eWeekday:i.Weekday.Unspecified}}};if(confirm("New Date entry?"))t.eType=i.DateValChoice.eDate;else if(confirm("New DateRange entry?"))t.eType=i.DateValChoice.eDateRange;else{if(!confirm("New Week 'n' Day entry?"))return;t.eType=i.DateValChoice.eWeekNDay}if(null==r||null==(null==r?void 0:r.editedValue))return;for(e=0;e<r.editedValue.length;e++)if(r.editedValue[e].eType===i.DateValChoice.Invalid){r.editedValue[e]=t;break}let a=d.getId()+"-"+e,n=_(e,t),s=d.getSublist();s?s.addEntry(a,n):(d.hasEntry(a)&&d.removeEntry(a),d.addEntry(a,n))}},{type:a.ComponentType.Button,settings:{background:{image:t.Icons.Standard.MenuBurger.path,imageHeight:60,imageHeightUnit:"%",imageWidth:60,imageWidthUnit:"%"},layout:{maxWidth:25}},callback:()=>{e.openParameterDialog()}}]});this.__attrHandler.calendars.set(e.InstancePath,e);const _=(e,s)=>{let _,h=d.getId()+"-"+e,c={cbOnCreated:[e=>{_=e}]};switch(c.controls=[{type:a.ComponentType.Textblock,settings:{textAttributes:{horizontalAlignment:"Right",text:n.calendarEntryToString(s)}},cbOnCreated:e=>{o.set(h,e)}},{type:a.ComponentType.Button,settings:{background:{image:t.Icons.Standard.Delete.path,imageHeight:80,imageHeightUnit:"%",imageWidth:80,imageWidthUnit:"%"},layout:{width:25,maxWidth:25}},callback:()=>{var a;if(!_)throw new Error("No date entry found!");confirm(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmRemoveEntry))&&(_.getBaParent().removeEntry(h),null!=(null==r?void 0:r.editedValue)&&(null===(a=r.editedValue)||void 0===a||a.splice(e,1)),l.delete(h),o.delete(h))}}],s.eType){case i.DateValChoice.eDate:c.name=h,c.cbOnCreated.push(e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Date,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}),c.Children=new Map([["date",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Date,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}],controls:{type:a.ComponentType.DateTimeField,settings:{mode:a.DateTimeField.Mode.date,date:new i.BaDate(s.uDate.stDate).toDate(),readOnly:!1,layout:{maxWidth:120}},callback:t=>{if(null!=(null==r?void 0:r.editedValue)){let a=o.get(h);r.editedValue[e].uDate.stDate=i.BaDate.fromDate(t),null==a||a.textHandler.setText(n.calendarEntryToString(r.editedValue[e]))}},cbOnCreated:e=>{let t=l.get(h);t&&(t.ctrls.dateFrom=e)}}}]]);break;case i.DateValChoice.eDateRange:let d,_;c.name=h,c.cbOnCreated.push(e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.DateRange,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}),c.Children=new Map([["date-from",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.DateFrom,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}],controls:{type:a.ComponentType.DateTimeField,settings:{mode:a.DateTimeField.Mode.date,date:new i.BaDate(s.uDate.stDateRange.stDateFrom).toDate(),readOnly:!1,layout:{maxWidth:120}},callback:t=>{if(null!=d&&null!=_){if(t>_.getDate())return alert("Date from is after date to, which is not allowed!"),void d.openPicker();if(null!=(null==r?void 0:r.editedValue)){let a=o.get(h);r.editedValue[e].uDate.stDateRange.stDateFrom=i.BaDate.fromDate(t),null==a||a.textHandler.setText(n.calendarEntryToString(r.editedValue[e]))}}},cbOnCreated:e=>{let t=l.get(h);t&&(t.ctrls.dateFrom=e),d=e}}}],["date-to",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.DateTo,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}],controls:{type:a.ComponentType.DateTimeField,settings:{mode:a.DateTimeField.Mode.date,date:new i.BaDate(s.uDate.stDateRange.stDateTo).toDate(),readOnly:!1,layout:{maxWidth:120}},callback:t=>{if(null!=d&&null!=_){if(t<d.getDate())return alert("Date from is after date to, which is not allowed!"),void _.openPicker();if(null!=(null==r?void 0:r.editedValue)){let a=o.get(h);r.editedValue[e].uDate.stDateRange.stDateTo=i.BaDate.fromDate(t),null==a||a.textHandler.setText(n.calendarEntryToString(r.editedValue[e]))}}},cbOnCreated:e=>{let t=l.get(h);t&&(t.ctrls.dateTo=e),_=e}}}]]);break;case i.DateValChoice.eWeekNDay:c.cbOnCreated.push(e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.WeekNDay,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}),c.Children=new Map([["day-of-week",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.DayOfWeek,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}],controls:{type:a.ComponentType.Combobox,settings:{readOnly:!1,layout:{maxWidth:120},data:n.createDayOfWeekCbData(),selectedValue:s.uDate.stWeekNDay.eWeekday},callback:t=>{if(null!=(null==r?void 0:r.editedValue)){let a=o.get(h);r.editedValue[e].uDate.stWeekNDay.eWeekday=t,null==a||a.textHandler.setText(n.calendarEntryToString(r.editedValue[e]))}},cbOnCreated:e=>{let t=l.get(h);t&&(t.ctrls.dayOfWeekCb=e)}}}],["week-of-month",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.WeekOfMonth,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}],controls:{type:a.ComponentType.Combobox,settings:{readOnly:!1,layout:{maxWidth:120},data:n.createWeekOfMonthCbData(),selectedValue:s.uDate.stWeekNDay.eWeekOfMonth},callback:t=>{if(null!=(null==r?void 0:r.editedValue)){let a=o.get(h);r.editedValue[e].uDate.stWeekNDay.eWeekOfMonth=t,null==a||a.textHandler.setText(n.calendarEntryToString(r.editedValue[e]))}},cbOnCreated:e=>{let t=l.get(h);t&&(t.ctrls.weekOfMonthCb=e)}}}],["month",{cbOnCreated:[e=>{this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.LangKey.Month,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}],controls:{type:a.ComponentType.Combobox,settings:{readOnly:!1,layout:{maxWidth:120},data:n.createMonthCbData(),selectedValue:s.uDate.stWeekNDay.eMonth},callback:t=>{if(null!=(null==r?void 0:r.editedValue)){let a=o.get(h);r.editedValue[e].uDate.stWeekNDay.eMonth=t,null==a||a.textHandler.setText(n.calendarEntryToString(r.editedValue[e]))}},cbOnCreated:e=>{let t=l.get(h);t&&(t.ctrls.monthCb=e)}}}]])}return c};this.baObjectHandler.watchBaVariable(r,e=>{if(r&&null!=e){r.editedValue=e;for(let t=0;t<e.length;t++){let a=d.getId()+"-"+t,s=e[t],r=d.getSublist(),h=o.get(a),c=l.get(a);if(null!=c&&null!=h&&c.type!=s.eType&&(null==r?void 0:r.hasEntry(a))&&(r.removeEntry(a),l.delete(a),o.delete(a),h=void 0,c=void 0),h)switch(h.textHandler.setText(n.calendarEntryToString(s)),s.eType){case i.DateValChoice.eDate:null!=(null==c?void 0:c.ctrls.dateFrom)&&c.ctrls.dateFrom.setDate(new i.BaDate(s.uDate.stDate).toDate());break;case i.DateValChoice.eDateRange:null!=(null==c?void 0:c.ctrls.dateFrom)&&c.ctrls.dateFrom.setDate(new i.BaDate(s.uDate.stDateRange.stDateFrom).toDate()),null!=(null==c?void 0:c.ctrls.dateTo)&&c.ctrls.dateTo.setDate(new i.BaDate(s.uDate.stDateRange.stDateTo).toDate());break;case i.DateValChoice.eWeekNDay:null!=(null==c?void 0:c.ctrls.monthCb)&&c.ctrls.monthCb.setSelectedValue(s.uDate.stWeekNDay.eMonth),null!=(null==c?void 0:c.ctrls.weekOfMonthCb)&&c.ctrls.weekOfMonthCb.setSelectedValue(s.uDate.stWeekNDay.eWeekOfMonth),null!=(null==c?void 0:c.ctrls.dayOfWeekCb)&&c.ctrls.dayOfWeekCb.setSelectedValue(s.uDate.stWeekNDay.eWeekday);break;default:(null==r?void 0:r.hasEntry(a))&&(r.removeEntry(a),l.delete(a),o.delete(a))}else{if(s.eType<=i.DateValChoice.Invalid)return;l.set(a,{type:s.eType,ctrls:{}});let e=_(t,s);r?r.addEntry(a,e):(d.hasEntry(a)&&d.removeEntry(a),d.addEntry(a,e))}}}})})}))}setAttributes(e){return super.setAttributes(e),this}getAttributes(){return this.__attrHandler.getRef()}}a.CalendarList=n,function(n){n.openCalendarListDialog=function e(s){var r;if(null==s){if(null==i.BaDevices)return;for(let t of i.BaDevices.values())e(t.ProjectStructure)}else{let e="CalendarList-"+s.InstancePath,i=1;for(;t.Globals.CreatedBaseNodes.has(e);)e="CalendarList-"+s.InstancePath+i,i++;let o=new n(e,null);o.baObjectHandler.setBaObject(s),o.getElement().css({width:"100%",height:"100%",position:"relative"});let l=null===(r=a.DialogWindow.createDialogWindow({appearance:{headline:{textAttributes:{text:"Calendar list | "+s.InstancePath}},content:o.getElement(),layout:{width:750,height:400},buttons:a.DialogWindow.Buttons.Cancel},callbacks:{cbClosed:()=>{d(),o.destroy()}},behaviour:{destroyOnClose:!0}}))||void 0===r?void 0:r.open();const d=t.Locale.Localization.watchText(t.Locale.LangKey.CalendarList,e=>{t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&(null==l||l.setHeadlineText(e.text+" | "+s.InstancePath))})}},n.WeekDays=[],n.WeekDaysShort=[],n.MonthNames=[],n.MonthNamesShort=[];let s=()=>{e.EventProvider.register(t.GlobalEvents.onWebSocketOpened,a=>{a.destroy();let i=[];for(let e=0;e<t.Locale.WeekDaysLongLangKey.length;e++)i.push(t.Locale.Localization.watchText(t.Locale.WeekDaysLongLangKey[e],a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(n.WeekDays[e]=a.text)}));for(let e=0;e<t.Locale.WeekDaysShortLangKey.length;e++)i.push(t.Locale.Localization.watchText(t.Locale.WeekDaysShortLangKey[e],a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(n.WeekDaysShort[e]=a.text)}));for(let e=0;e<t.Locale.MonthsLongLangKey.length;e++)i.push(t.Locale.Localization.watchText(t.Locale.MonthsLongLangKey[e],a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(n.MonthNames[e]=a.text)}));for(let e=0;e<t.Locale.MonthsShortLangKey.length;e++)i.push(t.Locale.Localization.watchText(t.Locale.MonthsShortLangKey[e],a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(n.MonthNamesShort[e]=a.text)}));e.EventProvider.register(t.GlobalEvents.onWebSocketClosed,e=>{e.destroy(),i.forEach(e=>e()),s()})})};s()}(n=a.CalendarList||(a.CalendarList={}))}(a=t.Components||(t.Components={})),function(e){e.BaView.prototype.getBaCalendarObjects=function(){let t=[];if(this instanceof e.BaView)for(let a of this.Children.values())a instanceof e.BaView&&(t=t.concat(a.getBaCalendarObjects())),a instanceof e.BaBasicObject&&a.Identifier.ObjectType===e.ObjectType.eCalendar&&t.push(a);return t}}(i=t.BA||(t.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i extends a.Base{onResized(){this.__updateVisibleEvents()}constructor(e,r,o){super(e,r,o),this.__initDone=!1,this.__lihToday=new a.LegendIconHandler,this.__lihMonth=new a.LegendIconHandler,this.__lihYear=new a.LegendIconHandler,this.__lastHighlights=[],this.__maxExcsLastPlcSched=0,this.__maxExcsLastEntryPlcSched=0,this.__maxExcsLastEntryPLcCal=0,this.__indexBaId=s.IndexStartBa,this.__indexBaRefId=s.IndexStartBa,this.__contextMenu=null,this.__handlerSwitchMonth=e=>{"<"===$(e.target).text()?this.__dateSelected.setMonth(this.__dateSelected.getMonth()-1):this.__dateSelected.setMonth(this.__dateSelected.getMonth()+1),this.__updateCalendarWrappers()},this.__handlerSwitchYear=e=>{"<"===$(e.target).text()?this.__dateSelected.setFullYear(this.__dateSelected.getFullYear()-1):this.__dateSelected.setFullYear(this.__dateSelected.getFullYear()+1),this.__updateCalendarWrappers()},this.__handlerSelectDay=e=>{let a,n,r,o,l,d,_;if(null!=e.target&&(l=e.target,n=$(l).prop("className"),null!=l.parentNode&&(a=l.parentNode,r=$(a).prop("className"),!n.includes("spacer")&&!n.includes("days")))){if(n.includes("day"))o=parseInt($(l).text()),d=0;else{if(!r.includes("day"))return;o=parseInt($(a).text()),d=1}this.__htmlDays.find("div.selected").removeClass("selected"),0===d?$(l).addClass("selected"):$(a).addClass("selected"),this.__dateSelectedLast.setDate(o),this.__dateSelectedLast.setMonth(this.__dateSelected.getMonth()),this.__dateSelectedLast.setFullYear(this.__dateSelected.getFullYear()),this.__dateSelected=new Date(this.__dateSelected.getFullYear(),this.__dateSelected.getMonth(),o,0,0,0,0),_=s.createEventSelection(i.CalendarSelectionType.Date),null!=_?(_.Data=new Date(this.__dateSelected.getTime()),this.__onSelectionChanged(_)):this.logger.log(t.Logger.Severity.error,"__handlerSwitchDay(): Selection type unknown.")}},this.__handlerSelectMonth=e=>{var t,a,n;let s,r,o,l=e.target;s=$(l).prop("className"),s.includes("days")||s.includes("text")?r=null===(t=l.parentElement)||void 0===t?void 0:t.attributes.baid:s.includes("day")?r=null===(n=null===(a=l.parentElement)||void 0===a?void 0:a.parentElement)||void 0===n?void 0:n.attributes.baid:s.includes("month")&&(r=l.attributes.baid),null!=r&&(o=Number.parseInt(r.value),isNaN(o)||(this.__dateSelected=new Date(this.__dateSelected.getFullYear(),o,1,0,0,0,0),this.__displayView=i.CalendarDisplayView.Month,this.__updateCalendar()))},this.__handlerSelectEvent=e=>{var a;if(0==this.checkAccess(t.Server.UserManagement.AccessRight.operate))return;let n,r,o,l,d,_=e.target,h=!1;o=$(_).prop("className"),o.includes("spacer")||o.includes("row")||(o.includes("event")||(h=!0,o.includes("col")))&&(n=h?null===(a=_.parentElement)||void 0===a?void 0:a.attributes.baid:_.attributes.baid,null!=n&&(r=Number.parseInt(n.value),isNaN(r)||(l=this.__getCalendarEvent(r),null!=l&&(d=s.createEventSelection(i.CalendarSelectionType.Event),null!=d?(d.Data={id:l.id,title:l.title,desc:l.desc,start:l.start,end:l.end},this.__onSelectionChanged(d),this.__openEventDialog(l)):this.logger.log(t.Logger.Severity.error,"__handlerEventClicked(): Selection type unknown.")))))},this.__handlerAddHighlight=e=>{var t;let a,i,n,s=e.target,r=!1;if(null!=s&&(i=$(s).prop("className"),!i.includes("spacer")&&(i.includes("event")||(r=!0,i.includes("col")))&&(a=r?null===(t=s.parentElement)||void 0===t?void 0:t.attributes.baid:s.attributes.baid,null!=a&&(n=this.__eventHighlights.get(Number.parseInt(a.value)),null!=n)))){this.__lastHighlights=n;for(let e=0;e<n.length;e++)n[e].classList.add("highlight")}},this.__handlerRemoveHighlight=()=>{for(let e=0;e<this.__lastHighlights.length;e++)this.__lastHighlights[e].classList.remove("highlight");this.__lastHighlights=[]},this.__handlerEventDialogConfirmed=()=>{let e=this.__eventDialog.getEvent();null!=e?(this.__changeEvent(e),this.__combineEvents(),this.__updateCalendarWrappers(),this.__menuEntryReset&&this.__menuEntryReset.setIsEnabled(!0)):this.logger.log(t.Logger.Severity.error,"__handlerEventDialogConfirmed(): Confirmed event was NULL.")},this.__handlerEventDialogDeleted=()=>{let e;a.DialogWindow.confirm(this.__strDeleteEntry).then(a=>{a&&(e=this.__eventDialog.getEvent(),null!=e?null!=this.__dialogWindow&&(this.__dialogWindow.close(),this.__changeEvent(e,!0),this.__combineEvents(),this.__updateCalendarWrappers(),this.__menuEntryReset&&this.__menuEntryReset.setIsEnabled(!0)):this.logger.log(t.Logger.Severity.error,"__handlerEventDialogDeleted(): Selected entry could not be deleted."))})},this.__handlerMenuEntryEventVisibility=()=>{var e;this.__contextMenu&&this.__contextMenu.menu.close(),(null===(e=this.__menuEntryVisibilityEvents)||void 0===e?void 0:e.getIsEnabled())&&this.__menuVisibilityEvents()},this.__handlerMenuEntryAdd=()=>{var e;this.__contextMenu&&this.__contextMenu.menu.close(),(null===(e=this.__menuEntryAdd)||void 0===e?void 0:e.getIsEnabled())&&this.__menuAdd()},this.__handlerMenuEntryReset=()=>{var e;this.__contextMenu&&this.__contextMenu.menu.close(),(null===(e=this.__menuEntryReset)||void 0===e?void 0:e.getIsEnabled())&&this.__menuReset()},this.__handlerButtonToday=()=>{this.__buttonToday.getIsEnabled()&&this.__today()},this.__handlerButtonToggleViewYearMonth=()=>{this.__toggleViewYearMonth()},this.__sortEvents=(e,t)=>{let a=e.start.getTime(),i=t.start.getTime();if(a<i)return-1;if(a>i)return 1;let n=e.end.getTime(),s=t.end.getTime();return a===i?n-a>s-i?-1:1:0},this.__dfStatic=[],this.__dfEvents=[],this.__monthLong=[],this.__daysLong=[],this.__daysShort=[],this.__maxWeeksDow=0,this.__dateYearPrev=0,this.__htmlHeaderMonth=[],this.__htmlHeaderYear=[],this.__htmlNavMonth=[],this.__htmlNavYear=[],this.__htmlTextMonths=[],this.__htmlDays=$("<div>"),this.__htmlMonths=$("<div>"),this.__htmlEventRows=$("<div>"),this.__events=[],this.__eventsNewBa=[],this.__eventsChangedBa=[],this.__eventsChangedBaRef=[],this.__eventsBa=[],this.__eventsBaRef=[],this.__eventHighlights=new Map,this.__lihToday=new a.LegendIconHandler,this.__lihMonth=new a.LegendIconHandler,this.__lihYear=new a.LegendIconHandler,this.__lihToday.icon=t.Icons.Standard.CalendarToday,this.__lihMonth.icon=t.Icons.Standard.CalendarMonth,this.__lihYear.icon=t.Icons.Standard.CalendarYear,this.baObjectHandler=new t.BaObjectHandler(this),this.__element.addClass("calendar"),this.__dialogWindowDltBtn=a.ControlContainer.createIControlOptions(),this.__dialogWindowDltBtn.type=a.ComponentType.Button,this.__dialogWindowDltBtn.settings={background:{image:t.Icons.Standard.Delete.path}},this.__dialogWindowDltBtn.callback=this.__handlerEventDialogDeleted,this.__eventDialog=new n(this.__id+"-event-dialog",o),this.__constructCalendar(),this.resizeHandler=new a.ResizeHandler(this),this.__initDone=!0}__init(e){super.__init(e),this.__displayMode=i.CalendarDisplayMode.DatePicker,this.__displayView=i.CalendarDisplayView.Month,this.__visibilityMenu=!1,this.__visibilityEvents=!0,this.__dowStart=t.BA.Weekday.eMonday,e&&(e.displayMode&&(this.__displayMode=e.displayMode),e.displayView&&(this.__displayView=e.displayView),e.visibilityMenu&&(this.__visibilityMenu=e.visibilityMenu),e.visibilityEvents&&(this.__visibilityEvents=e.visibilityEvents),e.dateInit&&t.Helper.Date.isDate(e.dateInit)&&(this.__dateInit=e.dateInit),e.dowStart&&(this.__dowStart=t.Helper.Date.validateDow(e.dowStart)))}__attach(){this.__isAttached||(super.__attach(),this.__updateLegendIcons())}__detach(){this.__isAttached&&(super.__detach(),this.__updateLegendIcons())}destroy(){this.__dfStatic&&(this.__dfStatic.forEach(e=>e()),this.__dfStatic.length=0),this.__dfEvents&&(this.__dfEvents.forEach(e=>e()),this.__dfEvents.length=0),this.__lihToday&&this.__lihToday.destroy(),this.__lihMonth&&this.__lihMonth.destroy(),this.__lihYear&&this.__lihYear.destroy(),this.__contextMenu&&(this.__contextMenu.menu&&this.__contextMenu.menu.destroy(),this.__contextMenu.button&&this.__contextMenu.button.destroy()),this.__buttonToday&&(this.__buttonToday.getElement().off("click"),this.__buttonToday.destroy()),this.__buttonToggleYearMonth&&(this.__buttonToggleYearMonth.getElement().off("click"),this.__buttonToggleYearMonth.destroy()),this.__dialogWindow&&this.__dialogWindow.destroy(),this.__eventDialog&&this.__eventDialog.destroy(),this.__htmlNavMonth&&($(this.__htmlNavMonth).off("click"),this.__htmlNavMonth.length=0),this.__htmlNavYear&&($(this.__htmlNavYear).off("click"),this.__htmlNavYear.length=0),this.__htmlDays&&(this.__htmlDays.off("click"),this.__htmlDays.empty()),this.__htmlMonths&&(this.__htmlMonths.off("click"),this.__htmlMonths.empty()),this.__htmlEventRows&&(this.__htmlEventRows.off("click"),this.__htmlEventRows.off("mouseover"),this.__htmlEventRows.off("mouseout"),this.__htmlEventRows.empty()),this.__htmlWrapperDay&&this.__htmlWrapperDay.empty(),this.__htmlWrapperMonth&&this.__htmlWrapperMonth.empty(),this.__htmlWrapperEvent&&this.__htmlWrapperEvent.empty(),this.__htmlNavConMonth&&this.__htmlNavConMonth.empty(),this.__monthLong&&(this.__monthLong.length=0),this.__daysLong&&(this.__daysLong.length=0),this.__daysShort&&(this.__daysShort.length=0),this.__htmlHeaderMonth&&(this.__htmlHeaderMonth.length=0),this.__htmlHeaderYear&&(this.__htmlHeaderYear.length=0),this.__htmlTextMonths&&(this.__htmlTextMonths.length=0),this.__lastHighlights&&(this.__lastHighlights.length=0),this.__events&&(this.__events.length=0),this.__eventsNewBa&&(this.__eventsNewBa.length=0),this.__eventsChangedBa&&(this.__eventsChangedBa.length=0),this.__eventsChangedBaRef&&(this.__eventsChangedBaRef.length=0),this.__eventsBa&&(this.__eventsBa.length=0),this.__eventsBaRef&&(this.__eventsBaRef.length=0),this.__schedExceptionList&&(this.__schedExceptionList.length=0),this.__schedCalendarList&&(this.__schedCalendarList.length=0),this.__schedCalendarExceptions&&(this.__schedCalendarExceptions.length=0),this.__eventHighlights&&this.__eventHighlights.clear(),this.resizeHandler&&this.resizeHandler.destroy(),super.destroy()}__processScheduleExceptionEntries(){if(null==this.__schedExceptionList)return;let e,a,i=0;this.__indexBaId=s.IndexStartBa,this.__maxExcsLastEntryPlcSched=0,this.__resetEventsBa(),this.__resetChangesBa();for(let n=0;n<this.__schedExceptionList.length&&(e=this.__schedExceptionList[n],e.eType!==t.BA.DateValChoice.Invalid);n++)if(a=this.__createEventFromBASchedException(e,0),null!=a&&(this.__eventsBa.push(a),a.data)){i=0;for(let e=0;e<a.data.length&&(a.data[e].eState!==t.BA.SchedEntryState.Invalid&&a.data[e].eState!==t.BA.SchedEntryState.eUndefined);e++)i++;i>this.__maxExcsLastEntryPlcSched&&(this.__maxExcsLastEntryPlcSched=i)}this.__maxExcsLastPlcSched=this.__eventsBa.length,this.__combineEvents(),this.__updateCalendarWrappers(),this.__onEventsChanged()}__processScheduleExceptionReferenceEntries(){var e;if(null==this.__schedCalendarList)return;if(null==this.baObjectHandler.baObject)return;let a=null===(e=t.BA.BaDevices)||void 0===e?void 0:e.get(this.baObjectHandler.baObject.Device.Description);if(null==a)return;let n,r,o,l,d=0;this.__indexBaRefId=s.IndexStartBaRef,this.__maxExcsLastEntryPLcCal=0,this.__resetEventsBaRef(),this.__resetChangesBaRef(),this.__schedCalendarExceptions=[];for(let e=0;e<this.__schedCalendarList.length;e++){let _,h;h=this.__schedCalendarList[e],0===h.stRefCalendarID.nInstanceID&&0===h.stRefCalendarID.eObjectType||(_=a.findBaObject({InstanceID:h.stRefCalendarID.nInstanceID,ObjectType:h.stRefCalendarID.eObjectType}),null!=_&&_.loadAttributes().then(()=>{null!=this.__schedCalendarExceptions&&(this.__schedCalendarExceptions.push({instanceId:h.stRefCalendarID.nInstanceID,exceptions:[]}),this.baObjectHandler.tryWatchChildrenBaVariable(_,t.BA.BaParameterId.eDateList,e=>{if(null!=e&&null!=this.__schedCalendarExceptions&&null!=_){l=null;for(let e=0;e<this.__schedCalendarExceptions.length;e++)if(_.Identifier.InstanceID===this.__schedCalendarExceptions[e].instanceId){l=this.__schedCalendarExceptions[e];break}if(null!=l){l.exceptions=[];for(let a=0;a<e.length&&(r=e[a],r.eType!==t.BA.DateValChoice.Invalid);a++){d=0,n=s.createScheduleException(),n.eType=r.eType,n.uDate=r.uDate,n.aEntry=h.aEntry,l.exceptions.push(n);for(let e=0;e<n.aEntry.length&&(n.aEntry[e].eState!==t.BA.SchedEntryState.Invalid&&n.aEntry[e].eState!==t.BA.SchedEntryState.eUndefined);e++)d++;d>this.__maxExcsLastEntryPLcCal&&(this.__maxExcsLastEntryPLcCal=d)}if(null!=this.__schedCalendarExceptions){o=null,this.__indexBaRefId=s.IndexStartBaRef,this.__resetEventsBaRef(),this.__resetChangesBaRef();for(let e=0;e<this.__schedCalendarExceptions.length;e++){l=this.__schedCalendarExceptions[e];for(let e=0;e<l.exceptions.length;e++)o=this.__createEventFromBASchedException(l.exceptions[e],l.instanceId,i.CalendarEventSource.BARef),null!=o&&this.__eventsBaRef.push(o)}this.__combineEvents(),this.__updateCalendarWrappers(),this.__onEventsChanged()}}}}))}))}}__processDisplayMode(){this.__constructCalendar()}__processDisplayView(){this.__displayMode!==i.CalendarDisplayMode.DatePicker&&this.__updateCalendar()}__constructCalendar(){var e,n,s,r,o;let l,d,_,h,c,u,g,p,v,m,b,y=[],f=[],D=[];if($(this.__htmlNavMonth).off("click"),$(this.__htmlNavYear).off("click"),this.__htmlDays.off("click"),this.__htmlMonths.off("click"),this.__htmlEventRows.off("mouseover"),this.__htmlEventRows.off("mouseout"),this.__htmlHeaderMonth.length=0,this.__htmlHeaderYear.length=0,this.__htmlNavMonth.length=0,this.__htmlNavYear.length=0,this.__htmlDays.empty(),this.__htmlMonths.empty(),this.__htmlEventRows.empty(),this.__dfStatic&&(this.__dfStatic.forEach(e=>e()),this.__dfStatic.length=0),null===(e=this.__dfStatic)||void 0===e||e.push(t.Locale.Localization.watchText(t.Locale.LangKey.ConfirmRemoveEntry,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strDeleteEntry=e.text)})),null===(n=this.__dfStatic)||void 0===n||n.push(t.Locale.Localization.watchText(t.Locale.LangKey.ConfirmResetChanges,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strResetChanges=e.text)})),this.__dateCurrent=new Date,this.__dateInit?(this.__dateSelected=new Date(this.__dateInit.getTime()),this.__dateSelectedLast=new Date(this.__dateInit.getTime())):(this.__dateSelected=new Date,this.__dateSelectedLast=new Date(t.BA.BaDate.YearOffset,1)),d=$("<div>").addClass("nav-wrapper"),_=$("<div>").addClass("day-wrapper"),h=$("<div>").addClass("month-wrapper"),c=$("<div>").addClass("event-wrapper"),this.__htmlWrapperDay=_,this.__htmlWrapperMonth=h,this.__htmlWrapperEvent=c,l=this.__element[0].children.length,0!==l)for(let e=0;e<l;e++)this.__element[0].children[0].remove();this.__element.append(d);for(let e=0;e<2;e++)this.__displayMode===i.CalendarDisplayMode.EventCalendar?(u=$("<div>").addClass("navc-c"),u.append($("<div>").addClass("navs")),g=$("<div>").addClass("nav-c"),g.append($("<div>").addClass("navb-c").text("<")),p=$("<div>").addClass("navt-c")):(u=$("<div>").addClass("navc-dp"),g=$("<div>").addClass("nav-dp"),g.append($("<div>").addClass("navb-dp").text("<")),p=$("<div>").addClass("navt-dp")),g.append(p),this.__displayMode===i.CalendarDisplayMode.EventCalendar?g.append($("<div>").addClass("navb-c").text(">")):g.append($("<div>").addClass("navb-dp").text(">")),u.append(g),0==e?(this.__htmlHeaderYear.push(p[0]),this.__displayMode===i.CalendarDisplayMode.EventCalendar&&u.append($("<div>").addClass("navs")),this.__htmlNavYear=g.find("div:nth-child(1), div:nth-child(3)").toArray()):(this.__htmlHeaderMonth.push(p[0]),this.__displayMode===i.CalendarDisplayMode.EventCalendar&&u.append($("<div>").addClass("navs")),this.__htmlNavMonth=g.find("div:nth-child(1), div:nth-child(3)").toArray(),this.__htmlNavConMonth=g),d.append(u);$(this.__htmlNavMonth).on("click",this.__handlerSwitchMonth),$(this.__htmlNavYear).on("click",this.__handlerSwitchYear),_.append($("<div>").addClass("header")),this.__htmlDays=$("<div>").addClass("days"),_.append(this.__htmlDays),v=$("<div>").addClass("headers"),h.append(v),this.__htmlMonths=$("<div>").addClass("months"),h.append(this.__htmlMonths),this.__element.css("--ba-height-nav-row","var(--ba-height-nav-row-dp)"),this.__displayMode===i.CalendarDisplayMode.EventCalendar&&(this.__htmlEventRows=$("<div>").addClass("event-rows"),c.append(this.__htmlEventRows),this.__htmlEventRows.on("mouseover",this.__handlerAddHighlight),this.__htmlEventRows.on("mouseout",this.__handlerRemoveHighlight),this.__element.css("--ba-height-nav-row","var(--ba-height-nav-row-c)")),$(this.__htmlHeaderYear).text(this.__dateCurrent.getFullYear());for(let e=0;e<t.Locale.MonthsLongLangKey.length;e++)null===(s=this.__dfStatic)||void 0===s||s.push(t.Locale.Localization.watchText(t.Locale.MonthsLongLangKey[e],a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__monthLong[e]=a.text,e===this.__dateSelected.getMonth()&&$(this.__htmlHeaderMonth).text(a.text),this.__htmlTextMonths[e]&&$(this.__htmlTextMonths[e]).text(a.text))}));y=this.__displayMode===i.CalendarDisplayMode.DatePicker?t.Locale.WeekDaysShortLangKey:t.Locale.WeekDaysLongLangKey,f=t.Locale.WeekDaysShortLangKey,y=y.slice(this.__dowStart-1).concat(y.slice(0,this.__dowStart-1)),f=f.slice(this.__dowStart-1).concat(f.slice(0,this.__dowStart-1));for(let e=0;e<=y.length-1;e++){let a=$("<div>");D.push(a),null===(r=this.__dfStatic)||void 0===r||r.push(t.Locale.Localization.watchText(y[e],e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&a.text(e.text)}))}for(let e=0;e<3;e++){m=$("<div>").addClass("header"),m.append($("<div>").addClass("spacer")),b=$("<div>").addClass("head"),m.append(b);for(let e=0;e<=f.length-1;e++){let a=$("<div>");b.append(a),null===(o=this.__dfStatic)||void 0===o||o.push(t.Locale.Localization.watchText(f[e],e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&a.text(e.text)}))}v.append(m)}this.__displayMode!==i.CalendarDisplayMode.DatePicker&&(null==this.__contextMenu&&(this.__contextMenu=a.ContextMenu.createContextMenuAndButton({id:this.__id,root:this.__element,parent:this}),this.__contextMenu.button.getElement().addClass("context-menu-button"),this.__menuEntryVisibilityEvents=this.__contextMenu.menu.addRowEntry({onPressed:this.__handlerMenuEntryEventVisibility,cbOnCreated:e=>{var a,i;null===(a=this.__dfStatic)||void 0===a||a.push(t.Locale.Localization.watchText(t.Locale.LangKey.Show,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__strEventsShow=a.text,this.getVisibilityEvents()||e.textHandler.setText(this.__strEventsShow))})),null===(i=this.__dfStatic)||void 0===i||i.push(t.Locale.Localization.watchText(t.Locale.LangKey.Hide,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__strEventsHide=a.text,this.getVisibilityEvents()&&e.textHandler.setText(this.__strEventsHide))}))}}),this.__menuEntryAdd=this.__contextMenu.menu.addRowEntry({onPressed:this.__handlerMenuEntryAdd,cbOnCreated:e=>{var a;null===(a=this.__dfStatic)||void 0===a||a.push(t.Locale.Localization.watchText(t.Locale.LangKey.Add,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}}),this.__menuEntryReset=this.__contextMenu.menu.addRowEntry({onPressed:this.__handlerMenuEntryReset,cbOnCreated:e=>{var a;null===(a=this.__dfStatic)||void 0===a||a.push(t.Locale.Localization.watchText(t.Locale.LangKey.Reset,a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}})),this.__element.append(this.__contextMenu.button.getElement()),null==this.__buttonToggleYearMonth&&(this.__buttonToggleYearMonth=new a.Button(this.__id+".button-header-year-month",this),this.__buttonToggleYearMonth.setCssClass("button-header year-month"),this.__buttonToggleYearMonth.getElement().on("click",this.__handlerButtonToggleViewYearMonth)),this.__element.append(this.__buttonToggleYearMonth.getElement()),null==this.__buttonToday&&(this.__buttonToday=new a.Button(this.__id+".button-header.today",this),this.__buttonToday.setCssClass("button-header today"),this.__buttonToday.backgroundStyler.setImage(t.Icons.Standard.CalendarToday.path,!0),this.__buttonToday.getElement().on("click",this.__handlerButtonToday)),this.__element.append(this.__buttonToday.getElement())),this.__htmlWrapperDay.find(".header").append(D),this.__updateCalendar(),this.__updateMenuStates()}__createEventFromBASchedException(e,a,n){let r="",o={},l=s.createEvent();switch(l.source=null==n?i.CalendarEventSource.BA:n,l.calInstId=a,l.data=e.aEntry,e.eType){case t.BA.DateValChoice.eDate:if(r="eDate",o={day:e.uDate.stDate.nDay,month:e.uDate.stDate.eMonth,year:e.uDate.stDate.nYear},e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=s.createDatePast(),l.end=s.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Daily,l.repitition.Data.dow=s.DowEvery,l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=s.createDatePast(0,e.uDate.stDate.nDay),l.end=s.createDateFuture(0,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=s.DowEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=s.createDatePast(e.uDate.stDate.eMonth-1),l.end=s.createDateFuture(e.uDate.stDate.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=s.DowEvery,l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=s.createDateFromBa(e.uDate.stDate.nYear,0,s.DayPast),l.end=s.createDateFromBa(e.uDate.stDate.nYear,0,s.DayFuture),l.repitition.Type=i.CalendarEventRepetition.MonthlyOnce,l.repitition.Data.dow=s.DowEvery,l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=s.createDatePast(),l.end=s.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek),l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){if(!s.isValidDate(e.uDate.stDate.nDay,e.uDate.stDate.eMonth))break;l.start=s.createDatePast(e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.end=s.createDateFuture(e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=s.DowEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=s.createDateFromBa(e.uDate.stDate.nYear,0,e.uDate.stDate.nDay),l.end=s.createDateFromBa(e.uDate.stDate.nYear,0,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.MonthlyOnce,l.repitition.Data.dow=s.DowEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=s.createDatePast(0,e.uDate.stDate.nDay),l.end=s.createDateFuture(0,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek);break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=s.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,s.DayPast),l.end=s.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,s.DayFuture),l.repitition.Type=i.CalendarEventRepetition.YearlyOnce,l.repitition.Data.dow=s.DowEvery,l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=s.createDatePast(e.uDate.stDate.eMonth-1),l.end=s.createDateFuture(e.uDate.stDate.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek),l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=s.createDateFromBa(e.uDate.stDate.nYear,0,s.DayPast),l.end=s.createDateFromBa(e.uDate.stDate.nYear,0,s.DayFuture),l.repitition.Type=i.CalendarEventRepetition.MonthlyOnce,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek),l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified){l.start=s.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.end=s.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Regular;break}if(e.uDate.stDate.nDay===t.BA.Day.Unspecified&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=s.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,s.DayPast),l.end=s.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,s.DayFuture),l.repitition.Type=i.CalendarEventRepetition.YearlyOnce,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek),l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth===t.BA.Month.Unspecified&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=s.createDateFromBa(e.uDate.stDate.nYear,0,e.uDate.stDate.nDay),l.end=s.createDateFromBa(e.uDate.stDate.nYear,0,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.MonthlyOnce,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek);break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.eDecember&&e.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){l.start=s.createDatePast(e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.end=s.createDateFuture(e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stDate.eDayOfWeek);break}if(e.uDate.stDate.nDay>=1&&e.uDate.stDate.nDay<=t.Helper.Date.DaysMax&&e.uDate.stDate.eMonth>=t.BA.Month.eJanuary&&e.uDate.stDate.eMonth<=t.BA.Month.even&&e.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified&&e.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){if(!s.isValidDate(e.uDate.stDate.nDay,e.uDate.stDate.eMonth,s.createYearFromBa(e.uDate.stDate.nYear)))break;l.start=s.createDateFromBa(e.uDate.stDate.nYear,e.uDate.stDate.eMonth-1,e.uDate.stDate.nDay),l.end=new Date(l.start.getTime()),l.repitition.Type=i.CalendarEventRepetition.Regular;break}break;case t.BA.DateValChoice.eDateRange:e.uDate.stDateRange.stDateFrom.nDay===t.BA.Day.Unspecified||e.uDate.stDateRange.stDateFrom.eMonth===t.BA.Month.Unspecified||e.uDate.stDateRange.stDateFrom.nYear===t.BA.BaDate.YearUnspecified?l.start=s.createDatePast():l.start=s.createDateFromBa(e.uDate.stDateRange.stDateFrom.nYear,e.uDate.stDateRange.stDateFrom.eMonth-1,e.uDate.stDateRange.stDateFrom.nDay),e.uDate.stDateRange.stDateTo.nDay===t.BA.Day.Unspecified||e.uDate.stDateRange.stDateTo.eMonth===t.BA.Month.Unspecified||e.uDate.stDateRange.stDateTo.nYear===t.BA.BaDate.YearUnspecified?l.end=s.createDateFuture():l.end=s.createDateFromBa(e.uDate.stDateRange.stDateTo.nYear,e.uDate.stDateRange.stDateTo.eMonth-1,e.uDate.stDateRange.stDateTo.nDay),l.repitition.Type=i.CalendarEventRepetition.Regular;break;case t.BA.DateValChoice.eWeekNDay:if(r="eWeekNDay",o={weekday:e.uDate.stWeekNDay.eWeekday,weekOfMonth:e.uDate.stWeekNDay.eWeekOfMonth,month:e.uDate.stWeekNDay.eMonth},e.uDate.stWeekNDay.eWeekday===t.BA.Weekday.Unspecified&&e.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified&&e.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified){l.start=s.createDatePast(),l.end=s.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Daily,l.repitition.Data.dow=s.DowEvery,l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stWeekNDay.eWeekday>=t.BA.Weekday.eMonday&&e.uDate.stWeekNDay.eWeekday<=t.BA.Weekday.eSunday&&e.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified&&e.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified){l.start=s.createDatePast(),l.end=s.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stWeekNDay.eWeekday),l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stWeekNDay.eWeekday===t.BA.Weekday.Unspecified&&e.uDate.stWeekNDay.eWeekOfMonth>=t.BA.Week.eWeek1&&e.uDate.stWeekNDay.eWeekOfMonth<=t.BA.Week.eWeek5&&e.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified){l.start=s.createDatePast(),l.end=s.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=s.DowEvery,l.repitition.Data.dowWeek=e.uDate.stWeekNDay.eWeekOfMonth;break}if(e.uDate.stWeekNDay.eWeekday===t.BA.Weekday.Unspecified&&e.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified&&e.uDate.stWeekNDay.eMonth>=t.BA.Month.eJanuary&&e.uDate.stWeekNDay.eMonth<=t.BA.Month.eDecember){l.start=s.createDatePast(e.uDate.stWeekNDay.eMonth-1),l.end=s.createDateFuture(e.uDate.stWeekNDay.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=s.DowEvery,l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stWeekNDay.eWeekday>=t.BA.Weekday.eMonday&&e.uDate.stWeekNDay.eWeekday<=t.BA.Weekday.eSunday&&e.uDate.stWeekNDay.eWeekOfMonth>=t.BA.Week.eWeek1&&e.uDate.stWeekNDay.eWeekOfMonth<=t.BA.Week.eWeek5&&e.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified){l.start=s.createDatePast(),l.end=s.createDateFuture(),l.repitition.Type=i.CalendarEventRepetition.Monthly,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stWeekNDay.eWeekday),l.repitition.Data.dowWeek=e.uDate.stWeekNDay.eWeekOfMonth;break}if(e.uDate.stWeekNDay.eWeekday===t.BA.Weekday.Unspecified&&e.uDate.stWeekNDay.eWeekOfMonth>=t.BA.Week.eWeek1&&e.uDate.stWeekNDay.eWeekOfMonth<=t.BA.Week.eWeek5&&e.uDate.stWeekNDay.eMonth>=t.BA.Month.eJanuary&&e.uDate.stWeekNDay.eMonth<=t.BA.Month.eDecember){l.start=s.createDatePast(e.uDate.stWeekNDay.eMonth-1),l.end=s.createDateFuture(e.uDate.stWeekNDay.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=s.DowEvery,l.repitition.Data.dowWeek=e.uDate.stWeekNDay.eWeekOfMonth;break}if(e.uDate.stWeekNDay.eWeekday>=t.BA.Weekday.eMonday&&e.uDate.stWeekNDay.eWeekday<=t.BA.Weekday.eSunday&&e.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified&&e.uDate.stWeekNDay.eMonth>=t.BA.Month.eJanuary&&e.uDate.stWeekNDay.eMonth<=t.BA.Month.eDecember){l.start=s.createDatePast(e.uDate.stWeekNDay.eMonth-1),l.end=s.createDateFuture(e.uDate.stWeekNDay.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stWeekNDay.eWeekday),l.repitition.Data.dowWeek=s.WeekEvery;break}if(e.uDate.stWeekNDay.eWeekday>=t.BA.Weekday.eMonday&&e.uDate.stWeekNDay.eWeekday<=t.BA.Weekday.eSunday&&e.uDate.stWeekNDay.eWeekOfMonth>=t.BA.Week.eWeek1&&e.uDate.stWeekNDay.eWeekOfMonth<=t.BA.Week.eWeek5&&e.uDate.stWeekNDay.eMonth>=t.BA.Month.eJanuary&&e.uDate.stWeekNDay.eMonth<=t.BA.Month.eDecember){l.start=s.createDatePast(e.uDate.stWeekNDay.eMonth-1),l.end=s.createDateFuture(e.uDate.stWeekNDay.eMonth-1),l.repitition.Type=i.CalendarEventRepetition.Yearly,l.repitition.Data.dow=s.convertBaDowToRepititionDow(e.uDate.stWeekNDay.eWeekday),l.repitition.Data.dowWeek=e.uDate.stWeekNDay.eWeekOfMonth;break}break;default:this.logger.log(t.Logger.Severity.warn,"__createEventFromBASchedException(): Exception type ",e.eType," unknown!")}return l.repitition.Type!=i.CalendarEventRepetition.None?l.id=this.__getNextEventId(l.source):this.logger.log(t.Logger.Severity.warn,"__createEventFromBASchedException(): Could not create schedule exception of eType("+r+")! See data:",o),l.id>0?l:null}__createSchedExceptionFromCalendarEvent(e){if(null==e)return null;let a,n=s.createScheduleException();if(null==e.data)return this.logger.log(t.Logger.Severity.warn,"__createSchedExceptionFromCalendarEvent(): Exception entry list is NULL!"),null;switch(n.aEntry=e.data,e.repitition.Type){case i.CalendarEventRepetition.Regular:n.uDate.stDateRange.stDateFrom.nDay=e.start.getDate(),n.uDate.stDateRange.stDateFrom.eMonth=e.start.getMonth()+1,n.uDate.stDateRange.stDateFrom.nYear=s.createYearForBa(e.start.getFullYear()),e.start.getFullYear()===e.end.getFullYear()&&e.start.getMonth()===e.end.getMonth()&&e.start.getDate()===e.end.getDate()?(n.uDate.stDate.nDay=n.uDate.stDateRange.stDateFrom.nDay,n.uDate.stDate.eMonth=n.uDate.stDateRange.stDateFrom.eMonth,n.uDate.stDate.nYear=n.uDate.stDateRange.stDateFrom.nYear,n.eType=t.BA.DateValChoice.eDate):(n.uDate.stDateRange.stDateTo.nDay=e.end.getDate(),n.uDate.stDateRange.stDateTo.eMonth=e.end.getMonth()+1,n.uDate.stDateRange.stDateTo.nYear=s.createYearForBa(e.end.getFullYear()),n.eType=t.BA.DateValChoice.eDateRange);break;case i.CalendarEventRepetition.Daily:n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=t.BA.Month.Unspecified,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.eType=t.BA.DateValChoice.eDate;break;case i.CalendarEventRepetition.Weekly:break;case i.CalendarEventRepetition.Monthly:if(e.start.getDate()===e.end.getDate()){a=s.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=e.start.getDate(),n.uDate.stDate.eMonth=t.BA.Month.Unspecified,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.uDate.stDate.eDayOfWeek=a[0],e.repitition.Data.dow===s.DowEvery&&(n.uDate.stDate.eDayOfWeek=t.BA.Weekday.Unspecified),n.eType=t.BA.DateValChoice.eDate;break}if(e.repitition.Data.dow===s.DowEvery&&e.repitition.Data.dowWeek===s.WeekEvery){n.uDate.stWeekNDay.eWeekday=t.BA.Weekday.Unspecified,n.uDate.stWeekNDay.eWeekOfMonth=t.BA.Week.Unspecified,n.uDate.stWeekNDay.eMonth=t.BA.Month.Unspecified,n.eType=t.BA.DateValChoice.eWeekNDay;break}if(e.repitition.Data.dow!==s.DowEvery&&e.repitition.Data.dowWeek===s.WeekEvery){a=s.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=t.BA.Month.Unspecified,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.uDate.stDate.eDayOfWeek=a[0],n.eType=t.BA.DateValChoice.eDate;break}if(e.repitition.Data.dow===s.DowEvery&&e.repitition.Data.dowWeek!==s.WeekEvery){n.uDate.stWeekNDay.eWeekday=t.BA.Weekday.Unspecified,n.uDate.stWeekNDay.eWeekOfMonth=e.repitition.Data.dowWeek,n.uDate.stWeekNDay.eMonth=t.BA.Month.Unspecified,n.eType=t.BA.DateValChoice.eWeekNDay;break}if(e.repitition.Data.dow!==s.DowEvery&&e.repitition.Data.dowWeek!==s.WeekEvery){a=s.createDows(e.repitition.Data.dow),n.uDate.stWeekNDay.eWeekday=a[0],n.uDate.stWeekNDay.eWeekOfMonth=e.repitition.Data.dowWeek,n.uDate.stWeekNDay.eMonth=t.BA.Month.Unspecified,n.eType=t.BA.DateValChoice.eWeekNDay;break}break;case i.CalendarEventRepetition.MonthlyOnce:n.uDate.stDate.eMonth=t.BA.Month.Unspecified,n.uDate.stDate.nYear=s.createYearForBa(e.start.getFullYear()),e.start.getDate()===s.DayPast&&e.end.getDate()===s.DayFuture&&e.repitition.Data.dow===s.DowEvery&&e.repitition.Data.dowWeek===s.WeekEvery?(n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.eType=t.BA.DateValChoice.eDate):(a=s.createDows(e.repitition.Data.dow),0!==e.repitition.Data.dow&&0!==e.repitition.Data.dowWeek?n.uDate.stDate.nDay=t.BA.Day.Unspecified:n.uDate.stDate.nDay=e.start.getDate(),n.uDate.stDate.eDayOfWeek=a[0],e.repitition.Data.dow===s.DowEvery&&(n.uDate.stDate.eDayOfWeek=t.BA.Weekday.Unspecified),n.eType=t.BA.DateValChoice.eDate);break;case i.CalendarEventRepetition.Yearly:if(e.repitition.Data.dow===s.DowEvery&&e.repitition.Data.dowWeek===s.WeekEvery){n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.eType=t.BA.DateValChoice.eDate;break}if(e.start.getDate()===e.end.getDate()&&0===e.repitition.Data.dow&&0===e.repitition.Data.dowWeek){n.uDate.stDate.nDay=e.start.getDate(),n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.eType=t.BA.DateValChoice.eDate;break}if(e.start.getDate()===e.end.getDate()&&0!==e.repitition.Data.dow&&0===e.repitition.Data.dowWeek){a=s.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=e.start.getDate(),n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.uDate.stDate.eDayOfWeek=a[0],e.repitition.Data.dow===s.DowEvery&&(n.uDate.stDate.eDayOfWeek=t.BA.Weekday.Unspecified),n.eType=t.BA.DateValChoice.eDate;break}if(e.repitition.Data.dow===s.DowEvery&&e.repitition.Data.dowWeek!==s.WeekEvery){n.uDate.stWeekNDay.eWeekday=t.BA.Weekday.Unspecified,n.uDate.stWeekNDay.eWeekOfMonth=e.repitition.Data.dowWeek,n.uDate.stWeekNDay.eMonth=e.start.getMonth()+1,n.eType=t.BA.DateValChoice.eWeekNDay;break}if(e.repitition.Data.dow!==s.DowEvery&&e.repitition.Data.dowWeek===s.WeekEvery){a=s.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=t.BA.BaDate.YearUnspecified,n.uDate.stDate.eDayOfWeek=a[0],n.eType=t.BA.DateValChoice.eDate;break}if(e.end.getDate()===s.DayFuture&&e.repitition.Data.dow!==s.DowEvery&&e.repitition.Data.dowWeek!==s.WeekEvery){a=s.createDows(e.repitition.Data.dow),n.uDate.stWeekNDay.eWeekday=a[0],n.uDate.stWeekNDay.eWeekOfMonth=e.repitition.Data.dowWeek,n.uDate.stWeekNDay.eMonth=e.start.getMonth()+1,n.eType=t.BA.DateValChoice.eWeekNDay;break}break;case i.CalendarEventRepetition.YearlyOnce:a=s.createDows(e.repitition.Data.dow),n.uDate.stDate.nDay=t.BA.Day.Unspecified,n.uDate.stDate.eMonth=e.start.getMonth()+1,n.uDate.stDate.nYear=s.createYearForBa(e.start.getFullYear()),n.uDate.stDate.eDayOfWeek=a[0],e.repitition.Data.dow===s.DowEvery&&(n.uDate.stDate.eDayOfWeek=t.BA.Weekday.Unspecified),n.eType=t.BA.DateValChoice.eDate}return n.eType!==t.BA.DateValChoice.Invalid?n:null}__changeEvent(e,a){if(null==e)return void this.logger.log(t.Logger.Severity.error,"__changeEvents(): Event was NULLL.");let n,r=!1,o=!1;if(null==a&&(a=!1),e.id<0)e.id=this.__getNextEventId(i.CalendarEventSource.BA),this.__eventsNewBa.push(e),o=!0;else switch(e.source){case i.CalendarEventSource.None:case i.CalendarEventSource.BA:for(let t=0;t<this.__eventsNewBa.length;t++)if(this.__eventsNewBa[t].id===e.id){a?this.__eventsNewBa.splice(t,1):this.__eventsNewBa[t]=e,o=!0;break}for(let t=0;t<this.__eventsChangedBa.length;t++)if(this.__eventsChangedBa[t].id===e.id){a&&(e.calInstId=-1),this.__eventsChangedBa[t]=e,r=!0,o=!0;break}r||(a&&(e.calInstId=-1),this.__eventsChangedBa.push(e),o=!0);break;case i.CalendarEventSource.BARef:for(let t=0;t<this.__eventsChangedBaRef.length;t++)this.__eventsChangedBaRef[t].calInstId===e.calInstId&&(this.__eventsChangedBaRef[t].data=e.data,r=!0,o=!0);if(!r){for(let t=0;t<this.__eventsBaRef.length;t++)this.__eventsBaRef[t].calInstId===e.calInstId&&(n=s.copyCalendarEvent(this.__eventsBaRef[t]),n.data=e.data,this.__eventsChangedBaRef.push(n));o=!0}}o&&(this.__combineEvents(),this.__updateCalendarWrappers(),this.__onEventsChanged())}__updateCalendar(){this.__updateCalendarWrappers(),this.__updateCalendarView()}__updateCalendarWrappers(){this.__dateCurrent=new Date,this.__updateWrapperDays(),this.__displayMode!==i.CalendarDisplayMode.DatePicker&&(this.__displayView===i.CalendarDisplayView.Month?(this.__updateWrapperEvents(),this.__updateVisibleEvents(),this.__dateYearPrev!==this.__dateSelected.getFullYear()&&this.__updateWrapperMonths(),this.__dateYearPrev=this.__dateSelected.getFullYear()):this.__updateWrapperMonths(),this.__updateButtonStateToday())}__updateWrapperDays(){let e,a,n,s,r=[],o=0,l=this.__dateCurrent.getDate(),d=this.__dateCurrent.getMonth(),_=this.__dateCurrent.getFullYear(),h=this.__dateSelectedLast.getDate(),c=this.__dateSelectedLast.getMonth(),u=this.__dateSelectedLast.getFullYear(),g=this.__dateSelected.getMonth(),p=this.__dateSelected.getFullYear(),v=new Date(p,g,1,0,0,0,0);this.__maxWeeksDow=t.Helper.Date.getWeeksOfMonth(this.__dateSelected,this.__dowStart),this.__element.css("--ba-js-weeks",this.__maxWeeksDow.toString()),$(this.__htmlHeaderYear).text(p),$(this.__htmlHeaderMonth).text(this.__monthLong[g]),this.__htmlDays.off("click"),this.__htmlDays.empty(),o=t.Helper.Date.getMaxDaysOfMonth(this.__dateSelected),n=t.Helper.Date.adjustDayOfWeek(v.getDay()),n>=this.__dowStart?n-=this.__dowStart:n=t.Helper.Date.WeekdaysMax-(this.__dowStart-n),v.setDate(o),s=t.Helper.Date.adjustDayOfWeek(v.getDay()),s=s>=this.__dowStart?t.Helper.Date.WeekdaysMax-s+(this.__dowStart-1):this.__dowStart-s-1;for(let e=0;e<n;e++)r.push($("<div>").addClass("day-spacer"));a=this.__displayMode===i.CalendarDisplayMode.EventCalendar?"day-c":"day-dp";for(let t=1;t<=o;t++)e=$("<div>").addClass(a),this.__displayMode===i.CalendarDisplayMode.DatePicker?e.text(t):e.append($("<div>").text(t)),r.push(e);for(let e=0;e<s;e++)r.push($("<div>").addClass("day-spacer"));_===p&&d===g&&(e=r[n+l-1],e.addClass("curbor"),this.__displayMode===i.CalendarDisplayMode.DatePicker&&e.addClass("curtxt")),u>t.BA.BaDate.YearOffset&&u===p&&c===g&&r[n+h-1].addClass("selected"),this.__htmlDays.append(r),this.__htmlDays.on("click",this.__handlerSelectDay)}__updateWrapperMonths(){let e,a,n,r,o,l,d,_,h,c,u,g=[],p=[],v=this.__dateCurrent.getMonth(),m=this.__dateCurrent.getFullYear(),b=this.__dateSelected.getFullYear(),y=[],f=!1,D=0,C=0,H=0,w=0,S=0,T=!1,E=!1,x=0,B=t.Helper.DateTime.convertDaysToMilliseconds(1);$(this.__htmlHeaderYear).text(b),this.__htmlMonths.off("click"),this.__htmlMonths.empty(),this.__htmlTextMonths.length=0;for(let e=0;e<t.Helper.Date.MonthsMax;e++){y[e]=[],h=new Date(b,e,1,0,0,0,0),o=t.Helper.Date.getMaxDaysOfMonth(h);for(let t=0;t<o;t++)y[e][t]=!1}for(let e=0;e<this.__events.length;e++){switch(_=s.copyCalendarEvent(this.__events[e]),_.start.getTime()>_.end.getTime()&&this.__swapDate(_),_.repitition.Type){case i.CalendarEventRepetition.Regular:if(_.start.getTime()===_.end.getTime()){if(_.start.getFullYear()!==b)continue;x=1}else{if(_.start.getFullYear()>b||_.end.getFullYear()<b)continue;if(_.start.getFullYear()<b&&(_.start=new Date(b,0,1,0,0,0,0)),_.end.getFullYear()>b&&(_.end=new Date(b,11,t.Helper.Date.DaysMax,0,0,0,0)),x=t.Helper.DateTime.convertMillisecondsToDays(_.end.getTime()-_.start.getTime()+B),u=this.__getDecimal(x),null==u)continue;x=u}for(H=_.start.getMonth(),D=_.start.getDate();x>0;x--)y[H][D-1]=!0,D++,D>y[H].length&&(D=1,H++);break;case i.CalendarEventRepetition.Daily:for(let e=0;e<y.length;e++)for(let t=0;t<y[e].length;t++)y[e][t]=!0;f=!0;break;case i.CalendarEventRepetition.Monthly:case i.CalendarEventRepetition.Yearly:case i.CalendarEventRepetition.MonthlyOnce:case i.CalendarEventRepetition.YearlyOnce:if((_.repitition.Type===i.CalendarEventRepetition.MonthlyOnce||_.repitition.Type===i.CalendarEventRepetition.YearlyOnce)&&_.start.getFullYear()!==b)continue;if(D=0,H=0,C=y.length,_.repitition.Type!==i.CalendarEventRepetition.Yearly&&_.repitition.Type!==i.CalendarEventRepetition.YearlyOnce||(H=_.start.getMonth(),C=H+1),0===_.repitition.Data.dow&&0===_.repitition.Data.dowWeek)for(D=_.start.getDate();H<C;H++)D<=y[H].length&&(y[H][D-1]=!0);else for(c=s.createDows(_.repitition.Data.dow),h=new Date(b,0,1,0,0,0,0),E=0!==_.repitition.Data.dow&&0===_.repitition.Data.dowWeek,T=_.repitition.Data.dowWeek===s.WeekEvery||E,w=T?1:_.repitition.Data.dowWeek,S=w;H<C;H++){T&&(h.setMonth(H),S=t.Helper.Date.getWeeksOfMonth(h,this.__dowStart));for(let e=w;e<=S;e++)for(let t=0;t<c.length;t++)h.setMonth(H),D=this.__getDayOfDow(c[t],e,h,this.__dowStart),0!==D&&(E&&D!==_.start.getDate()||D<=y[H].length&&(y[H][D-1]=!0))}}if(f)break}for(let i=0;i<y.length;i++){g.length=0,h=new Date(b,i,1,0,0,0,0),a=$("<div>").addClass("month"),a.attr("baid",i),o=y[i].length,l=t.Helper.Date.adjustDayOfWeek(h.getDay()),l>=this.__dowStart?l-=this.__dowStart:l=t.Helper.Date.WeekdaysMax-(this.__dowStart-l),h.setDate(o),d=t.Helper.Date.adjustDayOfWeek(h.getDay()),d=d>=this.__dowStart?t.Helper.Date.WeekdaysMax-d+(this.__dowStart-1):this.__dowStart-d-1;for(let e=0;e<l;e++)g.push($("<div>").addClass("day-spacer"));for(let t=1;t<=o;t++)e=$("<div>").addClass("day-c").text(t),this.__visibilityEvents&&y[i][t-1]&&e.addClass("evt"),g.push(e);for(let e=0;e<d;e++)g.push($("<div>").addClass("day-spacer"));if(r=t.Helper.Date.getWeeksOfMonth(h,this.__dowStart),r)switch(r){case 4:for(let e=0;e<t.Helper.Date.WeekdaysMax+1;e++)g.push($("<div>").addClass("day-spacer"));break;case 5:g.push($("<div>").addClass("day-spacer"))}n=$("<div>").addClass("month-text").text(this.__monthLong[i]),m===b&&v===i&&n.addClass("curbor"),a.append(n),a.append($("<div>").append(g).addClass("days")),p.push(a),this.__htmlTextMonths.push(n[0])}this.__htmlMonths.append(p),this.__htmlMonths.on("click",this.__handlerSelectMonth)}__updateWrapperEvents(){var e,a,n,r;let o,l,d,_,h,c,u,g,p,v,m=[],b=[],y=[],f=-1,D=-1,C=[],H=0,w=0,S=0,T=0,E=0,x=0,B=0,k=0,A=0,O=0,I=0,P=0,M=t.Helper.Date.getMaxDaysOfMonth(this.__dateSelected),L=0,V=0,W=0,j=0,R=t.Helper.DateTime.convertDaysToMilliseconds(1)-1,F=0,N=0;this.__dfEvents&&(this.__dfEvents.forEach(e=>e()),this.__dfEvents.length=0);for(let e=0;e<this.__maxWeeksDow;e++)C.push([]);this.__htmlEventRows.off("click"),this.__htmlEventRows.empty(),this.__eventHighlights.clear();for(let e=0;e<this.__maxWeeksDow;e++)h=$("<div>").addClass("event-row"),h.append($("<div>").addClass("event-spacer")),y.push(h);_=new Date(this.__dateSelected.getFullYear(),this.__dateSelected.getMonth(),1,0,0,0,0),c=_.getTime(),u=c+t.Helper.DateTime.convertDaysToMilliseconds(M-1);for(let e=0;e<this.__events.length;e++)if(o=s.copyCalendarEvent(this.__events[e]),o.start.getTime()>o.end.getTime()&&this.__swapDate(o),H=o.start.getMonth(),o.start.getFullYear()===s.YearPast&&(o.start.setFullYear(_.getFullYear()),o.end.setFullYear(_.getFullYear())),H==o.start.getMonth()){switch(H=o.start.getDate(),o.repitition.Type){case i.CalendarEventRepetition.Regular:if(o.start.getFullYear()>_.getFullYear())continue;if(o.start.getFullYear()===_.getFullYear()&&o.start.getMonth()>_.getMonth())continue;break;case i.CalendarEventRepetition.Daily:case i.CalendarEventRepetition.Monthly:case i.CalendarEventRepetition.Yearly:if(o.repitition.Type!==i.CalendarEventRepetition.Yearly)o.start.setMonth(_.getMonth()),o.end.setMonth(_.getMonth());else if(o.start.getMonth()!==_.getMonth())continue;if(0!==o.repitition.Data.dow&&0!==o.repitition.Data.dowWeek)v=s.createDows(o.repitition.Data.dow),V=v[0],W=o.repitition.Data.dowWeek,W===s.WeekEvery&&(W=1),L=this.__getDayOfDow(V,W,_),0!==L&&(H=L,o.start.setDate(L));else if(0!==o.repitition.Data.dow&&0===o.repitition.Data.dowWeek&&o.repitition.Data.dow!==s.DowEvery&&(v=s.createDows(o.repitition.Data.dow),V=v[0],V!==t.Helper.Date.adjustDayOfWeek(o.start.getDay())))continue;break;case i.CalendarEventRepetition.MonthlyOnce:if(o.start.getFullYear()!=_.getFullYear())continue;if(o.start.setMonth(_.getMonth()),o.end.setMonth(_.getMonth()),0!==o.repitition.Data.dow&&0===o.repitition.Data.dowWeek&&o.repitition.Data.dow!==s.DowEvery&&(v=s.createDows(o.repitition.Data.dow),V=v[0],V!==t.Helper.Date.adjustDayOfWeek(o.start.getDay())))continue;break;case i.CalendarEventRepetition.YearlyOnce:if(o.start.getFullYear()!=_.getFullYear())continue;if(o.start.getMonth()!=_.getMonth())continue;if(0!==o.repitition.Data.dow&&0===o.repitition.Data.dowWeek&&(v=s.createDows(o.repitition.Data.dow),V=v[0],V!==t.Helper.Date.adjustDayOfWeek(o.start.getDay())))continue}H===o.start.getDate()&&m.push(o)}m.sort(this.__sortEvents);for(let h=0;h<m.length;h++){switch(P=0,o=m[h],g=new Date(c),p=new Date(u),o.repitition.Type){case i.CalendarEventRepetition.Regular:g.setTime(o.start.getTime()),p.setTime(o.end.getTime()),P=1;break;case i.CalendarEventRepetition.Weekly:this.logger.log(t.Logger.Severity.warn,"__updateCalendarEvents(): Repitition type "+o.repitition.Type+" ("+i.CalendarEventRepetition[o.repitition.Type]+") not implemented yet!");break;case i.CalendarEventRepetition.Daily:case i.CalendarEventRepetition.Monthly:case i.CalendarEventRepetition.Yearly:case i.CalendarEventRepetition.MonthlyOnce:case i.CalendarEventRepetition.YearlyOnce:0===o.repitition.Data.dow&&0===o.repitition.Data.dowWeek||0!==o.repitition.Data.dow&&0===o.repitition.Data.dowWeek?(g.setDate(o.start.getDate()),p.setDate(o.end.getDate()),P=1):0!==o.repitition.Data.dow&&0!==o.repitition.Data.dowWeek&&(P=2);break;default:this.logger.log(t.Logger.Severity.warn,"__updateCalendarEvents(): Repitition type ",o.repitition.Type," is unknown!")}if(T=g.getTime(),E=p.getTime(),!(T>u||E<c||E<T))switch(P){case 1:w=g.getDate(),S=p.getDate(),T<c&&(w=1,T=c),E>u&&(S=M,E=u),B=S-w+1,_.setDate(w),k=t.Helper.Date.adjustDayOfWeek(_.getDay()),A=k>=this.__dowStart?k-this.__dowStart:t.Helper.Date.WeekdaysMax-(this.__dowStart-k),O=t.Helper.Date.WeekdaysMax-A,B>O?(x=O,B-=O):(x=B,B=0),I=O-x;for(let n=this.__getWeekOfDay(this.__dateSelected,w,this.__dowStart);n<=this.__maxWeeksDow;n++){f=n-1,0===C[f].length&&C[f].push(0);for(let e=0;e<=C[f].length-1;e++){if(T>C[f][e]){D=e+1;break}D=e+2}E=T+t.Helper.DateTime.convertDaysToMilliseconds(x)-1,void 0!==C[f][D-1]?(N=C[f][D-1],N>0&&(_.setTime(N),F=t.Helper.Date.adjustDayOfWeek(_.getDay()),F>=this.__dowStart?A-=F-this.__dowStart+1:A-=t.Helper.Date.WeekdaysMax-this.__dowStart+1+F),C[f][D-1]=E):C[f].push(E),D<=y[f][0].childElementCount-1?(l=y[f][0].children[D],l.lastChild&&l.removeChild(l.lastChild)):(l=$("<div>").addClass("event-row-entry")[0],y[f].append(l)),A>0&&l.append($("<div>").addClass("event-spacer-"+A)[0]);let s=0,r=$("<div>");if(o.source===i.CalendarEventSource.BARef?(d=$("<div>").addClass("event-"+x)[0],d.classList.add("calref"),d.append($("<div>").text("R").addClass("col1")[0]),d.append(r.addClass("col2")[0]),""===o.title?(s=o.calInstId,null===(e=this.__dfEvents)||void 0===e||e.push(t.Locale.Localization.watchText(t.Locale.LangKey.Exception,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&r.text(e.text+" "+s)}))):r.text(o.title)):(r.addClass("event-"+x),""===o.title?(s=o.id,null===(a=this.__dfEvents)||void 0===a||a.push(t.Locale.Localization.watchText(t.Locale.LangKey.Exception,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&r.text(e.text+" "+s)}))):r.text(o.title),d=r[0]),$(d).attr("baid",o.id),b.push(d),l.append(d),I>0&&l.append($("<div>").addClass("event-spacer-"+I)[0]),!(B>0)){this.__eventHighlights.set(o.id,b),b=[];break}A=0,I=0,T=E+1,O=t.Helper.Date.WeekdaysMax,B>O?(x=O,B-=O):(x=B,B=0,I=O-x)}break;case 2:L=1,V=0,v=s.createDows(o.repitition.Data.dow),W=0,j=0,W=o.repitition.Data.dowWeek,j=W,W===s.WeekEvery&&(W=1,j=this.__maxWeeksDow),x=1;for(let e=W;e<=j;e++)for(let a=0;a<v.length;a++){if(V=v[a],L=this.__getDayOfDow(V,e,_,this.__dowStart),0===L)continue;f=this.__getWeekOfDay(this.__dateSelected,L,this.__dowStart)-1,_.setTime(T),_.setDate(L),T=_.getTime(),A=V>=this.__dowStart?V-this.__dowStart:t.Helper.Date.WeekdaysMax-(this.__dowStart-V),I=t.Helper.Date.WeekdaysMax-A-x,0===C[f].length&&C[f].push(0);for(let e=0;e<=C[f].length-1;e++){if(T>C[f][e]){D=e+1;break}D=e+2}E=T+R,void 0!==C[f][D-1]?(N=C[f][D-1],N>0&&(_.setTime(N),F=t.Helper.Date.adjustDayOfWeek(_.getDay()),F>=this.__dowStart?A-=F-this.__dowStart+1:A-=t.Helper.Date.WeekdaysMax-this.__dowStart+1+F),C[f][D-1]=E):C[f].push(E),D<=y[f][0].childElementCount-1?(l=y[f][0].children[D],l.lastChild&&l.removeChild(l.lastChild)):(l=$("<div>").addClass("event-row-entry")[0],y[f].append(l)),A>0&&l.append($("<div>").addClass("event-spacer-"+A)[0]);let s=0,h=$("<div>");o.source===i.CalendarEventSource.BARef?(d=$("<div>").addClass("event-"+x)[0],d.classList.add("calref"),d.append($("<div>").text("R").addClass("col1")[0]),d.append(h.addClass("col2")[0]),""===o.title?(s=o.calInstId,null===(n=this.__dfEvents)||void 0===n||n.push(t.Locale.Localization.watchText(t.Locale.LangKey.Exception,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&h.text(e.text+" "+s)}))):h.text(o.title)):(h.addClass("event-"+x),""===o.title?(s=o.id,null===(r=this.__dfEvents)||void 0===r||r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Exception,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&h.text(e.text+" "+s)}))):h.text(o.title),d=h[0]),$(d).attr("baid",o.id),b.push(d),l.append(d),I>0&&l.append($("<div>").addClass("event-spacer-"+I)[0])}this.__eventHighlights.set(o.id,b),b=[]}}this.__htmlEventRows.append(y),this.__htmlEventRows.on("click",this.__handlerSelectEvent),C.length=0,m.length=0}__updateVisibleEvents(){if(null==this.__htmlEventRows)return;let e,t=this.__htmlEventRows.children(),a=0,i=0,n=0,s=0,r=0,o=0;for(let n=0;n<t.length;n++)if(e=t[n],!(e.childElementCount-1<1)){a=e.children[0].clientHeight,i=e.children[1].clientHeight;break}if(!(a<=0||i<=0||null==this.__htmlDays||this.__htmlDays[0].children.length<=0)){n=this.__htmlDays[0].children[0].clientHeight,r=n-a,o=Math.floor(r/i);for(let e=0;e<this.__maxWeeksDow;e++){let a=t[e];for(let e=1;e<a.childElementCount;e++)e>o?$(a.children[e]).addClass("invis"):$(a.children[e]).removeClass("invis")}s=this.__htmlDays.height(),null!=s&&this.__htmlEventRows.height(s)}}__updateCalendarView(){if(this.__htmlWrapperDay.detach(),this.__htmlWrapperMonth.detach(),this.__htmlWrapperEvent.detach(),this.__htmlNavConMonth.removeClass("invis"),this.__updateMenuVisibility(),this.__updateLegendIcons(),this.__displayMode!==i.CalendarDisplayMode.DatePicker){switch(this.__displayView){case i.CalendarDisplayView.Month:this.__element.append(this.__htmlWrapperDay),this.__visibilityEvents&&(this.__element.append(this.__htmlWrapperEvent),this.__updateVisibleEvents());break;case i.CalendarDisplayView.Year:this.__element.append(this.__htmlWrapperMonth),this.__htmlNavConMonth.addClass("invis")}this.__updateButtonStateToday(),this.__updateButtonImageToggleYear()}else this.__element.append(this.__htmlWrapperDay)}__updateMenuVisibility(){let e=this.__visibilityMenu?t.Visibility.Visible:t.Visibility.Hidden;this.__contextMenu&&this.__contextMenu.button.setVisibility(e),this.__buttonToggleYearMonth&&this.__buttonToggleYearMonth.setVisibility(e),this.__buttonToday&&this.__buttonToday.setVisibility(e)}__updateMenuTextEventVisibility(){this.__menuEntryVisibilityEvents&&this.__menuEntryVisibilityEvents.textHandler.setText(this.getVisibilityEvents()?this.__strEventsHide:this.__strEventsShow)}__updateMenuStateEventVisibility(){this.__menuEntryVisibilityEvents&&(null!=this.baObjectHandler.baObject?(this.__menuEntryVisibilityEvents.setIsEnabled(!0),this.setVisibilityEvents(!0)):(this.__menuEntryVisibilityEvents.setIsEnabled(!1),this.setVisibilityEvents(!1)),this.__updateMenuTextEventVisibility())}__updateMenuStates(){this.__updateMenuStateAdd(),this.__updateMenuStateReset(),this.__updateMenuStateEventVisibility()}__updateMenuStateAdd(){this.__menuEntryAdd&&this.__menuEntryAdd.setIsEnabled(null!=this.baObjectHandler.baObject)}__updateMenuStateReset(){this.__menuEntryReset&&this.__menuEntryReset.setIsEnabled(this.hasChanges())}__updateButtonStateToday(){if(!this.__buttonToday)return;let e=this.__dateCurrent.getFullYear()!==this.__dateSelected.getFullYear();this.__displayView===i.CalendarDisplayView.Month&&(e=this.__dateCurrent.getMonth()!==this.__dateSelected.getMonth()||e),this.__buttonToday.setIsEnabled(e)}__updateButtonImageToggleYear(){if(null==this.__buttonToggleYearMonth)return;let e=this.__displayView===i.CalendarDisplayView.Month?t.Icons.Standard.CalendarYear.path:t.Icons.Standard.CalendarMonth.path;this.__buttonToggleYearMonth.backgroundStyler.setImage(e,!0)}__updateLegendIcons(){if(!this.__isAttached||this.__displayMode===i.CalendarDisplayMode.DatePicker)return this.__lihToday.hide(),this.__lihMonth.hide(),void this.__lihYear.hide();this.__visibilityMenu?(this.__lihToday.show(),this.__displayView===i.CalendarDisplayView.Month?(this.__lihMonth.hide(),this.__lihYear.show()):(this.__lihMonth.show(),this.__lihYear.hide())):(this.__lihToday.hide(),this.__lihMonth.hide(),this.__lihYear.hide())}__reset(){this.__resetChanges(),this.__resetEvents()}__resetChanges(){this.__resetChangesBa(),this.__resetChangesBaRef()}__resetEvents(){this.__resetEventsBa(),this.__resetEventsBaRef(),this.__events=[]}__resetChangesBa(){this.__eventsNewBa=[],this.__eventsChangedBa=[],this.__updateMenuStateReset()}__resetChangesBaRef(){this.__eventsChangedBaRef=[],this.__updateMenuStateReset()}__resetEventsBa(){this.__eventsBa=[]}__resetEventsBaRef(){this.__eventsBaRef=[]}__swapDate(e){let t=0,a=0,i=0;t=e.start.getDate(),a=e.start.getMonth(),i=e.start.getFullYear(),e.start=new Date(e.end.getFullYear(),e.end.getMonth(),e.end.getDate()),e.end=new Date(i,a,t)}__combineEvents(){let e;if(this.__events=[],this.__eventsNewBa.length>0&&(this.__events=this.__events.concat(Array.from(this.__eventsNewBa))),this.__eventsChangedBa.length>0)for(let t=0;t<this.__eventsBa.length;t++){e=this.__eventsBa[t];for(let t=0;t<this.__eventsChangedBa.length;t++)if(e.id===this.__eventsChangedBa[t].id){e=this.__eventsChangedBa[t].calInstId<0?null:this.__eventsChangedBa[t];break}null!=e&&this.__events.push(e)}else this.__eventsBa.length>0&&(this.__events=this.__events.concat(Array.from(this.__eventsBa)));if(this.__eventsChangedBaRef.length>0)for(let t=0;t<this.__eventsBaRef.length;t++){e=this.__eventsBaRef[t];for(let t=0;t<this.__eventsChangedBaRef.length;t++)if(e.id===this.__eventsChangedBaRef[t].id){e=this.__eventsChangedBaRef[t].calInstId<0?null:this.__eventsChangedBaRef[t];break}null!=e&&this.__events.push(e)}else this.__eventsBaRef.length>0&&(this.__events=this.__events.concat(Array.from(this.__eventsBaRef)));this.__updateMenuStateReset()}__openEventDialog(e){var n;let s,r;null==e?(s=t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.AddException),r=!1,this.__IsEvtDlgEdit=!1):(s=t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.EditException),r=!(e.source===i.CalendarEventSource.BARef),this.__IsEvtDlgEdit=!0),this.__eventDialog.setCurrentDate(this.__dateSelected),this.__eventDialog.setEvent(e),this.__dialogWindow=a.DialogWindow.createDialogWindow({appearance:{content:this.__eventDialog.getElement(),headline:{textAttributes:{text:s}},buttons:a.DialogWindow.Buttons.OkCancel,layout:{width:700,widthUnit:"px",height:350,heightUnit:"px"},modal:!0,controls:r?[this.__dialogWindowDltBtn]:void 0},callbacks:{cbConfirmed:this.__handlerEventDialogConfirmed}}),null===(n=this.__dialogWindow)||void 0===n||n.open()}__today(){this.__dateSelected.setMonth(this.__dateCurrent.getMonth()),this.__dateSelected.setFullYear(this.__dateCurrent.getFullYear()),this.__updateCalendarWrappers()}__toggleViewYearMonth(){this.__displayView=this.__displayView===i.CalendarDisplayView.Month?i.CalendarDisplayView.Year:i.CalendarDisplayView.Month,this.__updateCalendar()}__menuVisibilityEvents(){this.toggleVisibilityEvents(),this.__updateMenuTextEventVisibility()}__menuAdd(){this.__openEventDialog()}__menuReset(){null!=this.__menuEntryReset&&this.__menuEntryReset.getIsEnabled()&&a.DialogWindow.confirm(this.__strResetChanges).then(e=>{e&&this.resetChanges()})}__getCalendarEvent(e){if(e>=s.IndexStartBa&&e<s.IndexStartBaRef&&e<=this.__indexBaId){for(let t=0;t<this.__eventsNewBa.length;t++)if(e===this.__eventsNewBa[t].id)return this.__eventsNewBa[t];for(let t=0;t<this.__eventsChangedBa.length;t++)if(e===this.__eventsChangedBa[t].id)return this.__eventsChangedBa[t]}if(e>=s.IndexStartBaRef&&e<=this.__indexBaRefId)for(let t=0;t<this.__eventsChangedBaRef.length;t++)if(e===this.__eventsChangedBaRef[t].id)return this.__eventsChangedBaRef[t];for(let t=0;t<this.__events.length;t++)if(e===this.__events[t].id)return this.__events[t];return null}__getWeekOfDay(e,a,i){if(!t.Helper.Date.isDate(e))return 0;if(a<1||a>t.Helper.Date.DaysMax)return 0;let n=new Date(e.getFullYear(),e.getMonth(),1),s=t.Helper.Date.adjustDayOfWeek(n.getDay());n.setDate(a);let r=t.Helper.Date.adjustDayOfWeek(n.getDay());return(a+(s>=(i=t.Helper.Date.validateDow(i))?s-i:t.Helper.Date.WeekdaysMax-(i-s))+(r>=i?t.Helper.Date.WeekdaysMax-(r-(i-1)):i-r-1))/t.Helper.Date.WeekdaysMax}__getDayOfDow(e,a,i,n){if(e<1||e>t.Helper.Date.WeekdaysMax)return 0;if(!t.Helper.Date.isDate(i))return 0;let s,r,o=t.Helper.Date.getWeeksOfMonth(i,n);if(a<1||a>o)return 0;let l=new Date(i.getTime());l.setDate(1);let d=t.Helper.Date.adjustDayOfWeek(l.getDay()),_=t.Helper.Date.getMaxDaysOfMonth(l);if(r=(n=t.Helper.Date.validateDow(n))-1,n!==t.BA.Weekday.eMonday&&(d=d>=n?d-r:d-r+t.Helper.Date.WeekdaysMax,e=e>=n?e-r:e-r+t.Helper.Date.WeekdaysMax),1===a){if(e<d)return 0;if(e===d)return 1;if(e>d)return e-d+1}if(a===o){if(l.setDate(_),d=t.Helper.Date.adjustDayOfWeek(l.getDay()),n!==t.BA.Weekday.eMonday&&(d=d>=n?d-r:d-r+t.Helper.Date.WeekdaysMax),e>d)return 0;if(e===d)return _;if(e<d)return _-(d-e)}return s=0,s+=t.Helper.Date.WeekdaysMax-d+1,s+=e,a-2>0&&(s+=t.Helper.Date.WeekdaysMax*(a-2)),s}__getNextEventId(e){switch(e){case i.CalendarEventSource.BA:return this.__indexBaId++;case i.CalendarEventSource.BARef:return this.__indexBaRefId++;default:return this.__indexBaId++}}__getDecimal(t){let a=e.ValueConverter.toNumber(t);return null==a?null:parseInt((a+"").split(".")[0])}__setScheduleExceptionEntries(e){null==e?(this.logger.log(t.Logger.Severity.warn,"__setScheduleExceptionEntries(): Invalid value was set for attribute 'eException'!"),this.__resetEventsBa(),this.__resetChangesBa(),this.__schedExceptionList=null):this.__schedExceptionList=t.Helper.Array.clone(e),this.__processScheduleExceptionEntries()}__setScheduleExceptionReferenceEntries(e){null==e?(this.logger.log(t.Logger.Severity.warn,"__setScheduleExceptionReferenceEntries(): Invalid value was set for attribute 'aCalendar'!"),this.__resetEventsBaRef(),this.__resetChangesBaRef(),this.__schedCalendarList=null):this.__schedCalendarList=t.Helper.Array.clone(e),this.__processScheduleExceptionReferenceEntries()}__onSelectionChanged(e){this.eventHandler.raise(i.CalendarEvent.onSelectionChanged,e)}__onEventsChanged(){this.eventHandler.raise(i.CalendarEvent.onEventsChanged)}processBaObject(){var e;if(null==this.baObjectHandler.baObject||!this.baObjectHandler.baObject.getIsValid())return null!=this.baObjectHandler.baObject&&this.logger.log(t.Logger.Severity.warn,"processBaObject(): "+(null===(e=this.baObjectHandler.baObject)||void 0===e?void 0:e.isNotValidText)),this.__reset(),this.__updateWrapperEvents(),void this.__updateMenuStates();let i;switch(this.__updateMenuStateAdd(),this.__updateMenuStateEventVisibility(),this.__eventDialog.setDataType(this.baObjectHandler.baObject.DataType),this.baObjectHandler.baObject.DataType){case t.DataType.boolean:this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,e=>{this.__eventDialog.setInactiveText(null==e?void 0:e.get(0)),this.__eventDialog.setActiveText(null==e?void 0:e.get(1))},!0);break;case t.DataType.number:this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eUnit,e=>{this.__eventDialog.setUnit(e)});break;case t.DataType.enum:this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,e=>{i=a.Combobox.toComboboxItemArray(e),this.__eventDialog.setStateTexts(i)},!0)}this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eException,e=>{this.__setScheduleExceptionEntries(e)}),this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eCalendar,e=>{this.__setScheduleExceptionReferenceEntries(e)})}setAttributes(e){if(super.setAttributes(e),!this.__initDone)return this;let a=0,i=this.__visibilityEvents,n=this.__displayView;switch(this.__eventDialog.setAttributes(e),null!=e.visibilityMenu&&this.setVisibilityMenu(e.visibilityMenu),null!=e.visibilityEvents&&(i=e.visibilityEvents,a=1),e.displayView&&(n=e.displayView,a=2),e.displayMode&&(this.__displayMode=e.displayMode,a=3),e.dowStart&&(this.__dowStart=t.Helper.Date.validateDow(e.dowStart),a=3),a){case 1:this.setVisibilityEvents(i);break;case 2:this.__visibilityEvents=i,this.setDisplayView(n);break;case 3:this.__visibilityEvents=i,this.__displayView=n,this.__constructCalendar()}return this}getAttributes(){let e=Object.assign(Object.assign({},this.__attrHandler.getRef()),{displayMode:this.__displayMode,displayView:this.__displayView,visibilityMenu:this.__visibilityMenu,visibilityEvents:this.__visibilityEvents});this.__dateInit&&(e.dateInit=this.__dateInit);let t=this.__eventDialog.getAttributes();return t.stateColors&&(e.stateColors=t.stateColors),t.snapPeriode&&(e.snapPeriode=t.snapPeriode),e}setVisibilityEvents(e){e!==this.__visibilityEvents&&(this.__visibilityEvents=e,this.__attrHandler.visibilityEvents=e,this.__displayMode!==i.CalendarDisplayMode.DatePicker&&(this.__displayView===i.CalendarDisplayView.Month?this.__updateCalendarView():this.__updateCalendarWrappers()))}getVisibilityEvents(){return this.__visibilityEvents}toggleVisibilityEvents(){this.setVisibilityEvents(!this.__visibilityEvents)}setStateColors(e){this.__eventDialog.setStateColors(e)}getStateColors(){return this.__eventDialog.getStateColors()}setSnapPeriode(e){this.__eventDialog.setSnapPeriode(e)}getSnapPeriode(){return this.__eventDialog.getSnapPeriode()}setDate(e){this.__dateSelected=new Date,e&&t.Helper.Date.isDate(e)&&(this.__dateSelected=new Date(e.getTime()),this.__dateSelectedLast=new Date(e.getTime())),this.__updateCalendarWrappers()}getSchedExceptionEntries(e,a,n){let r,o=0,l=[],d=this.__events,_=s.createScheduleEntry(),h=s.createScheduleException();(null==e||e<i.CalendarEventSource.None||e>Object.keys(i.CalendarEventSource).length/2)&&(e=i.CalendarEventSource.None);for(let e=0;e<this.__maxExcsLastEntryPlcSched;e++)h.aEntry.push(_);if(null==d||d.length<=0){for(let e=0;e<this.__maxExcsLastPlcSched;e++)l.push(h);return l}for(let t=0;t<d.length;t++)if(r=this.__createSchedExceptionFromCalendarEvent(d[t]),null!=r&&(e===i.CalendarEventSource.None||d[t].source===i.CalendarEventSource.None||d[t].source===e)){for(let e=0;e<this.__maxExcsLastEntryPlcSched-r.aEntry.length;e++)r.aEntry.push(_);l.push(r)}if(e===i.CalendarEventSource.BA){if(null!=this.__schedCalendarExceptions)for(let e=0;e<this.__schedCalendarExceptions.length;e++)o+=this.__schedCalendarExceptions[e].exceptions.length;for(let e=0;e<this.__maxExcsLastPlcSched-(this.__events.length-o);e++)l.push(h)}if(l.length<=0)return null;if(null==a&&null==n)return l;if(null==a)return null;let c,u,g,p,v,m,b,y,f,D,C,H,w,S,T,E=[],x=new Date(a.getTime()),B=new Date((n||a).getTime()),k=new Date,A=new Date;if(isNaN(x.getTime())||isNaN(B.getTime()))return this.logger.log(t.Logger.Severity.error,"getSchedExceptionEntries(): Invalid date range."),null;k.setHours(0),k.setMinutes(0),k.setSeconds(0),k.setMilliseconds(0),A.setHours(23),A.setMinutes(59),A.setSeconds(59),A.setMilliseconds(0),x.setHours(0),x.setMinutes(0),x.setSeconds(0),x.setMilliseconds(0),B.setHours(23),B.setMinutes(59),B.setSeconds(59),B.setMilliseconds(0);for(let e=0;e<l.length&&(r=l[e],r.eType!==t.BA.DateValChoice.Invalid);e++)switch(r.eType){case t.BA.DateValChoice.eDate:if(r.uDate.stDate.nDay!==t.BA.Day.Unspecified&&r.uDate.stDate.eMonth!==t.BA.Month.Unspecified&&r.uDate.stDate.nYear!==t.BA.BaDate.YearUnspecified)k.setDate(r.uDate.stDate.nDay),k.setMonth(r.uDate.stDate.eMonth-1),k.setFullYear(s.createYearFromBa(r.uDate.stDate.nYear)),A.setDate(r.uDate.stDate.nDay),A.setMonth(r.uDate.stDate.eMonth-1),A.setFullYear(s.createYearFromBa(r.uDate.stDate.nYear)),k.getTime()<=B.getTime()&&A.getTime()>=x.getTime()&&E.push(r);else if(r.uDate.stDate.nDay===t.BA.Day.Unspecified&&r.uDate.stDate.eMonth===t.BA.Month.Unspecified&&r.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&r.uDate.stDate.eDayOfWeek===t.BA.Weekday.Unspecified)E.push(r);else{if(C=new Date,C.setHours(0),C.setMinutes(0),C.setSeconds(0),C.setMilliseconds(0),S=!1,r.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified)w=x.getFullYear(),D=B.getFullYear();else{if(w=s.createYearFromBa(r.uDate.stDate.nYear),D=w,w<x.getFullYear()||w>B.getFullYear())break;C.setFullYear(w)}if(r.uDate.stDate.eMonth===t.BA.Month.Invalid)break;H=x.getMonth()+1,r.uDate.stDate.eMonth!==t.BA.Month.Unspecified&&(r.uDate.stDate.eMonth>x.getMonth()+1&&(H=r.uDate.stDate.eMonth),r.uDate.stDate.eMonth>B.getMonth()+1&&(H=B.getMonth()+1),C.setMonth(r.uDate.stDate.eMonth-1));for(let e=w;e<=D;e++){r.uDate.stDate.nYear===t.BA.BaDate.YearUnspecified&&C.setFullYear(e),b=e===D?B.getMonth()+1:12;for(let a=H;a<=b;a++){if(r.uDate.stDate.eMonth===t.BA.Month.Unspecified&&C.setMonth(a-1),r.uDate.stDate.nDay!==t.BA.Day.Unspecified){if(C.setDate(r.uDate.stDate.nDay),C.getTime()>=x.getTime()&&C.getTime()<=B.getTime())E.push(r),S=!0;else if(r.uDate.stDate.eMonth!==t.BA.Month.Unspecified)break}else if(r.uDate.stDate.eDayOfWeek!==t.BA.Weekday.Unspecified){y=t.Helper.Date.getWeeksOfMonth(C);for(let e=1;e<=y;e++)if(c=this.__getDayOfDow(r.uDate.stDate.eDayOfWeek,e,C),0!==c){if(C.setDate(c),C.getTime()>=x.getTime()&&C.getTime()<=B.getTime()){E.push(r),S=!0;break}if(C.getTime()>B.getTime()){S=!0;break}}}else{m=t.Helper.Date.getMaxDaysOfMonth(C);for(let e=1;e<=m;e++){if(C.setDate(e),C.getTime()>=x.getTime()&&C.getTime()<=B.getTime()){E.push(r),S=!0;break}if(C.getTime()>B.getTime()){S=!0;break}}}S&&(e=D+1,a=b+1)}H=1}}break;case t.BA.DateValChoice.eDateRange:c=0,u=0,g=0,c=r.uDate.stDateRange.stDateFrom.nDay!==t.BA.Day.Unspecified?r.uDate.stDateRange.stDateFrom.nDay:x.getDate(),u=r.uDate.stDateRange.stDateFrom.eMonth!==t.BA.Month.Unspecified?r.uDate.stDateRange.stDateFrom.eMonth-1:x.getMonth(),g=r.uDate.stDateRange.stDateFrom.nYear!==t.BA.BaDate.YearUnspecified?s.createYearFromBa(r.uDate.stDateRange.stDateFrom.nYear):x.getFullYear(),k=new Date(g,u,c,0,0,0),c=r.uDate.stDateRange.stDateTo.nDay!==t.BA.Day.Unspecified?r.uDate.stDateRange.stDateTo.nDay:B.getDate(),u=r.uDate.stDateRange.stDateTo.eMonth!==t.BA.Month.Unspecified?r.uDate.stDateRange.stDateTo.eMonth-1:B.getMonth(),g=r.uDate.stDateRange.stDateTo.nYear!==t.BA.BaDate.YearUnspecified?s.createYearFromBa(r.uDate.stDateRange.stDateTo.nYear):B.getFullYear(),A=new Date(g,u,c,23,59,59),k.getTime()<=B.getTime()&&A.getTime()>=x.getTime()&&E.push(r);break;case t.BA.DateValChoice.eWeekNDay:p=0,v=0,y=0,f=0,k.setFullYear(x.getFullYear()),A.setFullYear(x.getFullYear()),r.uDate.stWeekNDay.eMonth===t.BA.Month.Unspecified?(k.setMonth(x.getMonth()),A.setMonth(x.getMonth())):(k.setMonth(r.uDate.stWeekNDay.eMonth-1),A.setMonth(r.uDate.stWeekNDay.eMonth-1)),H=x.getMonth(),T=x.getMonth(),b=B.getMonth(),H>b&&(H=b,b=T-b);for(let e=H;e<=b;e++){k.setDate(1),A.setDate(1),p=0,y=t.Helper.Date.getWeeksOfMonth(k),f=t.Helper.Date.adjustDayOfWeek(k.getDay());for(let a=1;a<=y;a++){if(1===a)if(r.uDate.stWeekNDay.eWeekday!==t.BA.Weekday.Unspecified){if(r.uDate.stWeekNDay.eWeekday<f){p=t.Helper.Date.WeekdaysMax-t.Helper.Date.adjustDayOfWeek(k.getDay())+r.uDate.stWeekNDay.eWeekday+1,v=t.Helper.Date.WeekdaysMax-t.Helper.Date.adjustDayOfWeek(k.getDay())+r.uDate.stWeekNDay.eWeekday+1;continue}p=r.uDate.stWeekNDay.eWeekday-f+1,v=r.uDate.stWeekNDay.eWeekday-f+1}else p=1,v=p+(t.Helper.Date.WeekdaysMax-f);if(k.setDate(p),A.setDate(v),k.getTime()>=x.getTime()&&k.getTime()<=B.getTime()&&A.getTime()>=x.getTime()&&A.getTime()<=B.getTime()||k.getTime()<x.getTime()&&A.getTime()>=x.getTime()&&A.getTime()<=B.getTime()||k.getTime()>=x.getTime()&&k.getTime()<=B.getTime()&&A.getTime()>B.getTime()){if(r.uDate.stWeekNDay.eWeekOfMonth===t.BA.Week.Unspecified){E.push(r),e=b+1;break}if(a===r.uDate.stWeekNDay.eWeekOfMonth){E.push(r),e=b+1;break}}r.uDate.stWeekNDay.eWeekday!==t.BA.Weekday.Unspecified?(p+=t.Helper.Date.WeekdaysMax,v+=t.Helper.Date.WeekdaysMax,p>t.Helper.Date.getMaxDaysOfMonth(k)&&(a=y+1)):1===a?(p=v+1,v=p+(t.Helper.Date.WeekdaysMax-1)):(p+=t.Helper.Date.WeekdaysMax,p>t.Helper.Date.getMaxDaysOfMonth(k)&&(p=t.Helper.Date.getMaxDaysOfMonth(k)),v+=t.Helper.Date.WeekdaysMax,v>t.Helper.Date.getMaxDaysOfMonth(k)&&(v=t.Helper.Date.getMaxDaysOfMonth(k)))}if(r.uDate.stWeekNDay.eMonth!==t.BA.Month.Unspecified)break;k.setMonth(e+1),A.setMonth(e+1)}}return E}getSelectedDate(){return new Date(Date.UTC(this.__dateSelected.getFullYear(),this.__dateSelected.getMonth(),this.__dateSelected.getDate()))}hasChanges(){return this.__eventsNewBa.length+this.__eventsChangedBa.length+this.__eventsChangedBaRef.length>0}writeToPlc(){if(null==this.baObjectHandler.baObject)return;let e=this.getSchedExceptionEntries(i.CalendarEventSource.BA);null!=e&&e.length>0&&this.baObjectHandler.baObject.tryWriteBaVariableValue(t.BA.BaParameterId.eException,e);let a,n,r=[],o=s.createScheduleEntry();if(null!=this.__schedCalendarList){for(let e=0;e<this.__schedCalendarList.length;e++){if(a=this.__schedCalendarList[e],r.push({stRefCalendarID:{eObjectType:a.stRefCalendarID.eObjectType,nInstanceID:a.stRefCalendarID.nInstanceID},aEntry:[]}),0!==r[e].stRefCalendarID.nInstanceID)for(let t=0;t<this.__events.length;t++)if(n=this.__events[t],n.calInstId===r[e].stRefCalendarID.nInstanceID){r[e].aEntry=n.data;break}for(let t=0;t<this.__maxExcsLastEntryPLcCal-r[e].aEntry.length;t++)r[e].aEntry.push(o)}setTimeout(()=>{null!=this.baObjectHandler.baObject&&this.baObjectHandler.baObject.tryWriteBaVariableValue(t.BA.BaParameterId.eCalendar,r)},500)}}resetChanges(){this.__resetChanges(),this.__combineEvents(),this.__updateCalendarWrappers(),this.__onEventsChanged()}setDisplayMode(e){let t=null;return this.__attrHandler.checkAttribute(e,"displayMode",{validator:"number"})&&e in i.CalendarDisplayMode&&(t=e),null!==t&&(this.__attrHandler.displayMode=t,this.__displayMode=t,this.__processDisplayMode()),this}getDisplayMode(){return this.__displayMode}setDisplayView(e){let t=null;return this.__attrHandler.checkAttribute(e,"displayView",{validator:"number"})&&e in i.CalendarDisplayView&&(t=e),null!==t&&(this.__attrHandler.displayView=t,this.__displayView=t,this.__processDisplayView()),this}getDisplayView(){return this.__displayView}setVisibilityMenu(e){return this.__attrHandler.checkAttribute(e,"visibilityMenu",{validator:"boolean"})?(this.__attrHandler.visibilityMenu=e,this.__visibilityMenu=e,this.__updateLegendIcons(),this.__displayMode===i.CalendarDisplayMode.DatePicker||this.__updateMenuVisibility(),this):this}getVisibilityMenu(){return this.__visibilityMenu}}a.Calendar=i;class n{constructor(e,i){this.__maxTabs=5,this.__indexDowEvery=7,this.__indexWeekEvery=5,this.__indexMonthEvery=12,this.__element=$("<div>").addClass("event-dialog"),this.logger=new t.Logger({name:"CalendarEventDialog"}),this.__dfStatic=[],this.__strMonthLong=[],this.__strDaysLong=[],this.__strOrdinalText=[],this.__strEveryWeekday="",this.__strEveryMonth="",this.__strEvery="",this.__evt=null,this.__dateCurrent=null,this.__tabWindow=new a.TabWindow(e+"-tab-window",null,i),this.__tabWindow.setTabPosition(t.Position.top),this.__htmlTabWindow=this.__tabWindow.getElement()[0],this.__schedDaily=new a.DailySchedule(e+"-daily-schedule",null,i),this.__schedDaily.setOrientation(t.Orientation.horizontal),this.__schedDaily.setSnapPeriode(10),this.__schedDaily.setReadOnly(!1),this.__htmlSchedDaily=this.__schedDaily.getElement()[0],this.__constructTabContent(),this.__createLocalizationWatches(),this.__updateTabContent()}destroy(){this.__dfStatic&&(this.__dfStatic.forEach(e=>e()),this.__dfStatic.length=0),this.__tabWindow&&this.__tabWindow.destroy(),this.__schedDaily&&this.__schedDaily.destroy(),this.__dtf1_1&&this.__dtf1_1.destroy(),this.__dtf1_2&&this.__dtf1_2.destroy(),this.__radio2_1&&this.__radio2_1.destroy(),this.__cb2_1&&this.__cb2_1.destroy(),this.__ipb2_1&&this.__ipb2_1.destroy(),this.__ckb2_1&&this.__ckb2_1.destroy(),this.__radio4_1&&this.__radio4_1.destroy(),this.__radio4_2&&this.__radio4_2.destroy(),this.__cb4_1&&this.__cb4_1.destroy(),this.__cb4_2&&this.__cb4_2.destroy(),this.__cb4_3&&this.__cb4_3.destroy(),this.__cb4_4&&this.__cb4_4.destroy(),this.__ipb4_1&&this.__ipb4_1.destroy(),this.__ipb4_2&&this.__ipb4_2.destroy(),this.__ckb4_1&&this.__ckb4_1.destroy(),this.__ckb4_2&&this.__ckb4_2.destroy(),this.__radio5_1&&this.__radio5_1.destroy(),this.__radio5_2&&this.__radio5_2.destroy(),this.__cb5_1&&this.__cb5_1.destroy(),this.__cb5_2&&this.__cb5_2.destroy(),this.__cb5_3&&this.__cb5_3.destroy(),this.__cb5_4&&this.__cb5_4.destroy(),this.__cb5_5&&this.__cb5_5.destroy(),this.__cb5_6&&this.__cb5_6.destroy(),this.__ipb5_1&&this.__ipb5_1.destroy(),this.__ckb5_1&&this.__ckb5_1.destroy()}__constructTabContent(){var e,i,n,s,r,o,l,d,_,h,c,u,g,p;let v,m;this.__dfStatic&&(this.__dfStatic.forEach(e=>e()),this.__dfStatic.length=0),this.__tabWindow.removeAllTabs(),this.__tabs=[],v=[];for(let e=0;e<t.Helper.Date.DaysMax;e++)v.push({text:e+1+".",value:e});for(let b=1;b<=this.__maxTabs;b++)if(3!=b)if(m=this.__tabWindow.getId()+"-tab-"+b,null!=this.__tabWindow.addTab(m))switch(this.__tabs.push(m),b){case 1:null===(i=null===(e=this.__tabWindow)||void 0===e?void 0:e.getTab(this.__tabs[b-1]))||void 0===i||i.textHandler.setText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Regular)),this.__dtf1_1=new a.DateTimeField(m+"-dtf"+b+"-1",null),this.__dtf1_1.setReadOnly(!1),this.__dtf1_1.layoutHandler.setWidth(170,"px"),this.__dtf1_1.layoutHandler.setHeight(25,"px"),this.__dtf1_1.setMode(a.DateTimeField.Mode.date),this.__dtf1_2=new a.DateTimeField(m+"-dtf"+b+"-2",null),this.__dtf1_2.setReadOnly(!1),this.__dtf1_2.layoutHandler.setWidth(170,"px"),this.__dtf1_2.layoutHandler.setHeight(25,"px"),this.__dtf1_2.setMode(a.DateTimeField.Mode.date);break;case 2:null===(s=null===(n=this.__tabWindow)||void 0===n?void 0:n.getTab(this.__tabs[b-1]))||void 0===s||s.textHandler.setText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Daily)),this.__radio2_1=new a.RadioButton(m+"-r"+b+"-1",null),this.__radio2_1.getElement().addClass("eds"),this.__radio2_1.setRadioGroup("g2"),this.__radio2_1.setRadioState(!0),this.__cb2_1=new a.Combobox(m+"-cb"+b+"-1",null),this.__cb2_1.getElement().addClass("eds"),this.__cb2_1.setReadOnly(!1),this.__cb2_1.layoutHandler.setWidth(105,"px"),this.__cb2_1.layoutHandler.setHeight(25,"px"),this.__ckb2_1=new a.Checkbox(m+"-ckb"+b+"-1",null),this.__ckb2_1.setReadOnly(!1),this.__ckb2_1.layoutHandler.setWidth(20,"px"),this.__ckb2_1.layoutHandler.setHeight(20,"px"),this.__ckb2_1.setActiveText(""),this.__ckb2_1.setInactiveText(""),this.__div2_1=$("<div>").addClass("evd-text eds t3"),null===(r=this.__dfStatic)||void 0===r||r.push(t.Locale.Localization.watchText(t.Locale.LangKey.OnlyInYear,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div2_1.text(e.text)})),this.__ipb2_1=new a.InputBox(m+"-ipb"+b+"-1",null),this.__ipb2_1.setReadOnly(!1),this.__ipb2_1.layoutHandler.setWidth(55,"px"),this.__ipb2_1.layoutHandler.setHeight(25,"px"),this.__ipb2_1.setMinValue(0),this.__ipb2_1.setDigits(0);break;case 4:null===(l=null===(o=this.__tabWindow)||void 0===o?void 0:o.getTab(this.__tabs[b-1]))||void 0===l||l.textHandler.setText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Monthly)),this.__radio4_1=new a.RadioButton(m+"-r"+b+"-1",null),this.__radio4_1.getElement().addClass("eds"),this.__radio4_1.setRadioGroup("g4"),this.__radio4_1.setRadioState(!0),this.__cb4_1=new a.Combobox(m+"-cb"+b+"-1",null),this.__cb4_1.getElement().addClass("eds"),this.__cb4_1.setReadOnly(!1),this.__cb4_1.layoutHandler.setWidth(120,"px"),this.__cb4_1.layoutHandler.setHeight(25,"px"),this.__cb4_1.setData(v),this.__cb4_2=new a.Combobox(m+"-cb"+b+"-2",null),this.__cb4_2.getElement().addClass("eds3"),this.__cb4_2.setReadOnly(!1),this.__cb4_2.layoutHandler.setWidth(120,"px"),this.__cb4_2.layoutHandler.setHeight(25,"px"),this.__ckb4_1=new a.Checkbox(m+"-ckb"+b+"-1",null),this.__ckb4_1.setReadOnly(!1),this.__ckb4_1.layoutHandler.setWidth(20,"px"),this.__ckb4_1.layoutHandler.setHeight(20,"px"),this.__ckb4_1.setActiveText(""),this.__ckb4_1.setInactiveText(""),this.__div4_1=$("<div>").addClass("evd-text eds t3"),null===(d=this.__dfStatic)||void 0===d||d.push(t.Locale.Localization.watchText(t.Locale.LangKey.OnlyInYear,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div4_1.text(e.text)})),this.__ipb4_1=new a.InputBox(m+"-ipb"+b+"-1",null),this.__ipb4_1.setReadOnly(!1),this.__ipb4_1.layoutHandler.setWidth(55,"px"),this.__ipb4_1.layoutHandler.setHeight(25,"px"),this.__ipb4_1.setMinValue(0),this.__ipb4_1.setDigits(0),this.__radio4_2=new a.RadioButton(m+"-r"+b+"-2",null),this.__radio4_2.getElement().addClass("eds"),this.__radio4_2.setRadioGroup("g4"),this.__cb4_3=new a.Combobox(m+"-cb"+b+"-3",null),this.__cb4_3.getElement().addClass("eds"),this.__cb4_3.setReadOnly(!1),this.__cb4_3.layoutHandler.setWidth(120,"px"),this.__cb4_3.layoutHandler.setHeight(25,"px"),this.__cb4_4=new a.Combobox(m+"-cb"+b+"-4",null),this.__cb4_4.getElement().addClass("eds"),this.__cb4_4.setReadOnly(!1),this.__cb4_4.layoutHandler.setWidth(120,"px"),this.__cb4_4.layoutHandler.setHeight(25,"px"),this.__div4_2=$("<div>").addClass("evd-text eds t2"),null===(_=this.__dfStatic)||void 0===_||_.push(t.Locale.Localization.watchText(t.Locale.LangKey.Week,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div4_2.text(e.text)})),this.__ckb4_2=new a.Checkbox(m+"-ckb"+b+"-2",null),this.__ckb4_2.setReadOnly(!1),this.__ckb4_2.layoutHandler.setWidth(20,"px"),this.__ckb4_2.layoutHandler.setHeight(20,"px"),this.__ckb4_2.setActiveText(""),this.__ckb4_2.setInactiveText(""),this.__div4_3=$("<div>").addClass("evd-text eds t3"),null===(h=this.__dfStatic)||void 0===h||h.push(t.Locale.Localization.watchText(t.Locale.LangKey.OnlyInYear,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div4_3.text(e.text)})),this.__ipb4_2=new a.InputBox(m+"-ipb"+b+"-2",null),this.__ipb4_2.setReadOnly(!1),this.__ipb4_2.layoutHandler.setWidth(55,"px"),this.__ipb4_2.layoutHandler.setHeight(25,"px"),this.__ipb4_2.setMinValue(0),this.__ipb4_2.setDigits(0);break;case 5:null===(u=null===(c=this.__tabWindow)||void 0===c?void 0:c.getTab(this.__tabs[b-1]))||void 0===u||u.textHandler.setText(t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Annual)),this.__radio5_1=new a.RadioButton(m+"-r"+b+"-1",null),this.__radio5_1.getElement().addClass("eds"),this.__radio5_1.setRadioGroup("g5"),this.__radio5_1.setRadioState(!0),this.__cb5_1=new a.Combobox(m+"-cb"+b+"-1",null),this.__cb5_1.getElement().addClass("eds"),this.__cb5_1.setReadOnly(!1),this.__cb5_1.layoutHandler.setWidth(120,"px"),this.__cb5_1.layoutHandler.setHeight(25,"px"),this.__cb5_1.setData(v),this.__cb5_2=new a.Combobox(m+"-cb"+b+"-2",null),this.__cb5_2.getElement().addClass("eds2"),this.__cb5_2.setReadOnly(!1),this.__cb5_2.layoutHandler.setWidth(105,"px"),this.__cb5_2.layoutHandler.setHeight(25,"px"),this.__cb5_3=new a.Combobox(m+"-cb"+b+"-3",null),this.__cb5_3.getElement().addClass("eds"),this.__cb5_3.setReadOnly(!1),this.__cb5_3.layoutHandler.setWidth(120,"px"),this.__cb5_3.layoutHandler.setHeight(25,"px"),this.__radio5_2=new a.RadioButton(m+"-r"+b+"-2",null),this.__radio5_2.getElement().addClass("eds"),this.__radio5_2.setRadioGroup("g5"),this.__cb5_4=new a.Combobox(m+"-cb"+b+"-4",null),this.__cb5_4.getElement().addClass("eds"),this.__cb5_4.setReadOnly(!1),this.__cb5_4.layoutHandler.setWidth(120,"px"),this.__cb5_4.layoutHandler.setHeight(25,"px"),this.__cb5_5=new a.Combobox(m+"-cb"+b+"-5",null),this.__cb5_5.getElement().addClass("eds"),this.__cb5_5.setReadOnly(!1),this.__cb5_5.layoutHandler.setWidth(105,"px"),this.__cb5_5.layoutHandler.setHeight(25,"px"),this.__div5_1=$("<div>").addClass("evd-text eds t2"),null===(g=this.__dfStatic)||void 0===g||g.push(t.Locale.Localization.watchText(t.Locale.LangKey.WeekOf,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div5_1.text(e.text)})),this.__cb5_6=new a.Combobox(m+"-cb"+b+"-6",null),this.__cb5_6.getElement().addClass("eds"),this.__cb5_6.setReadOnly(!1),this.__cb5_6.layoutHandler.setWidth(120,"px"),this.__cb5_6.layoutHandler.setHeight(25,"px"),this.__ckb5_1=new a.Checkbox(m+"-ckb"+b+"-1",null),this.__ckb5_1.setReadOnly(!1),this.__ckb5_1.layoutHandler.setWidth(20,"px"),this.__ckb5_1.layoutHandler.setHeight(20,"px"),this.__ckb5_1.setActiveText(""),this.__ckb5_1.setInactiveText(""),this.__div5_2=$("<div>").addClass("evd-text eds t3"),null===(p=this.__dfStatic)||void 0===p||p.push(t.Locale.Localization.watchText(t.Locale.LangKey.OnlyInYear,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&this.__div5_2.text(e.text)})),this.__ipb5_1=new a.InputBox(m+"-ipb"+b+"-1",null),this.__ipb5_1.setReadOnly(!1),this.__ipb5_1.layoutHandler.setWidth(55,"px"),this.__ipb5_1.layoutHandler.setHeight(25,"px"),this.__ipb5_1.setMinValue(0),this.__ipb5_1.setDigits(0)}else this.logger.log(t.Logger.Severity.warn,`__constructTabContent(): Could not create tab with id ${m}.`);else this.__tabs.push("empty")}__createDialogValues(){return{selection:-1,dateStart:s.createDatePast(),dateEnd:s.createDateFuture(),yearSet:!1,yearValue:s.YearPast,combo1:-1,combo2:-1,combo3:-1}}__createLocalizationWatches(){var e,a,i,n,s,r;for(let a=0;a<t.Locale.MonthsLongLangKey.length;a++)null===(e=this.__dfStatic)||void 0===e||e.push(t.Locale.Localization.watchText(t.Locale.MonthsLongLangKey[a],e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strMonthLong[a]=e.text),this.__updateLocalization()}));for(let e=0;e<t.Locale.WeekDaysLongLangKey.length;e++)null===(a=this.__dfStatic)||void 0===a||a.push(t.Locale.Localization.watchText(t.Locale.WeekDaysLongLangKey[e],a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__strDaysLong[e]=a.text),this.__updateLocalization()}));for(let e=0;e<t.Locale.OrdinalTextLangKey.length;e++)null===(i=this.__dfStatic)||void 0===i||i.push(t.Locale.Localization.watchText(t.Locale.OrdinalTextLangKey[e],a=>{this.logger.checkServerResult(t.Logger.Severity.warn,a)&&null!=a.text&&(this.__strOrdinalText[e]=a.text),this.__updateLocalization()}));null===(n=this.__dfStatic)||void 0===n||n.push(t.Locale.Localization.watchText(t.Locale.LangKey.EveryWeekday,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strEveryWeekday=e.text),this.__updateLocalization()})),null===(s=this.__dfStatic)||void 0===s||s.push(t.Locale.Localization.watchText(t.Locale.LangKey.EveryMonth,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strEveryMonth=e.text),this.__updateLocalization()})),null===(r=this.__dfStatic)||void 0===r||r.push(t.Locale.Localization.watchText(t.Locale.LangKey.Every,e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.text&&(this.__strEvery=e.text),this.__updateLocalization()}))}__convertDowToComboboxIndex(e,t){return e===s.DowEvery?this.__indexDowEvery:t-1}__convertWeekToComboboxIndex(e){return e===s.WeekEvery?this.__indexWeekEvery:e-1}__updateLocalization(){let e=[],t=[],a=[],i=[];for(let t=0;t<this.__strMonthLong.length;t++)e.push({text:this.__strMonthLong[t],value:t}),a.push({text:this.__strMonthLong[t],value:t});e.push({text:this.__strEveryMonth,value:this.__strMonthLong.length}),this.__cb2_1.setData(e),this.__cb5_2.setData(a),this.__cb5_6.setData(a),t.length=0,a.length=0;for(let e=0;e<this.__strDaysLong.length;e++)t.push({text:this.__strDaysLong[e],value:e}),a.push({text:this.__strDaysLong[e],value:e});t.push({text:this.__strEveryWeekday,value:this.__strDaysLong.length}),this.__cb4_2.setData(t),this.__cb4_3.setData(t),a.push({text:this.__strEveryWeekday,value:this.__strDaysLong.length}),this.__cb5_3.setData(a),this.__cb5_4.setData(a);for(let e=0;e<this.__strOrdinalText.length;e++)i.push({text:this.__strOrdinalText[e],value:e});i.push({text:this.__strEvery,value:this.__strOrdinalText.length}),this.__cb4_4.setData(i),this.__cb5_5.setData(i)}__updateTabContent(){let e,t,a;for(let i=0;i<this.__maxTabs;i++)if(e=this.__tabWindow.getTab(this.__tabs[i]),e)switch(t=$("<div>").addClass("wrapper"),i+1){case 1:a=$("<div>"),a.append(this.__dtf1_1.getElement()),t.append(a),a=$("<div>"),a.append(this.__dtf1_2.getElement()),t.append(a),e.setContent(t);break;case 2:a=$("<div>"),a.append(this.__radio2_1.getElement()),a.append(this.__cb2_1.getElement()),a.append(this.__ckb2_1.getElement()),a.append(this.__div2_1[0]),a.append(this.__ipb2_1.getElement()),t.append(a),e.setContent(t);break;case 4:a=$("<div>"),a.append(this.__radio4_1.getElement()),a.append(this.__cb4_1.getElement()),a.append(this.__cb4_2.getElement()),a.append(this.__ckb4_1.getElement()),a.append(this.__div4_1[0]),a.append(this.__ipb4_1.getElement()),t.append(a),a=$("<div>"),a.append(this.__radio4_2.getElement()),a.append(this.__cb4_3.getElement()),a.append(this.__cb4_4.getElement()),a.append(this.__div4_2[0]),a.append(this.__ckb4_2.getElement()),a.append(this.__div4_3[0]),a.append(this.__ipb4_2.getElement()),t.append(a),e.setContent(t);break;case 5:a=$("<div>"),a.append(this.__radio5_1.getElement()),a.append(this.__cb5_1.getElement()),a.append(this.__cb5_2.getElement()),a.append(this.__cb5_3.getElement()),t.append(a),a=$("<div>"),a.append(this.__radio5_2.getElement()),a.append(this.__cb5_4.getElement()),a.append(this.__cb5_5.getElement()),a.append(this.__div5_1[0]),a.append(this.__cb5_6.getElement()),a.append(this.__ckb5_1.getElement()),a.append(this.__div5_2[0]),a.append(this.__ipb5_1.getElement()),t.append(a),e.setContent(t)}}__resetEventDialog(){this.__tabWindow.selectTab(this.__tabs[0]),this.__dateCurrent?(this.__dtf1_1.setDate(new Date(this.__dateCurrent.getTime())),this.__dtf1_2.setDate(new Date(this.__dateCurrent.getTime())),this.__dateCurrent=null):(this.__dtf1_1.setDate(new Date),this.__dtf1_2.setDate(new Date)),this.__radio2_1.setRadioState(!0),this.__cb2_1.setSelectedValue(0),this.__ckb2_1.setState(!1),this.__ipb2_1.setValue(null),this.__radio4_1.setRadioState(!0),this.__cb4_1.setSelectedValue(0),this.__cb4_2.setSelectedValue(0),this.__ckb4_1.setState(!1),this.__ipb4_1.setValue(null),this.__radio4_2.getRadioState(),this.__cb4_3.setSelectedValue(0),this.__cb4_4.setSelectedValue(0),this.__ckb4_2.setState(!1),this.__ipb4_2.setValue(null),this.__radio5_1.setRadioState(!0),this.__cb5_1.setSelectedValue(0),this.__cb5_2.setSelectedValue(0),this.__cb5_3.setSelectedValue(0),this.__cb5_4.setSelectedValue(0),this.__cb5_5.setSelectedValue(0),this.__cb5_6.setSelectedValue(0),this.__ckb5_1.setState(!1),this.__ipb5_1.setValue(null),this.__schedDaily.setData(null);for(let e=0;e<this.__element[0].children.length;e++)switch(this.__element[0].children[e].id){case this.__tabWindow.getId():this.__element[0].removeChild(this.__htmlTabWindow);break;case this.__schedDaily.getId():this.__element[0].removeChild(this.__htmlSchedDaily)}this.__element[0].appendChild(this.__htmlTabWindow),this.__element[0].appendChild(this.__htmlSchedDaily)}setAttributes(e){return this.__tabWindow.setAttributes(e),this.__schedDaily.setAttributes(e),this}getAttributes(){return Object.assign(Object.assign({},this.__tabWindow.getAttributes()),this.__schedDaily.getAttributes())}setEvent(e){if(this.__resetEventDialog(),null==e)return void(this.__evt=null);e.source===i.CalendarEventSource.BARef&&this.__element[0].removeChild(this.__htmlTabWindow),this.__evt=s.copyCalendarEvent(e);let t,a=0,n=this.__evt,r=this.__createDialogValues();if(null!=n){switch(this.__schedDaily.setData(this.__evt.data),n.repitition.Type){case i.CalendarEventRepetition.Regular:r.dateStart=n.start,r.dateEnd=n.end,a=1;break;case i.CalendarEventRepetition.Daily:t=s.createDows(n.repitition.Data.dow),r.selection=1,r.combo1=this.__indexMonthEvery,a=2;break;case i.CalendarEventRepetition.Weekly:break;case i.CalendarEventRepetition.Monthly:t=s.createDows(n.repitition.Data.dow),n.start.getDate()===n.end.getDate()?(r.selection=1,r.combo1=n.start.getDate()-1,r.combo2=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),a=4):n.repitition.Data.dow===s.DowEvery&&n.repitition.Data.dowWeek===s.WeekEvery?(r.selection=1,r.combo1=this.__indexMonthEvery,a=2):(r.selection=2,r.combo1=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),r.combo2=this.__convertWeekToComboboxIndex(n.repitition.Data.dowWeek),a=4);break;case i.CalendarEventRepetition.MonthlyOnce:n.start.getDate()===n.end.getDate()?(t=s.createDows(n.repitition.Data.dow),r.selection=1,r.combo1=n.start.getDate()-1,r.combo2=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),r.yearSet=!0,r.yearValue=n.start.getFullYear(),a=4):n.repitition.Data.dow===s.DowEvery&&n.repitition.Data.dowWeek===s.WeekEvery?(r.selection=1,r.combo1=this.__indexMonthEvery,r.combo2=this.__indexDowEvery,r.yearSet=!0,r.yearValue=n.start.getFullYear(),a=2):(t=s.createDows(n.repitition.Data.dow),r.selection=2,r.combo1=t[0]-1,r.combo2=this.__convertWeekToComboboxIndex(n.repitition.Data.dowWeek),r.yearSet=!0,r.yearValue=n.start.getFullYear(),a=4);break;case i.CalendarEventRepetition.Yearly:n.repitition.Data.dow===s.DowEvery&&n.repitition.Data.dowWeek===s.WeekEvery?(t=s.createDows(n.repitition.Data.dow),r.selection=1,r.combo1=n.start.getMonth(),a=2):n.start.getDate()===n.end.getDate()?(t=s.createDows(n.repitition.Data.dow),r.selection=1,r.combo1=n.start.getDate()-1,r.combo2=n.start.getMonth(),r.combo3=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),a=5):(t=s.createDows(n.repitition.Data.dow),r.selection=2,r.combo1=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),r.combo2=this.__convertWeekToComboboxIndex(n.repitition.Data.dowWeek),r.combo3=n.start.getMonth(),a=5);break;case i.CalendarEventRepetition.YearlyOnce:t=s.createDows(n.repitition.Data.dow),n.repitition.Data.dow===s.DowEvery&&n.repitition.Data.dowWeek===s.WeekEvery?(r.selection=1,r.combo1=n.start.getMonth(),r.combo2=this.__indexDowEvery,r.yearSet=!0,r.yearValue=n.start.getFullYear(),a=2):(r.selection=2,r.combo1=this.__convertDowToComboboxIndex(n.repitition.Data.dow,t[0]),r.combo2=this.__convertWeekToComboboxIndex(n.repitition.Data.dowWeek),r.combo3=n.start.getMonth(),r.yearSet=!0,r.yearValue=r.yearValue=n.start.getFullYear(),a=5)}switch(a>0&&a<=5&&this.__tabWindow.selectTab(this.__tabs[a-1]),a){case 1:this.__dtf1_1.setDate(r.dateStart),this.__dtf1_2.setDate(r.dateEnd);break;case 2:this.__radio2_1.setRadioState(!0),this.__cb2_1.setSelectedValue(r.combo1),r.yearSet&&(this.__ckb2_1.setState(!0),this.__ipb2_1.setValue(r.yearValue));break;case 4:switch(r.selection){case 1:this.__radio4_1.setRadioState(!0),this.__cb4_1.setSelectedValue(r.combo1),this.__cb4_2.setSelectedValue(r.combo2),r.yearSet&&(this.__ckb4_1.setState(!0),this.__ipb4_1.setValue(r.yearValue));break;case 2:this.__radio4_2.setRadioState(!0),this.__cb4_3.setSelectedValue(r.combo1),this.__cb4_4.setSelectedValue(r.combo2),r.yearSet&&(this.__ckb4_2.setState(!0),this.__ipb4_2.setValue(r.yearValue))}break;case 5:switch(r.selection){case 1:this.__radio5_1.setRadioState(!0),this.__cb5_1.setSelectedValue(r.combo1),this.__cb5_2.setSelectedValue(r.combo2),this.__cb5_3.setSelectedValue(r.combo3);break;case 2:this.__radio5_2.setRadioState(!0),this.__cb5_4.setSelectedValue(r.combo1),this.__cb5_5.setSelectedValue(r.combo2),this.__cb5_6.setSelectedValue(r.combo3),r.yearSet&&(this.__ckb5_1.setState(!0),this.__ipb5_1.setValue(r.yearValue))}}}}getEvent(){let e;null!=this.__evt?(e=this.__evt,e.repitition.Data.dow=0,e.repitition.Data.dowWeek=0):e=s.createEvent();let a=this.__tabWindow.getSelectedTab();if(null==a)return null;let n,r,o,l,d,_,h,c=a.getId(),u=parseInt(c.slice(c.length-1));if(null==u)return this.logger.log(t.Logger.Severity.error,"getEvent(): Invalid tab id of NULL."),null;e.data=[],n=this.__schedDaily.getData(),null==n&&(n=[]);for(let a=0;a<n.length;a++)n[a].eState!=t.BA.SchedEntryState.eUndefined&&e.data.push(n[a]);switch(u){case 1:if(r=this.__dtf1_1.getDate(),null==r){e=null,this.logger.log(t.Logger.Severity.warn,"getEvent(): Invalid date for tab 1.");break}e.start=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0),r=this.__dtf1_2.getDate(),e.end=null==r?new Date(e.start.getTime()):new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,0),e.repitition.Type=i.CalendarEventRepetition.Regular;break;case 2:if(o=this.__cb2_1.getSelectedValue(),null==o){e=null;break}if(_=this.__ckb2_1.getState(),h=this.__ipb2_1.getValue(),e.start.setDate(s.DayPast),e.end.setDate(s.DayFuture),e.repitition.Data.dow=s.DowEvery,e.repitition.Data.dowWeek=s.WeekEvery,o===this.__indexMonthEvery)if(_){if(null==h){e=null;break}e.start.setFullYear(h),e.start.setMonth(0),e.end.setFullYear(h),e.end.setMonth(0),e.repitition.Type=i.CalendarEventRepetition.MonthlyOnce}else e.start.setFullYear(s.YearPast),e.start.setMonth(0),e.end.setFullYear(s.YearFuture),e.end.setMonth(0),e.repitition.Type=i.CalendarEventRepetition.Daily;else if(_){if(null==h){e=null;break}e.start.setFullYear(h),e.start.setMonth(o),e.end.setFullYear(h),e.end.setMonth(o),e.repitition.Type=i.CalendarEventRepetition.YearlyOnce}else e.start.setFullYear(s.YearPast),e.start.setMonth(o),e.end.setFullYear(s.YearFuture),e.end.setMonth(o),e.repitition.Type=i.CalendarEventRepetition.Yearly;break;case 3:this.logger.log(t.Logger.Severity.warn,"getEvent(): Tab id 3 not implemented yet.");break;case 4:if(e.start.setMonth(0),e.end.setMonth(0),this.__radio4_1.getRadioState()){if(o=this.__cb4_1.getSelectedValue(),l=this.__cb4_2.getSelectedValue(),null==o||null==l){e=null;break}if(_=this.__ckb4_1.getState(),h=this.__ipb4_1.getValue(),_){if(null==h){e=null;break}e.start.setFullYear(h),e.end.setFullYear(h),e.repitition.Type=i.CalendarEventRepetition.MonthlyOnce}else e.start.setFullYear(s.YearPast),e.end.setFullYear(s.YearFuture),e.repitition.Type=i.CalendarEventRepetition.Monthly;e.start.setDate(o+1),e.end.setDate(o+1),e.repitition.Data.dow=l===this.__indexDowEvery?s.DowEvery:Math.pow(2,l)}else{if(!this.__radio4_2.getRadioState()){e=null;break}if(o=this.__cb4_3.getSelectedValue(),l=this.__cb4_4.getSelectedValue(),null==o||null==l){e=null;break}if(e.start.setDate(s.DayPast),e.end.setDate(s.DayFuture),_=this.__ckb4_2.getState(),h=this.__ipb4_2.getValue(),_){if(null==h){e=null;break}e.start.setFullYear(h),e.end.setFullYear(h),e.repitition.Type=i.CalendarEventRepetition.MonthlyOnce}else e.start.setFullYear(s.YearPast),e.end.setFullYear(s.YearFuture),e.repitition.Type=i.CalendarEventRepetition.Monthly;e.repitition.Data.dow=o===this.__indexDowEvery?s.DowEvery:Math.pow(2,o),e.repitition.Data.dowWeek=l===this.__indexWeekEvery?s.WeekEvery:l+1}break;case 5:if(e.start.setDate(s.DayPast),e.end.setDate(s.DayFuture),this.__radio5_1.getRadioState()){if(o=this.__cb5_1.getSelectedValue(),l=this.__cb5_2.getSelectedValue(),d=this.__cb5_3.getSelectedValue(),null==o||null==l||null==d){e=null;break}e.start.setFullYear(s.YearPast),e.start.setMonth(l),e.start.setDate(o+1),e.end.setFullYear(s.YearFuture),e.end.setMonth(l),e.end.setDate(o+1),e.repitition.Data.dow=d===this.__indexDowEvery?s.DowEvery:Math.pow(2,d),e.repitition.Type=i.CalendarEventRepetition.Yearly}else if(this.__radio5_2.getRadioState()){if(o=this.__cb5_4.getSelectedValue(),l=this.__cb5_5.getSelectedValue(),d=this.__cb5_6.getSelectedValue(),null==o||null==l||null==d){e=null;break}if(_=this.__ckb5_1.getState(),h=this.__ipb5_1.getValue(),_){if(null==h){e=null;break}e.start.setFullYear(h),e.end.setFullYear(h),e.repitition.Type=i.CalendarEventRepetition.YearlyOnce}else e.start.setFullYear(s.YearPast),e.end.setFullYear(s.YearFuture),e.repitition.Type=i.CalendarEventRepetition.Yearly;e.start.setMonth(d),e.end.setMonth(d),e.repitition.Data.dow=o===this.__indexDowEvery?s.DowEvery:Math.pow(2,o),e.repitition.Data.dowWeek=l===this.__indexWeekEvery?s.WeekEvery:l+1}break;default:e=null}return e}setStateColors(e){this.__schedDaily.setStateColors(e)}getStateColors(){return this.__schedDaily.getStateColors()}setSnapPeriode(e){this.__schedDaily.setSnapPeriode(e)}getSnapPeriode(){return this.__schedDaily.getSnapPeriode()}setCurrentDate(e){this.__dateCurrent=null,null!=e&&t.Helper.Date.isDate(e)&&(this.__dateCurrent=new Date(e.getTime()),this.__dateCurrent.setDate(1))}getElement(){return this.__element}setDataType(e){this.__schedDaily.setDataType(e)}setStateTexts(e){this.__schedDaily.setStateTexts(e)}setActiveText(e){this.__schedDaily.setActiveText(e)}setInactiveText(e){this.__schedDaily.setInactiveText(e)}setUnit(e){this.__schedDaily.setUnit(e)}}class s{static createEvent(){return{id:-1,source:i.CalendarEventSource.None,calInstId:-1,repitition:s.createRepitition(),start:new Date,end:new Date,title:"",desc:"",data:null}}static createRepitition(){return{Type:i.CalendarEventRepetition.None,Data:{dow:0,dowNth:0,dowWeek:0,workday:0}}}static createEventSelection(e){switch(e){case i.CalendarSelectionType.Date:return{Type:i.CalendarSelectionType.Date,Data:new Date};case i.CalendarSelectionType.Event:return{Type:i.CalendarSelectionType.Event,Data:s.createEvent()}}return null}static createScheduleException(){return{aEntry:[],eType:t.BA.DateValChoice.Invalid,uDate:{stDate:s.createBaDate(),stDateRange:{stDateFrom:s.createBaDate(),stDateTo:s.createBaDate()},stWeekNDay:{eMonth:t.BA.Month.Unspecified,eWeekOfMonth:t.BA.Week.Unspecified,eWeekday:t.BA.Weekday.Unspecified}}}}static createBaDate(){return{nYear:t.BA.BaDate.YearUnspecified,eMonth:t.BA.Month.Unspecified,nDay:t.BA.Day.Unspecified,eDayOfWeek:t.BA.Weekday.Unspecified}}static createScheduleEntry(){return{eState:t.BA.SchedEntryState.eUndefined,stTime:{nHour:255,nMinute:255,nSecond:255},uValue:{bVal:!1,rVal:0,udiVal:0}}}static createDatePast(e=0,t=s.DayPast){return new Date(s.YearPast,e,t)}static createDateFuture(e=0,t=s.DayFuture){return new Date(s.YearFuture,e,t)}static createDateFromBa(e,t,a){return new Date(s.createYearFromBa(e),t,a)}static createYearFromBa(e){return e+t.BA.BaDate.YearOffset}static createYearForBa(e){return e-t.BA.BaDate.YearOffset}static createDows(e){if(e<0||e>s.DowEvery)return console.warn("createDows(): Invalid dow value "+e),[];let a=[],i=0;for(let n=t.Helper.Date.WeekdaysMax-1;n>=0;n--)i=Math.pow(2,n),i<=e&&(e-=i,a.push(n+1));return a.sort((e,t)=>e<t?-1:e>t?1:0),a}static convertBaDowToRepititionDow(e){let a=0;switch(e){case t.BA.Weekday.eMonday:a=1;break;case t.BA.Weekday.eTuesday:a=2;break;case t.BA.Weekday.eWednesday:a=4;break;case t.BA.Weekday.eThursday:a=8;break;case t.BA.Weekday.eFriday:a=16;break;case t.BA.Weekday.eSaturday:a=32;break;case t.BA.Weekday.eSunday:a=64}return a}static copyCalendarEvent(e){let t=JSON.parse(JSON.stringify(e));return t.start=new Date(t.start),t.end=new Date(t.end),t}static isValidDate(e,a,i){if(e<1||e>t.Helper.Date.DaysMax)return!1;if(a<1||a>t.Helper.Date.MonthsMax)return!1;if(i){if(i<0)return!1}else i=s.YearPast;let n=t.Helper.Date.getMaxDaysOfMonth({month:a,year:i});return 0!==n&&!(e>n)}}s.IndexStartBa=1,s.IndexStartBaRef=100,s.DowEvery=127,s.WeekEvery=7,s.DayPast=1,s.DayFuture=20,s.YearPast=1904,s.YearFuture=2204,function(e){let t,a,i,n,s,r;!function(e){e.onEventsChanged="oneventschanged",e.onSelectionChanged="onselectionchanged"}(t=e.CalendarEvent||(e.CalendarEvent={})),function(e){e[e.DatePicker=0]="DatePicker",e[e.EventCalendar=1]="EventCalendar"}(a=e.CalendarDisplayMode||(e.CalendarDisplayMode={})),function(e){e[e.Month=0]="Month",e[e.Year=1]="Year"}(i=e.CalendarDisplayView||(e.CalendarDisplayView={})),function(e){e[e.None=0]="None",e[e.Regular=1]="Regular",e[e.Daily=2]="Daily",e[e.Weekly=3]="Weekly",e[e.Monthly=4]="Monthly",e[e.Yearly=5]="Yearly",e[e.MonthlyOnce=6]="MonthlyOnce",e[e.YearlyOnce=7]="YearlyOnce"}(n=e.CalendarEventRepetition||(e.CalendarEventRepetition={})),function(e){e[e.None=0]="None",e[e.User=1]="User",e[e.BA=2]="BA",e[e.BARef=3]="BARef"}(s=e.CalendarEventSource||(e.CalendarEventSource={})),function(e){e[e.None=0]="None",e[e.Date=1]="Date",e[e.Event=2]="Event"}(r=e.CalendarSelectionType||(e.CalendarSelectionType={}))}(i=a.Calendar||(a.Calendar={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i extends a.TextControl{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.baObjectHandler=new t.BaObjectHandler(this),this.valueHandler=new t.System.ValueHandler(this),this.resizeHandler=new a.ResizeHandler(this),this.__checkbox=$("<input type='checkbox'></input>"),this.__paddingContainer=$("<div>").addClass("padding-container"),this.__stateChangedHandler=e=>this.__onStateChanged(e),this.__labelPressedHandler=e=>this.__onLabelPressed(e),this.__element.addClass("checkbox"),this.__element.append(this.__paddingContainer),void 0===(null==e?void 0:e.activeText)&&this.setActiveText("Active"),void 0===(null==e?void 0:e.inactiveText)&&this.setInactiveText("Inactive"),void 0===(null==e?void 0:e.appearance)&&this.setAppearance(i.Appearance.checkbox),void 0===(null==e?void 0:e.readOnly)&&this.setReadOnly(!0),this.textHandler.setHorizontalAlignment("Left"),this.__updateElements(this.__attrHandler.state)}__attach(){this.__isAttached||(this.__checkbox.on("change",this.__stateChangedHandler),this.__useLabel&&this.__paddingContainer.children(".text-element").on("pointerdown",this.__labelPressedHandler),null==this.__attrHandler.appearance&&this.setAppearance(i.Appearance.checkbox),this.onResized(),super.__attach())}__detach(){this.__isAttached&&(this.__checkbox.off("change",this.__stateChangedHandler),this.__paddingContainer.children(".text-element").off("pointerdown",this.__labelPressedHandler),super.__detach())}destroy(){var e,t;super.destroy(),null===(e=this.__activeTextSymbol)||void 0===e||e.destroy(),null===(t=this.__inactiveTextSymbol)||void 0===t||t.destroy(),this.valueHandler.destroy(),this.resizeHandler.destroy()}onResized(){if(this.__isAttached&&(this.__element.css("--tchmi-ba-checkbox-height",this.__element.outerHeight()+"px"),null!=this.__attrHandler.appearance&&this.__attrHandler.appearance>i.Appearance.checkbox)){let e=this.__paddingContainer.find(".checkbox-container");e[0]&&e.css("--tchmi-ba-checkbox-container-width",e.outerWidth()+"px")}}onValueChanged(e){this.__setStateInternal(null!=e&&e)}__onStateChanged(e){if(e.stopPropagation(),1==this.__attrHandler.readOnly||0==this.__attrHandler.isEnabled||0==this.checkAccess(t.Server.UserManagement.AccessRight.operate))this.__checkbox.prop("checked",this.__attrHandler.state);else{if(this.__setStateInternal(this.__checkbox.prop("checked")),null!=this.__attrHandler.state&&this.valueHandler.processChangedValue(this.__attrHandler.state),null!=this.__attrHandler.stateFeedback&&this.__attrHandler.state!=this.__attrHandler.stateFeedback){let e=()=>{this.__stateFeedbackReady&&this.__stateFeedbackReady(),null!=this.__attrHandler.stateFeedback&&this.__setStateInternal(this.__attrHandler.stateFeedback)};this.__stateFeedbackReady=this.busyHandler.setBusy("Waiting for StateFeedback",{cbOnTimeout:e,optionalOutput:"Hint: Maybe the object is logged by a higher priority?"})}this.eventHandler.raise(i.CheckboxEvents.onUserInteractionFinished)}}__onLabelPressed(e){if((null==e.button||0===e.button)&&!this.__attrHandler.readOnly){let t=()=>{this.__checkbox.prop("checked",!this.__attrHandler.state),this.__onStateChanged(e),this.__element.off("pointerup",t)};this.__element.on("pointerup",t)}}__updateElements(e){this.__checkbox.prop("checked",e),this.__useLabel&&this.__updateLabel(e),e?this.__element.addClass("checked"):this.__element.removeClass("checked"),this.__processCheckedBackgroundColor()}__updateLabel(e){if(null==this.__paddingContainer)return;let t=this.__useLabel,a=this.__paddingContainer.children(".text-element");null==this.__attrHandler.activeText&&null==this.__attrHandler.inactiveText?(this.__useLabel=!1,this.__element.removeClass("use-label"),null!=a[0]&&(a.text(""),a.detach())):(this.__useLabel=!0,this.__element.addClass("use-label"),null==a[0]&&(a=$("<span>").addClass("text-element"),this.__paddingContainer.append(a)),e?a.text(this.__attrHandler.activeText?this.__attrHandler.activeText:""):a.text(this.__attrHandler.inactiveText?this.__attrHandler.inactiveText:"")),t!==this.__useLabel&&(this.eventHandler.raise(i.CheckboxEvents.onUseLabelChanged),this.__useLabel&&this.__isAttached&&a.on("click touchstart",this.__labelPressedHandler))}processBaObject(){this.baObjectHandler.baObject&&this.baObjectHandler.baObject.DataType===t.DataType.boolean&&(this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,e=>{this.setStateFeedback(e)}),this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,e=>{this.setInactiveText(null==e?void 0:e.get(0)),this.setActiveText(null==e?void 0:e.get(1))},!0),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess()))}getUseLabel(){return this.__useLabel}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.state&&this.setState(e.state),void 0!==e.stateFeedback&&this.setStateFeedback(e.stateFeedback),void 0!==e.activeText&&this.setActiveText(e.activeText),void 0!==e.inactiveText&&this.setInactiveText(e.inactiveText),void 0!==e.checkedBackgroundColor&&this.setCheckedBackgroundColor(e.checkedBackgroundColor),void 0!==e.checkmarkColor&&this.setCheckmarkColor(e.checkmarkColor),void 0!==e.appearance&&this.setAppearance(e.appearance),this}getAttributes(){return this.__attrHandler.getRef()}setState(e){return this.__attrHandler.checkAttribute(e,"state",{validator:"boolean"})?(null==e&&(e=!1),null==this.__attrHandler.stateFeedback&&this.__setStateInternal(e),this):this}__setStateInternal(e){e!==this.__attrHandler.state&&(this.__attrHandler.state=e,this.__processState(),this.eventHandler.raise(i.CheckboxEvents.onStateChanged))}__processState(){null!=this.__attrHandler.state&&this.__updateElements(this.__attrHandler.state)}getState(){return this.__attrHandler.state}setStateFeedback(e){return this.__attrHandler.checkAttribute(e,"stateFeedback",{validator:"boolean"})?(this.__attrHandler.stateFeedback=e,null!=this.__attrHandler.stateFeedback&&this.__processStateFeedback(),this.__stateFeedbackReady&&this.__stateFeedbackReady(),this.eventHandler.raise(i.CheckboxEvents.onStateFeedbackChanged),this):this}__processStateFeedback(){null==this.__attrHandler.stateFeedback&&(this.__attrHandler.stateFeedback=!1),this.__setStateInternal(this.__attrHandler.stateFeedback)}getStateFeedback(){return this.__attrHandler.stateFeedback}setActiveText(a){return this.__attrHandler.checkAttribute(a,"activeText",{validator:"string"})?(this.__attrHandler.activeText=a,null!=this.__attrHandler.activeText&&e.Symbol.isSymbolExpression(this.__attrHandler.activeText)?(null!=this.__activeTextSymbol&&this.__activeTextSymbol.destroy(),this.__activeTextSymbol=new e.Symbol(this.__attrHandler.activeText),this.__activeTextSymbol.watch(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.value&&(this.__attrHandler.activeText=e.value,this.__processActiveText())})):this.__processActiveText(),this):this}__processActiveText(){let e=this.__useLabel;null==this.__attrHandler.activeText?(this.__useLabel=!1,this.__element.removeClass("use-label")):(this.__useLabel=!0,this.__element.addClass("use-label")),e!==this.__useLabel&&this.eventHandler.raise(i.CheckboxEvents.onUseLabelChanged),this.__updateLabel(this.__attrHandler.state)}getActiveText(){return this.__attrHandler.activeText}setInactiveText(a){return this.__attrHandler.checkAttribute(a,"inactiveText",{validator:"string"})?(this.__attrHandler.inactiveText=a,null!=this.__attrHandler.inactiveText&&e.Symbol.isSymbolExpression(this.__attrHandler.inactiveText)?(null!=this.__inactiveTextSymbol&&this.__inactiveTextSymbol.destroy(),this.__inactiveTextSymbol=new e.Symbol(this.__attrHandler.inactiveText),this.__inactiveTextSymbol.watch(e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&null!=e.value&&(this.__attrHandler.inactiveText=e.value,this.__processInactiveText())})):this.__processInactiveText(),this):this}__processInactiveText(){let e=this.__useLabel;null==this.__attrHandler.inactiveText?(this.__useLabel=!1,this.__element.removeClass("use-label")):(this.__useLabel=!0,this.__element.addClass("use-label")),e!==this.__useLabel&&this.eventHandler.raise(i.CheckboxEvents.onUseLabelChanged),this.__updateLabel(this.__attrHandler.state)}getInactiveText(){return this.__attrHandler.inactiveText}setCheckedBackgroundColor(e){return this.__attrHandler.checkColorAttribute(e,"checkedBackgroundColor")?(this.__attrHandler.checkedBackgroundColor=e,this.__processCheckedBackgroundColor(),this):this}__processCheckedBackgroundColor(){null==this.__attrHandler.checkedBackgroundColor?this.__element.css("--tchmi-ba-checkbox-checked-background-color",""):this.__element.css("--tchmi-ba-checkbox-checked-background-color",this.__attrHandler.checkedBackgroundColor.toString())}getCheckedBackgroundColor(){return this.__attrHandler.checkedBackgroundColor}setCheckmarkColor(e){return this.__attrHandler.checkColorAttribute(e,"checkmarkColor")?(this.__attrHandler.checkmarkColor=e,this.__processCheckmarkColor(),this):this}__processCheckmarkColor(){null==this.__attrHandler.checkmarkColor?this.__element.css("--tchmi-ba-checkbox-checkmark-color",""):this.__element.css("--tchmi-ba-checkbox-checkmark-color",this.__attrHandler.checkmarkColor.toString())}getCheckmarkColor(){return this.__attrHandler.checkmarkColor}setAppearance(e){return this.__attrHandler.checkAttribute(e,"appearance",{validator:"number"})?(null==e&&(e=i.Appearance.checkbox),this.__attrHandler.appearance=e,this.__processAppearance(),this):this}__processAppearance(){let e=this.__paddingContainer.find(".checkbox-container");switch(e[0]&&e.detach(),e=$("<label>").addClass("checkbox-container"),this.__attrHandler.appearance){case i.Appearance.toggleSwitch:case i.Appearance.toggleSlider:this.__element.addClass("toggle-switch"),this.__element.removeClass("standard");let t=$("<span>").addClass("toggle-switch-slider");e.append(this.__checkbox,t),this.__paddingContainer.append(e),this.__attrHandler.appearance===i.Appearance.toggleSlider?this.__element.addClass("toggle-slider"):this.__element.removeClass("toggle-slider"),this.onResized();break;default:this.__element.removeClass("toggle-switch"),this.__element.removeClass("toggle-slider"),this.__element.addClass("standard");let a=$('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30">\n\t\t\t\t\t\t\t\t<path d="M 9 18 L 13 22 L 22 9" fill="none" stroke-width="2" stroke-linecap="round"></path>\n\t\t\t\t\t\t\t</svg>');e.append(this.__checkbox,a),this.__paddingContainer.append(e)}}getAppearance(){return this.__attrHandler.appearance}__processReadOnly(){super.__processReadOnly(),null!=this.__attrHandler.readOnly&&!1===this.__attrHandler.readOnly?this.__checkbox.removeAttr("disabled"):this.__checkbox.attr("disabled","disabled")}}a.Checkbox=i,function(e){let t,a;!function(e){e.onStateChanged="onStateChanged",e.onStateFeedbackChanged="onStateFeedbackChanged",e.onUserInteractionFinished="onUserInteractionFinished",e.onUseLabelChanged="onUseLabelChanged"}(t=e.CheckboxEvents||(e.CheckboxEvents={})),function(e){e[e.checkbox=0]="checkbox",e[e.toggleSwitch=1]="toggleSwitch",e[e.toggleSlider=2]="toggleSlider"}(a=e.Appearance||(e.Appearance={}))}(i=a.Checkbox||(a.Checkbox={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.TextControl{constructor(e,t,a){super(e,t,a)}__init(t){super.__init(t),this.baObjectHandler=new e.BaObjectHandler(this),this.valueHandler=new e.System.ValueHandler(this),this.__combobox=$("<select>").addClass("text-element"),this.__changedHandler=e=>this.__onChanged(e),this.__element.addClass("combobox"),this.__element.append(this.__combobox),this.__button=$('<div class=\'combobox-button\'>\n\t\t\t\t\t<svg version="1.1"\n\t\t\t\t\t   width="100" height="100"\n\t\t\t\t\t   xmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\t   viewBox="0 0 100 100"\n\t\t\t\t\t   style="\n\t\t\t\t\t\t  stroke: var(--tchmi-ba-combobox-button-arrow-color);\n\t\t\t\t\t\t  fill: transparent;\n\t\t\t\t\t\t  stroke-linecap: round;\n\t\t\t\t\t\t  stroke-linejoin: round;\n\t\t\t\t\t\t  stroke-width: 6px;\n\t\t\t\t\t   ">\n\t\t\t\t\t   <g>\n\t\t\t\t\t\t  <path\n\t\t\t\t\t\t\t d="M 3 30 L 50 70 L 97 30" />\n\t\t\t\t\t   </g>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>'),this.__element.append(this.__button),void 0===(null==t?void 0:t.readOnly)&&this.setReadOnly(!0)}__attach(){this.__isAttached||(this.__combobox.on("change",this.__changedHandler),super.__attach())}__detach(){this.__isAttached&&(this.__combobox.off("change",this.__changedHandler),super.__detach())}destroy(){super.destroy(),this.valueHandler.destroy()}onValueChanged(e){this.__setSelectedValueInternal(e)}__onChanged(e){if(e.stopPropagation(),null!=this.__attrHandler.data&&(this.__setSelectedValueInternal(this.__attrHandler.data[this.__combobox[0].selectedIndex].value),null!=this.__attrHandler.selectedData)){if(null!=this.__attrHandler.selectedData.value&&this.valueHandler.processChangedValue(this.__attrHandler.selectedData.value),null!=this.__attrHandler.selectedValueFeedback&&this.__attrHandler.selectedData.value!=this.__attrHandler.selectedValueFeedback){let e=()=>{this.__valueFeedbackReady&&this.__valueFeedbackReady(),null!=this.__attrHandler.selectedValueFeedback&&this.__setSelectedValueInternal(this.__attrHandler.selectedValueFeedback)};this.__valueFeedbackReady=this.busyHandler.setBusy("Waiting for SelectedValueFeedback",{cbOnTimeout:e,optionalOutput:"Hint: Maybe the object is logged by a higher priority?"})}this.eventHandler.raise(a.ComboboxEvents.onUserInteractionFinished)}}__addOption(e){let t=$("<option>");t.text(e.text||""),$(this.__combobox).append(t)}__updateElements(e){if(null!=this.__attrHandler.data)if(null==e)this.__combobox[0].selectedIndex=0,this.textHandler.setText(this.__attrHandler.data[0].text);else{let t=this.__attrHandler.data.findIndex(t=>t.value===e);if(t>-1){this.__combobox[0].selectedIndex=t;let e=this.__attrHandler.data[t].text;null!==e&&this.textHandler.setText(e)}else this.__attrHandler.selectedData||(this.__attrHandler.selectedData={text:"invalid#",value:e}),this.__combobox[0].selectedIndex=t,this.__attrHandler.selectedData.text||(this.__attrHandler.selectedData.text="invalid#"),this.textHandler.setText(this.__attrHandler.selectedData.text)}}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.data&&this.setData(e.data),void 0!==e.selectedValue&&this.setSelectedValue(e.selectedValue),void 0!==e.selectedValueFeedback&&this.setSelectedValueFeedback(e.selectedValueFeedback),void 0!==e.buttonColor&&this.setButtonColor(e.buttonColor),e.buttonArrowColor&&this.setButtonArrowColor(e.buttonArrowColor),this}getAttributes(){return this.__attrHandler.getRef()}setData(e){if(!this.__attrHandler.checkAttribute(e,"data",{validator:()=>e instanceof Array}))return this;let t=null;if(null!=e)for(let i=0;i<e.length;i++){if(!a.isComboboxItem(e[i]))return this.__attrHandler.invalidAttribute("Data",e[i]),this;let n=e.findIndex((t,a)=>a!==i&&t.value===e[i].value);n<0?(null==t&&(t=[]),t.push(e[i])):console.warn("Dublicate value in data of "+this.__id+".\n Entries with texts "+e[i].text+" and "+e[n].text+" have same value!\n The dublicate entry will be ignored!")}return this.__attrHandler.data=t,this.__processData(),this}__processData(){var e,t;if($(this.__combobox).empty(),null!=this.__attrHandler.data)for(let t=0;t<this.__attrHandler.data.length;t++)null==(null===(e=this.__attrHandler.selectedData)||void 0===e?void 0:e.value)&&this.setSelectedValue(this.__attrHandler.data[t].value),this.__addOption(this.__attrHandler.data[t]);this.__updateElements(null===(t=this.__attrHandler.selectedData)||void 0===t?void 0:t.value)}getData(){return this.__attrHandler.data}getSelectedData(){return this.__attrHandler.selectedData}setSelectedValue(e){return this.__attrHandler.checkAttribute(e,"selectedValue")?(null==this.__attrHandler.selectedValueFeedback&&this.__setSelectedValueInternal(e),this):this}__setSelectedValueInternal(e){this.__attrHandler.selectedValue!=e&&(this.__attrHandler.selectedValue=e,this.__processSelectedValue(),this.eventHandler.raise(a.ComboboxEvents.onSelectedValueChanged))}__processSelectedValue(){if(null==this.__attrHandler.selectedValue)this.__attrHandler.selectedData={text:null,value:null};else if(null!=this.__attrHandler.data){let e=this.__attrHandler.data.find(e=>e.value===this.__attrHandler.selectedValue);this.__attrHandler.selectedData=null==e?{text:"invalid#",value:this.__attrHandler.selectedValue}:e}else this.__attrHandler.selectedData={text:"invalid#",value:this.__attrHandler.selectedValue};this.__updateElements(this.__attrHandler.selectedValue)}getSelectedValue(){return this.__attrHandler.selectedValue}setSelectedValueFeedback(e){return this.__attrHandler.checkAttribute(e,"selectedValueFeedback")?(this.__attrHandler.selectedValueFeedback=e,this.__processSelectedValueFeedback(),this.__valueFeedbackReady&&this.__valueFeedbackReady(),this.eventHandler.raise(a.ComboboxEvents.onSelectedValueFeedbackChanged),this):this}__processSelectedValueFeedback(){this.__setSelectedValueInternal(this.__attrHandler.selectedValueFeedback)}getSelectedValueFeedback(){return this.__attrHandler.selectedValueFeedback}setButtonColor(e){return this.__attrHandler.checkColorAttribute(e,"buttonColor")?(this.__attrHandler.buttonColor=e,this.__processButtonColor(),this):this}__processButtonColor(){null==this.__attrHandler.buttonColor?this.__element.css("--tchmi-ba-combobox-button-color",""):this.__element.css("--tchmi-ba-combobox-button-color",this.__attrHandler.buttonColor.toString())}getButtonColor(){return this.__attrHandler.buttonColor}setButtonArrowColor(e){return this.__attrHandler.checkColorAttribute(e,"buttonArrowColor")?(this.__attrHandler.buttonArrowColor=e,this.__processButtonArrowColor(),this):this}__processButtonArrowColor(){null==this.__attrHandler.buttonArrowColor?this.__element.css("--tchmi-ba-combobox-button-arrow-color",""):this.__element.css("--tchmi-ba-combobox-button-arrow-color",this.__attrHandler.buttonArrowColor.toString())}getButtonArrowColor(){return this.__attrHandler.buttonArrowColor}__processReadOnly(){super.__processReadOnly(),null!=this.__attrHandler.readOnly&&!1===this.__attrHandler.readOnly?(this.textHandler.getTextElement().detach(),this.__element.append(this.__combobox),this.__element.append(this.__button),this.__element.addClass("editable")):(this.__element.append(this.textHandler.getTextElement()),this.__combobox.detach(),this.__element.removeClass("editable"),this.__button.detach())}static toComboboxItemArray(e,t){if(null==e)return null;let a=[];if(e instanceof Map)for(let[t,i]of e){let e={text:i,value:t};a.push(e)}else if(e instanceof Array){if(e.length<=0)return null;null==t&&(t=0);for(let i=0;i<e.length;i++)if(e[i].length>0){let n={text:e[i],value:i+t};a.push(n)}}else if("object"==typeof e)for(let t in e)a.push({value:Number(t),text:e[t]});return a}processBaObject(){if(!this.baObjectHandler.baObject)return;if(this.baObjectHandler.baObject.DataType!==e.DataType.enum)return;let t=this.baObjectHandler.baObject.tryGetBaVariable(e.BA.BaParameterId.ePresentValue);null!=t&&(this.baObjectHandler.tryWatchBaVariable(t.ID,e=>{this.setSelectedValueFeedback(e)}),this.baObjectHandler.watchValueRange(t.ID,e=>{this.setData(a.toComboboxItemArray(e)),this.__processSelectedValueFeedback()},!0)),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess())}}t.Combobox=a,function(t){let a;t.isComboboxItem=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("text","string"),i.set("value","any"),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a},t.createDataFromEnum=function(e){let t=[];for(let a in e)if(isNaN(Number(a))){let i=Number(e[a]);if(isNaN(i))throw new Error("Value must be of type number!");t.push({text:a,value:i})}return t},function(e){e.onSelectedValueChanged="onSelectedValueChanged",e.onSelectedValueFeedbackChanged="onSelectedValueFeedbackChanged",e.onUserInteractionFinished="onUserInteractionFinished"}(a=t.ComboboxEvents||(t.ComboboxEvents={}))}(a=t.Combobox||(t.Combobox={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(e,t,a){super(e,t,a)}__init(e){var a,i;super.__init(e),this.resizeHandler=new t.ResizeHandler(this),this.controlContainer=new t.ControlContainer(this.__id+"-control-container",this),this.__header=$("<div>").addClass("header"),this.__headline=new t.Textblock(this.__id+"-headline",this),this.__contentContainer=$("<div>").addClass("content-container"),this.__headerMenuButtonPressed=()=>{var e,t;null===(e=this.__contextMenu)||void 0===e||e.toggleOpen(this.__element,null===(t=this.__attrHandler.menuAppearance)||void 0===t?void 0:t.sideways),null!=this.__destroyHeaderMenuButtonPressed&&this.__destroyHeaderMenuButtonPressed()},this.__contextMenuClosedHandler=()=>{var e,a,i,n;null===(e=this.__menuButton)||void 0===e||e.setToggleState(null===(a=this.__contextMenu)||void 0===a?void 0:a.getIsOpen()),(null===(i=this.__contextMenu)||void 0===i?void 0:i.getIsOpen())||(this.__destroyHeaderMenuButtonPressed=null===(n=this.__menuButton)||void 0===n?void 0:n.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,this.__headerMenuButtonPressed))},this.__controlContainerCollectionChangedHandler=(e,t)=>{this.__onControlContainerCollectionChanged(e,t)},this.__element.addClass("content-window"),this.__header.append(this.__headline.getElement()),void 0===(null===(i=null===(a=null==e?void 0:e.headline)||void 0===a?void 0:a.textAttributes)||void 0===i?void 0:i.overflow)&&this.__headline.textHandler.setOverflow(t.TextHandler.Overflow.marquee),this.__headerAppended=!1,this.setShowHeader(!0),this.__element.append(this.__contentContainer),this.controlContainer.onControlsCollectionChanged(this.__controlContainerCollectionChangedHandler),this.controlContainer.getElement().addClass("controls-container")}__attach(){var e,a;this.__isAttached||(this.__destroyHeaderMenuButtonPressed=null===(e=this.__menuButton)||void 0===e?void 0:e.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,this.__headerMenuButtonPressed),null!=this.__contextMenu&&this.__destroyersToCallOnDetach.push(null===(a=this.__contextMenu)||void 0===a?void 0:a.eventHandler.register(t.ContextMenu.ContextMenuEvents.onMenuClose,this.__contextMenuClosedHandler)),super.__attach())}__detach(){this.__isAttached&&(null!=this.__destroyHeaderMenuButtonPressed&&this.__destroyHeaderMenuButtonPressed(),super.__detach())}destroy(){var e,t;this.__headline.destroy(),null===(e=this.__contextMenu)||void 0===e||e.destroy(),null===(t=this.__menuButton)||void 0===t||t.destroy(),null!=this.__destroyHeaderMenuButtonPressed&&(this.__destroyHeaderMenuButtonPressed(),delete this.__destroyHeaderMenuButtonPressed),this.controlContainer.destroy(),this.resizeHandler.destroy(),super.destroy()}__onControlContainerCollectionChanged(e,t){this.controlContainer.getControls().length>0?this.__header.append(this.controlContainer.getElement()):this.controlContainer.getElement().detach(),this.__updateHeaderElementsOrder()}onResized(){var e,t;let a=this.__header.width(),i=this.controlContainer.getElement().width(),n=Number(this.controlContainer.getElement().css("margin-right").replace("px","")),s=null===(e=this.__menuButton)||void 0===e?void 0:e.getElement().width(),r=Number(null===(t=this.__menuButton)||void 0===t?void 0:t.getElement().css("margin-right").replace("px",""));a=null!=a?a:0,n=isNaN(n)?0:n,i=null!=i?i+n:0,r=isNaN(r)?0:r,s=null!=s?s+r:0;let o=a-i-s;this.__headline.layoutHandler.setMaxWidth(o)}__updateHeaderElementsOrder(){var e;this.controlContainer.getElement().detach(),null===(e=this.__menuButton)||void 0===e||e.getElement().detach(),this.controlContainer.getControls().length>0&&this.__header.append(this.controlContainer.getElement()),this.__contextMenu&&this.__header.append(this.__menuButton.getElement())}getHeader(){return this.__header}getContentContainer(){return this.__contentContainer}addMenu(a){return null!=this.__contextMenu?(console.warn(`There was already a menu created for ${this.__id}!`),this.__contextMenu):(this.__menuButton=new t.ToggleButton(this.__id+"-header-menu-button",this),this.__menuButton.backgroundStyler.setImage(e.Icons.Standard.MenuBurger.path,!0).setImageHeight(60,"%").setImageWidth(60,"%"),this.__menuButton.getElement().addClass("controls-container menu-button"),this.__header.append(this.__menuButton.getElement()),this.__isAttached&&null==this.__destroyHeaderMenuButtonPressed&&(this.__destroyHeaderMenuButtonPressed=this.__menuButton.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,this.__headerMenuButtonPressed)),this.__contextMenu=new t.ContextMenu(this.__id+"-context-menu",this),a&&this.__contextMenu.addRowEntry(a),this.__isAttached&&this.__destroyersToCallOnDestroy.push(this.__contextMenu.eventHandler.register(t.ContextMenu.ContextMenuEvents.onMenuClose,this.__contextMenuClosedHandler)),this.__processMenuAppearance(),this.__updateHeaderElementsOrder(),this.__contextMenu)}getHeadline(){return this.__headline}setAttributes(e){return super.setAttributes(e),void 0!==e.content&&this.setContent(e.content),void 0!==e.menuAppearance&&this.setMenuAppearance(e.menuAppearance),null!=e.headline&&this.__headline.setAttributes(e.headline),void 0!==e.showHeader&&this.setShowHeader(e.showHeader),void 0!==e.headerColor&&this.setHeaderColor(e.headerColor),void 0!==e.headerHeight&&this.setHeaderHeight(e.headerHeight,e.headerHeightUnit),e.menu&&this.addMenu(e.menu),void 0!==e.controls&&(e.controls instanceof Array?this.controlContainer.addControls(e.controls):this.controlContainer.addControl(e.controls)),this}getAttributes(){return this.__attrHandler.getRef()}setContent(e){return this.__attrHandler.checkAttribute(e,"content")?(this.__attrHandler.content=e,this.__processContent(),this):this}__processContent(){this.__contentContainer.empty(),null!=this.__attrHandler.content&&this.__contentContainer.append(this.__attrHandler.content)}getContent(){return this.__attrHandler.content}setHeadlineText(e){var t,a;return void 0===e?this:null!=e&&"string"!=typeof e?(this.__attrHandler.invalidAttribute("Headline",e),this):e===(null===(a=null===(t=this.__attrHandler.headline)||void 0===t?void 0:t.textAttributes)||void 0===a?void 0:a.text)?(this.__attrHandler.equalAttribute("Headline"),this):(this.__attrHandler.headline||(this.__attrHandler.headline={}),this.__attrHandler.headline.textAttributes||(this.__attrHandler.headline.textAttributes={}),this.__attrHandler.headline.textAttributes.text=e,this.__processHeadlineText(),this)}__processHeadlineText(){var e,t,a;null===(e=this.__headline)||void 0===e||e.textHandler.setText(null===(a=null===(t=this.__attrHandler.headline)||void 0===t?void 0:t.textAttributes)||void 0===a?void 0:a.text)}getHeadlineText(){var e,t;return null===(t=null===(e=this.__attrHandler.headline)||void 0===e?void 0:e.textAttributes)||void 0===t?void 0:t.text}setHeadlineAttributes(e){return this.__headline.setAttributes(e),this}getHeadlineAttributes(){return this.__headline.getAttributes()}setHeaderColor(e){return this.__attrHandler.checkColorAttribute(e,"headerColor")?(this.__attrHandler.headerColor=e,this.__processHeaderColor(),this):this}__processHeaderColor(){null==this.__attrHandler.headerColor?this.__header.css("background-color",""):this.__header.css("background-color",this.__attrHandler.headerColor.toString())}getHeaderColor(){return this.__attrHandler.headerColor}setHeaderHeight(e,a){return t.LayoutHandler.dimensionSetter(this.__attrHandler,"headerHeight",e,a)?(this.__processHeaderHeight(),this):this}__processHeaderHeight(){null==this.__attrHandler.headerHeight?this.__header.css("--tchmi-ba-content-window-header-height",""):this.__header.css("--tchmi-ba-content-window-header-height",this.__attrHandler.headerHeight+(this.__attrHandler.headerHeightUnit?this.__attrHandler.headerHeightUnit:"px"))}getHeaderHeight(){return this.__attrHandler.headerHeight}getHeaderHeightUnit(){return this.__attrHandler.headerHeightUnit}setShowHeader(e){return this.__attrHandler.checkAttribute(e,"showHeader",{validator:"boolean"})?(this.__attrHandler.showHeader=e,this.__processShowHeader(),this):this}__processShowHeader(){null!==this.__attrHandler.showHeader&&(!0===this.__attrHandler.showHeader?!1===this.__headerAppended&&(this.__element.append(this.__header),this.__contentContainer.detach(),this.__element.append(this.__contentContainer),this.__headerAppended=!0):!1===this.__attrHandler.showHeader&&!0===this.__headerAppended&&(this.__header.detach(),this.__headerAppended=!1))}getShowHeader(){return this.__attrHandler.showHeader}setMenuAppearance(e){return this.__attrHandler.checkAttribute(e,"menuAppearance",{validator:a.isMenuAppearance})?(this.__attrHandler.menuAppearance=e,this.__processMenuAppearance(),this):this}__processMenuAppearance(){var e,t,a,i,n;null==this.__attrHandler.menuAppearance?(null===(e=this.__contextMenu)||void 0===e||e.getElement().removeClass("overlay"),null===(t=this.__contextMenu)||void 0===t||t.getElement().removeClass("sideways")):(null!=this.__attrHandler.menuAppearance.overlay&&this.__attrHandler.menuAppearance.overlay&&(null===(a=this.__contextMenu)||void 0===a||a.getElement().addClass("overlay")),null!=this.__attrHandler.menuAppearance.sideways&&this.__attrHandler.menuAppearance.sideways&&(null===(i=this.__contextMenu)||void 0===i||i.getElement().addClass("sideways"),null===(n=this.__contextMenu)||void 0===n||n.getElement().addClass("overlay")))}getMenuAppearance(){return this.__attrHandler.menuAppearance}}t.ContentWindow=a,function(t){t.isMenuAppearance=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}}(a=t.ContentWindow||(t.ContentWindow={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.__rowEntryPressedHandler=e=>this.__onRowEntryPressed(e),this.__bodyPressedHandler=e=>{null==this.__element.find(e.target)[0]&&this.__close()},this.__element=$("<ul>").addClass(this.__element[0].classList.toString()),this.__element.addClass("context-menu"),this.__element.attr("id",this.__id),void 0===(null==e?void 0:e.rowEntryHeight)&&this.setRowEntryHeight(30),void 0===(null==e?void 0:e.autoClose)&&this.setAutoClose(!0)}__attach(){this.__isAttached||(this.__element.on("pointerdown","li",this.__rowEntryPressedHandler),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown","li",this.__rowEntryPressedHandler),$("body").off("pointerdown",this.__bodyPressedHandler),super.__detach())}destroy(){var e;null===(e=this.__rowEntries)||void 0===e||e.forEach(e=>e.rowEntry.destroy()),super.destroy()}__onRowEntryPressed(e){if(null!=e.button&&0!==e.button)return;e.stopPropagation();let t=()=>{if(!this.__rowEntries)return;let a;for(let t=0;t<this.__rowEntries.length;t++)if(this.__rowEntries[t].rowEntry.getId()===e.currentTarget.id){a=this.__rowEntries[t];break}a&&a.options&&a.options.onPressed&&a.options.onPressed(a.options.callbackParams),this.__element.off("pointerup","li",t)};this.__element.on("pointerup","li",t)}__open(e,t){if(this.__isOpen)return;if(!this.__rowEntries)return;null==e||e.append(this.__element);let i=()=>{this.__attrHandler.autoClose&&$("body").on("pointerdown",this.__bodyPressedHandler),this.eventHandler.raise(a.ContextMenuEvents.onMenuOpen),this.eventHandler.raise(a.ContextMenuEvents.onMenuToggle)};null!=t&&t?(this.__element.animate({width:"30%"},200,i),this.__openedSideways=!0):null!=this.__attrHandler.rowEntryHeight&&this.__element.animate({"min-height":this.__attrHandler.rowEntryHeight*this.__rowEntries.length+"px"},200,i),this.__isOpen=!0}__close(){if(!this.__isOpen)return;this.__attrHandler.autoClose&&$("body").off("pointerdown",this.__bodyPressedHandler);let e=()=>{this.__element.detach(),this.eventHandler.raise(a.ContextMenuEvents.onMenuClose),this.eventHandler.raise(a.ContextMenuEvents.onMenuToggle)};this.__openedSideways?this.__element.animate({width:0},200,e):this.__element.animate({"min-height":0},200,e),this.__openedSideways=!1,this.__isOpen=!1}__addRowEntry(e){this.__rowEntries||(this.__rowEntries=[]);let t=this.__id+"-row-entry",i=1;for(;this.__rowEntries.find(e=>e.rowEntry.getId()===t);)t=this.__id+"-row-entry-"+i,i++;let n=new a.RowEntry(t,this);return e&&(e.text&&n.textHandler.setText(e.text),e.controls&&(e.controls instanceof Array?n.controlContainer.addControls(e.controls):n.controlContainer.addControl(e.controls)),void 0!==e.controlsHorizontalAlignment&&n.controlContainer.setControlsHorizonzalAlignment(e.controlsHorizontalAlignment)),this.__rowEntries.push({rowEntry:n,options:e}),this.__element.append(n.getElement()),this.__isOpen&&null!=this.__attrHandler.rowEntryHeight&&this.__element.animate({"min-height":this.__attrHandler.rowEntryHeight*this.__rowEntries.length+"px"},200),e.cbOnCreated&&e.cbOnCreated(n),n}toggleOpen(e,t){this.__isOpen?this.__close():this.__open(e,t)}open(e,t){this.__open(e,t)}close(){this.__close()}addRowEntry(e){let t;if(e instanceof Array){t=[];for(let a=0;a<e.length;a++)t.push(this.__addRowEntry(e[a]))}else t=this.__addRowEntry(e);return t}removeRowEntry(e){if(!this.__rowEntries)return!1;let t;if(t="string"==typeof e?this.getRowEntry(e):e,!t)return!1;for(let e=0;e<this.__rowEntries.length;e++)if(this.__rowEntries[e].rowEntry.getId()===t.getId())return this.__rowEntries[e].rowEntry.getElement().detach(),this.__rowEntries[e].rowEntry.destroy(),this.__rowEntries.splice(e,1),!0;return!1}getRowEntriesCount(){return this.__rowEntries?this.__rowEntries.length:0}getRowEntry(e){var t;let a;if(this.__rowEntries)for(let i=0;i<this.__rowEntries.length;i++)if((null===(t=this.__rowEntries[i].options)||void 0===t?void 0:t.name)===e){a=this.__rowEntries[i].rowEntry;break}return a}getRowEntries(){let e=[];if(this.__rowEntries)for(let t=0;t<this.__rowEntries.length;t++)e.push(this.__rowEntries[t].rowEntry);return e}getIsOpen(){return null!=this.__isOpen&&this.__isOpen}setAttributes(e){return super.setAttributes(e),void 0!==e.autoClose&&this.setAutoClose(e.autoClose),void 0!==e.rowEntryHeight&&this.setRowEntryHeight(e.rowEntryHeight),this}getAttributes(){return this.__attrHandler.getRef()}setRowEntryHeight(e){return this.__attrHandler.checkAttribute(e,"rowEntryHeight",{validator:"number"})?(null==e&&(e=30),this.__attrHandler.rowEntryHeight=e,this.__processRowEntryHeight(),this):this}__processRowEntryHeight(){null==this.__attrHandler.rowEntryHeight?this.__element.css("--row-entry-height",""):this.__element.css("--row-entry-height",this.__attrHandler.rowEntryHeight+"px")}getRowEntryHeight(){return this.__attrHandler.rowEntryHeight}setAutoClose(e){return this.__attrHandler.checkAttribute(e,"autoClose",{validator:"boolean"})?(null==e&&(e=!0),this.__attrHandler.autoClose=e,this):this}getAutoClose(){return this.__attrHandler.autoClose}}t.ContextMenu=a,function(a){let i;!function(e){e.onMenuOpen="onMenuOpen",e.onMenuClose="onMenuClose",e.onMenuToggle="onMenuToggle"}(i=a.ContextMenuEvents||(a.ContextMenuEvents={})),a.createContextMenuAndButton=function(n){n.parent||(n.parent=null);let s=new t.ToggleButton(n.id+"-context-menu-button",n.parent);s.backgroundStyler.setImageHeight(60,"%").setImageWidth(60,"%"),s.backgroundStyler.setImage(e.Icons.Standard.MenuBurger.path,!0);let r,o=new a(n.id+"-context-menu",n.parent);n.rowEntryOptions&&o.addRowEntry(n.rowEntryOptions);let l,d=()=>{if(!o.getIsOpen()){if(n.root)o.open(n.root);else{let e=s.getElement().offset(),t=s.getElement().outerHeight(),a=$(window).outerWidth(),i=o.getElement().outerWidth(),n=e.left;a&&i&&n>a-i&&(n=a-i),o.layoutHandler.setAttributes({left:n,top:e.top+t}),o.getElement().css("zIndex",2e3),o.open($("body"))}null!=r&&r()}},_=e=>{e.destroy(),null!=r&&r(),s.eventHandler.register(t.BaseNode.BaseNodeEvents.onAttached,h)},h=e=>{e.destroy(),r=s.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,d),s.eventHandler.register(t.BaseNode.BaseNodeEvents.onDetached,_)};s.eventHandler.register(t.BaseNode.BaseNodeEvents.onAttached,h);let c=e=>{e.destroy(),null!=l&&l(),o.eventHandler.register(t.BaseNode.BaseNodeEvents.onAttached,u)},u=a=>{a.destroy(),l=o.eventHandler.register(i.onMenuToggle,()=>{s.setToggleState(o.getIsOpen()),o.getIsOpen()||(n.root||e.System.OverlayContainer.remove(o.getElement()),r=s.eventHandler.register(t.ToggleButton.ToggleButtonEvents.onToggleStateChanged,d))}),o.eventHandler.register(t.BaseNode.BaseNodeEvents.onDetached,c)};return o.eventHandler.register(t.BaseNode.BaseNodeEvents.onAttached,u),n.parent&&e.isIEventHandler(n.parent)&&n.parent.eventHandler.register(t.BaseNode.BaseNodeEvents.onDestroyed,(e,t)=>{e.destroy(),s.destroy(),o.destroy()}),{button:s,menu:o}};class n extends t.TextControl{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.controlContainer=new t.ControlContainer(this.__id+"-control-container",this),this.__controlCreatorCollectionChangedHandler=(e,t)=>{this.controlContainer.getControls().length>0?this.__element.append(this.controlContainer.getElement()):this.controlContainer.getElement().detach()},this.__element=$("<li>").addClass(this.__element[0].classList.toString()),this.__element.attr("id",this.__id),this.controlContainer.onControlsCollectionChanged(this.__controlCreatorCollectionChangedHandler)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){this.controlContainer.destroy(),super.destroy()}onTextChanged(e){super.onTextChanged(e),null==e?this.textHandler.getTextElement().detach():this.__element.append(this.textHandler.getTextElement())}}a.RowEntry=n}(a=t.ContextMenu||(t.ContextMenu={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i extends a.TextControl{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.valueHandler=new t.System.ValueHandler(this),this.resizeHandler=new a.ResizeHandler(this),this.__localeChangedHandler=()=>{this.__processMode()},void 0===e.readOnly&&(e.readOnly=!0),this.__element.addClass("date-time-field"),this.__element.append(this.textHandler.getTextElement()),void 0===(null==e?void 0:e.mode)&&this.setMode(i.Mode.dateTime)}__attach(){this.__isAttached||(e.EventProvider.register("onLocaleChanged",this.__localeChangedHandler),this.__processMode(),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){var e;null===(e=this.__btn)||void 0===e||e.destroy(),delete this.__btn,this.valueHandler.destroy(),this.resizeHandler.destroy(),null!=this.__destroyOnButtonPressed&&(this.__destroyOnButtonPressed(),delete this.__destroyOnButtonPressed),super.destroy()}onResized(){this.__element.css("--used-height",this.__element.innerHeight()+"px")}onValueChanged(e){this.setDate(e)}__onButtonPressed(){let e=e=>{this.setDate(e),this.eventHandler.raise(i.DateTimeFieldEvents.onUserInteractionFinished)};switch(this.__attrHandler.mode){case i.Mode.date:a.DateTimePicker.openDatePickerDialog(null!=this.__attrHandler.date?this.__attrHandler.date:new Date,t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.SelectNewDate),e);break;case i.Mode.time:a.TimePicker.openTimePickerDialog(null!=this.__attrHandler.date?this.__attrHandler.date:new Date,t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.SelectNewTime),e);break;default:a.DateTimePicker.openDateTimePickerDialog(null!=this.__attrHandler.date?this.__attrHandler.date:new Date,t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.SelectNewDate),e)}}openPicker(){this.__onButtonPressed()}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.date&&this.setDate(e.date),void 0!==e.mode&&this.setMode(e.mode),this}getAttributes(){return this.__attrHandler.getRef()}setDate(e){return this.__attrHandler.checkAttribute(e,"date",{validator:"date"})?(this.__attrHandler.date=e,this.__processDate(),null!=this.__attrHandler.date&&this.valueHandler.processChangedValue(this.__attrHandler.date),this.eventHandler.raise(i.DateTimeFieldEvents.onDateChanged),this):this}__processDate(){null==this.__attrHandler.date?this.setDate(new Date):this.__processMode()}getDate(){return this.__attrHandler.date}setMode(e){return this.__attrHandler.checkAttribute(e,"mode",{validator:"number"})?(null==e&&(e=i.Mode.dateTime),this.__attrHandler.mode=e,this.__processMode(),this):this}__processMode(){if(null!=this.__destroyLocaleWatch&&this.__destroyLocaleWatch(),null!=this.__attrHandler.date)switch(this.__attrHandler.mode){case i.Mode.dateTime:this.__destroyLocaleWatch=t.Locale.Localization.watchText(t.Locale.WeekDaysShortLangKey[t.Helper.Date.getWeekday(this.__attrHandler.date)-1],e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&this.textHandler.setText(e.text+" "+this.__attrHandler.date.toLocaleString())});break;case i.Mode.date:this.__destroyLocaleWatch=t.Locale.Localization.watchText(t.Locale.WeekDaysShortLangKey[t.Helper.Date.getWeekday(this.__attrHandler.date)-1],e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&this.textHandler.setText(e.text+" "+this.__attrHandler.date.toLocaleDateString())});break;case i.Mode.time:this.textHandler.setText(this.__attrHandler.date.toLocaleTimeString())}}getMode(){return this.__attrHandler.mode}__processReadOnly(){var e,i;super.__processReadOnly(),null==this.__attrHandler.readOnly||!0===this.__attrHandler.readOnly?(null===(e=this.__btn)||void 0===e||e.getElement().detach(),null===(i=this.__btn)||void 0===i||i.destroy(),null!=this.__destroyOnButtonPressed&&(this.__destroyOnButtonPressed(),delete this.__destroyOnButtonPressed),delete this.__btn):null==this.__btn&&(this.__btn=new a.Button(this.__id+".button",this),this.__btn.backgroundStyler.setImage(t.Icons.Standard.DateTime.path,!0).setImageWidth(80,"%").setImageHeight(80,"%"),this.__element.append(this.__btn.getElement()),this.__destroyOnButtonPressed=this.__btn.eventHandler.register(a.Button.ButtonEvents.onPressed,()=>this.__onButtonPressed()))}}a.DateTimeField=i,function(e){let t,a;!function(e){e.onDateChanged="onDateChanged",e.onUserInteractionFinished="onUserInteractionFinished"}(t=e.DateTimeFieldEvents||(e.DateTimeFieldEvents={})),function(e){e[e.date=0]="date",e[e.time=1]="time",e[e.dateTime=2]="dateTime"}(a=e.Mode||(e.Mode={}))}(i=a.DateTimeField||(a.DateTimeField={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.__timePicker=new i(this.__id+"-time-picker",this),this.__datePicker=new t.Calendar(this.__id+"-date-picker",this),this.__resultField=new t.DateTimeField(this.__id+"-result-field",this),this.__element.addClass("date-time-picker"),this.__resultField.setReadOnly(!0),this.__datePicker.getElement().addClass("calendar");let a=$("<div>").addClass("right-column");a.append(this.__timePicker.getElement(),this.__resultField.getElement()),this.__element.append(this.__datePicker.getElement(),a)}__attach(){this.__isAttached||(this.__destroyersToCallOnDetach.push(this.__timePicker.eventHandler.register(i.TimePickerEvents.onTimeChanged,()=>this.__onTimeChanged())),this.__destroyersToCallOnDetach.push(this.__datePicker.eventHandler.register(t.Calendar.CalendarEvent.onSelectionChanged,(e,t,a)=>this.__onDateChanged(a))),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__onTimeChanged(){if(null==this.__attrHandler.date)return;let e=new Date(this.__attrHandler.date),t=this.__timePicker.getTime();null!=t&&(e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds())),t!=this.__attrHandler.date&&(this.setDate(e),this.eventHandler.raise(a.DateTimePickerEvents.onDateTimeChanged))}__onDateChanged(e){if(null==this.__attrHandler.date)return;let i,n=new Date(this.__attrHandler.date);null!=e&&e.Type===t.Calendar.CalendarSelectionType.Date&&(i=e.Data,n.setDate(i.getDate()),n.setMonth(i.getMonth()),n.setFullYear(i.getFullYear())),this.setDate(n),this.eventHandler.raise(a.DateTimePickerEvents.onDateTimeChanged)}static openDateTimePickerDialog(e,i,n,s){let r=new a((new Date).getTime()+"-date-time-picker",null);r.setDate(e);return t.DialogWindow.openDialogWindow({appearance:{content:r.getElement(),headline:{textAttributes:{text:i}},buttons:t.DialogWindow.Buttons.OkCancel,modal:!0,layout:{width:650,height:450}},callbacks:{cbConfirmed:()=>{null!=n&&n(r.getDate())},cbClosed:()=>{null!=s&&s(e),r.destroy()}}})}static openDatePickerDialog(e,a,i,n){let s=new t.Calendar((new Date).getTime()+"-date-picker",null);s.getElement().css({position:"relative"}),s.layoutHandler.setHeight(100,"%").setWidth(100,"%"),s.setDisplayMode(t.Calendar.CalendarDisplayMode.DatePicker),s.setDate(e);return t.DialogWindow.openDialogWindow({appearance:{content:s.getElement(),headline:{textAttributes:{text:a}},buttons:t.DialogWindow.Buttons.OkCancel,modal:!0,layout:{width:300,height:300}},callbacks:{cbConfirmed:()=>{null!=i&&i(s.getSelectedDate())},cbClosed:()=>{null!=n&&n(e),s.destroy()}}})}setAttributes(e){return super.setAttributes(e),void 0!==e.date&&this.setDate(e.date),this}getAttributes(){return this.__attrHandler.getRef()}setDate(e){return this.__attrHandler.checkAttribute(e,"date",{validator:"date"})?(this.__attrHandler.date=e,this.__processDate(),this):this}__processDate(){this.__timePicker.setTime(this.__attrHandler.date),null!=this.__attrHandler.date&&this.__datePicker.setDate(this.__attrHandler.date),this.__resultField.setDate(this.__attrHandler.date)}getDate(){return this.__attrHandler.date}}t.DateTimePicker=a,function(e){let t;!function(e){e.onDateTimeChanged="onDateTimeChanged"}(t=e.DateTimePickerEvents||(e.DateTimePickerEvents={}))}(a=t.DateTimePicker||(t.DateTimePicker={}));class i extends t.Base{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.__hourSelector=new n(this.__id+"-hour-selector",this),this.__minuteSelector=new n(this.__id+"-minute-selector",this),this.__secondSelector=new n(this.__id+"-second-selector",this),this.__selectorChangedHandler=(e,t)=>this.__onSelectorChanged(t),this.__element.addClass("time-picker"),this.__hourSelector.setMinValue(0).setMaxValue(23).setReadOnly(!1),this.__minuteSelector.setMinValue(0).setMaxValue(59).setReadOnly(!1),this.__secondSelector.setMinValue(0).setMaxValue(59).setReadOnly(!1),this.__element.append(this.__hourSelector.getElement(),this.__minuteSelector.getElement(),this.__secondSelector.getElement())}__attach(){this.__isAttached||(this.__destroyersToCallOnDestroy.push(this.__hourSelector.eventHandler.register(n.NumberSelectFieldEvents.onNumberChanged,this.__selectorChangedHandler)),this.__destroyersToCallOnDestroy.push(this.__minuteSelector.eventHandler.register(n.NumberSelectFieldEvents.onNumberChanged,this.__selectorChangedHandler)),this.__destroyersToCallOnDestroy.push(this.__secondSelector.eventHandler.register(n.NumberSelectFieldEvents.onNumberChanged,this.__selectorChangedHandler)),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__onSelectorChanged(e){let t=e.getValue();if(null==t)return;let a=new Date(0,0,0,0,0,0,0);switch(null!=this.__attrHandler.time&&(a=new Date(this.__attrHandler.time)),e.getId()){case this.__hourSelector.getId():a.setHours(t);break;case this.__minuteSelector.getId():a.setMinutes(t);break;case this.__secondSelector.getId():a.setSeconds(t)}this.setTime(a),this.eventHandler.raise(i.TimePickerEvents.onTimeChanged)}static openTimePickerDialog(e,a,n,s){let r=new i((new Date).getTime()+"-time-picker",null);r.setTime(e).layoutHandler.setHeight(100).setWidth(200);t.DialogWindow.openDialogWindow({appearance:{content:r.getElement(),headline:{textAttributes:{text:a}},buttons:t.DialogWindow.Buttons.OkCancel,modal:!0,layout:{width:350,height:200}},callbacks:{cbConfirmed:()=>{null!=n&&n(r.getTime())},cbClosed:()=>{null!=s&&s(e),r.destroy()}}})}setAttributes(e){return super.setAttributes(e),void 0!==e.time&&this.setTime(e.time),this}getAttributes(){return this.__attrHandler.getRef()}setTime(e){return this.__attrHandler.checkAttribute(e,"time",{validator:"date"})?(this.__attrHandler.time=e,this.__processTime(),this):this}__processTime(){null==this.__attrHandler.time?(this.__hourSelector.setValue(null),this.__minuteSelector.setValue(null),this.__secondSelector.setValue(null)):(this.__hourSelector.setValue(this.__attrHandler.time.getHours()),this.__minuteSelector.setValue(this.__attrHandler.time.getMinutes()),this.__secondSelector.setValue(this.__attrHandler.time.getSeconds()))}getTime(){return this.__attrHandler.time}}t.TimePicker=i,function(e){let t;!function(e){e.onTimeChanged="onTimeChanged"}(t=e.TimePickerEvents||(e.TimePickerEvents={}))}(i=t.TimePicker||(t.TimePicker={}));class n extends t.Base{constructor(e,t,a){super(e,t,a)}__init(a){super.__init(a),this.__input=new t.InputBox(this.__id+"-input",this,{digits:0,value:0}),this.__upButton=new t.Button(this.__id+"-up-button",this,{background:{image:e.Icons.Standard.Up.path,useSVG:!0,imageHeight:80,imageHeightUnit:"%",imageWidth:80,imageWidthUnit:"%"},cssClass:"up-button"}),this.__downButton=new t.Button(this.__id+"-down-button",this,{background:{image:e.Icons.Standard.Down.path,useSVG:!0,imageHeight:80,imageHeightUnit:"%",imageWidth:80,imageWidthUnit:"%"},cssClass:"down-button"}),this.__element.addClass("number-select-field"),this.__element.append(this.__upButton.getElement(),this.__input.getElement(),this.__downButton.getElement())}__attach(){this.__isAttached||(this.__destroyersToCallOnDestroy.push(this.__upButton.eventHandler.register(t.Button.ButtonEvents.onPressed,()=>this.__onUpButtonPressed())),this.__destroyersToCallOnDestroy.push(this.__downButton.eventHandler.register(t.Button.ButtonEvents.onPressed,()=>this.__onDownButtonPressed())),this.__destroyersToCallOnDestroy.push(this.__input.eventHandler.register(t.InputBox.InputBoxEvents.onUserInteractionFinished,()=>this.setValue(this.__input.getValue()))),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__onUpButtonPressed(){if(null!=this.__attrHandler.value){if(null!=this.__attrHandler.maxValue&&this.__attrHandler.value+1>this.__attrHandler.maxValue)return void this.__upButton.setIsEnabled(!1);this.setValue(this.__attrHandler.value+1)}else null!=this.__attrHandler.maxValue&&1<this.__attrHandler.maxValue?this.setValue(1):this.setValue(this.__attrHandler.maxValue)}__onDownButtonPressed(){if(null!=this.__attrHandler.value){if(null!=this.__attrHandler.minValue&&this.__attrHandler.value-1<this.__attrHandler.minValue)return void this.__downButton.setIsEnabled(!1);this.setValue(this.__attrHandler.value-1)}else null!=this.__attrHandler.minValue&&-1>this.__attrHandler.minValue?this.setValue(-1):this.setValue(this.__attrHandler.minValue)}setAttributes(e){return super.setAttributes(e),void 0!==e.value&&this.setValue(e.value),void 0!==e.minValue&&this.setMinValue(e.minValue),void 0!==e.maxValue&&this.setMaxValue(e.maxValue),void 0!==e.orientation&&this.setOrientation(e.orientation),this}getAttributes(){return this.__attrHandler.getRef()}setValue(e){return this.__attrHandler.checkAttribute(e,"value",{validator:"number"})?(this.__attrHandler.value=e,this.__processValue(),this.eventHandler.raise(n.NumberSelectFieldEvents.onNumberChanged),this):this}__processValue(){this.__input.setValue(this.__attrHandler.value),null==this.__attrHandler.value?this.setValue(0):(null!=this.__attrHandler.minValue&&(this.__attrHandler.value<=this.__attrHandler.minValue?this.__downButton.setIsEnabled(!1):this.__downButton.setIsEnabled(!0)),null!=this.__attrHandler.maxValue&&(this.__attrHandler.value>=this.__attrHandler.maxValue?this.__upButton.setIsEnabled(!1):this.__upButton.setIsEnabled(!0)))}getValue(){return this.__attrHandler.value}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(this.__attrHandler.minValue=e,this.__processMinValue(),this):this}__processMinValue(){this.__input.setMinValue(this.__attrHandler.minValue),null==this.__attrHandler.minValue?(this.__upButton.setIsEnabled(!0),this.__downButton.setIsEnabled(!0)):null!=this.__attrHandler.value&&(this.__attrHandler.value<=this.__attrHandler.minValue?this.__downButton.setIsEnabled(!1):this.__downButton.setIsEnabled(!0))}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(this.__attrHandler.maxValue=e,this.__processMaxValue(),this):this}__processMaxValue(){this.__input.setMaxValue(this.__attrHandler.maxValue),null==this.__attrHandler.maxValue?(this.__upButton.setIsEnabled(!0),this.__downButton.setIsEnabled(!0)):null!=this.__attrHandler.value&&(this.__attrHandler.value>=this.__attrHandler.maxValue?this.__upButton.setIsEnabled(!1):this.__upButton.setIsEnabled(!0))}getMaxValue(){return this.__attrHandler.maxValue}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this):this}__processOrientation(){this.__attrHandler.orientation===e.Orientation.horizontal?this.__element.addClass("horizontal"):this.__element.removeClass("horizontal")}getOrientation(){return this.__attrHandler.orientation}__processReadOnly(){var e;super.__processReadOnly(),null===(e=this.__input)||void 0===e||e.setReadOnly(this.__attrHandler.readOnly)}}t.NumberSelectField=n,function(e){let t;!function(e){e.onNumberChanged="onNumberChanged"}(t=e.NumberSelectFieldEvents||(e.NumberSelectFieldEvents={}))}(n=t.NumberSelectField||(t.NumberSelectField={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(t){!function(a){class i extends a.ContentWindow{constructor(e,t,a){super(e,t,a),this.__stopClosing=!1}__init(e){super.__init(e),null==e.buttons&&this.setButtons(i.Buttons.Cancel),this.layoutHandler.setAutoUpdateAttributes(["left","top","width","height"]),this.__selectHandler=e=>{null!=e.button&&0!=e.button||this.focus()},this.__minimizedDownHandler=e=>{if(null!=e.button&&0!=e.button)return;let t=()=>{this.toggleMinimize(),this.__element.off("pointerup",t)};this.__element.on("pointerup",t),this.__element.off("pointerdown",this.__minimizedDownHandler)},this.__element.addClass("dialog-window"),n.register(this)}__attach(){var e,t,a,n;this.__isAttached||(this.__element.hasClass("maximized")||null==(null===(e=this.__attrHandler.layout)||void 0===e?void 0:e.left)&&null==(null===(t=this.__attrHandler.layout)||void 0===t?void 0:t.right)&&null==(null===(a=this.__attrHandler.layout)||void 0===a?void 0:a.bottom)&&null==(null===(n=this.__attrHandler.layout)||void 0===n?void 0:n.top)&&this.__adjustPositionToCenter(),this.__makeDragable(),this.__element.on("pointerdown",this.__selectHandler),this.eventHandler.raise(i.DialogWindowEvents.onOpened),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown",this.__selectHandler),super.__detach())}destroy(){var e;n.deregister(this),null===(e=this.__defaultButtonsContainer)||void 0===e||e.destroy(),super.destroy()}onResized(){if(super.onResized(),this.__defaultButtonsContainer){let e=this.__defaultButtonsContainer.getElement().width(),t=Number(this.__defaultButtonsContainer.getElement().css("margin-right").replace("px",""));t=isNaN(t)?0:t,e=null!=e?e+t:0;let a=this.__headline.layoutHandler.getMaxWidth(),i=(null!=a?a:0)-e;this.__headline.layoutHandler.setMaxWidth(i)}}__adjustPositionToCenter(){var e,t,a,i,n,s,r,o;if(null==(null===(e=this.__attrHandler.layout)||void 0===e?void 0:e.left)&&null==(null===(t=this.__attrHandler.layout)||void 0===t?void 0:t.top)){let e=$(window).outerWidth(),t=$(window).outerHeight();if(null!=t&&null!=e)if(e>0&&t>0){let l,d,_,h,c,u;if(null!=(null===(a=this.__attrHandler.layout)||void 0===a?void 0:a.maxHeight)&&(d="%"===this.__attrHandler.layout.maxHeightUnit?t/100*this.__attrHandler.layout.maxHeight:this.__attrHandler.layout.maxHeight),null!=(null===(i=this.__attrHandler.layout)||void 0===i?void 0:i.maxWidth)&&(l="%"===this.__attrHandler.layout.maxWidthUnit?e/100*this.__attrHandler.layout.maxWidth:this.__attrHandler.layout.maxWidth),null!=(null===(n=this.__attrHandler.layout)||void 0===n?void 0:n.minHeight)&&(h="%"===this.__attrHandler.layout.minHeightUnit?t/100*this.__attrHandler.layout.minHeight:this.__attrHandler.layout.minHeight),null!=(null===(s=this.__attrHandler.layout)||void 0===s?void 0:s.minWidth)&&(_="%"===this.__attrHandler.layout.minWidthUnit?e/100*this.__attrHandler.layout.minWidth:this.__attrHandler.layout.minWidth),u=null!=(null===(r=this.__attrHandler.layout)||void 0===r?void 0:r.height)?"%"===this.__attrHandler.layout.heightUnit?t/100*this.__attrHandler.layout.height:this.__attrHandler.layout.height:this.__element.outerHeight(),c=null!=(null===(o=this.__attrHandler.layout)||void 0===o?void 0:o.width)?"%"===this.__attrHandler.layout.widthUnit?e/100*this.__attrHandler.layout.width:this.__attrHandler.layout.width:this.__element.outerWidth(),void 0!==u?void 0!==h&&u<h?u=h:void 0!==d&&u>d&&(u=d):u=h,void 0!==c?void 0!==_&&c<_?c=_:void 0!==l&&c>l&&(c=l):c=_,void 0!==c)if(c>0){let t=e/2-c/2;t<=10&&(t=10),this.layoutHandler.setLeft(t)}else this.layoutHandler.setLeft(50);if(void 0!==u)if(u>0){let e=t/2-u/2;e<=10&&(e=10),this.layoutHandler.setTop(e)}else this.layoutHandler.setTop(50)}else this.layoutHandler.setLeft(0).setTop(0)}}__updateHeaderElementsOrder(){var e,t;this.controlContainer.getElement().detach(),null===(e=this.__defaultButtonsContainer)||void 0===e||e.getElement().detach(),null===(t=this.__menuButton)||void 0===t||t.getElement().detach(),this.controlContainer.getControls().length>0&&this.__header.append(this.controlContainer.getElement()),this.__contextMenu&&this.__header.append(this.__menuButton.getElement()),null!=this.__attrHandler.buttons&&this.__defaultButtonsContainer&&this.__header.append(this.__defaultButtonsContainer.getElement())}__makeDragable(){let e={limitingContainer:$("body")};this.__openedModal&&(e.allowHorizontalMovement=!1,e.allowVerticalMovement=!1),t.Helper.DragableElement.makeDragable(this.__element,this.__header,e)}__resetDragable(){t.Helper.DragableElement.resetDragable(this.__element,this.__header)}open(e){return this.__isOpen?(this.__isMinimized&&this.toggleMinimize(),this.focus()):(void 0===e&&(e=this.__attrHandler.modal),e?(this.__openedModal=!0,t.System.OverlayContainer.set(this.__element)):(this.__openedModal=!1,$("body").append(this.__element),this.__element.addClass("resizeable")),this.__isOpen=!0),this}close(){if(!0===this.__isOpen){if(this.eventHandler.raise(i.DialogWindowEvents.onClosing),this.__stopClosing)return this.__stopClosing=!1,this;this.__openedModal?t.System.OverlayContainer.remove(this.__element):(this.__element.detach(),this.__element.removeClass("resizeable")),this.__isOpen=!1,this.__openedModal=!1,this.eventHandler.raise(i.DialogWindowEvents.onClosed)}return this}stopClosing(){this.__stopClosing=!0}confirm(){return!0===this.__isOpen&&(this.eventHandler.raise(i.DialogWindowEvents.onConfirmed),0==this.__stopClosing?this.close():this.__stopClosing=!1),this}focus(){return this.__header.addClass("selected"),this.__element.addClass("selected"),this.layoutHandler.setZindex(11),this.eventHandler.raise(i.DialogWindowEvents.onFocused),this}unfocus(e){this.__header.removeClass("selected"),this.__element.removeClass("selected"),e&&this.layoutHandler.setZindex(10)}getIsOpen(){return null!=this.__isOpen&&this.__isOpen}getHeader(){return this.__header}getContentContainer(){return this.__contentContainer}toggleMaximize(){this.__element.toggleClass("maximized"),this.__element.hasClass("maximized")?this.__layoutBeforeMaximized=this.layoutHandler.reset():this.__layoutBeforeMaximized&&this.layoutHandler.setAttributes(this.__layoutBeforeMaximized)}toggleMinimize(){this.__isMinimized?(this.__isMinimized=!1,this.__element.removeClass("minimized"),this.__element.append(this.__contentContainer),this.__layoutBeforeMinimized&&this.layoutHandler.setAttributes(this.__layoutBeforeMinimized),this.__makeDragable(),this.__headline.textHandler.setOverflow(a.TextHandler.Overflow.marquee),this.__element.off("pointerdown",this.__minimizedDownHandler)):(this.__isMinimized=!0,this.__element.addClass("minimized"),this.__element.on("pointerdown",this.__minimizedDownHandler),this.__contentContainer.detach(),this.__layoutBeforeMinimized=this.layoutHandler.reset(),this.__resetDragable(),this.__headline.textHandler.setOverflow(a.TextHandler.Overflow.ellipsis)),this.eventHandler.raise(i.DialogWindowEvents.onMinimizedChanged)}getIsMinimized(){return this.__isMinimized}setAttributes(e){return super.setAttributes(e),void 0!==e.buttons&&this.setButtons(e.buttons),void 0!==e.modal&&(this.__attrHandler.modal=e.modal),this}getAttributes(){return this.__attrHandler.getRef()}setButtons(e){return this.__attrHandler.checkAttribute(e,"buttons",{validator:"number"})?(this.__attrHandler.buttons=e,this.__processButtons(),this):this}__processButtons(){var e;null===this.__attrHandler.buttons?null===(e=this.__defaultButtonsContainer)||void 0===e||e.removeAllControls():(this.__defaultButtonsContainer||(this.__defaultButtonsContainer=new a.ControlContainer(this.__id+"-default-buttons-container",this,{cssClass:"controls-container default-buttons-container"})),this.__attrHandler.buttons!==i.Buttons.CancelSize&&this.__attrHandler.buttons!==i.Buttons.OkCancelSize||(null==this.__defaultButtonsContainer.getControl("minimize-button")&&this.__defaultButtonsContainer.addControl({name:"minimize-button",type:a.ComponentType.Button,settings:{background:{image:t.Icons.Standard.Minus.path,useSVG:!0,imageHeight:80,imageHeightUnit:"%",imageWidth:60,imageWidthUnit:"%"},order:1},callback:()=>{this.toggleMinimize()}}),null==this.__defaultButtonsContainer.getControl("maximize-button")&&this.__defaultButtonsContainer.addControl({name:"maximize-button",type:a.ComponentType.Button,settings:{background:{image:t.Icons.Standard.Maximize.path,useSVG:!0,imageHeight:70,imageHeightUnit:"%",imageWidth:70,imageWidthUnit:"%"},order:2},callback:()=>{this.toggleMaximize()}})),this.__attrHandler.buttons!==i.Buttons.OkCancel&&this.__attrHandler.buttons!==i.Buttons.OkCancelSize||null==this.__defaultButtonsContainer.getControl("confirm-button")&&this.__defaultButtonsContainer.addControl({name:"confirm-button",type:a.ComponentType.Button,settings:{background:{image:t.Icons.Standard.Confirm.path,useSVG:!0,imageHeight:80,imageHeightUnit:"%",imageWidth:80,imageWidthUnit:"%"},order:3},callback:()=>{this.confirm()}}),this.__attrHandler.buttons!==i.Buttons.Cancel&&this.__attrHandler.buttons!==i.Buttons.OkCancel&&this.__attrHandler.buttons!==i.Buttons.CancelSize&&this.__attrHandler.buttons!==i.Buttons.OkCancelSize||(null==this.__defaultButtonsContainer.getControl("cancel-button")&&this.__defaultButtonsContainer.addControl({name:"cancel-button",type:a.ComponentType.Button,settings:{background:{image:t.Icons.Standard.Close.path,useSVG:!0,imageHeight:80,imageHeightUnit:"%",imageWidth:80,imageWidthUnit:"%"},order:4},callback:()=>{this.eventHandler.raise(i.DialogWindowEvents.onCanceled),this.close()}}),this.__attrHandler.buttons===i.Buttons.Cancel&&null!=this.__defaultButtonsContainer.getControl("confirm-button")&&this.__defaultButtonsContainer.removeControl("confirm-button")),this.__header.append(this.__defaultButtonsContainer.getElement()))}getButtons(){return this.__attrHandler.buttons}static createDialogWindow(t){if(null==t)return null;if(null!=t.appearance&&null!=t.appearance.content){let s=0,r="TcHmi.BuildingAutomation.Controls.DialogWindow-"+s;for(;void 0!==n.getRegisteredDialog(r);)s++,r="TcHmi.BuildingAutomation.Controls.DialogWindow-"+s;let o=new i(r,null);if(void 0!==o){let n,s,l,d;o.setAttributes(t.appearance);let _=()=>{var i;if(t.callbacks&&null!=t.callbacks.cbClosed&&t.callbacks.cbClosed(),null!=n&&n(),null!=s&&s(),null!=l&&l(),null!=d&&d(),1==(null===(i=t.behaviour)||void 0===i?void 0:i.destroyOnClose)){let e=e=>{e.destroy(),o.destroy()};o.eventHandler.register(a.BaseNode.BaseNodeEvents.onDetached,e)}let _=e.Controls.get(r+"-region");_&&(_.setTargetContent(""),_.destroy())},h=()=>{t.callbacks&&null!=t.callbacks.cbConfirmed&&t.callbacks.cbConfirmed()},c=()=>{t.callbacks&&null!=t.callbacks.cbClosing&&t.callbacks.cbClosing()},u=()=>{t.callbacks&&null!=t.callbacks.cbCanceled&&t.callbacks.cbCanceled()},g=()=>{t.callbacks&&null!=t.callbacks.cbOpened&&t.callbacks.cbOpened(),p()},p=o.eventHandler.register(i.DialogWindowEvents.onOpened,g);return t.appearance&&null!=t.appearance.buttons&&(n=o.eventHandler.register(i.DialogWindowEvents.onCanceled,u),s=o.eventHandler.register(i.DialogWindowEvents.onClosing,c),l=o.eventHandler.register(i.DialogWindowEvents.onClosed,_)),!t.appearance||t.appearance.buttons!==i.Buttons.OkCancel&&t.appearance.buttons!==i.Buttons.OkCancelSize||(d=o.eventHandler.register(i.DialogWindowEvents.onConfirmed,h)),o}}return null}static openDialogWindow(e){var t,a;null!=e&&(null===(t=this.createDialogWindow(Object.assign(Object.assign({},e),{behaviour:{destroyOnClose:!0}})))||void 0===t||t.open(null===(a=e.appearance)||void 0===a?void 0:a.modal))}static alert(e,n){return 0==(null==n?void 0:n.skipLog)&&t.Logger.log(t.Logger.Severity.error,e),new Promise((t,s)=>{let r=$("<div>").addClass("dialog-window-alert-content-container"),o=null==n?void 0:n.attr;null==o&&(o={}),null==o.fontSize&&(o.fontSize=14),null==o.fontWeight&&(o.fontWeight="Bold"),null==o.wordWrap&&(o.wordWrap=!0),null==o.overflow&&(o.overflow=a.TextHandler.Overflow.none),null==o.horizontalAlignment&&(o.horizontalAlignment="Left"),o.text=e;let l=new a.Textblock(Date.now().toString()+"-alert-msg-block",null,{cssClass:"dialog-window-alert-msg",textAttributes:o});r.append(l.getElement());let d=a.TextHandler.calculateTextSize(o,500);i.openDialogWindow({appearance:{modal:!0,headline:{textAttributes:{text:(null==n?void 0:n.header)?n.header:"Alert"}},layout:{width:d.width+20,height:d.height+55},content:r,buttons:i.Buttons.Cancel},callbacks:{cbClosed:()=>{l.destroy(),t()}}})})}static confirm(e,t,n){return new Promise((s,r)=>{let o=$("<div>").addClass("dialog-window-alert-content-container");null==n&&(n={}),null==n.fontSize&&(n.fontSize=14),null==n.fontWeight&&(n.fontWeight="Bold"),null==n.wordWrap&&(n.wordWrap=!0),null==n.overflow&&(n.overflow=a.TextHandler.Overflow.none),null==n.horizontalAlignment&&(n.horizontalAlignment="Left"),n.text=e;let l=new a.Textblock(Date.now().toString()+"-alert-msg-block",null,{cssClass:"dialog-window-alert-msg",textAttributes:n});o.append(l.getElement());let d=a.TextHandler.calculateTextSize(n,500);i.openDialogWindow({appearance:{modal:!0,headline:{textAttributes:{text:t||"Confirm"}},layout:{width:d.width+20,height:d.height+55},content:o,buttons:i.Buttons.OkCancel},callbacks:{cbClosed:()=>{l.destroy()},cbCanceled:()=>{s(!1)},cbConfirmed:()=>{s(!0)}}})})}static prompt(e,n,s,r){return new Promise((o,l)=>{var d;let _=$("<div>").addClass("dialog-window-alert-content-container prompt");null==r&&(r={}),null==r.fontSize&&(r.fontSize=14),null==r.fontWeight&&(r.fontWeight="Bold"),null==r.wordWrap&&(r.wordWrap=!0),null==r.overflow&&(r.overflow=a.TextHandler.Overflow.none),null==r.horizontalAlignment&&(r.horizontalAlignment="Left"),r.text=e;let h=new a.Textblock(Date.now().toString()+"-alert-msg-block",null,{cssClass:"dialog-window-alert-msg",textAttributes:r});_.append(h.getElement());let c=new a.InputBox(Date.now().toString()+"-prompt-input",null,{cssClass:"dialog-window-prompt-input",textAttributes:r,readOnly:!1,dataType:t.DataType.string});_.append(c.getElement()),c.setValue(n);let u=a.TextHandler.calculateTextSize(r,500),g=null===(d=i.createDialogWindow({appearance:{modal:!0,headline:{textAttributes:{text:s||"Prompt"}},layout:{width:u.width+20,height:u.height+55+35},content:_,buttons:i.Buttons.OkCancel},callbacks:{cbClosed:()=>{h.destroy(),c.destroy()},cbCanceled:()=>{o(null)},cbConfirmed:()=>{let e=c.getValue();o(null!=e?e:null)}},behaviour:{destroyOnClose:!0}}))||void 0===d?void 0:d.open();c.eventHandler.register(a.InputBox.InputBoxEvents.onUserInteractionFinished,e=>{e.destroy(),null==g||g.confirm()})})}static promptNumericWithLimits(e,a,n,s,r,o){return new Promise((l,d)=>__awaiter(this,void 0,void 0,(function*(){let d,_=!1;do{let h=yield i.prompt(`${e} (Min: ${n}; Max: ${s}):`,a.toString(),r,o);if(null==h)return void l(null);h=h.replace(",","."),d=Number(h),isNaN(d)?yield i.alert(t.Locale.Localization.getText(t.Locale.LangKey.NaN)+"!"):null!=n&&null!=s&&(d<n||d>s)?yield i.alert(tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ValueNotWithinLimits),n.toString(),s.toString())+"!"):_=!0}while(!_);l(d)})))}}a.DialogWindow=i,function(e){let t,a;!function(e){e[e.Cancel=0]="Cancel",e[e.CancelSize=1]="CancelSize",e[e.OkCancel=2]="OkCancel",e[e.OkCancelSize=3]="OkCancelSize"}(t=e.Buttons||(e.Buttons={})),function(e){e.onOpened="onDialogWindowOpened",e.onConfirmed="onDialogWindowConfirmed",e.onCanceled="onDialogWindowCanceled",e.onClosing="onDialogWindowClosing",e.onClosed="onDialogWindowClosed",e.onFocused="onDialogWindowFocused",e.onMinimizedChanged="onDialogWindowMinimizedChanged"}(a=e.DialogWindowEvents||(e.DialogWindowEvents={}))}(i=a.DialogWindow||(a.DialogWindow={}));class n{static __onDialogOpened(e){if(this.__registeredDialogs.has(e.getId())){if(this.__openDialogs.set(e.getId(),e)){for(let t of this.__openDialogs.values())if(t.getId()!==e.getId()){let a=e.layoutHandler.getLeft(),i=e.layoutHandler.getTop();null!=a&&t.layoutHandler.getLeft()===a&&e.layoutHandler.setLeft(a+25),null!=i&&t.layoutHandler.getTop()===i&&e.layoutHandler.setTop(i+25)}return e.focus(),!0}return console.warn("The opened dialog "+e.getId()+" could not be added to the open dialog dictionary of the dialog window management."),!1}return console.warn("The opened dialog "+e.getId()+" was not registered in the dialog window management."),!1}static __onDialogClosed(e){return!!this.__openDialogs.delete(e.getId())||(console.warn("The closed dialog "+e.getId()+" was not in the open dialog dictionary of the dialog window management."),!1)}static __onDialogFocused(e){if(this.__openDialogs.has(e.getId())){if(this.__focusedDialog&&e.getId()===this.__focusedDialog.getId())return!0;this.__focusedDialog=e;for(let t of this.__openDialogs.values())t.getId()!==e.getId()&&t.unfocus(!0);return!0}return console.warn("The focused dialog "+e.getId()+" was not in the open dialog dictionary of the dialog window management."),!1}static __onDialogMinimizedChanged(e){if(this.__openDialogs.get(e.getId())){let e=0;for(let t of this.__openDialogs.values())t.getIsMinimized()&&(t.layoutHandler.setLeft(e),e+=205);return!0}return console.warn(`The minimized dialog ${e.getId()} was not found in DialogWindowManager.`),!1}static register(e){if(0==this.__registeredDialogs.has(e.getId())){let t=[];return t.push(e.eventHandler.register(i.DialogWindowEvents.onOpened,()=>n.__onDialogOpened(e))),t.push(e.eventHandler.register(i.DialogWindowEvents.onClosed,()=>n.__onDialogClosed(e))),t.push(e.eventHandler.register(i.DialogWindowEvents.onFocused,()=>n.__onDialogFocused(e))),t.push(e.eventHandler.register(i.DialogWindowEvents.onMinimizedChanged,()=>n.__onDialogMinimizedChanged(e))),this.__registeredDialogs.set(e.getId(),{dialog:e,dfs:t}),!0}return!1}static deregister(e){let t=this.__registeredDialogs.get(e.getId());return null!=t&&(t.dfs.forEach(e=>e()),this.__registeredDialogs.delete(e.getId()))}static getRegisteredDialogsCnt(){return this.__registeredDialogs.size}static getRegisteredDialog(e){var t;return null===(t=this.__registeredDialogs.get(e))||void 0===t?void 0:t.dialog}}n.__openDialogs=new Map,n.__registeredDialogs=new Map}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i extends a.Base{constructor(e,t,a){super(e,t,a)}__init(e){var t,i;super.__init(e),this.__legendIconHandler=new a.LegendIconHandler,this.__button=new a.Button(this.__id+"-button",this),this.__edgeIcon=new a.Base(this.__id+"-edge-icon",this),this.__pressedHandler=()=>this.__onPressedHandler(),this.__element.addClass("event-icon"),this.__button.getElement().addClass("button"),this.__button.backgroundStyler.setImageHeight(80,"%").setImageWidth(80,"%"),void 0===(null===(t=null==e?void 0:e.background)||void 0===t?void 0:t.imageHeight)&&this.backgroundStyler.setImageHeight(100,"%"),void 0===(null===(i=null==e?void 0:e.background)||void 0===i?void 0:i.imageWidth)&&this.backgroundStyler.setImageWidth(100,"%"),this.__edgeIcon.getElement().addClass("edge-icon"),this.__edgeIcon.backgroundStyler.setImageHeight(80,"%").setImageWidth(80,"%"),this.setEventCount(1)}__attach(){this.__isAttached||(null!=this.__attrHandler.eventCondition&&this.__attrHandler.eventCondition>=t.BA.EventCondition.eTypeAlarm&&this.__attrHandler.eventCondition<=t.BA.EventCondition.eTypeOther&&(this.__button.setIsEnabled(!0),this.__destroyOnPressed=this.__button.eventHandler.register(a.Button.ButtonEvents.onPressed,this.__pressedHandler),this.__edgeIcon.getElement().on("click",this.__pressedHandler)),this.__setDisplayedEvent(),this.__legendIconHandler.show(),this.__destroyersToCallOnDetach.push(e.EventProvider.register("onThemeDataChanged",()=>{this.__setDisplayedEvent()})),super.__attach())}__detach(){this.__isAttached&&(null!=this.__destroyOnPressed&&this.__destroyOnPressed(),this.__legendIconHandler.hide(),super.__detach())}destroy(){this.__button.destroy(),this.__edgeIcon.destroy(),null!=this.__destroyOnPressed&&(this.__destroyOnPressed(),delete this.__destroyOnPressed),super.destroy()}__onPressedHandler(){null!=this.__attrHandler.acknowledgeMapping&&(e.Server.writeSymbol(this.__attrHandler.acknowledgeMapping,!0,t=>{t.error!==e.Errors.NONE&&console.error(e.Log.buildMessage(t.details))}),this.logger.log(t.Logger.Severity.debug,"Nothing was acknowledged in the PLC because no acknowledgeMapping was set!")),this.eventHandler.raise(i.EventIconEvents.onAcknowledged)}__setDisplayedEvent(){this.__element.removeClass("clickable"),this.__edgeIcon.backgroundStyler.setImage(t.Icons.Standard.Confirm.path,!0);let e=!1;if(null!=this.__attrHandler.eventCondition&&null!=this.__attrHandler.eventState){let n,s=i.getEventIconAndColor(this.__attrHandler.eventCondition,this.__attrHandler.eventState);switch(this.__attrHandler.eventCondition){case t.BA.EventCondition.eTypeAlarm:case t.BA.EventCondition.eTypeDisturb:case t.BA.EventCondition.eTypeMaintenance:case t.BA.EventCondition.eTypeNotification:case t.BA.EventCondition.eTypeOther:this.__attrHandler.eventState!==t.BA.EventIconState.eGoneAcked&&this.__attrHandler.eventState!==t.BA.EventIconState.ePresentAcked||(e=!0),this.__attrHandler.readOnly||this.__element.addClass("clickable");break;case t.BA.EventCondition.eLockPrioLocalMedium:case t.BA.EventCondition.eLockPrioLocalHigh:this.__edgeIcon.backgroundStyler.setImage(t.Icons.Standard.Hand.path,!0),this.__edgeIcon.getElement().addClass("hand"),e=!0}e?this.__element.append(this.__edgeIcon.getElement()):this.__edgeIcon.getElement().detach(),this.__attrHandler.readOnly?(this.__button.getElement().detach(),n=this):(this.__element.append(this.__button.getElement()),n=this.__button,this.backgroundStyler.setImage(null));let r=n.backgroundStyler.getSvg(),o=()=>{r&&s&&null!=this.__attrHandler.eventCondition&&null!=this.__attrHandler.eventState&&(this.__attrHandler.eventCondition>t.BA.EventCondition.eTypeOther||(this.__attrHandler.eventState===t.BA.EventIconState.eIndicatd?null!=s.color&&r.css({fill:"transparent",stroke:s.color.toString()}):null!=s.color&&(r.css({fill:s.color.toString(),stroke:s.color.toString()}),this.__attrHandler.eventCondition===t.BA.EventCondition.eTypeAlarm&&this.__attrHandler.eventState>t.BA.EventIconState.eNone&&r.css("stroke",""))))};r?o():n.eventHandler.register(a.BackgroundStyler.Events.onSvgLoaded,e=>{e.destroy(),r=n.backgroundStyler.getSvg(),o()}),s&&(this.__legendIconHandler.icon=s.icon,this.__isAttached&&this.__legendIconHandler.show(),n.backgroundStyler.setImage(s.icon.path,!0).setImageColor(s.color))}}static getEventIconAndColor(e,a){if(null==e)return null;let n,s=null;switch(e){case t.BA.EventCondition.eTypeAlarm:n=t.Icons.Events.Event.Alarm,s=t.Color.RGBAColor.Red,null!=a&&a<t.BA.EventIconState.ePresentAcked&&(s=i.GoneAckedColor),a===t.BA.EventIconState.eNone&&(n=t.Icons.Standard.Close);break;case t.BA.EventCondition.eTypeDisturb:n=t.Icons.Events.Event.Disturbance,s=t.Color.RGBAColor.DarkOrange,null!=a&&a<t.BA.EventIconState.ePresentAcked&&(s=i.GoneAckedColor),a===t.BA.EventIconState.eNone&&(n=t.Icons.Standard.Close);break;case t.BA.EventCondition.eTypeMaintenance:n=t.Icons.Events.Event.Maintenance,s=t.Color.RGBAColor.TcHmiBlue,null!=a&&a<t.BA.EventIconState.ePresentAcked&&(s=i.GoneAckedColor),a===t.BA.EventIconState.eNone&&(n=t.Icons.Standard.Close);break;case t.BA.EventCondition.eTypeNotification:n=t.Icons.Events.Event.Notification,s=t.Color.RGBAColor.TcHmiBlue,null!=a&&a<t.BA.EventIconState.ePresentAcked&&(s=i.GoneAckedColor),a===t.BA.EventIconState.eNone&&(n=t.Icons.Standard.Close);break;case t.BA.EventCondition.eTypeOther:n=t.Icons.Events.Event.Other,s=t.Color.RGBAColor.TcHmiBlue,null!=a&&a<t.BA.EventIconState.ePresentAcked&&(s=i.GoneAckedColor),a===t.BA.EventIconState.eNone&&(n=t.Icons.Standard.Close);break;case t.BA.EventCondition.eFlagFault:n=t.Icons.Events.Flag.Fault,s=t.Color.RGBAColor.DarkOrange;break;case t.BA.EventCondition.eFlagActiveEvent:n=t.Icons.Events.Flag.InAlarm,s=t.Color.RGBAColor.Red;break;case t.BA.EventCondition.eFlagOverridden:n=t.Icons.Events.Flag.Overridden,s=t.Color.RGBAColor.TcHmiBlue;break;case t.BA.EventCondition.eFlagOutOfService:n=t.Icons.Events.Flag.OutOfService,s=t.Color.RGBAColor.DarkOrange;break;case t.BA.EventCondition.ePrioLifeSafety:n=t.Icons.Events.Priority.Safety,s=t.Color.RGBAColor.Red;break;case t.BA.EventCondition.ePrioCritical:n=t.Icons.Events.Priority.Critical,s=t.Color.RGBAColor.DarkOrange;break;case t.BA.EventCondition.ePrioManualLocal:n=t.Icons.Events.Priority.ManualLocal,s=t.Color.RGBAColor.DarkOrange;break;case t.BA.EventCondition.ePrioManualRemote:n=t.Icons.Events.Priority.ManualRemote,s=t.Color.RGBAColor.TcHmiBlue;break;case t.BA.EventCondition.eLockPrioLocalMedium:case t.BA.EventCondition.eLockPrioMedium:n=t.Icons.Events.Lock.LockMedium,s=t.Color.RGBAColor.DarkOrange;break;case t.BA.EventCondition.eLockPrioLocalHigh:case t.BA.EventCondition.eLockPrioHigh:n=t.Icons.Events.Lock.LockHigh,s=t.Color.RGBAColor.Red;break;default:return null}return{icon:n,color:s}}setAttributes(e){return super.setAttributes(e),void 0!==e.eventCondition&&this.setEventCondition(e.eventCondition),void 0!==e.eventState&&this.setEventState(e.eventState),void 0!==e.eventCount&&this.setEventCount(e.eventCount),void 0!==e.acknowledgeMapping&&this.setAcknowledgeSymbol(e.acknowledgeMapping),this}getAttributes(){return this.__attrHandler.getRef()}setEventCondition(e){return this.__attrHandler.checkAttribute(e,"eventCondition",{validator:"number"})?(this.__attrHandler.eventCondition=e,this.__processEventCondition(),this):this}__processEventCondition(){null!=this.__attrHandler.eventCondition&&this.__attrHandler.eventCondition>=t.BA.EventCondition.eTypeAlarm&&this.__attrHandler.eventCondition<=t.BA.EventCondition.eTypeOther?this.__button.getIsEnabled()||(this.__button.setIsEnabled(!0),this.__isAttached&&null==this.__destroyOnPressed&&(this.__destroyOnPressed=this.__button.eventHandler.register(a.Button.ButtonEvents.onPressed,this.__pressedHandler),this.__edgeIcon.getElement().on("click",this.__pressedHandler))):(this.__button.setIsEnabled(!1),null!=this.__destroyOnPressed&&this.__destroyOnPressed(),this.__edgeIcon.getElement().off("click",this.__pressedHandler)),this.__isAttached&&this.__setDisplayedEvent()}getEventCondition(){return this.__attrHandler.eventCondition}setEventState(e){return this.__attrHandler.checkAttribute(e,"eventState",{validator:"number"})?(this.__attrHandler.eventState=e,this.__isAttached&&this.__setDisplayedEvent(),this):this}getEventState(){return this.__attrHandler.eventState}setEventCount(e){return this.__attrHandler.checkAttribute(e,"eventCount",{validator:"number"})?(this.__attrHandler.eventCount=e,this.__processEventCount(),this):this}__processEventCount(){null!=this.__attrHandler.eventCount&&this.__attrHandler.eventCount>1?a.Button.addBadge(this.__element,this.__attrHandler.eventCount):a.Button.addBadge(this.__element,0)}getEventCount(){return this.__attrHandler.eventCount}setAcknowledgeSymbol(e){return this.__attrHandler.checkAttribute(e,"acknowledgeMapping",{validator:"string"})?(this.__attrHandler.acknowledgeMapping=e,this):this}getAcknowledgeMapping(){return this.__attrHandler.acknowledgeMapping}setIcon(e){return this.__attrHandler.checkAttribute(e,"icon",{validator:"string"})?(this.__attrHandler.icon=e,this.__button.backgroundStyler.setImage(e,!0),this):this}getIcon(){return this.__button.backgroundStyler.getImage()}__processReadOnly(){super.__processReadOnly(),this.__isAttached&&this.__setDisplayedEvent()}}a.EventIcon=i,function(e){let a;!function(e){e.onAcknowledged="onAcknowledged"}(a=e.EventIconEvents||(e.EventIconEvents={})),e.GoneAckedColor=t.Color.RGBAColor.Black}(i=a.EventIcon||(a.EventIcon={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),TcHmi.EventProvider.register("onThemeDataChanged",()=>{"Base-Dark"===TcHmi.Theme.get()?TcHmi.BuildingAutomation.Components.EventIcon.GoneAckedColor=TcHmi.BuildingAutomation.Color.RGBAColor.Gray:TcHmi.BuildingAutomation.Components.EventIcon.GoneAckedColor=TcHmi.BuildingAutomation.Color.RGBAColor.Black}),function(e){!function(t){!function(a){class i extends a.TextControl{constructor(e,t,a){super(e,t,a),this.__warnColorActive=!1}__init(e){super.__init(e),this.baObjectHandler=new t.BaObjectHandler(this),this.valueHandler=new t.System.ValueHandler(this),this.__usedDataType=t.DataType.unknown,this.__keydownHandler=e=>this.__onKeyDown(e),this.__pasteHandler=e=>this.__onTextPaste(e),this.__focusinHandler=e=>this.__onFocusIn(e),this.__focusoutHandler=e=>this.__onFocusOut(e),this.__input=$('<input autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" data-tchmi-input-mode="none" />').addClass("text-element"),this.__element.addClass("input-box"),void 0===(null==e?void 0:e.readOnly)&&this.setReadOnly(!0),void 0===(null==e?void 0:e.digits)&&this.setDigits(1)}__attach(){this.__isAttached||(this.__input.on("focusin",this.__focusinHandler),this.__input.on("click pointerdown",t.EventHandler.stopPropagationHandler),super.__attach())}__detach(){this.__isAttached&&(this.__input.off("keydown",this.__keydownHandler),this.__input.off("paste",this.__pasteHandler),this.__input.off("focusout",this.__focusoutHandler),this.__input.off("focusin",this.__focusinHandler),this.__input.off("click pointerdown",t.EventHandler.stopPropagationHandler),super.__detach())}destroy(){super.destroy(),this.valueHandler.destroy()}__onKeyDown(e){let a=e.originalEvent,i=e.keyCode;if(this.__usedDataType===t.DataType.unknown){let e=a.getModifierState("CapsLock"),n=a.getModifierState("Shift"),s=a.getModifierState("Alt");i>=48&&i<=57&&(!e||!n||!s)||i>=96&&i<=105?this.__setUsedDataType(t.DataType.number):(i>=65&&i<=90||i>=48&&i<=48&&(e||n||s))&&this.__setUsedDataType(t.DataType.string)}this.__validateInput(a)||this.__setWarnColor(!1)}__onTextPaste(e){let a=e.originalEvent,i=a.clipboardData;if(null!==i){let e=i.getData("text"),n=this.__detectDataType(e);this.__usedDataType===t.DataType.number&&n!=t.DataType.number&&n!=t.DataType.integer&&(this.__setWarnColor(!1),a.preventDefault())}}__onFocusIn(a){if(null!=this.__attrHandler.minValue&&null!=this.__attrHandler.maxValue&&this.__attrHandler.maxValue==this.__attrHandler.minValue&&this.logger.log(t.Logger.Severity.warn,"Min and max values of silder are equal. No input will be possible!"),this.__input.on("keydown",this.__keydownHandler),this.__input.on("paste",this.__pasteHandler),this.__input.on("focusout",this.__focusoutHandler),(this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer)&&null!=this.__attrHandler.unit){let e=String(this.__input.val());e.indexOf(this.__attrHandler.unit)>0&&(e=e.replace(" "+this.__attrHandler.unit,""),this.__input.val(e))}this.__input.select(),this.baObjectHandler.baObject&&(this.__lowLimit||(this.__lowLimit=this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eLowLimit),this.__lowLimit&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eLowLimit,e=>{e&&e.bEnable?this.setMinValue(e.fValue):this.setMinValue(null)})),this.__highLimit||(this.__highLimit=this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eHighLimit),this.__highLimit&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eHighLimit,e=>{e&&e.bEnable?this.setMaxValue(e.fValue):this.setMaxValue(null)}))),this.eventHandler.raise(i.InputBoxEvents.onFocusIn),e.EventProvider.raise(e.BuildingAutomation.Components.InputBox.InputBoxEvents.onFocusIn,this)}__onFocusOut(t){this.__input.off("keydown",this.__keydownHandler),this.__input.off("paste",this.__pasteHandler),this.__input.off("focusout",this.__focusoutHandler),this.__setWarnColor(!0),this.__endUserInteraction(),this.eventHandler.raise(i.InputBoxEvents.onFocusOut),e.EventProvider.raise(e.BuildingAutomation.Components.InputBox.InputBoxEvents.onFocusOut,this)}onValueChanged(e){this.setValue(e)}__endUserInteraction(){this.__input.off("keydown",this.__keydownHandler),this.__input.off("paste",this.__pasteHandler),this.__input.off("focusout",this.__focusoutHandler);let a=String(this.__input.val()),n=null;if(this.__usedDataType===t.DataType.unknown&&this.__setUsedDataType(this.__detectDataType(a)),this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer){a=a.replace(",",".");let e=Number(a);isNaN(e)?console.error("The entered text is not a number: "+a):(this.__checkMinMax(e)||(this.__setWarnColor(!1),null!=this.__attrHandler.minValue&&e<this.__attrHandler.minValue&&(e=this.__attrHandler.minValue),null!=this.__attrHandler.maxValue&&e>this.__attrHandler.maxValue&&(e=this.__attrHandler.maxValue)),e!=this.__attrHandler.value&&(n=e),this.__updateTextElements(e))}else a!=this.__attrHandler.value&&(n=a);if(null!=n){if(this.__setValueInternal(n),null!=this.__attrHandler.valueFeedback&&this.__attrHandler.value!=this.__attrHandler.valueFeedback){let e=()=>{this.__valueFeedbackReady&&this.__valueFeedbackReady(),null!=this.__attrHandler.valueFeedback&&this.__setValueInternal(this.__attrHandler.valueFeedback)};this.__valueFeedbackReady=this.busyHandler.setBusy("Waiting for ValueFeedback",{cbOnTimeout:e,optionalOutput:"Hint: Maybe the object is logged by a higher priority?"})}null!=this.__attrHandler.value&&this.valueHandler.processChangedValue(this.__attrHandler.value),this.eventHandler.raise(i.InputBoxEvents.onUserInteractionFinished),e.EventProvider.raise(e.BuildingAutomation.Components.InputBox.InputBoxEvents.onUserInteractionFinished,this)}}__validateInput(e){let a=e.keyCode,i=String(this.__input.val());if(null!=this.__attrHandler.unit&&i.indexOf(this.__attrHandler.unit)&&i.replace(" "+this.__attrHandler.unit,""),16===a||20===a||9===a||18===a||91===a)return!0;if(this.__usedDataType!==t.DataType.number&&this.__usedDataType!==t.DataType.integer||!(a>=48&&a<=57||a>=96&&a<=105||8===a||13===a||a>=37&&a<=40||46===a||190===a||189===a||109===a||110===a||188===a)||e.getModifierState("CapsLock")||e.getModifierState("Shift")||e.getModifierState("Alt"))return this.__usedDataType===t.DataType.string||this.__usedDataType===t.DataType.unknown?(13===a&&(e.preventDefault(),this.__endUserInteraction(),this.__input.blur()),!0):!(!e.getModifierState("Control")||e.getModifierState("Alt"))||(e.preventDefault(),!1);if(this.__usedDataType===t.DataType.integer&&(","===e.key||"."===e.key))return e.preventDefault(),!1;if(null!=this.__attrHandler.digits&&this.__attrHandler.digits>-1&&this.__attrHandler.digits<=0&&(","===e.key||"."===e.key))return e.preventDefault(),!1;if(","===e.key||"."===e.key)for(let t=0;t<i.length;t++)if(","===i[t]||"."===i[t])return e.preventDefault(),!1;if(13===a){if(i=i.replace(",","."),!this.__checkMinMax(Number(i)))return e.preventDefault(),!1;this.__endUserInteraction(),this.__input.blur()}return!0}__updateTextElements(e){null==e?(this.__input.val(""),this.textHandler.setText("")):this.__usedDataType!==t.DataType.number&&this.__usedDataType!==t.DataType.integer||"number"!=typeof e?(this.__input.val(e),this.textHandler.setText(e.toString())):(e=null!=this.__attrHandler.digits?e.toFixed(this.__attrHandler.digits):e.toFixed(0),this.__input.val(null!=this.__attrHandler.unit?e+" "+this.__attrHandler.unit:e),this.textHandler.setText(null!=this.__attrHandler.unit?e+" "+this.__attrHandler.unit:e.toString()))}__checkMinMax(e){return isNaN(e)?(console.error("The number to check is not a number: "+e),!1):null!=this.__attrHandler.minValue&&e<this.__attrHandler.minValue?(this.__element.attr("data-tooltip","Entered value is lower than minium value \nMinium value is: "+this.__attrHandler.minValue),this.__element.addClass("add-input-info"),this.__element.addClass("show-input-info"),setTimeout(()=>{this.__element.removeClass("show-input-info")},3e3),this.__setValueInternal(this.__attrHandler.minValue),!1):!(null!=this.__attrHandler.maxValue&&e>this.__attrHandler.maxValue)||(this.__element.attr("data-tooltip","Entered value is higher than maximum value \nMaximum value is: "+this.__attrHandler.maxValue),this.__element.addClass("add-input-info"),this.__element.addClass("show-input-info"),setTimeout(()=>{this.__element.removeClass("show-input-info")},3e3),this.__setValueInternal(this.__attrHandler.maxValue),!1)}__setWarnColor(e){if(e)null!=this.__oldBackgroundColor&&!0===this.__warnColorActive?this.backgroundStyler.setColor(this.__oldBackgroundColor):this.backgroundStyler.setColor(null),this.__warnColorActive=!1;else if(!1===this.__warnColorActive){if(this.__oldBackgroundColor=this.backgroundStyler.getColor(),null==this.__oldBackgroundColor)try{this.__oldBackgroundColor=t.Color.RGBAColor.fromCssString(this.__element.css("--tchmi-ba-background-styler-background-color"))}catch(e){this.__oldBackgroundColor=null}this.backgroundStyler.setColor(t.Color.RGBAColor.Red),this.__warnColorActive=!0,setTimeout(()=>{this.__setWarnColor(!0)},1e3)}}__detectDataType(e){if("number"==typeof e)return Number.isInteger(e)?t.DataType.integer:t.DataType.number;if("string"==typeof e&&e.length>0){let a=Number(e);return isNaN(a)?t.DataType.string:this.__detectDataType(a)}return t.DataType.unknown}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.value&&this.setValue(e.value),e.valueFeedback&&this.setValueFeedback(e.valueFeedback),void 0!==e.dataType&&this.setDataType(e.dataType),void 0!==e.digits&&this.setDigits(e.digits),void 0!==e.minValue&&this.setMinValue(e.minValue),void 0!==e.maxValue&&this.setMaxValue(e.maxValue),void 0!==e.unit&&this.setUnit(e.unit),void 0!==e.baObject&&this.baObjectHandler.setBaObject(e.baObject),this}getAttributes(){return this.__attrHandler.getRef()}__setUsedDataType(e){return void 0===e?this:null!=e&&"number"!=typeof e?(this.__attrHandler.invalidAttribute("UsedDateType",e),this):e===this.__usedDataType?(this.__attrHandler.equalAttribute("UsedDataType"),this):(this.__usedDataType=e,this.__processUsedDataType(),this)}__processUsedDataType(){null==this.__usedDataType?this.__usedDataType=t.DataType.unknown:null!=this.__attrHandler.value&&(this.__usedDataType!==t.DataType.number&&this.__usedDataType!==t.DataType.integer||(isNaN(Number(this.__attrHandler.value))?this.__setValueInternal("0"):this.__setValueInternal(Number(this.__attrHandler.value)))),this.__updateTextElements(this.__attrHandler.value)}getUsedDataType(){return this.__usedDataType}setValue(e){return this.__attrHandler.checkAttribute(e,"value",{validator:["number","string"],skipEqualityCheck:!0})?e===this.__attrHandler.value||null!=e&&"number"==typeof e&&"number"==typeof this.__attrHandler.value&&null!=this.__attrHandler.digits&&e===Number(this.__attrHandler.value.toFixed(this.__attrHandler.digits))?(this.__attrHandler.equalAttribute("Value"),this):(null==this.__attrHandler.valueFeedback&&this.__setValueInternal(e),this):this}__setValueInternal(e){e!==this.__attrHandler.value&&(this.__attrHandler.value=e,this.__processValue(),this.eventHandler.raise(i.InputBoxEvents.onValueChanged))}__processValue(){if(null==this.__attrHandler.value)this.__setUsedDataType(null);else if(this.__usedDataType===t.DataType.unknown&&(null!=this.__attrHandler.dataType&&this.__attrHandler.dataType>t.DataType.unknown?this.__setUsedDataType(this.__attrHandler.dataType):this.__setUsedDataType(this.__detectDataType(this.__attrHandler.value))),(this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer)&&"number"!=typeof this.__attrHandler.value){let e=Number(this.__attrHandler.value);isNaN(e)?this.logger.log(t.Logger.Severity.warn,"The value of text is not a number: "+this.__attrHandler.value):this.__attrHandler.value=e}this.__updateTextElements(this.__attrHandler.value)}getValue(){return this.__attrHandler.value}setValueFeedback(e){return this.__attrHandler.checkAttribute(e,"valueFeedback",{validator:["number","string"],skipEqualityCheck:!0})?e===this.__attrHandler.valueFeedback||null!=e&&"number"==typeof e&&"number"==typeof this.__attrHandler.valueFeedback&&null!=this.__attrHandler.digits&&e===Number(this.__attrHandler.valueFeedback.toFixed(this.__attrHandler.digits))?(this.__attrHandler.equalAttribute("ValueFeedback"),this):(this.__attrHandler.valueFeedback=e,null!=this.__attrHandler.valueFeedback?this.__processValueFeedback():this.__processValue(),this.__valueFeedbackReady&&this.__valueFeedbackReady(),this.eventHandler.raise(i.InputBoxEvents.onValueFeedbackChanged),this):this}__processValueFeedback(){if(null!=this.__attrHandler.valueFeedback&&(this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer)&&"number"!=typeof this.__attrHandler.valueFeedback){let e=Number(this.__attrHandler.valueFeedback);isNaN(e)?this.logger.log(t.Logger.Severity.warn,"The value of text feedback is not a number: "+this.__attrHandler.valueFeedback):this.__attrHandler.valueFeedback=e}this.__setValueInternal(this.__attrHandler.valueFeedback)}getValueFeedback(){return this.__attrHandler.valueFeedback}setDataType(e){return this.__attrHandler.checkAttribute(e,"dataType",{validator:"number"})?(this.__attrHandler.dataType=e,this.__processDataType(),this):this}__processDataType(){if(null==this.__attrHandler.dataType)this.__setUsedDataType(null);else if(this.__attrHandler.dataType===t.DataType.unknown&&null!==this.__attrHandler.value){let e=this.__detectDataType(this.__attrHandler.value);e>t.DataType.unknown&&this.__setUsedDataType(e)}else switch(this.__attrHandler.dataType){case t.DataType.number:case t.DataType.integer:this.__setUsedDataType(t.DataType.number),this.__attrHandler.dataType===t.DataType.integer&&this.setDigits(0);break;case t.DataType.string:this.__setUsedDataType(t.DataType.string);break;case t.DataType.unknown:this.__setUsedDataType(null);break;default:console.warn(`DataType of InputBox ${this.__id} is invalid!`)}this.__input.attr("data-tchmi-data-type",null!=this.__attrHandler.dataType?this.__attrHandler.dataType:t.DataType.string)}getDataType(){return this.__attrHandler.dataType}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(this.__attrHandler.minValue=e,this.__processMinValue(),this):this}__processMinValue(){this.__attrHandler.minValue}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(this.__attrHandler.maxValue=e,this.__processMaxValue(),this):this}__processMaxValue(){this.__attrHandler.maxValue}getMaxValue(){return this.__attrHandler.maxValue}setUnit(a){if(!this.__attrHandler.checkAttribute(a,"unit",{validator:["string","number"]}))return this;if("number"==typeof a)if(void 0!==t.Globals.Units)a=t.Helper.convertUnitToString(a),this.__attrHandler.unit=a,this.__processUnit();else{this.__attrHandler.unit=t.BA.Unit[a],this.__processUnit();let i=e.EventProvider.register("CustomBA.onUnitsLoaded",()=>{this.__attrHandler.unit=t.Helper.convertUnitToString(a),this.__processUnit(),i()})}else this.__attrHandler.unit=a,this.__processUnit();return this}__processUnit(){let e=String(this.__input.val());this.__usedDataType===t.DataType.number||this.__usedDataType===t.DataType.integer?(null!==this.__oldUnit&&(e=e.replace(" "+this.__oldUnit,"")),null!=this.__attrHandler.unit&&(e=e+" "+this.__attrHandler.unit),this.__oldUnit=this.__attrHandler.unit,this.__input.val(e),this.textHandler.setText(e)):this.__oldUnit=this.__attrHandler.unit}getUnit(){return this.__attrHandler.unit}setDigits(e){return this.__attrHandler.checkAttribute(e,"digits",{validator:"number"})?(this.__attrHandler.dataType===t.DataType.integer&&0!==e&&(console.warn(`Data type of InputBox ${this.__id} is 'integer' and no digits are allowed! Processing with 0 digits!`),e=0),this.__attrHandler.digits=e,this.__updateTextElements(this.__attrHandler.value),this):this}getDigits(){return this.__attrHandler.digits}__processReadOnly(){super.__processReadOnly(),null==this.__attrHandler.readOnly||!0===this.__attrHandler.readOnly?(this.__element.removeClass("editable"),this.__element.append(this.textHandler.getTextElement()),this.__input.detach()):(this.__element.addClass("editable"),this.__element.append(this.__input),this.textHandler.getTextElement().detach())}processBaObject(){if(null==this.baObjectHandler.baObject)return this.setValue(null),this.setValueFeedback(null),void this.setDataType(null);this.baObjectHandler.baObject.DataType===t.DataType.number&&(this.setDataType(t.DataType.number),this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,e=>{this.setValueFeedback(e)}),this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eOutputUnit)?this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eOutputUnit,e=>{this.setUnit(e)}):this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eUnit,e=>{this.setUnit(e)}),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess()))}}a.InputBox=i,function(e){let t;!function(e){e.onFocusIn="onFocusIn",e.onFocusOut="onFocusOut",e.onUserInteractionFinished="onUserInteractionFinished",e.onValueChanged="onValueChanged",e.onValueFeedbackChanged="onValueFeedbackChanged"}(t=e.InputBoxEvents||(e.InputBoxEvents={}))}(i=a.InputBox||(a.InputBox={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i extends a.Base{constructor(i,n,r){super(i,n,r),this.__categories=new Map,this.__entries=new Map,this.__entryCounter=0,this.__iconData=[],this.__iconDataCustom=[],this.__element.addClass("legend"),this.__tabWindow=new a.TabWindow(this.__id+"-tab-window",this,{tabSizeAuto:!0}),this.__contentWindow=new a.ContentWindow(this.__id+"-content-window",this,{headline:{textAttributes:{text:t.Locale.Localization.getSymbolExpression(t.Locale.LangKey.Legend)}}}),this.__constructLegend(),this.__updateLegend(),this.__destroyOnIconsChanged=e.EventProvider.register(s.onIconsChanged,()=>{this.__updateLegend()})}__init(e){super.__init(e),this.__attrHandler.visibilityHeadline=e.visibilityHeadline||!1,this.__attrHandler.tabPosition=e.tabPosition||t.Position.left,this.__attrHandler.entryWidth=e.entryWidth||172,this.__attrHandler.entryWidthUnit=e.entryWidthUnit||"px",this.__attrHandler.iconDataSource=e.iconDataSource||i.IconDataSource.All,this.__attrHandler.iconDataCustom=e.iconDataCustom||[]}__attach(){this.__isAttached||(super.__attach(),this.__processEntryWidth())}__detach(){this.__isAttached&&super.__detach()}destroy(){null!=this.__destroyOnIconsChanged&&this.__destroyOnIconsChanged(),null!=this.__entries&&(this.__entries.forEach(e=>{e.icon.destroy(),e.label.destroy()}),this.__entries.clear()),null!=this.__categories&&(this.__categories.forEach(e=>{e.content.detach(),e.tab.destroy()}),this.__categories.clear()),null!=this.__iconData&&(this.__iconData.length=0),null!=this.__iconDataCustom&&(this.__iconDataCustom.length=0),null!=this.__tabWindow&&this.__tabWindow.destroy(),null!=this.__contentWindow&&this.__contentWindow.destroy(),super.destroy()}__constructLegend(){this.__element.empty(),this.__tabWindow.setTabPosition(this.__attrHandler.tabPosition),this.__attrHandler.visibilityHeadline?(this.__contentWindow.setAttributes({content:this.__tabWindow.getElement()}),this.__element.append(this.__contentWindow.getElement())):this.__element.append(this.__tabWindow.getElement())}__getCategories(e){let t,a;if(0===e.length)return[];t=[];for(let e=0;e<this.__iconData.length;e++)a=this.__iconData[e].category,t.includes(a)||t.push(a);return t}__createEntry(e){let i,s=n.createKeyFromPath(e.path).includes(".svg"),r=new a.Base(this.__tabWindow.getId()+"-icon-"+this.__entryCounter,this,{background:{image:e.path,useSVG:s,imageColor:null!=e.color?new t.Color.RGBAColor(e.color):void 0,imageHeight:100,imageHeightUnit:"%",imageWidth:100,imageWidthUnit:"%"},cssClass:"icon"});return s||r.getElement().css("background-image","var(--tchmi-ba-background-styler-image)"),i={icon:r,label:new a.Textblock(this.__tabWindow.getId()+"-label"+this.__entryCounter,this,{textAttributes:{horizontalAlignment:"Left",text:e.description,wordWrap:!0},cssClass:"label"})},this.__entryCounter++,i}__updateIconData(){let t=!1,s=!1,r=!1;switch(this.__iconData.length=0,this.__attrHandler.iconDataSource){case i.IconDataSource.All:t=!0,r=!0,s=!0;break;case i.IconDataSource.OnlyBa:t=!0;break;case i.IconDataSource.OnlyCustom:r=!0;break;case i.IconDataSource.OnlyCustomGlobal:s=!0;break;case i.IconDataSource.BaAndCustom:t=!0,r=!0;break;case i.IconDataSource.BaAndCustomGlobal:t=!0,s=!0;break;case i.IconDataSource.CustomAndCustomGlobal:r=!0,s=!0}t&&(this.__iconData=this.__iconData.concat(n.getIconData())),r&&(this.__iconData=this.__iconData.concat(...this.__iconDataCustom)),s&&e.Symbol.readEx2("%i%"+a.Legend.IconDataSymbolName+"%/i%",e=>{0===e.error&&null!=e.value&&e.value.length>0&&(this.__iconData=this.__iconData.concat(...e.value))})}__updateTabCollection(){let e,a,i,n;if(null!=this.__tabWindow&&this.__tabWindow.removeAllTabs(),null!=this.__categories&&(this.__categories.forEach(e=>{e.content.detach()}),this.__categories.clear()),0!==this.__iconData.length){e=this.__getCategories(this.__iconData);for(let s=0;s<e.length;s++)i=this.__tabWindow.addTab(this.__tabWindow.getId()+"-tab-"+s),null!=i&&(a=e[s],i.text=t.Icons.Locale.Localization.getSymbolExpression("KeyL_IconCategory"+a),n=$("<div>").addClass("entries"),null==this.__categories.get(a)&&(i.setContent(n),this.__categories.set(a,{tab:i,content:n})))}}__updateTabContent(){let e,a,i,s;if(null!=this.__entries&&(this.__entries.forEach(e=>{e.icon.destroy(),e.label.destroy()}),this.__entries.clear()),0!==this.__iconData.length)for(let r=0;r<this.__iconData.length;r++)e=this.__categories.get(this.__iconData[r].category),null!=e?(i=n.createKeyFromPath(this.__iconData[r].path),a=this.__entries.get(i),null==a?(a=this.__createEntry(this.__iconData[r]),this.__entries.set(i,a)):(a.icon.getElement().detach(),a.label.getElement().detach()),s=$("<div>").addClass("entry"),s.append(a.icon.getElement(),a.label.getElement()),e.content.append(s)):this.logger.log(t.Logger.Severity.warn,"No matching category for '"+this.__iconData[r].category+"' found! Entry was skipped.")}__updateLegend(){this.__updateIconData(),this.__updateTabCollection(),this.__updateTabContent()}setAttributes(e){return super.setAttributes(e),null!=e.visibilityHeadline&&this.setVisibilityHeadline(e.visibilityHeadline),null!=e.tabPosition&&this.setTabPosition(e.tabPosition),null!=e.entryWidth&&(this.__attrHandler.entryWidth=e.entryWidth),null!=e.entryWidthUnit&&(this.__attrHandler.entryWidthUnit=e.entryWidthUnit),null!=e.iconDataSource&&this.setIconDataSource(e.iconDataSource),null!=e.iconDataCustom&&this.setIconDataCustom(e.iconDataCustom),this.setEntryWidth(this.__attrHandler.entryWidth,this.__attrHandler.entryWidthUnit),this}getAttributes(){return this.__attrHandler.getRef()}setVisibilityHeadline(e){return this.__attrHandler.checkAttribute(e,"visibilityHeadline",{validator:"boolean"})?(this.__attrHandler.visibilityHeadline=e,this.__processVisibilityHeadline(),this):this}__processVisibilityHeadline(){this.__constructLegend()}getVisibilityHeadline(){return this.__attrHandler.visibilityHeadline}setTabPosition(e){return this.__attrHandler.checkAttribute(e,"tabPosition",{validator:()=>null!=e&&e>=t.Position.left&&e<=t.Position.bottom})?(this.__attrHandler.tabPosition=e,this.__processTabPosition(),this):this}__processTabPosition(){this.__constructLegend()}getTabPosition(){return this.__attrHandler.tabPosition}setEntryWidth(e,t){return t=t||this.__attrHandler.entryWidthUnit,a.LayoutHandler.dimensionSetter(this.__attrHandler,"entryWidth",e,t)?(this.__processEntryWidth(),this):this}__processEntryWidth(){null!=this.__attrHandler.entryWidth&&null!=this.__attrHandler.entryWidthUnit&&null!=this.__tabWindow&&this.__tabWindow.getIsAttached()&&this.__tabWindow.getElement().css("--ba-js-width-entry",this.__attrHandler.entryWidth+this.__attrHandler.entryWidthUnit)}getEntryWidth(){return this.__attrHandler.entryWidth}getEntryWidthUnit(){return this.__attrHandler.entryWidthUnit}setIconDataSource(e){return this.__attrHandler.checkAttribute(e,"iconDataSource",{validator:"number"})?(null!=e&&this.__attrHandler.iconDataSource!==e&&(this.__attrHandler.iconDataSource=e,this.__processIconDataSource()),this):this}__processIconDataSource(){this.__updateLegend()}getIconDataSource(){return this.__attrHandler.iconDataSource}setIconDataCustom(e){return this.__attrHandler.checkAttribute(e,"iconDataCustom",{validator:()=>e instanceof Array})?(null!=e&&(this.__iconDataCustom=e,this.__updateLegend()),this):this}__processIconDataCustom(){this.__updateLegend()}getIconDataCustom(){return[...this.__iconDataCustom]}}a.Legend=i,function(e){let t;!function(e){e[e.All=0]="All",e[e.OnlyBa=1]="OnlyBa",e[e.OnlyCustom=2]="OnlyCustom",e[e.OnlyCustomGlobal=3]="OnlyCustomGlobal",e[e.BaAndCustom=4]="BaAndCustom",e[e.BaAndCustomGlobal=5]="BaAndCustomGlobal",e[e.CustomAndCustomGlobal=6]="CustomAndCustomGlobal"}(t=e.IconDataSource||(e.IconDataSource={})),e.IconDataSymbolName="BaLegendIconDataList"}(i=a.Legend||(a.Legend={}));a.LegendIconHandler=class{constructor(){}set icon(e){this.__icon=e}get icon(){return this.__icon}show(){null!=this.__icon?(this.hide(),this.__icon instanceof Array?this.__destroyIconWatch=n.watchIcons(this.__icon):this.__destroyIconWatch=n.watchIcon(this.__icon)):t.Logger.log(t.Logger.Severity.error,"Icon must be available here! Legend will not be updated!")}hide(){null!=this.__destroyIconWatch&&(this.__destroyIconWatch(),delete this.__destroyIconWatch)}destroy(){this.hide(),delete this.__icon}};class n{static __watchIcon(e,t){let a,i,n=this.createKeyFromPath(t.path);return""===n?(console.log("LegendManager - watchIcon(): Could not create IconKey (path: 0)!",t.path),n):(a=this.__iconReferences.get(n),null!=a?a.includes(e)?n="":(a.push(e),i=this.__idReferences.get(e),null!=i?i.push(n):this.__idReferences.set(e,[n])):(this.__iconReferences.set(n,[e]),this.__iconData.set(n,t),i=this.__idReferences.get(e),null!=i?i.push(n):this.__idReferences.set(e,[n])),n)}static __unwatchIcon(t,a){this.__removeId(t,a),this.__removeIconKey(t,a),e.EventProvider.raise(s.onIconsChanged)}static __unwatchIcons(t,a){for(let e=0;e<a.length;e++)this.__removeId(t,a[e]),this.__removeIconKey(t,a[e]);e.EventProvider.raise(s.onIconsChanged)}static __removeId(e,t){let a=this.__iconReferences.get(t),i=-1;if(null!=a){for(let t=0;t<a.length;t++)if(a[t]===e){i=t;break}i<0||(a.splice(i,1),0===a.length&&(this.__iconReferences.delete(t),this.__iconData.delete(t)))}}static __removeIconKey(e,t){let a=this.__idReferences.get(e),i=-1;if(null!=a){for(let e=0;e<a.length;e++)if(a[e]===t){i=e;break}i<0||(a.splice(i,1),0===a.length&&this.__idReferences.delete(e))}}static watchIcon(t){let a=++this.__id,i=this.__watchIcon(a,t);return""!==i?(e.EventProvider.raise(s.onIconsChanged),()=>{this.__unwatchIcon(a,i)}):()=>{}}static watchIcons(t){let a,i=[],n=!1,r=++this.__id;for(let e=0;e<t.length;e++)a=this.__watchIcon(r,t[e]),""!==a&&(i.push(a),n=!0);return n?(e.EventProvider.raise(s.onIconsChanged),()=>{this.__unwatchIcons(r,i)}):()=>{}}static unwatchAll(t){let a,i=this.__idReferences.get(t);if(null!=i){for(let e=0;e<i.length;e++)a=i[e],this.__removeId(t,a);this.__idReferences.delete(t),e.EventProvider.raise(s.onIconsChanged)}}static getIconData(){return Array.from(this.__iconData.values())}static createKeyFromPath(e){let t,a,i="";return null==e?i:(t=e.split("/"),i=t[t.length-1],i=i.toLowerCase(),a=i.includes(".svg")||i.includes(".png")||i.includes(".jpg")||i.includes(".gif"),a?i:"")}}let s;n.__id=0,n.__iconData=new Map,n.__iconReferences=new Map,n.__idReferences=new Map,function(e){e.onIconsChanged="onLegendManagerIconsChanged"}(s||(s={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(e){class t extends e.TextControl{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.__radioButton=$("<input type='radio'></input>"),this.__stateChangedHandler=e=>{e.stopPropagation(),this.eventHandler.raise(t.RadioButtonEvents.onSelected)},this.__labelPressedHandler=e=>this.__onLabelPressed(e),this.__element.addClass("radio-button"),this.__element.append(this.__radioButton)}__attach(){if(this.__isAttached)return;this.__radioButton.change(this.__stateChangedHandler);let e=this.__element.find("label");e[0]&&e.on("click",this.__labelPressedHandler),super.__attach()}__detach(){if(!this.__isAttached)return;let e=this.__element.find("label");e[0]&&e.off("click",this.__labelPressedHandler),super.__detach()}destroy(){super.destroy()}onTextChanged(e){super.onTextChanged(e);let t=this.__element.find("label");null==e?null!=t[0]&&(t.text(""),t.detach()):(t[0]||(t=$(`<label for=${this.__id}></label>`).addClass("text-element"),this.__element.append(t),this.__isAttached&&t.on("click",this.__labelPressedHandler)),t.text(e))}__onLabelPressed(e){if(e.stopPropagation(),!this.__attrHandler.readOnly)if("click"===e.type)this.setRadioState(!0);else if("touchstart"===e.type){let e=this.__element.find("label");if(e[0]){let t=a=>{this.setRadioState(!0),e.off("touchend",t)};e.on("touchend",t)}}}setAttributes(e){return super.setAttributes(e),void 0!==e.radioGroup&&this.setRadioGroup(e.radioGroup),void 0!==e.checkmarkColor&&this.setCheckmarkColor(e.checkmarkColor),this}getAttributes(){return this.__attrHandler.getRef()}setRadioState(e){return void 0===e?this:null!=e&&"boolean"!=typeof e?(this.__attrHandler.invalidAttribute("RadioState",e),this):(this.__radioButton.prop("checked",e),this)}getRadioState(){return this.__radioButton.prop("checked")}setRadioGroup(e){return this.__attrHandler.checkAttribute(e,"radioGroup",{validator:"string"})?(this.__attrHandler.radioGroup=e,this.__processRadioGroup(),this):this}__processRadioGroup(){null==this.__attrHandler.radioGroup?this.__radioButton.removeProp("name"):this.__radioButton.prop("name",this.__attrHandler.radioGroup)}getRadioGroup(){return this.__attrHandler.radioGroup}setCheckmarkColor(e){return this.__attrHandler.checkColorAttribute(e,"checkmarkColor")?(this.__attrHandler.checkmarkColor=e,this.__processCheckmarkColor(),this):this}__processCheckmarkColor(){null==this.__attrHandler.checkmarkColor?this.__element.css("--tchmi-ba-checkbox-checkmark-color",""):this.__element.css("--tchmi-ba-checkbox-checkmark-color",this.__attrHandler.checkmarkColor.toString())}getCheckmarkColor(){return this.__attrHandler.checkmarkColor}__processReadOnly(){super.__processReadOnly();let e=this.__element.find("label");null!=this.__attrHandler.readOnly&&!1===this.__attrHandler.readOnly?(this.__radioButton.removeAttr("disabled"),this.setIsEnabled(!0),this.__isAttached&&e[0]&&e.on("click",this.__labelPressedHandler)):(this.__radioButton.attr("disabled","disabled"),this.setIsEnabled(!1),e[0]&&e.off("click",this.__labelPressedHandler))}}e.RadioButton=t,function(e){let t;!function(e){e.onSelected="onSelected"}(t=e.RadioButtonEvents||(e.RadioButtonEvents={}))}(t=e.RadioButton||(e.RadioButton={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.TextControl{constructor(e,t,a){super(e,t,a),this.__table=$("<table>"),this.__columns=new Map,this.__originalData=[],this.__sortedData=[],this.__settingRowValuesInProgress=!1,this.__rowManipulators=[],this.__isResizing=!1,this.__sortableColumnPressedHandler=e=>{if("click"===e.type&&0!=e.button)return;if(this.__isResizing)return;if(!$(e.target).hasClass("sortable"))return;let t=$(e.target),a=this.__columns.get(t.data("column-id"));if(!a)throw new Error(`Column for target ${t.data("id")} could not be found!`);this.__sortedColumn=a.opt,a.opt.sortable&&this.__sortData(a.opt.id)},this.__resizerPressedHandler=e=>{if("mousedown"===e.type&&0!=e.button)return;if(!$(e.target).hasClass("resizer"))return;this.__isResizing=!0;let t=$(e.target).parent(),a=t.data("column-id"),i=this.__columns.get(a);if(!i)throw new Error(`Column for target ${t.data("id")} could not be found!`);if(!i.opt.resizeable)return;let n=!0;if(!n)return;let s=0;if("mousedown"===e.type){if(0!=e.button)return;s=e.pageX}else s=e.touches[0].pageX;let r=t.width();if(void 0===r)return;let o=t.closest(".table-resizable").addClass("resizing"),l=e=>{if(n){let a=0;a="mousemove"===e.type?r+(e.pageX-s):r+(e.touches[0].pageX-s),void 0!==i.opt.minWidth&&i.opt.minWidth>0&&a<i.opt.minWidth&&(a=i.opt.minWidth),t.css("min-width",a+"px")}},d=e=>{n&&(o.removeClass("resizing"),n=!1),$(document).off("mousemove touchmove",l),$(document).off("mouseup touchend",d),setTimeout(()=>this.__isResizing=!1,100)};$(document).on("mousemove touchmove",l),$(document).on("mouseup touchend",d)},this.__doubleClickHandler=e=>{this.__resetColumnWidth()},this.__cellSelectedHandler=e=>this.__onCellSelected(e),this.__selectedHandler=e=>this.__onSelected(e),this.__element.addClass("table");let i=$("<div>").addClass("table-container").append(this.__table);this.__element.append(i),this.__table.append("\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t</tbody>"),this.__headerRow=this.__table.find("thead").find("tr"),this.__tableBody=this.__table.find("tbody")}__attach(){if(this.__isAttached)return;let e;super.__attach(),this.__element.on("mousedown touchstart","table th.resizeable div.resizer",this.__resizerPressedHandler),this.__element.on("click touch","table th.sortable",this.__sortableColumnPressedHandler),this.__element.on("dblclick","table th.resizeable div.resizer",this.__doubleClickHandler),this.__element.on("click touch","table tbody tr td",this.__cellSelectedHandler),this.__element.on("click touch",".table-container",this.__selectedHandler);for(let t of this.__columns.values()){if(e=t.th.width(),void 0===e)throw new Error("Width should be defined hete!");void 0!==t.opt.minWidth&&(e=t.opt.minWidth),void 0!==t.opt.defaultWidth&&(e=t.opt.defaultWidth),t.th.css("min-width",e+"px"),t.th.data("init-width",e)}this.__element.addClass("initialized")}__detach(){this.__isAttached&&(super.__detach(),this.__element.off("mousedown touchstart","table th.resizeable div.resizer",this.__resizerPressedHandler),this.__element.off("click touch","table th.sortable",this.__sortableColumnPressedHandler),this.__element.off("dblclick","table th.resizeable div.resizer",this.__doubleClickHandler),this.__element.off("click touch","table tbody tr td",this.__cellSelectedHandler),this.__element.off("click touch",".table-container",this.__selectedHandler),this.__element.removeClass("initialized"))}destroy(){this.removeAllData(),super.destroy()}__onSelected(e){return("mousedown"!==e.type||0===e.button)&&(!!$(e.target).hasClass("table-container")&&(this.__unselectedRows(),!0))}__onCellSelected(e){if("mousedown"===e.type&&0!==e.button)return!1;let t,i=$(e.currentTarget),n=i.data("row-index"),s=this.__tableBody.find("tr");for(let e=0;e<s.length;e++)t=$(s[e]),e===n?t.addClass("focused"):t.removeClass("focused");return this.__selectedCell=i,this.eventHandler.raise(a.TableEvents.onCellSelected,i),!0}__addColumn(e){let t,a=this.__headerRow.find("th");for(let i=0;i<a.length;i++)if(t=$(a[i]),t.data("column-id")===e.id)return;t=$("<th>"),e.title&&(t.html(e.title),t.addClass("has-title")),t.data("column-id",e.id),e.sortable&&t.addClass("sortable not-sorted"),e.resizeable&&(t.addClass("resizeable"),t.append($("<div>").addClass("resizer"))),this.__headerRow.append(t),0===this.__columns.size&&this.showRowNumbers(this.__element.hasClass("show-row-numbers")),this.__columns.set(e.id,{th:t,opt:e});for(let t=0;t<this.__originalData.length;t++)this.__originalData[t][e.id]&&this.__addDataCellElement(e.id,t)}__removeColumn(e){let t=this.__columns.get(e);if(t){t.th.detach();for(let t=0;t<this.__originalData.length;t++)this.__removeDataCellElement(e,t);this.__columns.delete(e),this.__resetColumnWidth()}else console.warn(`No column with id "${e}" found!`)}__addDataCellElement(e,i){var n;let s=this.__tableBody.find("tr"),r=$(s[i]);r[0]||(r=$("<tr>"),r.data("init-row-index",s.length),this.__tableBody.append(r)),s=this.__tableBody.find("tr");let o=r.find("td");for(let t=0;t<o.length;t++)if($(o[t]).data("column-id")===e)return;let l=$("<td>");l.data({"column-id":e,"row-index":s.length-1});let d=null===(n=this.__columns.get(e))||void 0===n?void 0:n.opt;if(!d)throw new Error(`No value or column options were found for column id ${e}!`);switch(d.dataType){case a.ColumnOptionsDataType.boolean:case a.ColumnOptionsDataType.dateTime:case a.ColumnOptionsDataType.enum:case a.ColumnOptionsDataType.number:case a.ColumnOptionsDataType.integer:case a.ColumnOptionsDataType.string:let i=new t.ValueField(this.__id+"-"+e+"-"+(s.length-1),this);switch(i.getElement().data({"column-id":e,"row-index":s.length-1}),d.dataType){case a.ColumnOptionsDataType.boolean:void 0!==d.activeText&&i.setActiveText(d.activeText),void 0!==d.inactiveText&&i.setInactiveText(d.inactiveText),d.digits&&i.setDigits(d.digits);break;case a.ColumnOptionsDataType.number:d.unit&&i.setUnit(d.unit);break;case a.ColumnOptionsDataType.enum:d.stateTexts&&i.setStateTexts(d.stateTexts)}i.setDataType(d.dataType).setReadOnly(!d.editable),i.textHandler.setVerticalAlignment(d.textVerticalAlignment).setHorizontalAlignment(d.textHorizontalAlignment),l.append(i.getElement());let n=i.eventHandler.register(t.ValueField.ValueFieldEvents.onValueChanged,e=>{if(this.__settingRowValuesInProgress)return;let t=i.getElement().data("row-index"),n=i.getElement().data("column-id"),s=this.__sortedData[t],r=s.dataIndex;if(void 0===s)throw new Error(`Data for data index ${r} and column id ${n} was not found!`);this.__originalData[r][n]=i.getValue(),this.eventHandler.raise(a.TableEvents.onDataChanged,[r,n,this.__originalData[r][n]])});i.eventHandler.register(t.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),n()});break;case a.ColumnOptionsDataType.event:let r=new t.EventIcon(this.__id+"-"+e+"-"+(s.length-1),this);l.append(r.getElement())}r.append(l)}__removeDataCellElement(e,t){let a,i,n,s=this.__tableBody.find("tr"),r=$(s[t]);if(!r[0])throw new Error(`No row was found for row index ${t}!`);a=r.find("td");for(let t=0;t<a.length;t++)if(i=$(a[t]),n=i.data("column-id"),n===e){let t=this.childrenHandler.getChildren().get(this.__id+"-"+e+"-"+r.data("init-row-index"));t&&(t.getElement().detach(),t.destroy()),i.detach();break}0===r.find("td").length&&r.detach()}__addData(e){if(a.isTableData(e)){this.__originalData.push(e);for(let e of this.__columns.keys())this.__addDataCellElement(e,this.__originalData.length-1)}else this.__attrHandler.invalidAttribute("Data",e)}__removeData(e){let t;for(t=0;t<this.__sortedData.length&&this.__sortedData[t].dataIndex!==e;t++);for(let e of this.__columns.keys())this.__removeDataCellElement(e,t);this.__sortedData.splice(t,1),this.__originalData.splice(e,1)}__createOriginalDataClone(){let e=[];for(let t=0;t<this.__originalData.length;t++)e.push({value:this.__originalData[t],dataIndex:t});return e}__sortData(t,a){let i=this.__columns.get(t);if(!i)throw new Error(`Column with id ${t} was not found!`);if(!i.opt.sortable)return;void 0===a&&(a=0,i.th.hasClass("not-sorted")?a=1:i.th.hasClass("asc")&&(a=-1));for(let[e,a]of this.__columns)a.opt.sortable&&(e!==t?a.th.addClass("not-sorted"):a.th.removeClass("not-sorted"),a.th.removeClass("desc"),a.th.removeClass("asc"));let n=!0,s=!1;if(this.__sortedData=this.__createOriginalDataClone(),0!==a){let i,r,o;for(;n;){for(n=!1,o=0;o<this.__sortedData.length-1;o++)if(s=!1,i=this.__sortedData[o].value[t],r=this.__sortedData[o+1].value[t],-1===a){if("object"!=typeof i||i instanceof Date||null==i||"object"!=typeof r||r instanceof Date||null==r){if(null==i&&null!=r){s=!0;break}if(null!=i&&null!=r&&i<r){s=!0;break}}else if(i.eventCondition<r.eventCondition){s=!0;break}}else if(1===a)if("object"!=typeof i||i instanceof Date||null==i||"object"!=typeof r||r instanceof Date||null==r){if(null!=i&&null==r){s=!0;break}if(null!=i&&null!=r&&i>r){s=!0;break}}else if(i.eventCondition>r.eventCondition){s=!0;break}s&&(e.Helper.Array.swapItems(this.__sortedData,o,o+1),n=!0)}}1===a?i.th.addClass("asc"):-1===a?i.th.addClass("desc"):i.th.addClass("not-sorted"),this.__updateRowValues()}__updateRowNumbers(){if(this.__element.hasClass("show-row-numbers")){let e,t=this.__tableBody.find("tr"),a=1;for(let i=0;i<t.length;i++)e=$(t[i]),e.hasClass("hide")||($(e.find("td")[0]).attr("data-row-index",a),a++)}}__updateRowValues(){let e,t,i;this.__settingRowValuesInProgress=!0;for(let n=0;n<this.__sortedData.length;n++){let s=this.__tableBody.find("tr")[n],r=$(s).find("td");if(s){for(let[s,o]of this.__columns)if(i=this.__sortedData[n].value[s],void 0!==i)switch(o.opt.dataType){case a.ColumnOptionsDataType.boolean:case a.ColumnOptionsDataType.dateTime:case a.ColumnOptionsDataType.enum:case a.ColumnOptionsDataType.number:case a.ColumnOptionsDataType.integer:case a.ColumnOptionsDataType.string:if(i instanceof Date||"object"!=typeof i){if(e=this.childrenHandler.getChildren().get(this.__id+"-"+s+"-"+n),!e)throw new Error("Value");e.setValue(i)}break;case a.ColumnOptionsDataType.image:if("string"==typeof i){let e;for(let t=0;t<r.length&&(e=$(r[t]),e.data("column-id")!==s);t++);e&&(e.addClass("use-image"),e.css("background-image","url("+i+")"))}break;case a.ColumnOptionsDataType.event:"object"!=typeof i||i instanceof Date||(t=this.childrenHandler.getChildren().get(this.__id+"-"+s+"-"+n),t&&t.setEventState(null==i?void 0:i.eventState).setEventCondition(null==i?void 0:i.eventCondition).setReadOnly(!0));break;default:throw new Error("Invalid data type for Table!")}for(let e=0;e<this.__rowManipulators.length;e++)this.__rowManipulators[e](this.__sortedData[n].value,$(s),r)}}this.__settingRowValuesInProgress=!1}__resetColumnWidth(){let e;for(let[t,a]of this.__columns){if(e=a.th.data("init-width"),void 0===e)throw new Error("Width should be defined hete!");a.th.css("min-width",e+"px")}}__unselectedRows(){let e,t=this.__tableBody.find("tr");for(let a=0;a<t.length;a++)e=$(t[a]),e.removeClass("focused");this.__selectedCell=void 0}addColumn(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.__addColumn(e[t]);else this.__addColumn(e);return this}removeColumn(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.__removeColumn(e[t]);else this.__removeColumn(e);return this}addData(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.__addData(e[t]);else this.__addData(e);return this.__sortedColumn?this.__sortData(this.__sortedColumn.id,-1):(this.__sortedData=this.__createOriginalDataClone(),this.__updateRowValues()),this.__updateRowNumbers(),this.eventHandler.raise(a.TableEvents.onDataChanged),this}getData(){return this.__originalData}removeData(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.__removeData(e[t]);else this.__removeData(e);return this.__updateRowNumbers(),this.eventHandler.raise(a.TableEvents.onDataChanged),this}removeAllData(){for(;this.__originalData.length>0;)this.__removeData(this.__originalData.length-1);return this.__updateRowNumbers(),this.eventHandler.raise(a.TableEvents.onDataChanged),this}showRowNumbers(e){let t=$(this.__headerRow.find("th")[0]);return e?(this.__element.addClass("show-row-numbers"),t.append($("<div>").addClass("row-number-place-holder")),this.__updateRowNumbers()):(this.__element.removeClass("show-row-numbers"),t.find(".row-number-place-holder").detach()),this}setRowManipulator(e){return this.__rowManipulators.push(e),this.__updateRowValues(),this}getSelectedCell(){return this.__selectedCell}getSelectedData(){if(!this.__selectedCell)return;let e=this.__selectedCell.data("row-index");return this.__sortedData[e].value}}!function(t){let a,i;!function(e){e.onDataChanged="onDataChanged",e.onCellSelected="onCellSelected"}(a=t.TableEvents||(t.TableEvents={})),function(e){e[e.unknown=0]="unknown",e[e.string=1]="string",e[e.number=2]="number",e[e.integer=3]="integer",e[e.boolean=4]="boolean",e[e.enum=7]="enum",e[e.dateTime=8]="dateTime",e[e.image=9]="image",e[e.event=10]="event"}(i=t.ColumnOptionsDataType||(t.ColumnOptionsDataType={})),t.isTableData=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;for(let e in t)i.set(e,["number","boolean","string","date","object",null]);e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}}(a||(a={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(t){!function(a){class i extends a.TextControl{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.baObjectHandler=new t.BaObjectHandler(this),this.resizeHandler=new a.ResizeHandler(this),this.valueHandler=new t.System.ValueHandler(this),this.__digits=0,this.__valueFeedbackReady=[],this.__input=$('<input type="range" max="100" min="0"/>'),this.__curValueDisplay=$("<div>").addClass("text-element limit-display current-value-display"),this.__unitDisplay=$("<div>").addClass("text-element limit-display unit-display"),this.__scaleContainer=$("<div>").addClass("scale-container"),this.__minValueDisplay=$("<div>").addClass("text-element limit-display minimum"),this.__maxValueDisplay=$("<div>").addClass("text-element limit-display maximum"),this.__changedHandler=e=>this.__onChanged(e),this.__downHandler=e=>this.__onDown(e),this.__moveHandler=e=>this.__onMove(e),this.__curValueDisplayPressedHandler=e=>this.__onCurValueDisplayPressed(e),this.__upHandler=e=>this.__onUp(e),this.__element.addClass("slider"),this.__element.append(this.__scaleContainer),this.__scaleContainer.append(this.__minValueDisplay),this.__scaleContainer.append(this.__maxValueDisplay),this.__element.append(this.__input),this.__element.append(this.__curValueDisplay),void 0===(null==e?void 0:e.showValue)&&this.setShowValue(!0),void 0===(null==e?void 0:e.showScale)&&this.setShowScale(!0),void 0===(null==e?void 0:e.minValue)&&this.setMinValue(-100),void 0===(null==e?void 0:e.maxValue)&&this.setMaxValue(100),void 0===(null==e?void 0:e.step)&&this.setStep(0),void 0===(null==e?void 0:e.orientation)&&this.setOrientation(t.Orientation.horizontal),void 0===(null==e?void 0:e.switchMinMax)&&this.setSwitchMinMax(!1)}__attach(){this.__isAttached||(this.__input.on("pointerdown",this.__downHandler),this.__input.on("change",this.__changedHandler),this.__curValueDisplay.on("pointerdown",this.__curValueDisplayPressedHandler),this.__managePressAndHold=t.Helper.pressAndHold(this.__input,()=>{this.__openValueInput()}),this.__processIsEnabled(),super.__attach())}__detach(){var e;this.__isAttached&&(this.__input.off("pointerdown",this.__downHandler),this.__input.off("change",this.__changedHandler),this.__curValueDisplay.off("pointerdown",this.__curValueDisplayPressedHandler),null===(e=this.__managePressAndHold)||void 0===e||e.stop(),super.__detach())}destroy(){this.resizeHandler.destroy(),super.destroy()}onTextChanged(e){super.onTextChanged(e),null!=e?this.__element.append(this.textHandler.getTextElement()):this.textHandler.getTextElement().detach()}onResized(){let e=this.__element[0].getBoundingClientRect(),a=e.height,i=e.width;this.__attrHandler.orientation===t.Orientation.vertical?(this.__element.css("--tchmi-ba-slider-knob-width","10px"),this.__element.css("--tchmi-ba-slider-knob-height",i+(i/100+15)+"px"),this.__element.css("--tchmi-ba-slider-height",i+"px"),this.__element.css("--tchmi-ba-slider-width",a+"px")):(this.__element.css("--tchmi-ba-slider-knob-height",a+(a/100+15)+"px"),this.__element.css("--tchmi-ba-slider-knob-width","10px"),this.__element.css("--tchmi-ba-slider-height",a+"px"),this.__element.css("--tchmi-ba-slider-width",i+"px"))}onValueChanged(e){this.__setValueInternal(e)}__onChanged(e){if(0==this.__attrHandler.isEnabled)return e.stopPropagation(),void(null!=this.__attrHandler.valueFeedback&&null!=this.__attrHandler.valueFeedback?this.__input.val(this.__attrHandler.valueFeedback):null!=this.__attrHandler.value&&this.__input.val(this.__attrHandler.value))}__onDown(e){0!=this.__attrHandler.isEnabled?null!=e.button&&0!==e.button||($(document).on("pointermove",this.__moveHandler),$(document).on("pointerup",this.__upHandler),this.__wasMoved=!1):e.stopPropagation()}__onMove(e){var t,a;let i=this.__getValueFromHtml();(null===(t=this.__managePressAndHold)||void 0===t?void 0:t.isPressed())&&null!=this.__attrHandler.value&&i>this.__attrHandler.value-5&&i<this.__attrHandler.value+5||(this.__setValueInternal(i),this.__wasMoved=!0,null===(a=this.__managePressAndHold)||void 0===a||a.release())}__onUp(e){null!=this.__attrHandler.minValue&&null!=this.__attrHandler.maxValue&&this.__attrHandler.maxValue==this.__attrHandler.minValue&&this.logger.log(t.Logger.Severity.warn,"Min and max values of silder are equal. No input will be possible!");let a=this.__getValueFromHtml();if(this.__wasMoved&&null!=this.__attrHandler.value&&a!==this.__attrHandler.value&&(this.__input.val(this.__attrHandler.value),a=this.__attrHandler.value),this.__setValueInternal(a),null!=this.__attrHandler.valueFeedback&&this.__attrHandler.value!=this.__attrHandler.valueFeedback){let e=()=>{this.__valueFeedbackReady.forEach(e=>e()),this.__valueFeedbackReady=[],null!=this.__attrHandler.valueFeedback&&null!=this.__attrHandler.valueFeedback&&this.__setValueInternal(this.__attrHandler.valueFeedback)};this.__valueFeedbackReady.push(this.busyHandler.setBusy("Waiting for ValueFeedback",{cbOnTimeout:e}))}null!=this.__attrHandler.value&&this.valueHandler.processChangedValue(this.__attrHandler.value),this.eventHandler.raise(i.SliderEvents.onUserInteractionFinished),$(document).off("pointermove",this.__moveHandler),$(document).off("pointerup",this.__upHandler)}__onCurValueDisplayPressed(e){var a;0!=this.__attrHandler.isEnabled&&0!=this.checkAccess(t.Server.UserManagement.AccessRight.operate)&&(null!=e.button&&0!==e.button||(null===(a=this.__managePressAndHold)||void 0===a||a.release(),this.__openValueInput()))}__calculatePercentage(e){return null==this.__attrHandler.minValue||null==this.__attrHandler.maxValue?0:(e-this.__attrHandler.minValue)/(this.__attrHandler.maxValue-this.__attrHandler.minValue)*100}__openValueInput(){return __awaiter(this,void 0,void 0,(function*(){if(null==this.__attrHandler.value)return;let e=yield a.DialogWindow.promptNumericWithLimits(t.Locale.Localization.getText(t.Locale.LangKey.EnterValue),this.__attrHandler.value,this.__attrHandler.minValue,this.__attrHandler.maxValue);if(null!=e){if(this.__setValueInternal(e),null!=this.__attrHandler.valueFeedback&&this.__attrHandler.value!=this.__attrHandler.valueFeedback){let e=()=>{this.__valueFeedbackReady.forEach(e=>e()),this.__valueFeedbackReady=[],null!=this.__attrHandler.valueFeedback&&null!=this.__attrHandler.valueFeedback&&this.__setValueInternal(this.__attrHandler.valueFeedback)};this.__valueFeedbackReady.push(this.busyHandler.setBusy("Waiting for ValueFeedback",{cbOnTimeout:e,optionalOutput:"Hint: Maybe the object is logged by a higher priority?"}))}this.valueHandler.processChangedValue(this.__attrHandler.value),this.eventHandler.raise(i.SliderEvents.onUserInteractionFinished)}}))}__getValueFromHtml(){let e=Number(this.__input.val());if(null==e||"number"!=typeof e)throw new Error("Value of slider input must always be of type number!");return e}__validateMinMax(){null!=this.__attrHandler.minValue&&null!=this.__attrHandler.maxValue&&this.__attrHandler.minValue==this.__attrHandler.maxValue?(this.logger.log(t.Logger.Severity.debug,"Min and max values of silder are equal. No input will be possible!"),this.__oldEnabled,this.getIsEnabled(),void 0===this.__oldEnabled&&(this.__oldEnabled=!0),this.setIsEnabled(!1)):void 0!==this.__oldEnabled&&(this.setIsEnabled(this.__oldEnabled),delete this.__oldEnabled)}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&(this.valueHandler.setAttributes(e.valueHandler),this.__attrHandler.valueHandler=e.valueHandler),void 0!==e.value&&this.setValue(e.value),void 0!==e.valueFeedback&&this.setValueFeedback(e.valueFeedback),void 0!==e.showValue&&this.setShowValue(e.showValue),void 0!==e.showScale&&this.setShowScale(e.showScale),void 0!==e.minValue&&this.setMinValue(e.minValue),void 0!==e.maxValue&&this.setMaxValue(e.maxValue),void 0!==e.orientation&&this.setOrientation(e.orientation),void 0!==e.switchMinMax&&this.setSwitchMinMax(e.switchMinMax),void 0!==e.step&&this.setStep(e.step),void 0!==e.ranges&&this.setRanges(e.ranges),void 0!==e.unit&&this.setUnit(e.unit),void 0!==e.knobAppearance&&this.setKnobAppearance(e.knobAppearance),this}getAttributes(){return this.__attrHandler.getRef()}setValue(e){return this.__attrHandler.checkAttribute(e,"value",{validator:"number",skipEqualityCheck:!0})?(null!=e&&(e=Number(e.toFixed(this.__digits))),this.__attrHandler.checkEquality(e,this.__attrHandler.value,"value")?(this.__setValueInternal(e),this):this):this}__setValueInternal(e){e!==this.__attrHandler.value&&(this.__attrHandler.value=e,this.__processValue(),this.eventHandler.raise(i.SliderEvents.onValueChanged))}__processValue(){null==this.__attrHandler.value?(this.__input.val(0),this.__curValueDisplay.html("null")):(this.__input.val(this.__attrHandler.value),this.__curValueDisplay.html(this.__attrHandler.value.toFixed(this.__digits)))}getValue(){return this.__attrHandler.value}setValueFeedback(e){return this.__attrHandler.checkAttribute(e,"valueFeedback",{validator:"number",skipEqualityCheck:!0})?(null!=e&&(e=Number(e.toFixed(this.__digits))),this.__attrHandler.checkEquality(e,this.__attrHandler.valueFeedback,"valueFeedback")?(this.__attrHandler.valueFeedback=e,null!=this.__attrHandler.valueFeedback&&this.__processValueFeedback(),this.__valueFeedbackReady.forEach(e=>e()),this.__valueFeedbackReady=[],this.eventHandler.raise(i.SliderEvents.onValueFeedbackChanged),this):this):this}__processValueFeedback(){var e,t;null==this.__attrHandler.valueFeedback?(null===(e=this.__feedbackSlider)||void 0===e||e.detach(),delete this.__feedbackSlider):(null==this.__feedbackSlider&&(this.__feedbackSlider=$('<input type="range" max="100" min="0"/>').addClass("feedback-slider"),this.__element.append(this.__feedbackSlider),this.__feedbackSlider.attr("disabled","disabled"),this.__processMinValue(),this.__processMaxValue(),this.__processOrientation(),this.__processStep()),null===(t=this.__feedbackSlider)||void 0===t||t.val(this.__attrHandler.valueFeedback),this.__curValueDisplay.html(this.__attrHandler.valueFeedback.toFixed(this.__digits)))}getValueFeedback(){return this.__attrHandler.valueFeedback}setShowValue(e){return this.__attrHandler.checkAttribute(e,"showValue",{validator:"boolean"})?(this.__attrHandler.showValue=e,this.__processShowValue(),this):this}__processShowValue(){null!=this.__attrHandler.showValue&&!0===this.__attrHandler.showValue?this.__element.append(this.__curValueDisplay):this.__curValueDisplay.detach()}getShowValue(){return this.__attrHandler.showValue}setShowScale(e){return this.__attrHandler.checkAttribute(e,"showScale",{validator:"boolean"})?(this.__attrHandler.showScale=e,this.__processShowScale(),this):this}__processShowScale(){null!=this.__attrHandler.showScale&&!0===this.__attrHandler.showScale?this.__element.append(this.__scaleContainer):this.__scaleContainer.detach()}getShowScale(){return this.__attrHandler.showScale}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(null!=e&&null!=this.__attrHandler.maxValue&&e>this.__attrHandler.maxValue?(this.setMinValue(this.__attrHandler.maxValue),this.setMaxValue(e),this.setSwitchMinMax(!0)):(this.__attrHandler.minValue=e,this.__processMinValue(),this.setSwitchMinMax(!1)),this):this}__processMinValue(){var e,t;null==this.__attrHandler.minValue?(this.__input.attr("min",-100),null===(e=this.__feedbackSlider)||void 0===e||e.attr("min",-100),this.__minValueDisplay.html("-100")):(this.__input.attr("min",this.__attrHandler.minValue),null===(t=this.__feedbackSlider)||void 0===t||t.attr("min",this.__attrHandler.minValue),this.__minValueDisplay.html(this.__attrHandler.minValue.toString())),this.__processValue(),this.__processRanges(),this.__validateMinMax()}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(null!=e&&null!=this.__attrHandler.minValue&&e<this.__attrHandler.minValue?(this.setMaxValue(this.__attrHandler.minValue),this.setMinValue(e),this.setSwitchMinMax(!0)):(this.__attrHandler.maxValue=e,this.__processMaxValue(),this.setSwitchMinMax(!1)),this):this}__processMaxValue(){var e,t;null==this.__attrHandler.maxValue?(this.__input.attr("max",100),this.__maxValueDisplay.html("100"),null===(e=this.__feedbackSlider)||void 0===e||e.attr("min",100)):(this.__input.attr("max",this.__attrHandler.maxValue),null===(t=this.__feedbackSlider)||void 0===t||t.attr("max",this.__attrHandler.maxValue),this.__maxValueDisplay.html(this.__attrHandler.maxValue.toString())),this.__processValue(),this.__processRanges(),this.__validateMinMax()}getMaxValue(){return this.__attrHandler.maxValue}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this.__processRanges(),this):this}__processOrientation(){var e,a;null!=this.__attrHandler.orientation&&this.__attrHandler.orientation===t.Orientation.vertical?(this.__element.addClass("vertical"),this.__input.attr("orient","vertical"),null===(e=this.__feedbackSlider)||void 0===e||e.attr("orient","vertical")):(this.__element.removeClass("vertical"),this.__input.attr("orient","horizontal"),null===(a=this.__feedbackSlider)||void 0===a||a.attr("orient","horizontal")),this.onResized()}getOrientation(){return this.__attrHandler.orientation}setSwitchMinMax(e){return this.__attrHandler.checkAttribute(e,"switchMinMax",{validator:"boolean"})?(this.__attrHandler.switchMinMax=e,this.__processSwitchMinMax(),this):this}__processSwitchMinMax(){null!=this.__attrHandler.switchMinMax&&(this.__attrHandler.switchMinMax?this.__element.addClass("switch-min-max"):this.__element.removeClass("switch-min-max"),this.__processValue())}getSwitchMinMax(){return this.__attrHandler.switchMinMax}setStep(e){return this.__attrHandler.checkAttribute(e,"step",{validator:"number"})?(this.__attrHandler.step=e,this.__processStep(),this):this}__processStep(){var e,t;if(null==this.__attrHandler.step)this.__digits=0,this.__processValue(),this.__input.attr("step",0),null===(e=this.__feedbackSlider)||void 0===e||e.attr("step",0);else{let e=this.__attrHandler.step.toString();if(e.indexOf(".")>-1){let t=e.split(".");this.__digits=t[1].length}else this.__digits=0;this.__processValue(),this.__input.attr("step",this.__attrHandler.step),null===(t=this.__feedbackSlider)||void 0===t||t.attr("step",this.__attrHandler.step)}this.__processValue()}getStep(){return this.__attrHandler.step}setRanges(e){if(!this.__attrHandler.checkAttribute(e,"ranges",{validator:()=>e instanceof Array}))return this;if(null!=e)for(let t=0;t<e.length;t++)if(!i.isSliderRange(e[t]))return this.logger.invalidAttribute("Ranges",e[t]),this;return this.__attrHandler.ranges=e,this.__processRanges(),this}__processRanges(){if(null==this.__attrHandler.ranges)return null!=this.__oldBackgroundColor&&this.backgroundStyler.setColor(this.__oldBackgroundColor),void this.__element.removeClass("has-ranges");if(null==this.__attrHandler.minValue||null==this.__attrHandler.maxValue)return void console.warn(`MinValue or MaxValue was not set for slider ${this.__id}. No ranges were set!`);try{this.__oldBackgroundColor=t.Color.RGBAColor.fromCssString(this.__element.css("background-color"))}catch(e){this.__oldBackgroundColor=null}this.__attrHandler.ranges.sort((e,t)=>e.start-t.start),this.__element.addClass("has-ranges");let e="",a=new t.Color.LinearGradient;null==this.__attrHandler.orientation||this.__attrHandler.orientation===t.Orientation.horizontal?(e="linear-gradient(to right",a.direction="to Right"):a.direction="to Top",e="linear-gradient(to top";for(let t=0;t<this.__attrHandler.ranges.length;t++){let i=this.__attrHandler.ranges[t];if(i.start<this.__attrHandler.minValue){console.warn("Start value of range is smaller than the minimum value. Range will be ignored!");continue}let n=this.__calculatePercentage(i.start);if(null==i.end)if(t<this.__attrHandler.ranges.length-1){let s=this.__calculatePercentage(this.__attrHandler.ranges[t+1].start);if(e=e+", "+i.color+" "+n.toString()+"%, "+this.__attrHandler.ranges[t+1].color+" "+s.toString()+"%",a.stops.push({color:i.color,stop:n,stopUnit:"%"},{color:this.__attrHandler.ranges[t+1].color,stop:s,stopUnit:"%"}),s>=100)break}else e=e+", "+i.color+" "+n.toString()+"%, "+i.color+" 100%",a.stops.push({color:i.color,stop:n,stopUnit:"%"},{color:i.color,stop:100,stopUnit:"%"});else{if(i.end<i.start){console.warn("End value of range is smaller than the start value. Range will be ignored!");continue}if(i.end>this.__attrHandler.maxValue){console.warn("End value of range is bigger than the maximum value. Range will be ignored!");continue}let t=this.__calculatePercentage(i.end);e=e+", "+i.color+" "+n.toString()+"%, "+i.color+" "+t.toString()+"%",a.stops.push({color:i.color,stop:n,stopUnit:"%"},{color:i.color,stop:t,stopUnit:"%"})}}e+=")",this.backgroundStyler.setColor(a)}getRanges(){return this.__attrHandler.ranges}setUnit(a){if(!this.__attrHandler.checkAttribute(a,"unit",{validator:["string","number"]}))return this;if("number"==typeof a)if(void 0!==t.Globals.Units)a=t.Helper.convertUnitToString(a),this.__attrHandler.unit=a,this.__processUnit();else{this.__attrHandler.unit=t.BA.Unit[a],this.__processUnit();let i=e.EventProvider.register("CustomBA.onUnitsLoaded",()=>{this.__attrHandler.unit=t.Helper.convertUnitToString(a),this.__processUnit(),i()})}else this.__attrHandler.unit=a,this.__processUnit();return this}__processUnit(){null!=this.__attrHandler.unit?(this.__unitDisplay.html(this.__attrHandler.unit),this.__element.append(this.__unitDisplay)):this.__unitDisplay.detach()}getUnit(){return this.__attrHandler.unit}setKnobAppearance(e){return this.__attrHandler.checkAttribute(e,"knobAppearance",{validator:"number"})?(this.__attrHandler.knobAppearance=e,this.__processKnobAppearance(),this):this}__processKnobAppearance(){switch(this.__attrHandler.knobAppearance){case i.KnobAppearance.round:this.__element.addClass("round-knob");break;default:this.__element.removeClass("round-knob")}}getKnobAppearance(){return this.__attrHandler.knobAppearance}__processIsEnabled(){var e,t;super.__processIsEnabled(),0==this.__attrHandler.isEnabled||1==this.__attrHandler.readOnly?(this.__input.attr("disabled","disabled"),this.__element.addClass("tchmi-control-disabled"),this.__curValueDisplay.off("pointerdown",this.__curValueDisplayPressedHandler),null===(e=this.__managePressAndHold)||void 0===e||e.stop()):(this.__input.removeAttr("disabled"),this.__element.removeClass("tchmi-control-disabled"),this.__isAttached&&this.__curValueDisplay.on("pointerdown",this.__curValueDisplayPressedHandler),null===(t=this.__managePressAndHold)||void 0===t||t.resume())}__processReadOnly(){super.__processReadOnly(),this.__processIsEnabled()}processBaObject(){if(!this.baObjectHandler.baObject)return;if(this.baObjectHandler.baObject.DataType!==t.DataType.number)return;this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.ePresentValue,e=>{this.setValueFeedback(e)}),this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eOutputUnit)?this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eOutputUnit,e=>{this.setUnit(e)}):this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eUnit,e=>{this.setUnit(e)}),this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eLowLimit)&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eLowLimit,e=>{e&&e.bEnable?this.setMinValue(e.fValue):this.setMinValue(null)}),this.baObjectHandler.baObject.tryGetBaVariable(t.BA.BaParameterId.eHighLimit)&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eHighLimit,e=>{e&&e.bEnable?this.setMaxValue(e.fValue):this.setMaxValue(null)}),1!=this.__attrHandler.readOnly&&this.setReadOnly(!this.baObjectHandler.baObject.checkManualValueWriteAccess())}}a.Slider=i,function(e){let a,i;e.isSliderRange=function(e){let a=!0;if(null!=e&&"object"==typeof e){let i=new Map;i.set("color",t.Color.isRGBAColor),i.set("start","number"),null!=e.end&&i.set("end","number"),t.TypeGuards.validateProperties(e,i)||(a=!1)}else a=!1;return a},function(e){e[e.rectangle=0]="rectangle",e[e.round=1]="round"}(a=e.KnobAppearance||(e.KnobAppearance={})),function(e){e.onUserInteractionFinished="onUserInteractionFinished",e.onValueChanged="onValueChanged",e.onValueFeedbackChanged="onValueFeedbackChanged"}(i=e.SliderEvents||(e.SliderEvents={}))}(i=a.Slider||(a.Slider={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends t.Base{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),a.useAnimation&&this.__element.addClass("use-animation"),this.__contentContainer=$("<div>").addClass("content-container"),this.__tabContainer=$("<div>").addClass("tab-container"),this.__tabs=new Map,this.__element.addClass("tab-window"),this.__element.append(this.__contentContainer),this.__element.append(this.__tabContainer)}__attach(){if(!this.__isAttached){if(!this.__selectedTab)for(let e of this.__tabs.values()){this.selectTab(e);break}super.__attach()}}__detach(){this.__isAttached&&super.__detach()}destroy(){this.removeAllTabs(),super.destroy()}set tabDistance(e){this.__attrHandler.checkAttribute(e,"tabDistance",{validator:"number"})&&(this.__attrHandler.tabDistance=e,null==e?this.__element.css("--tchmi-ba-tab-window-tab-distance",""):this.__element.css("--tchmi-ba-tab-window-tab-distance",e+"px"))}get tabDistance(){return this.__attrHandler.tabDistance}set tabContainerSize(e){this.__attrHandler.checkAttribute(e,"tabContainerSize",{validator:"number"})&&(this.__attrHandler.tabContainerSize=e,null==e?this.__element.css("--tchmi-ba-tab-window-tab-container-size",""):this.__element.css("--tchmi-ba-tab-window-tab-container-size",e+"px"))}get tabContainerSize(){return this.__attrHandler.tabContainerSize}set tabSizeAuto(e){this.__attrHandler.checkAttribute(e,"tabSizeAuto",{validator:"boolean"})&&(this.__attrHandler.tabSizeAuto=e,e?this.__element.addClass("tab-size-auto"):this.__element.removeClass("tab-size-auto"))}get tabSizeAuto(){return this.__attrHandler.tabSizeAuto}set tabIconPadding(e){this.__attrHandler.checkAttribute(e,"tabIconPadding",{validator:"number"})&&(this.__attrHandler.tabIconPadding=e,null==e?this.__element.css("--tchmi-ba-tab-window-tab-icon-padding",""):this.__element.css("--tchmi-ba-tab-window-tab-icon-padding",e+"px"))}get tabIconPadding(){return this.__attrHandler.tabIconPadding}addTab(e,i){if(!e){let t=0;for(e=this.__id+"-tab-"+t;this.__tabs.has(e);)t++,e=this.__id+"-tab-"+t}if(this.__tabs.has(e))return void console.warn("Tab with id "+e+" already exists!");let n=new a.Tab(e,this,i),s=n.eventHandler.register(a.Tab.TabEvents.onContentChanged,(e,t)=>{null!=this.__selectedTab&&t.getId()===this.__selectedTab.getId()&&t.getElement()[0].classList.contains("selected")&&(this.__contentContainer.children().detach(),this.selectTab(t))});return n.eventHandler.register(t.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),s()}),this.__tabs.set(e,n),this.__element.css("--tchmi-ba-tab-window-tab-cnt",String(this.__tabs.size)),this.__tabContainer.append(n.getElement()),1===this.__tabs.size&&(n.getElement().addClass("selected"),this.__isAttached&&this.selectTab(n)),n}removeTab(e){var t;let a=this.__tabs.get(e);if(null==a)return console.warn("Tab with id "+e+" was not found and could not be removed!"),!1;if(this.__tabs.delete(e),null!=this.__selectedTab&&this.__selectedTab.getId()===a.getId())for(let e of this.__tabs.values()){this.selectTab(e);break}return null===(t=a.getContent())||void 0===t||t.detach(),a.getElement().detach(),a.destroy(),!0}removeAllTabs(){for(let e of this.__tabs.values())e.getElement().detach(),e.destroy();this.__tabs=new Map,this.__contentContainer.children().detach()}getTab(e){return this.__tabs.get(e)}getSelectedTab(){return this.__selectedTab}getTabs(){return this.__tabs}selectTab(e){return"string"==typeof e&&this.__tabs.has(e)&&(e=this.__tabs.get(e)),!!(e instanceof a.Tab&&this.__tabs.has(e.getId()))&&(this.__updateSelectedTab(e),this.eventHandler.raise(a.TabWindowEvents.onTabSelected,e),!0)}__updateSelectedTab(e){for(let t of this.__tabs.values())t.getId()!==e.getId()?t.getElement().removeClass("selected"):t.getElement().addClass("selected");if(null!=this.__selectedTab){let e=this.__selectedTab.getContent();null!=e&&(e.detach(),this.__contentContainer.empty())}let t=e.getContent();null!=t&&this.__contentContainer.append(t),this.__selectedTab=e}setAttributes(e){if(super.setAttributes(e),void 0!==e.tabs)if(null===e.tabs)this.removeAllTabs();else for(let t=0;t<e.tabs.length;t++)this.addTab(void 0,e.tabs[t]);return void 0!==e.tabPosition&&this.setTabPosition(e.tabPosition),null!=e.tabDistance&&(this.tabDistance=e.tabDistance),null!=e.tabContainerSize&&(this.tabContainerSize=e.tabContainerSize),null!=e.tabSizeAuto&&(this.tabSizeAuto=e.tabSizeAuto),this}getAttributes(){return this.__attrHandler.getRef()}setTabPosition(t){return this.__attrHandler.checkAttribute(t,"tabPosition",{validator:()=>null!=t&&t>=e.Position.left&&t<=e.Position.bottom})?(this.__attrHandler.tabPosition=t,this.__processTabPosition(),this):this}__processTabPosition(){for(let t=0;t<=e.Position.bottom;t++)this.__element.removeClass("tab-position-"+e.Position[t]);null==this.__attrHandler.tabPosition?this.__element.addClass("tab-position-"+e.Position[e.Position.bottom]):this.__element.addClass("tab-position-"+e.Position[this.__attrHandler.tabPosition])}getTabPosition(){return this.__attrHandler.tabPosition}}t.TabWindow=a,function(e){let a;!function(e){e.onTabSelected="onTabSelected"}(a=e.TabWindowEvents||(e.TabWindowEvents={})),e.useAnimation=!0;class i extends t.TextControl{constructor(e,t,a){super(e,t,a)}__init(t){super.__init(t),this.__element.addClass("tab"),this.__downHandler=t=>{null!=t.button&&0!==t.button||this.__baParent instanceof e&&this.__baParent.selectTab(this.__id)},this.__element.append(this.textHandler.getTextElement())}__attach(){this.__isAttached||(this.__element.on("pointerdown",this.__downHandler),this.__destroyersToCallOnDetach.push(this.eventHandler.register(t.BackgroundStyler.Events.onSvgLoaded,()=>{null==this.text&&this.textHandler.getTextElement().detach(),this.__element.addClass("has-icon")})),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown",this.__downHandler),super.__detach())}destroy(){super.destroy()}set text(e){this.__element.append(this.textHandler.getTextElement()),this.textHandler.setText(e)}get text(){return this.textHandler.getText()}set icon(e){null==this.text&&this.textHandler.getTextElement().detach(),null==e&&null!=this.text&&this.__element.append(this.textHandler.getTextElement()),null!=e?this.__element.addClass("has-icon"):this.__element.removeClass("has-icon"),this.backgroundStyler.setImage(e,!0)}get icon(){return this.backgroundStyler.getImage()}setAttributes(e){return super.setAttributes(e),void 0!==e.content&&this.setContent(e.content),void 0!==e.tabBackgroundColorSelected&&this.setBackgroundColorSelected(e.tabBackgroundColorSelected),void 0!==e.textColorSelected&&this.setTextColorSelected(e.textColorSelected),this}getAttributes(){return this.__attrHandler.getRef()}setContent(e){return this.__attrHandler.checkAttribute(e,"content",{validator:"object"})?(this.__attrHandler.content=e,this.__processContent(),this):this}__processContent(){this.eventHandler.raise(e.Tab.TabEvents.onContentChanged)}getContent(){return this.__attrHandler.content}setBackgroundColorSelected(e){return this.__attrHandler.checkColorAttribute(e,"tabBackgroundColorSelected")?(this.__attrHandler.tabBackgroundColorSelected=e,this.__processBackgroundColorSelected(),this):this}__processBackgroundColorSelected(){null==this.__attrHandler.tabBackgroundColorSelected?this.__element.css("--tchmi-ba-tab-window-tab-background-color-selected",""):this.__element.css("--tchmi-ba-tab-window-tab-background-color-selected",this.__attrHandler.tabBackgroundColorSelected.toString())}getTabBackgroundColorSelected(){return this.__attrHandler.tabBackgroundColorSelected}setTextColorSelected(e){return this.__attrHandler.checkColorAttribute(e,"textColorSelected")?(this.__attrHandler.textColorSelected=e,this.__processTextColorSelected(),this):this}__processTextColorSelected(){null==this.__attrHandler.textColorSelected?this.__element.css("--tchmi-ba-tab-window-tab-text-color-selected",""):this.__element.css("--tchmi-ba-tab-window-tab-text-color-selected",this.__attrHandler.textColorSelected.toString())}getTextColorSelected(){return this.__attrHandler.textColorSelected}}e.Tab=i,function(e){let t;!function(e){e.onContentChanged="onContentChanged"}(t=e.TabEvents||(e.TabEvents={}))}(i=e.Tab||(e.Tab={}))}(a=t.TabWindow||(t.TabWindow={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i extends a.Button{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.baObjectHandler=new t.BaObjectHandler(this),void 0===(null==e?void 0:e.showDisplays)&&this.setShowDisplays(!0),this.__element.addClass("ui-icon"),void 0===(null==e?void 0:e.connectionColors)&&this.setConnectionColors(new t.Color.RGBAColor({r:144,g:185,b:234,a:1})),void 0===(null==e?void 0:e.connectionsWidth)&&this.setConnectionsWidth(4)}__attach(){this.__isAttached||(t.Helper.appendSourroundingElementsDimensionRectangle(this.__element,i.__eventIconSize/2),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){var e,a;if(null===(e=this.__eventIcons)||void 0===e||e.forEach(e=>e.destroy()),delete this.__eventIcons,this.__displaysDataSymbols)for(let e of this.__displaysDataSymbols.keys())this.__removeDataSubscriptions(e);null===(a=this.__displays)||void 0===a||a.forEach(e=>{e.getElement().off("pointerdown click",t.EventHandler.stopPropagationHandler),e.destroy()}),delete this.__displays,null!=this.__eventWatchIdentifier&&(this.baObjectHandler.baObject instanceof t.BA.BaObject||this.baObjectHandler.baObject instanceof t.BA.BaView)&&this.baObjectHandler.baObject.stopWatchEventsPerIcon(this.__eventWatchIdentifier),super.destroy()}__onEventDataChanged(e){let t=[];for(let[a,i]of e){let e={activate:!0,eventCondition:null,eventState:null,eventCount:null};i.nCount>0&&(e.eventCondition=a,e.eventState=i.eMostPriorisedState,e.eventCount=i.nCount,t.push(e))}this.setEventsData(t)}__onDisplayValueChanged(a){if(null!=this.__displays&&null!=this.__attrHandler.displaysData)for(let[n,s]of this.__displays)if(s.getId()===a.getId()){if(this.__attrHandler.displaysData.get(n).value=s.getValue(),this.__displaysDataSymbols){let i=this.__displaysDataSymbols.get(n);null!=i&&null!=i.valueMapping&&e.Server.writeSymbol(i.valueMapping,a.getValue(),e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)})}this.eventHandler.raise(i.UiIconEvents.onDisplayValueChanged);break}}__managePulse(){if(null==this.__attrHandler.eventsData)return this.__enablePulse(!1),void this.__element.removeClass("shows-pulse");let e=!1;for(let a=0;a<this.__attrHandler.eventsData.length;a++){let i=this.__attrHandler.eventsData[a];if(i.activate)if(null!=i.eventCondition&&"number"==typeof i.eventCondition&&null!=i.eventState&&"number"==typeof i.eventState){let a=i.eventCondition;if(null!=a&&a>=t.BA.EventCondition.eTypeAlarm&&a<=t.BA.EventCondition.eTypeOther&&(i.eventState===t.BA.EventIconState.eGone||i.eventState===t.BA.EventIconState.ePresent)){e=!0;break}}else if(i.enablePulse){e=!0;break}}this.__enablePulse(e),e?this.__element.addClass("shows-pulse"):this.__element.removeClass("shows-pulse")}__enablePulse(a){a?null==this.__destroyOnCustomBaPulse&&(this.__destroyOnCustomBaPulse=e.EventProvider.register(t.GlobalEvents.onCustomBaNewPulse,()=>{this.__element.addClass("pulse"),this.__element.on("animationend",()=>{this.__element.removeClass("pulse")})})):this.__destroyOnCustomBaPulse&&(this.__destroyOnCustomBaPulse(),delete this.__destroyOnCustomBaPulse)}__createEventIcons(){if(null!=this.__attrHandler.eventsData){if(this.__eventIcons)for(;this.__eventIcons.length>this.__attrHandler.eventsData.length&&this.__eventIcons.length>0;){let e=this.__eventIcons[this.__eventIcons.length-1];this.__removeEventSubscriptions(this.__eventIcons.length-1),e.getElement().detach(),e.destroy(),this.__eventIcons.pop()}if(!(this.__attrHandler.eventsData.length<=0)){this.__eventIcons||(this.__eventIcons=[]);for(let n=0;n<this.__attrHandler.eventsData.length;n++){let s=this.__attrHandler.eventsData[n],r=this.__id+"-event-icon-"+n,o=this.__eventIcons[n];if(null==o){o=new a.EventIcon(r,this,s),o.getElement().on("pointerdown click",t.EventHandler.stopPropagationHandler),o.layoutHandler.setHeight(i.__eventIconSize).setWidth(i.__eventIconSize),this.__eventIcons.push(o);let e=o.eventHandler.register(a.EventIcon.EventIconEvents.onAcknowledged,()=>{var e;return null===(e=this.baObjectHandler.baObject)||void 0===e?void 0:e.openParameterDialog("Events")});o.eventHandler.register(a.BaseNode.BaseNodeEvents.onDestroyed,a=>{o.getElement().off("pointerdown click",t.EventHandler.stopPropagationHandler),a.destroy(),e()})}let l=this.__eventsDataSymbols?this.__eventsDataSymbols[n]:void 0,d=s.activate;"string"==typeof d&&e.Symbol.isSymbolExpression(d)&&(null==l?l={}:null!=l.activateSubscriptionId&&t.Server.subscriptionCollector.remove(l.activateSubscriptionId),l.activateMapping=t.Helper.String.toServerMapping(d),l.activateSubscriptionId=t.Server.subscriptionCollector.add(l.activateMapping,e=>{s.activate=e,this.__activateEvents()})),o.setAcknowledgeSymbol(s.acknowledgeMapping);let _=s.eventCondition,h=s.eventCondition;if(null!=_&&("string"==typeof _&&_.length>0||"number"==typeof _)&&null!=h&&("string"==typeof h&&h.length>0||"number"==typeof h)){if("string"==typeof _&&e.Symbol.isSymbolExpression(_))null==l?l={}:null!=l.eventConditionSubscriptionId&&t.Server.subscriptionCollector.remove(l.eventConditionSubscriptionId),l.eventConditionMapping=t.Helper.String.toServerMapping(_),l.eventConditionSubscriptionId=t.Server.subscriptionCollector.add(l.eventConditionMapping,e=>{null==o||o.setEventCondition(e)});else{if("string"==typeof s.eventCondition&&(s.eventCondition=Number(s.eventCondition),isNaN(s.eventCondition))){console.warn(`A event description of ${this.__id} has an invalid value in property eventCondition!`),o.destroy();continue}o.setEventCondition(s.eventCondition)}if("string"==typeof h&&e.Symbol.isSymbolExpression(h))null==l?l={}:null!=l.eventStateSubscriptionId&&t.Server.subscriptionCollector.remove(l.eventStateSubscriptionId),l.eventStateMapping=t.Helper.String.toServerMapping(h),l.eventStateSubscriptionId=t.Server.subscriptionCollector.add(l.eventStateMapping,e=>{null==o||o.setEventState(e)});else{if("string"==typeof s.eventState&&(s.eventState=Number(s.eventState),isNaN(s.eventState))){console.warn(`A event description of ${this.__id} has an invalid value in property eventState!`),o.destroy();continue}o.setEventState(s.eventState)}let a=s.eventCount;if("string"==typeof a&&e.Symbol.isSymbolExpression(a))null==l?l={}:null!=l.eventCountSubscriptionId&&t.Server.subscriptionCollector.remove(l.eventCountSubscriptionId),l.eventCountMapping=t.Helper.String.toServerMapping(a),l.eventCountSubscriptionId=t.Server.subscriptionCollector.add(l.eventCountMapping,e=>{null==o||o.setEventCount(e)});else{if("string"==typeof s.eventCount&&(s.eventCount=Number(s.eventCount),isNaN(s.eventCount))){console.warn(`A event description of ${this.__id} has an invalid value in property eventCount!`),o.destroy();continue}o.setEventCount(s.eventCount)}}else o.setEventCondition(null),o.setEventState(null),o.setIsEnabled(null==s.isAcknowledgeable||s.isAcknowledgeable),o.setIcon(s.icon)}}}}__activateEvents(){if(null!=this.__attrHandler.eventsData&&null!=this.__eventIcons){let e=[];for(let a=0;a<this.__attrHandler.eventsData.length;a++){let i=this.__attrHandler.eventsData[a],n=this.__eventIcons[a];if(null!=n){if(i.activate){let i=t.CornerPosition.topRight;switch(a){case 0:i=t.CornerPosition.topRight;break;case 1:i=t.CornerPosition.bottomRight;break;case 2:i=t.CornerPosition.bottomLeft;break;case 3:i=t.CornerPosition.topLeft}e.push({element:n.getElement(),position:i})}else n.getIsAttached()&&n.getElement().detach();if(3===a)break}}t.Helper.appendSourroundingElements(this.__element,e,{distance:i.__eventIconSize/2})}this.__managePulse(),this.eventHandler.raise(i.UiIconEvents.onActiveEventsChanged),this.eventHandler.raise(i.UiIconEvents.onDisplayedEventsChanged)}__removeEventSubscriptions(e){if(!this.__eventsDataSymbols)return;let a=this.__eventsDataSymbols[e];null!=a&&(null!=a.activateSubscriptionId&&t.Server.subscriptionCollector.remove(a.activateSubscriptionId),null!=a.eventConditionSubscriptionId&&t.Server.subscriptionCollector.remove(a.eventConditionSubscriptionId),null!=a.eventStateSubscriptionId&&t.Server.subscriptionCollector.remove(a.eventStateSubscriptionId),null!=a.eventCountSubscriptionId&&t.Server.subscriptionCollector.remove(a.eventCountSubscriptionId))}__removeDataSubscriptions(e){if(null==this.__displaysDataSymbols)return;const a=this.__displaysDataSymbols.get(e);null!=a&&(null!=a.valueSubscriptionId&&t.Server.subscriptionCollector.remove(a.valueSubscriptionId),null!=a.unitSubscriptionId&&t.Server.subscriptionCollector.remove(a.unitSubscriptionId),null!=a.readOnlySubscriptionId&&t.Server.subscriptionCollector.remove(a.readOnlySubscriptionId))}__processDisplayPositions(){if(null!=this.__displays&&null!=this.__attrHandler.displaysData)for(let[e,t]of this.__displays){const a=this.__attrHandler.displaysData.get(e);null==a.position&&(a.position=i.DisplayPosition.top);for(let e=i.DisplayPosition.left;e<=i.DisplayPosition.bottomLeft;e++)t.getElement().hasClass(i.DisplayPosition[e])&&t.getElement().removeClass(i.DisplayPosition[e]);t.getElement().addClass(i.DisplayPosition[a.position]);let n=[];for(let[e,t]of this.__attrHandler.displaysData)t.position==a.position&&n.push({name:e,order:t.order});switch(n.length>1&&(n=n.sort((e,t)=>null==e.order&&null==t.order?0:null==e.order&&null!=t.order?1:null==t.order&&null!=e.order||e.order>t.order?-1:0)),t.getElement().css("--tchmi-ba-ui-icon-display-number",n.findIndex(t=>t.name===e)),n.length>1&&t.getElement().addClass("count-over-1"),t.getElement().css("--tchmi-ba-ui-icon-display-count",n.length),a.position){case i.DisplayPosition.bottomLeft:t.textHandler.setHorizontalAlignment("Right").setVerticalAlignment("Bottom");break;case i.DisplayPosition.topLeft:t.textHandler.setHorizontalAlignment("Right").setVerticalAlignment("Top");break;case i.DisplayPosition.left:t.textHandler.setHorizontalAlignment("Right").setVerticalAlignment("Center");break;case i.DisplayPosition.bottomRight:t.textHandler.setHorizontalAlignment("Left").setVerticalAlignment("Bottom");break;case i.DisplayPosition.right:t.textHandler.setHorizontalAlignment("Left").setVerticalAlignment("Center");break;case i.DisplayPosition.topRight:t.textHandler.setHorizontalAlignment("Left").setVerticalAlignment("Top")}}}processBaObject(){let e=this.baObjectHandler.baObject;if(null!=e){if(e instanceof t.BA.BaView||e instanceof t.BA.BaObject&&e.IsEventEnabled){let a=this.busyHandler.setBusy("Watching events of BaObject",{showIndicator:t.BusyHandler.ShowEventLoading}),i=e.watchEventsPerIcon(e=>{this.__onEventDataChanged(e),a()});null!=i?this.__eventWatchIdentifier=i:a()}this.__processShowTag()}}getConnection(e){let a=this.__element.children(".connection."+t.Position[e]);return a[0]?a:null}getDisplays(){return this.__displays}getDisplay(e){if(null==this.__displays)return null;const t=this.__displays.get(e);return null==t?null:t}addDisplay(e,i){var n;null==this.__displays&&(this.__displays=new Map),null==this.__attrHandler.displaysData&&(this.__attrHandler.displaysData=new Map);let s=null===(n=this.__displays)||void 0===n?void 0:n.get(e);if(null==s)return this.__attrHandler.displaysData.set(e,i),s=new a.InputBox(this.__id+"-display-"+e,this),s.getElement().on("pointerdown click",t.EventHandler.stopPropagationHandler),this.__displays.set(e,s),this.updateDisplay(e,i),this.__destroyersToCallOnDestroy.push(s.eventHandler.register(a.InputBox.InputBoxEvents.onUserInteractionFinished,(e,t)=>this.__onDisplayValueChanged(t))),s;throw new Error(`A display with name '${e}' has already been added.`)}updateDisplay(a,i){var n;if(null==this.__attrHandler.displaysData)throw new Error("No display data available!");let s=null===(n=this.__displays)||void 0===n?void 0:n.get(a);if(null==s)throw new Error(`No display with name '${a}' found.`);{this.__attrHandler.displaysData.set(a,Object.assign(Object.assign({},this.__attrHandler.displaysData.get(a)),i));let n=this.__displaysDataSymbols?this.__displaysDataSymbols.get(a):void 0,r=i.value;null!=r&&"string"==typeof r&&e.Symbol.isSymbolExpression(r)&&(null==n?n={}:null!=n.valueSubscriptionId&&t.Server.subscriptionCollector.remove(n.valueSubscriptionId),n.valueMapping=t.Helper.String.toServerMapping(r),n.valueSubscriptionId=t.Server.subscriptionCollector.add(n.valueMapping,e=>{null==s||s.setValueFeedback(e)}),i.value=void 0),null!=i.unit&&"string"==typeof i.unit&&e.Symbol.isSymbolExpression(i.unit)&&(null==n?n={}:null!=n.unitSubscriptionId&&t.Server.subscriptionCollector.remove(n.unitSubscriptionId),n.unitMapping=t.Helper.String.toServerMapping(i.unit),n.unitSubscriptionId=t.Server.subscriptionCollector.add(n.unitMapping,e=>{null==s||s.setUnit(e)}),i.unit=void 0);let o=i.readOnly;null!=o&&("string"==typeof o&&e.Symbol.isSymbolExpression(o)?(null==n?n={}:null!=n.readOnlySubscriptionId&&t.Server.subscriptionCollector.remove(n.readOnlySubscriptionId),n.readOnlyMapping=t.Helper.String.toServerMapping(o),n.readOnlySubscriptionId=t.Server.subscriptionCollector.add(n.readOnlyMapping,e=>{null==s||s.setReadOnly(e)}),i.readOnly=void 0):"boolean"!=typeof o&&(console.warn(`Wrong data input for attribute read only in UiIcon ${this.__id}!`),i.readOnly=!0)),n&&(this.__displaysDataSymbols||(this.__displaysDataSymbols=new Map),this.__displaysDataSymbols.set(a,n)),s.setAttributes(i),this.__processDisplayPositions(),this.__processShowDisplays()}}removeDisplay(e){var t,a;const i=null===(t=this.__displays)||void 0===t?void 0:t.get(e);return!(null==this.__attrHandler.displaysData||!i)&&(this.__attrHandler.displaysData.delete(e),null==this.__attrHandler.displaysData.size&&(this.__attrHandler.displaysData=null),this.__removeDataSubscriptions(e),i.getElement().detach(),i.destroy(),null===(a=this.__displays)||void 0===a||a.delete(e),this.__processDisplayPositions(),this.__processShowDisplays(),!0)}setDisplayPosition(e,a){if(null==this.__attrHandler.displaysData||null==this.__displays)return;const i=this.__attrHandler.displaysData.get(e);null!=i&&0!=this.__displays.has(e)?(i.position=a,this.__processDisplayPositions()):this.logger.log(t.Logger.Severity.warn,`Can't set position of display with name ${e} because it does not exist!`)}setAttributes(e){return super.setAttributes(e),void 0!==e.showDisplays&&this.setShowDisplays(e.showDisplays),void 0!==e.displaysData&&this.setDisplaysData(e.displaysData),void 0!==e.eventsData&&this.setEventsData(e.eventsData),void 0!==e.connections&&this.setConnections(e.connections),void 0!==e.connectionExtensions&&this.setConnectionExtensions(e.connectionExtensions),void 0!==e.connectionsWidth&&this.setConnectionsWidth(e.connectionsWidth),void 0!==e.connectionColors&&this.setConnectionColors(e.connectionColors),this}getAttributes(){return this.__attrHandler.getRef()}setDisplaysData(e){return this.__attrHandler.checkAttribute(e,"displaysData",{validator:()=>e instanceof Map})?(this.__attrHandler.displaysData=e,this.__processDisplaysData(),this):this}__processDisplaysData(){var e;if(null==this.__attrHandler.displaysData||this.__attrHandler.displaysData.size<=0){if(this.__displays){for(let[e,t]of this.__displays)this.__removeDataSubscriptions(e),t.getElement().detach(),t.destroy();delete this.__displays}}else{if(null!=this.__displays)for(const e of this.__displays.keys())0==this.__attrHandler.displaysData.has(e)&&this.removeDisplay(e);for(let[t,a]of this.__attrHandler.displaysData){let i=null===(e=this.__displays)||void 0===e?void 0:e.get(t);null==i?i=this.addDisplay(t,a):this.updateDisplay(t,a)}}}getDisplaysData(){return this.__attrHandler.displaysData}setEventsData(e){return this.__attrHandler.checkAttribute(e,"eventsData",{validator:"array"})?(this.__attrHandler.eventsData=e,this.__processEventsData(),this):this}__processEventsData(){if(null==this.__attrHandler.eventsData||this.__attrHandler.eventsData.length<=0){if(this.__eventIcons){for(let e=0;e<this.__eventIcons.length;e++){let t=this.__eventIcons[e];t.getIsAttached()&&t.getElement().detach(),t.destroy(),this.__removeEventSubscriptions(e)}delete this.__eventIcons}}else this.__createEventIcons();this.__activateEvents()}getEventsData(){return this.__attrHandler.eventsData}setIsActive(e){return this.__attrHandler.checkAttribute(e,"isActive",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.isActive=e,this.__processIsActive(),this):this}__processIsActive(){this.__attrHandler.isActive?this.__element.addClass("is-active"):this.__element.removeClass("is-active")}getIsActive(){return this.__attrHandler.isActive}setShowDisplays(e){return this.__attrHandler.checkAttribute(e,"showDisplays",{validator:"boolean"})?(null==e&&(e=!1),this.__attrHandler.showDisplays=e,this.__processShowDisplays(),this):this}__processShowDisplays(){if(this.__attrHandler.showDisplays){if(null==this.__displays)return;for(let e of this.__displays.values())!1===e.getIsAttached()&&this.__element.append(e.getElement())}else{if(null==this.__displays)return;for(let e of this.__displays.values())!0===e.getIsAttached()&&e.getElement().detach()}}getShowDisplays(){return this.__attrHandler.showDisplays}setConnections(e){return this.__attrHandler.checkAttribute(e,"connections",{validator:"object"})?(this.__attrHandler.connections=e,this.__processConnections(),this):this}__processConnections(){if(null==this.__attrHandler.connections){let e=this.__element.children(".connection");e[0]&&e.detach()}else{for(let e in this.__attrHandler.connections){if(e.indexOf("Unit")>-1)continue;if("top"!=e&&"right"!=e&&"bottom"!=e&&"left"!=e)continue;let t=this.__attrHandler.connections[e],a=this.__element.children(".connection."+e);if(null==t||t<=0)a[0]&&a.detach();else{let i;switch(a[0]||(a=$("<div>").addClass("connection "+e),this.__element.append(a)),e){case"bottom":case"top":if(t>0&&a.css("height",t+"px"),this.__attrHandler.connectionExtensions)for(let t in this.__attrHandler.connectionExtensions)if("left"===t||"right"===t){i=a.children(".connection.extension."+e+"."+t);let n=this.__attrHandler.connectionExtensions[t];n?(i[0]||(i=$("<div>").addClass("connection extension "+e+" "+t),a.append(i)),n>0&&i.css("width",n+"px")):i[0]&&i.detach()}break;case"right":case"left":if(t>0&&a.css("width",t+"px"),this.__attrHandler.connectionExtensions)for(let t in this.__attrHandler.connectionExtensions)if("top"===t||"bottom"===t){i=a.children(".connection.extension."+e+"."+t);let n=this.__attrHandler.connectionExtensions[t];n?(i[0]||(i=$("<div>").addClass("connection extension "+e+" "+t),a.append(i)),n>0&&i.css("height",n+"px")):i[0]&&i.detach()}}}}this.__processConnectionColors()}}getConnections(){return this.__attrHandler.connections}setConnectionExtensions(e){return this.__attrHandler.checkAttribute(e,"connectionExtensions",{validator:"object"})?(this.__attrHandler.connectionExtensions=e,this.__processConnectionExtensions(),this):this}__processConnectionExtensions(){this.__processConnections()}getConnectionExtensions(){return this.__attrHandler.connectionExtensions}setConnectionsWidth(e){return this.__attrHandler.checkAttribute(e,"connectionsWidth",{validator:"number"})?(this.__attrHandler.connectionsWidth=e,this.__processConnectionsWidth(),this):this}__processConnectionsWidth(){null==this.__attrHandler.connectionsWidth?this.__element.css("--tchmi-ba-ui-icon-connections-width",""):this.__element.css("--tchmi-ba-ui-icon-connections-width",this.__attrHandler.connectionsWidth+"px")}getConnectionsWidth(){return this.__attrHandler.connectionsWidth}setConnectionColors(e){if(!this.__attrHandler.checkColorAttribute(e,"connectionColors",{doNotlogError:!0})&&!this.__attrHandler.checkAttribute(e,"connectionColors",{validator:t.Color.isIFourSidedColor}))return this;let a;return a=e instanceof t.Color.RGBAColor?{left:e,right:e,top:e,bottom:e}:e,this.__attrHandler.connectionColors=a,this.__processConnectionColors(),this}__processConnectionColors(){if(null==this.__attrHandler.connectionColors)this.__element.find(".connection").css("background-color","");else for(let e in this.__attrHandler.connectionColors)null==this.__attrHandler.connectionColors[e]?this.__element.children(".connection."+e).css("background-color",""):this.__element.children(".connection."+e).css("background-color",this.__attrHandler.connectionColors[e].toString())}getConnectionColors(){return this.__attrHandler.connectionColors}setShowTag(e){return this.__attrHandler.checkAttribute(e,"showTag",{validator:"number"})?(this.__attrHandler.showTag=e,this.__processShowTag(),this):this}__processShowTag(){var e;if(null==this.baObjectHandler.baObject||null==this.__attrHandler.showTag)this.removeDisplay("tagDisplay");else{if(null==this.baObjectHandler.baObject.Params)throw new Error("BaObject not loaded yet! Make sure to loadAttributes of BaObject!");let a=this.getDisplay("tagDisplay");null==a&&(a=this.addDisplay("tagDisplay",{readOnly:!0,textAttributes:{fontWeight:"Bold"}})),this.updateDisplay("tagDisplay",{position:this.__attrHandler.showTag,value:t.Helper.String.toSymbolExpression(null===(e=this.baObjectHandler.baObject.Params)||void 0===e?void 0:e.get(t.BA.BaParameterId.eTag).Mapping)})}}getShowTag(){return this.__attrHandler.showTag}}i.__eventIconSize=30,a.UiIcon=i,function(e){let t,a;!function(e){e.onActiveEventsChanged="onUiIconActiveEventsChanged",e.onDisplayedEventsChanged="onUiIconDisplayedEventsChanged",e.onDisplayValueChanged="onUiIconDisplayValueChanged"}(t=e.UiIconEvents||(e.UiIconEvents={})),function(e){e[e.left=0]="left",e[e.top=1]="top",e[e.right=2]="right",e[e.bottom=3]="bottom",e[e.topLeft=4]="topLeft",e[e.topRight=5]="topRight",e[e.bottomRight=6]="bottomRight",e[e.bottomLeft=7]="bottomLeft"}(a=e.DisplayPosition||(e.DisplayPosition={}))}(i=a.UiIcon||(a.UiIcon={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i extends a.TextControl{constructor(e,t,a){super(e,t,a),this.__curDataType=null}__init(e){var a,i;super.__init(e),this.baObjectHandler=new t.BaObjectHandler(this),this.__element.addClass("value-field"),void 0===(null==e?void 0:e.digits)&&this.setDigits(1),void 0===(null==e?void 0:e.activeText)&&this.setActiveText("Active"),void 0===(null==e?void 0:e.inactiveText)&&this.setInactiveText("Inactive"),void 0===(null===(a=null==e?void 0:e.valueHandler)||void 0===a?void 0:a.autoWrite)&&this.setValueHandler({autoWrite:!0}),void 0===(null===(i=null==e?void 0:e.textAttributes)||void 0===i?void 0:i.horizontalAlignment)&&this.textHandler.setHorizontalAlignment("Left")}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){var e,t,a,i;null===(e=this.__valueField)||void 0===e||e.destroy(),null===(t=this.__checkbox)||void 0===t||t.destroy(),null===(a=this.__inputField)||void 0===a||a.destroy(),null===(i=this.__combobox)||void 0===i||i.destroy(),super.destroy()}__onDataTypeChanged(){var e,n,s,r,o;if(this.__attrHandler.dataType!==this.__curDataType)if(null!=this.__attrHandler.dataType){if(null!=this.__valueField){this.__valueField.getElement().detach();let e=this.__valueField.getId(),i=i=>{var n,s,r,o;i.destroy();let l=t.Globals.CreatedBaseNodes.get(e);if(l instanceof a.Checkbox)null===(n=this.__checkbox)||void 0===n||n.destroy(),delete this.__checkbox;else if(l instanceof a.InputBox)null===(s=this.__inputField)||void 0===s||s.destroy(),delete this.__inputField;else if(l instanceof a.Combobox)null===(r=this.__combobox)||void 0===r||r.destroy(),delete this.__combobox;else{if(!(l instanceof a.DateTimeField))throw new Error("Not handled control was detached!");null===(o=this.__dateTimeField)||void 0===o||o.destroy(),delete this.__dateTimeField}};this.__valueField.eventHandler.register(a.BaseNode.BaseNodeEvents.onDetached,i),delete this.__valueField}let l=null;switch(this.__attrHandler.dataType){case t.DataType.boolean:null==this.__checkbox&&(this.__checkbox=new a.Checkbox(this.__id+"-checkbox",this),this.__destroyersToCallOnDestroy.push(this.__checkbox.eventHandler.register(a.Checkbox.CheckboxEvents.onStateChanged,()=>{null!=this.__checkbox&&(this.__attrHandler.value=this.__checkbox.getState(),this.eventHandler.raise(i.ValueFieldEvents.onValueChanged))})),this.__destroyersToCallOnDestroy.push(this.__checkbox.eventHandler.register(a.Checkbox.CheckboxEvents.onUseLabelChanged,()=>this.__processCheckboxUseLabel())),this.__destroyersToCallOnDestroy.push(this.__checkbox.eventHandler.register(a.Checkbox.CheckboxEvents.onUserInteractionFinished,(e,t)=>this.__onUserInteractionFinished(e,t)))),this.__valueField=this.__checkbox,this.__checkbox.setInactiveText(this.__attrHandler.inactiveText).setActiveText(this.__attrHandler.activeText).textHandler.setHorizontalAlignment(null===(e=this.__attrHandler.textAttributes)||void 0===e?void 0:e.horizontalAlignment),this.__processCheckboxUseLabel(),null!=this.__attrHandler.valueFeedback?"boolean"==typeof this.__attrHandler.valueFeedback&&(l=this.__attrHandler.valueFeedback):"boolean"==typeof this.__attrHandler.value&&(l=this.__attrHandler.value),this.__updateValue(l);break;case t.DataType.number:case t.DataType.integer:case t.DataType.string:null==this.__inputField&&(this.__inputField=new a.InputBox(this.__id+"-input-field",this),this.__destroyersToCallOnDestroy.push(this.__inputField.eventHandler.register(a.InputBox.InputBoxEvents.onUserInteractionFinished,()=>{null!=this.__inputField&&(this.__attrHandler.value=this.__inputField.getValue(),this.eventHandler.raise(i.ValueFieldEvents.onValueChanged))})),this.__destroyersToCallOnDestroy.push(this.__inputField.eventHandler.register(a.InputBox.InputBoxEvents.onUserInteractionFinished,(e,t)=>this.__onUserInteractionFinished(e,t)))),this.__valueField=this.__inputField,this.__inputField.setDigits(this.__attrHandler.digits).setDataType(this.__attrHandler.dataType).textHandler.setHorizontalAlignment(null===(n=this.__attrHandler.textAttributes)||void 0===n?void 0:n.horizontalAlignment),this.__attrHandler.dataType!==t.DataType.number&&this.__attrHandler.dataType!==t.DataType.integer||this.__inputField.setUnit(this.__attrHandler.unit),null!=this.__attrHandler.valueFeedback?"number"==typeof this.__attrHandler.valueFeedback&&(l=this.__attrHandler.valueFeedback):"number"==typeof this.__attrHandler.value&&(l=this.__attrHandler.value),this.__updateValue(l);break;case t.DataType.enum:null==this.__combobox&&(this.__combobox=new a.Combobox(this.__id+"-combobox-field",this),this.__destroyersToCallOnDestroy.push(this.__combobox.eventHandler.register(a.Combobox.ComboboxEvents.onSelectedValueChanged,()=>{null!=this.__combobox&&(this.__attrHandler.value=this.__combobox.getSelectedValue(),this.eventHandler.raise(i.ValueFieldEvents.onValueChanged))})),this.__destroyersToCallOnDestroy.push(this.__combobox.eventHandler.register(a.Combobox.ComboboxEvents.onUserInteractionFinished,(e,t)=>this.__onUserInteractionFinished(e,t)))),this.__valueField=this.__combobox,this.__combobox.setData(this.__attrHandler.stateTexts),null!=this.__attrHandler.valueFeedback?"number"==typeof this.__attrHandler.valueFeedback&&(l=this.__attrHandler.valueFeedback):"number"==typeof this.__attrHandler.value&&(l=this.__attrHandler.value),this.__updateValue(l);break;case t.DataType.dateTime:null==this.__dateTimeField&&(this.__dateTimeField=new a.DateTimeField(this.__id+"-date-time-field",this),this.__isAttached&&this.__destroyersToCallOnDestroy.push(this.__dateTimeField.eventHandler.register(a.DateTimeField.DateTimeFieldEvents.onDateChanged,()=>{null!=this.__dateTimeField&&(this.__attrHandler.value=this.__dateTimeField.getDate(),this.eventHandler.raise(i.ValueFieldEvents.onValueChanged))})),this.__destroyersToCallOnDestroy.push(this.__dateTimeField.eventHandler.register(a.DateTimeField.DateTimeFieldEvents.onUserInteractionFinished,(e,t)=>this.__onUserInteractionFinished(e,t)))),this.__valueField=this.__dateTimeField,null!=this.__attrHandler.valueFeedback?"number"===this.__attrHandler.valueFeedback&&(l=this.__attrHandler.valueFeedback):"number"==typeof this.__attrHandler.value&&(l=this.__attrHandler.value),this.__updateValue(l);break;case t.DataType.unknown:break;default:console.error("No valid data type was found. Please check the attributes of E.DataTypes!")}this.__curDataType=this.__attrHandler.dataType,null!=this.__valueField&&(this.__valueField.setAttributes({valueHandler:this.__attrHandler.valueHandler}).setContentPadding(this.__attrHandler.contentPadding).setReadOnly(this.__attrHandler.readOnly),this.__valueField.textHandler.setHorizontalAlignment(null===(s=this.__attrHandler.textAttributes)||void 0===s?void 0:s.horizontalAlignment),this.__valueField.layoutHandler.setWidth(100,"%").setHeight(100,"%"),this.__attrHandler.dataType===t.DataType.boolean&&null==(null===(r=this.__attrHandler.textAttributes)||void 0===r?void 0:r.horizontalAlignment)?this.__valueField.textHandler.setHorizontalAlignment("Left"):this.__valueField.textHandler.setHorizontalAlignment(null===(o=this.__attrHandler.textAttributes)||void 0===o?void 0:o.horizontalAlignment),this.__element.append(this.__valueField.getElement()))}else if(null!=this.__valueField){this.__valueField.getElement().detach();let e=this.__valueField.getId(),i=i=>{i.destroy();let n=t.Globals.CreatedBaseNodes.get(e);n instanceof a.Base&&(null==n||n.destroy())};this.__valueField.eventHandler.register(a.BaseNode.BaseNodeEvents.onDetached,i),delete this.__valueField}}__onUserInteractionFinished(e,t){this.eventHandler.raise(i.ValueFieldEvents.onUserInteractionFinished)}__updateValue(e){var a,i,n,s,r,o,l;if(this.__attrHandler.dataType!=t.DataType.unknown)if(null==this.__attrHandler.valueFeedback)if(null==e)null===(a=this.__checkbox)||void 0===a||a.setState(null),null===(i=this.__inputField)||void 0===i||i.setValue(null),null===(n=this.__combobox)||void 0===n||n.setSelectedValue(null),null===(s=this.__dateTimeField)||void 0===s||s.setDate(null);else switch(this.__attrHandler.dataType){case t.DataType.boolean:void 0!==this.__checkbox&&"boolean"==typeof e&&this.__checkbox.setState(e);break;case t.DataType.number:case t.DataType.integer:case t.DataType.string:void 0===this.__inputField||"number"!=typeof e&&"string"!=typeof e||this.__inputField.setValue(e);break;case t.DataType.enum:void 0!==this.__combobox&&"number"==typeof e&&this.__combobox.setSelectedValue(e);break;case t.DataType.dateTime:void 0!==this.__dateTimeField&&e instanceof Date&&this.__dateTimeField.setDate(e);break;default:console.error("No valid data type was found. Please check the attributes of E.DataTypes!")}else if(null==e||null==this.__attrHandler.dataType)null===(r=this.__checkbox)||void 0===r||r.setStateFeedback(null),null===(o=this.__inputField)||void 0===o||o.setValueFeedback(null),null===(l=this.__combobox)||void 0===l||l.setSelectedValueFeedback(null);else switch(this.__attrHandler.dataType){case t.DataType.boolean:void 0!==this.__checkbox&&"boolean"==typeof e&&this.__checkbox.setStateFeedback(e);break;case t.DataType.string:case t.DataType.integer:case t.DataType.number:void 0===this.__inputField||"number"!=typeof e&&"string"!=typeof e||this.__inputField.setValueFeedback(e);break;case t.DataType.enum:void 0!==this.__combobox&&"number"==typeof e&&this.__combobox.setSelectedValueFeedback(e);break;case t.DataType.dateTime:void 0!==this.__dateTimeField&&e instanceof Date&&this.__dateTimeField.setDate(e);break;default:console.error("No valid data type was found. Please check the attributes of E.DataTypes!")}else console.warn(`DataType of ValueField ${this.__id} is unkown! Please set DataType before setting value of the ValueField!`)}__processCheckboxUseLabel(){void 0===this.__checkbox||this.__checkbox.getUseLabel()?this.__element.css({display:"","justify-content":""}):this.__element.css({display:"flex","justify-content":"center"})}processBaObject(){var e,a,i;if(null!=this.baObjectHandler.baObject)switch(this.baObjectHandler.baObject.DataType){case t.DataType.number:this.setDataType(t.DataType.number),null===(e=this.__inputField)||void 0===e||e.baObjectHandler.setBaObject(this.baObjectHandler.baObject);break;case t.DataType.boolean:this.setDataType(t.DataType.boolean),null===(a=this.__checkbox)||void 0===a||a.baObjectHandler.setBaObject(this.baObjectHandler.baObject);break;case t.DataType.enum:this.setDataType(t.DataType.enum),null===(i=this.__combobox)||void 0===i||i.baObjectHandler.setBaObject(this.baObjectHandler.baObject);break;default:console.error("No valid data type was found. Please check the attributes of E.DataTypes!")}}getValueField(){return this.__valueField}setAttributes(e){return super.setAttributes(e),null!=e.valueHandler&&this.setValueHandler(e.valueHandler),void 0!==e.value&&this.setValue(e.value),void 0!==e.valueFeedback&&this.setValueFeedback(e.valueFeedback),void 0!==e.dataType&&this.setDataType(e.dataType),void 0!==e.activeText&&this.setActiveText(e.activeText),void 0!==e.inactiveText&&this.setInactiveText(e.inactiveText),void 0!==e.unit&&this.setUnit(e.unit),void 0!==e.minValue&&this.setMinValue(e.minValue),void 0!==e.maxValue&&this.setMaxValue(e.maxValue),void 0!==e.stateTexts&&this.setStateTexts(e.stateTexts),this}getAttributes(){return this.__attrHandler.getRef()}setValue(e){return this.__attrHandler.checkAttribute(e,"value",{validator:["number","boolean","string","date"]})?(null==this.__attrHandler.valueFeedback&&(this.__attrHandler.value=e,this.__processValue()),this.eventHandler.raise(i.ValueFieldEvents.onValueChanged),this):this}__processValue(){this.__updateValue(this.__attrHandler.value)}getValue(){return this.__attrHandler.value}setValueFeedback(e){return this.__attrHandler.checkAttribute(e,"valueFeedback",{validator:["number","boolean","string","date"]})?(this.__attrHandler.valueFeedback=e,this.__processValueFeedback(),this):this}__processValueFeedback(){this.__attrHandler.value=this.__attrHandler.valueFeedback,this.__updateValue(this.__attrHandler.valueFeedback)}getValueFeedback(){return this.__attrHandler.valueFeedback}setDataType(e){return this.__attrHandler.checkAttribute(e,"dataType",{validator:"number"})?(null==e&&(e=t.DataType.unknown),this.__attrHandler.dataType=e,this.__processDataType(),this):this}__processDataType(){this.__onDataTypeChanged()}getDataType(){return this.__attrHandler.dataType}setActiveText(e){return this.__attrHandler.checkAttribute(e,"activeText",{validator:"string"})?(this.__attrHandler.activeText=e,this.__processActiveText(),this):this}__processActiveText(){var e;null===(e=this.__checkbox)||void 0===e||e.setActiveText(this.__attrHandler.activeText)}getActiveText(){return this.__attrHandler.activeText}setInactiveText(e){return this.__attrHandler.checkAttribute(e,"inactiveText",{validator:"string"})?(this.__attrHandler.inactiveText=e,this.__processInactiveText(),this):this}__processInactiveText(){var e;null===(e=this.__checkbox)||void 0===e||e.setInactiveText(this.__attrHandler.inactiveText)}getInactiveText(){return this.__attrHandler.inactiveText}setUnit(a){if(!this.__attrHandler.checkAttribute(a,"unit",{validator:["string","number"]}))return this;if("number"==typeof a)if(void 0!==t.Globals.Units)a=t.Helper.convertUnitToString(a),this.__attrHandler.unit=a,this.__processUnit();else{this.__attrHandler.unit=t.BA.Unit[a],this.__processUnit();let i=e.EventProvider.register("CustomBA.onUnitsLoaded",()=>{this.__attrHandler.unit=t.Helper.convertUnitToString(a),this.__processUnit(),i()})}else this.__attrHandler.unit=a,this.__processUnit();return this.__processUnit(),this}__processUnit(){var e;null===(e=this.__inputField)||void 0===e||e.setUnit(this.__attrHandler.unit)}getUnit(){return this.__attrHandler.unit}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(this.__attrHandler.minValue=e,this.__processMinValue(),this):this}__processMinValue(){var e;null===(e=this.__inputField)||void 0===e||e.setMinValue(this.__attrHandler.minValue)}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(this.__attrHandler.maxValue=e,this.__processMaxValue(),this):this}__processMaxValue(){var e;null===(e=this.__inputField)||void 0===e||e.setMaxValue(this.__attrHandler.maxValue)}getMaxValue(){return this.__attrHandler.maxValue}setStateTexts(e){return this.__attrHandler.checkAttribute(e,"stateTexts",{validator:"array"})?(this.__attrHandler.stateTexts=e,this.__processStateTexts(),this):this}__processStateTexts(){var e;null===(e=this.__combobox)||void 0===e||e.setData(this.__attrHandler.stateTexts),null==this.__attrHandler.stateTexts?this.__attrHandler.dataType===t.DataType.enum&&this.setDataType(t.DataType.unknown):this.setDataType(t.DataType.enum)}getStateTexts(){return this.__attrHandler.stateTexts}setDigits(e){var t;return this.__attrHandler.checkAttribute(e,"digits",{validator:"number"})?(this.__attrHandler.digits=e,null===(t=this.__inputField)||void 0===t||t.setDigits(this.__attrHandler.digits),this):this}getDigits(){return this.__attrHandler.digits}setValueHandler(e){var t,a,i;return this.__attrHandler.checkAttribute(e,"valueHandler")?(this.__attrHandler.valueHandler=e,null===(t=this.__checkbox)||void 0===t||t.setAttributes({valueHandler:e}),null===(a=this.__inputField)||void 0===a||a.setAttributes({valueHandler:e}),null===(i=this.__combobox)||void 0===i||i.setAttributes({valueHandler:e}),this):this}getAutoWrite(){return this.__attrHandler.valueHandler}__processReadOnly(){var e;super.__processReadOnly(),null===(e=this.__valueField)||void 0===e||e.setReadOnly(this.__attrHandler.readOnly)}__processContentPadding(){var e;super.__processContentPadding(),null===(e=this.__valueField)||void 0===e||e.setContentPadding(this.__attrHandler.contentPadding)}__processTextHorizontalAlignment(){var e,a,i,n;this.__attrHandler.dataType===t.DataType.boolean&&null==(null===(e=this.__attrHandler.textAttributes)||void 0===e?void 0:e.horizontalAlignment)?null===(a=this.__valueField)||void 0===a||a.textHandler.setHorizontalAlignment("Left"):null===(i=this.__valueField)||void 0===i||i.textHandler.setHorizontalAlignment(null===(n=this.__attrHandler.textAttributes)||void 0===n?void 0:n.horizontalAlignment)}__processTextVerticalAlignment(){var e,t;null===(e=this.__valueField)||void 0===e||e.textHandler.setVerticalAlignment(null===(t=this.__attrHandler.textAttributes)||void 0===t?void 0:t.verticalAlignment)}}a.ValueField=i,function(e){let t;!function(e){e.onValueChanged="onValueFieldValueChanged",e.onUserInteractionFinished="onValueFieldUserIneractionFinished"}(t=e.ValueFieldEvents||(e.ValueFieldEvents={}))}(i=a.ValueField||(a.ValueField={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(e){!function(t){class a extends t.Base{constructor(e,t,a){super(e,t,a),this.__originalLeft=null,this.__originalTop=null,this.__originalRight=null,this.__originalBottom=null,this.__originalMouseX=null,this.__originalMouseY=null,this.__maxPos=null}__init(a){var i;super.__init(a),this.valueField=new t.ValueField(this.__id+"-value-field",this),this.__startTimeDisplay=$("<div>").addClass("time-display start"),this.__resizerStart=$("<div>").addClass("resizer start"),this.__contentContainer=$("<div>").addClass("content-container"),this.__element.addClass("daily-schedule-entry"),this.__elementPressedHandler=e=>this.__onElementPressed(e),this.__pressEndHandler=e=>this.__onPressEnd(e),this.__moveHandler=e=>this.__onMoved(e),this.__resizerPressedHandler=e=>this.__onResizerPressed(e),this.__editButtonPressedHandler=()=>this.__onEditButtonPressed(),this.__deleteButtonPressedHandler=()=>this.__onDeleteButtonPressed(),this.__cbStateChangedHandler=()=>this.__onCbStateChanged();let n=[{onPressed:this.__editButtonPressedHandler,cbOnCreated:t=>{this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.Edit,a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text)}))}},{onPressed:this.__deleteButtonPressedHandler,cbOnCreated:t=>{this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.Delete,a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text)}))}},{name:"select-state",controls:{type:t.ComponentType.Combobox,callback:this.__cbStateChangedHandler,name:"cb",settings:{readOnly:!1,data:[{text:"value",value:e.BA.SchedEntryState.eValue},{text:"null",value:e.BA.SchedEntryState.eNull}]}},cbOnCreated:t=>{this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.State,a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text+":")}))}}],s=t.ContextMenu.createContextMenuAndButton({id:this.__id,root:this.__element,parent:this,rowEntryOptions:n});this.__contextMenu=s.menu,this.__menuButton=s.button,this.__menuButton.getElement().addClass("menu-button"),this.__element.append(this.__startTimeDisplay),this.__element.append(this.__resizerStart),this.__cbState=null===(i=this.__contextMenu.getRowEntry("select-state"))||void 0===i?void 0:i.controlContainer.getControl("cb"),this.__element.append(this.__contentContainer),a&&this.valueField.setAttributes(a),this.valueField.getElement().addClass("value-field"),void 0===(null==a?void 0:a.allowMoving)&&this.setAllowMoving(!0),void 0===(null==a?void 0:a.snapPeriode)&&this.setSnapPeriode(1),void 0===(null==a?void 0:a.activeText)&&this.valueField.setActiveText(e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.Active)),void 0===(null==a?void 0:a.inactiveText)&&this.valueField.setInactiveText(e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.Inactive))}__attach(){this.__isAttached||(this.__element.on("mousedown touchstart",this.__elementPressedHandler),this.__resizerStart.on("mousedown touchstart",this.__resizerPressedHandler),this.__destroyersToCallOnDetach.push(this.valueField.eventHandler.register(t.ValueField.ValueFieldEvents.onValueChanged,()=>this.__onValueChanged())),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("mousedown touchstart",this.__elementPressedHandler),this.__resizerStart.off("mousedown touchstart",this.__resizerPressedHandler),super.__detach())}destroy(){this.valueField.destroy();let e=this.childrenHandler.getChildren().get(this.__id+"-null-indicator");null==e||e.destroy(),super.destroy()}__onElementPressed(e){e.stopPropagation(),"mousedown"===e.type&&0!=e.button||"input"!==e.target.localName&&this.__attrHandler.allowMoving&&this.__resizerPressedHandler(e)}__onPressEnd(e){$(window).off("mousemove touchmove",this.__moveHandler),$(window).off("mouseup touchend",this.__pressEndHandler)}__onMoved(t){if(null==this.__attrHandler.startTime||null==this.__attrHandler.endTime||null==this.__attrHandler.offset||null==this.__maxPos)return;let a=this.__currentTarget;if(null==a)return;let i=this.__attrHandler.startTime.toSeconds(),n=this.__attrHandler.endTime.toSeconds(),s=null,r=null;if("mousemove"===t.type?(s=t.pageX,r=t.pageY):"touchmove"===t.type&&(s=t.touches[0].pageX,r=t.touches[0].pageY),null!==s&&null!==r){if(this.__attrHandler.orientation===e.Orientation.horizontal){if(null===this.__originalLeft||null===this.__originalRight||null===this.__originalMouseX)return;a.classList.contains("start")?i=Math.floor((this.__originalLeft+(s-this.__originalMouseX))/this.__attrHandler.offset):(i=Math.floor((this.__originalLeft+(s-this.__originalMouseX))/this.__attrHandler.offset),n=Math.floor((this.__maxPos-this.__originalRight+(s-this.__originalMouseX))/this.__attrHandler.offset))}else{if(null===this.__originalTop||null===this.__originalBottom||null===this.__originalMouseY)return;a.classList.contains("start")?i=Math.floor((this.__originalTop+(r-this.__originalMouseY))/this.__attrHandler.offset):(i=Math.floor((this.__originalTop+(r-this.__originalMouseY))/this.__attrHandler.offset),n=Math.floor((this.__maxPos-this.__originalBottom+(r-this.__originalMouseY))/this.__attrHandler.offset))}this.__validateNewTimes(i,n)}}__onResizerPressed(t){t.stopPropagation(),0!=this.checkAccess(e.Server.UserManagement.AccessRight.operate)&&("mousedown"===t.type&&0!==t.button||!0!==this.__attrHandler.readOnly&&(this.__attrHandler.orientation===e.Orientation.horizontal?(this.__originalLeft=Number(this.__element.css("left").replace("px","")),this.__originalRight=Number(this.__element.css("right").replace("px","")),"mousedown"===t.type?this.__originalMouseX=t.pageX:"touchstart"===t.type&&(this.__originalMouseX=t.touches[0].pageX)):(this.__originalTop=Number(this.__element.css("top").replace("px","")),this.__originalBottom=Number(this.__element.css("bottom").replace("px","")),"mousedown"===t.type?this.__originalMouseY=t.pageY:"touchstart"===t.type&&(this.__originalMouseY=t.touches[0].pageY)),this.__currentTarget=t.currentTarget,$(window).on("mousemove touchmove",this.__moveHandler),$(window).on("mouseup touchend",this.__pressEndHandler)))}__onValueChanged(){if(null!=this.__attrHandler.unionValue){switch(this.__attrHandler.dataType){case e.DataType.boolean:this.__attrHandler.unionValue.bVal=this.valueField.getValue(),this.valueField.setValue(this.__attrHandler.unionValue.bVal);break;case e.DataType.number:this.__attrHandler.unionValue.rVal=this.valueField.getValue(),this.valueField.setValue(this.__attrHandler.unionValue.rVal);break;case e.DataType.enum:this.__attrHandler.unionValue.udiVal=this.valueField.getValue(),this.valueField.setValue(this.__attrHandler.unionValue.udiVal)}this.__updateStateColors(),this.eventHandler.raise(a.DailyScheduleEntryEvents.onValueChanged)}}__onEditButtonPressed(){if(this.__contextMenu.close(),null!=this.__attrHandler.startTime&&null!=this.__attrHandler.endTime){let a,i,n=t=>{a=e.BA.BaTime.fromDate(t)},s=n=>__awaiter(this,void 0,void 0,(function*(){if(null==a&&(a=e.BA.BaTime.fromDate(n)),this.__baParent instanceof t.DailySchedule)if(e.Helper.Map.getNext(this.__baParent.getScheduleEntries(),this.__id)){let n=t=>{i=e.BA.BaTime.fromDate(t)},s=n=>__awaiter(this,void 0,void 0,(function*(){null==i&&(i=e.BA.BaTime.fromDate(n)),this.__validateNewTimes(a.toSeconds(),i.toSeconds())||(yield t.DialogWindow.alert("Input was not valid!"))}));t.TimePicker.openTimePickerDialog(this.__attrHandler.endTime.toDate(),e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.SelectNewEndTime),n,s)}else this.__validateNewTimes(a.toSeconds(),this.__attrHandler.endTime.toSeconds())||(yield t.DialogWindow.alert("Input was not valid!"))}));t.TimePicker.openTimePickerDialog(this.__attrHandler.startTime.toDate(),e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.SelectNewStartTime),n,s)}}__onDeleteButtonPressed(){return __awaiter(this,void 0,void 0,(function*(){this.__contextMenu.close(),(yield t.DialogWindow.confirm("Do you really want to delete this entry?"))&&this.eventHandler.raise(a.DailyScheduleEntryEvents.onEntryDeleted)}))}__onCbStateChanged(){var e;this.__contextMenu.close(),this.setState(null===(e=this.__cbState)||void 0===e?void 0:e.getSelectedValue())}__validateNewTimes(i,n,s){var r,o,l,d;if(null==this.__attrHandler.startTime||null==this.__attrHandler.endTime)return!1;let _=!1,h=!1,c=!0;if(i!==this.__attrHandler.startTime.toSeconds()){if(null!=this.__attrHandler.minStartTime){let e=this.__attrHandler.minStartTime.toSeconds();i<e&&(i=e,h=!0)}if(n-i<t.WeeklySchedule.MinEntryTime)i=n-t.WeeklySchedule.MinEntryTime;else if(i<=a.minSeconds)i=a.minSeconds,h=!0;else if(i>=a.maxSeconds)i=a.maxSeconds-t.WeeklySchedule.MinEntryTime;else if(s){if(this.__baParent instanceof t.DailySchedule){null===(r=e.Helper.Map.getPrevious(this.__baParent.getScheduleEntries(),this.__id))||void 0===r||r.value,null===(o=e.Helper.Map.getNext(this.__baParent.getScheduleEntries(),this.__id))||void 0===o||o.value}}else c=!1}else c=!1;if(n!==this.__attrHandler.endTime.toSeconds()){if(null!=this.__attrHandler.maxEndTime){let e=this.__attrHandler.maxEndTime.toSeconds();n>e&&(n=e,_=!0,c=!0)}if(n-i<t.WeeklySchedule.MinEntryTime)n=i+t.WeeklySchedule.MinEntryTime,_=!0,c=!0;else if(n>=a.maxSeconds)n=a.maxSeconds,_=!0,c=!0;else if(n<=a.minSeconds)n=a.minSeconds,c=!0;else if(s){if(this.__baParent instanceof t.DailySchedule){null===(l=e.Helper.Map.getPrevious(this.__baParent.getScheduleEntries(),this.__id))||void 0===l||l.value,null===(d=e.Helper.Map.getNext(this.__baParent.getScheduleEntries(),this.__id))||void 0===d||d.value}c=!0}else c=!1}else c=!1;return _||this.setStartTime(e.BA.BaTime.fromSeconds(i)),h||this.setEndTime(e.BA.BaTime.fromSeconds(n)),!c}__updateStateColors(){if(null==this.__attrHandler.unionValue)return;let t=this.__attrHandler.stateColors;switch(null==t&&(t=a.StateColors),this.__attrHandler.dataType){case e.DataType.boolean:this.__attrHandler.unionValue.bVal?this.backgroundStyler.setColor(t.binary.true):this.backgroundStyler.setColor(t.binary.false);break;case e.DataType.number:t.analog=e.Helper.Array.mergeSort(t.analog,!1,(e,t)=>e.start>t.start);for(let a=0;a<t.analog.length;a++){if(t.analog[a].start==this.__attrHandler.unionValue.rVal){this.backgroundStyler.setColor(t.analog[a].color);break}if(t.analog[a].start>this.__attrHandler.unionValue.rVal){if(0==a){this.backgroundStyler.setColor(t.analog[a].color);break}this.backgroundStyler.setColor(e.Color.getFadeColor(t.analog[a-1].color,t.analog[a-1].start,t.analog[a].color,t.analog[a].start,this.__attrHandler.unionValue.rVal));break}if(t.analog[a].start<this.__attrHandler.unionValue.rVal&&a==t.analog.length-1){this.backgroundStyler.setColor(t.analog[a].color);break}}break;case e.DataType.enum:let a=0,i=0;for(;a<this.__attrHandler.unionValue.udiVal;)a++,i++,i>t.multistate.length-1&&(i=0);this.backgroundStyler.setColor(t.multistate[i])}}updateStartPos(t){if(null!=this.__attrHandler.offset&&null!=t){let a=this.__attrHandler.offset*t.toSeconds();this.__attrHandler.orientation===e.Orientation.horizontal?this.__element.css({left:a+"px",top:"0"}):this.__element.css({top:a+"px",left:"0"})}}updateEndPos(t){if(null!=this.__attrHandler.offset&&null!=t){let a=this.__attrHandler.offset*(86400-e.Helper.DateTime.convertSTTimeToSeconds(t));this.__attrHandler.orientation===e.Orientation.horizontal?this.__element.css({right:a+"px",bottom:"0"}):this.__element.css({bottom:a+"px",right:"0"})}}setAttributes(e){return super.setAttributes(e),void 0!==e.startTime&&this.setStartTime(e.startTime),void 0!==e.endTime&&this.setEndTime(e.endTime),void 0!==e.minStartTime&&this.setMinStartTime(e.minStartTime),void 0!==e.maxEndTime&&this.setMaxEndTime(e.maxEndTime),void 0!==e.orientation&&this.setOrientation(e.orientation),void 0!==e.allowMoving&&this.setAllowMoving(e.allowMoving),void 0!==e.offset&&this.setOffset(e.offset),void 0!==e.snapPeriode&&this.setSnapPeriode(e.snapPeriode),void 0!==e.state&&this.setState(e.state),void 0!==e.stateColors&&this.setStateColors(e.stateColors),void 0!==e.unionValue&&this.setValue(e.unionValue),void 0!==e.dataType&&this.setDataType(e.dataType),this.valueField.setAttributes(e),this}getAttributes(){return this.__attrHandler.getRef()}setOffset(e){return this.__attrHandler.checkAttribute(e,"offset",{validator:"number"})?(this.__attrHandler.offset=e,this.__maxPos=24*(e||0)*60*60,null!=this.__attrHandler.startTime&&this.updateStartPos(this.__attrHandler.startTime),null!=this.__attrHandler.endTime&&this.updateEndPos(this.__attrHandler.endTime),this):this}getOffset(){return this.__attrHandler.offset}setStartTime(t){var i,n,s;return this.__attrHandler.checkAttribute(t,"startTime",{validator:e.BA.isBaTime,skipEqualityCheck:!0})?(null!=t&&null!=this.__attrHandler.snapPeriode&&t.snapToPeriode(60*this.__attrHandler.snapPeriode),(null===(i=this.__attrHandler.startTime)||void 0===i?void 0:i.equals(t))?(this.__attrHandler.equalAttribute("StartTime"),this):(this.__attrHandler.startTime=t,this.updateStartPos(this.__attrHandler.startTime),null!=this.__attrHandler.startTime?null===(n=this.__startTimeDisplay)||void 0===n||n.html(this.__attrHandler.startTime.toString(e.BA.BaTime.TimeStringFormat.minutes)):null===(s=this.__startTimeDisplay)||void 0===s||s.html("null"),this.eventHandler.raise(a.DailyScheduleEntryEvents.onStartTimeChanged),this)):this}getStartTime(){return this.__attrHandler.startTime}setEndTime(t){var i;return this.__attrHandler.checkAttribute(t,"endTime",{validator:e.BA.isBaTime,skipEqualityCheck:!0})?(null!=t&&null!=this.__attrHandler.snapPeriode&&t.snapToPeriode(60*this.__attrHandler.snapPeriode),(null===(i=this.__attrHandler.endTime)||void 0===i?void 0:i.equals(t))?(this.__attrHandler.equalAttribute("EndTime"),this):(this.__attrHandler.endTime=t,this.updateEndPos(this.__attrHandler.endTime),this.eventHandler.raise(a.DailyScheduleEntryEvents.onEndTimeChanged),this)):this}getEndTime(){return this.__attrHandler.endTime}setMinStartTime(t){var a;return this.__attrHandler.checkAttribute(t,"minStartTime",{validator:e.BA.isBaTime,skipEqualityCheck:!0})?(null===(a=this.__attrHandler.minStartTime)||void 0===a?void 0:a.equals(t))?(this.__attrHandler.equalAttribute("MinStartTime"),this):(this.__attrHandler.minStartTime=t,this):this}getMinStartTime(){return this.__attrHandler.minStartTime}setMaxEndTime(t){var a;return this.__attrHandler.checkAttribute(t,"maxEndTime",{validator:e.BA.isBaTime,skipEqualityCheck:!0})?(null===(a=this.__attrHandler.maxEndTime)||void 0===a?void 0:a.equals(t))?(this.__attrHandler.equalAttribute("MaxEndTime"),this):(this.__attrHandler.maxEndTime=t,this):this}getMaxEndTime(){return this.__attrHandler.maxEndTime}setSnapPeriode(e){return this.__attrHandler.checkAttribute(e,"snapPeriode",{validator:"number"})?(null==e&&(e=1),this.__attrHandler.snapPeriode=e,null==this.__attrHandler.snapPeriode&&(this.__attrHandler.snapPeriode=1),null!=this.__attrHandler.startTime&&this.setStartTime(this.__attrHandler.startTime.snapToPeriode(60*this.__attrHandler.snapPeriode)),null!=this.__attrHandler.endTime&&this.setEndTime(this.__attrHandler.endTime.snapToPeriode(60*this.__attrHandler.snapPeriode)),this):this}getSnapPeriode(){return this.__attrHandler.snapPeriode}setState(e){return this.__attrHandler.checkAttribute(e,"state",{validator:"number"})?(this.__attrHandler.state=e,this.__processState(),this.eventHandler.raise(a.DailyScheduleEntryEvents.onStateChanged),this):this}__processState(){var a;if(this.__attrHandler.state===e.BA.SchedEntryState.eValue){this.__contentContainer.append(this.valueField.getElement());let e=this.childrenHandler.getChildren().get(this.__id+"-null-indicator");e&&(e.getElement().detach(),e.destroy())}else{this.valueField.getElement().detach();let e=new t.Textblock(this.__id+"-null-indicator",this);e.textHandler.setText("null"),e.getElement().addClass("value-field"),this.__contentContainer.append(e.getElement())}null===(a=this.__cbState)||void 0===a||a.setSelectedValue(this.__attrHandler.state),this.__updateStateColors(),this.valueField.setStateTexts(this.__attrHandler.stateTexts)}getState(){return this.__attrHandler.state}setDataType(e){return this.__attrHandler.checkAttribute(e,"dataType",{validator:"number"})?(this.__attrHandler.dataType=e,this.__processDataType(),this):this}__processDataType(){if(null!=this.__attrHandler.dataType)switch(this.__attrHandler.dataType){case e.DataType.boolean:this.valueField.setDataType(e.DataType.boolean);break;case e.DataType.number:this.valueField.setDataType(e.DataType.number),this.valueField.getElement().css({"max-width":"100px"});break;case e.DataType.enum:this.valueField.setDataType(e.DataType.enum)}else this.valueField.setDataType(null);this.__processValue()}getDataType(){return this.__attrHandler.dataType}setValue(e){return this.__attrHandler.checkAttribute(e,"unionValue",{validator:"object"})?(this.__attrHandler.unionValue=e,null!==this.__attrHandler.dataType&&this.__processValue(),this.eventHandler.raise(a.DailyScheduleEntryEvents.onValueChanged),this):this}__processValue(){if(null!=this.__attrHandler.dataType&&null!=this.__attrHandler.unionValue){switch(this.__attrHandler.dataType){case e.DataType.boolean:this.valueField.setValue(this.__attrHandler.unionValue.bVal);break;case e.DataType.number:this.valueField.setValue(this.__attrHandler.unionValue.rVal),this.valueField.getElement().css({"max-width":"100px"});break;case e.DataType.enum:this.valueField.setValue(this.__attrHandler.unionValue.udiVal)}this.__updateStateColors()}else this.valueField.setValue(null)}getValue(){return this.__attrHandler.unionValue}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this):this}__processOrientation(){this.__attrHandler.orientation===e.Orientation.horizontal?(this.__resizerStart.removeClass("vertical"),this.__element.removeClass("vertical"),this.__startTimeDisplay.removeClass("vertical"),this.__contextMenu.getElement().removeClass("vertical"),this.__menuButton.getElement().removeClass("vertical"),this.__contentContainer.removeClass("vertical"),this.__resizerStart.addClass("horizontal"),this.__element.addClass("horizontal"),this.__startTimeDisplay.addClass("horizontal"),this.__contextMenu.getElement().addClass("horizontal"),this.__menuButton.getElement().addClass("horizontal"),this.__contentContainer.addClass("horizontal")):(this.__resizerStart.removeClass("horizontal"),this.__element.removeClass("horizontal"),this.__startTimeDisplay.removeClass("horizontal"),this.__contextMenu.getElement().removeClass("horizontal"),this.__menuButton.getElement().removeClass("horizontal"),this.__contentContainer.removeClass("horizontal"),this.__resizerStart.addClass("vertical"),this.__element.addClass("vertical"),this.__startTimeDisplay.addClass("vertical"),this.__contextMenu.getElement().addClass("vertical"),this.__menuButton.getElement().addClass("vertical"),this.__contentContainer.addClass("vertical"))}getOrientation(){return this.__attrHandler.orientation}setAllowMoving(e){return this.__attrHandler.checkAttribute(e,"allowMoving",{validator:"boolean"})?(this.__attrHandler.allowMoving=e,this.__processAllowMoving(),this):this}__processAllowMoving(){}getAllowMoving(){return this.__attrHandler.allowMoving}setStateColors(e){return this.__attrHandler.checkAttribute(e,"stateColors",{validator:"object"})?(this.__attrHandler.stateColors=e,this.__processStateColors(),this):this}__processStateColors(){null!=this.__attrHandler.dataType&&null!=this.__attrHandler.unionValue&&null!=this.__attrHandler.stateColors&&null!=this.__attrHandler.state&&(this.__attrHandler.state===e.BA.SchedEntryState.eValue?this.__updateStateColors():this.backgroundStyler.setColor(null))}getStateColors(){return this.__attrHandler.stateColors}__processReadOnly(){super.__processReadOnly(),null!==this.__attrHandler.readOnly&&(this.valueField.setReadOnly(this.__attrHandler.readOnly),this.__processAllowMoving(),!1===this.__attrHandler.readOnly?this.__element.append(this.__menuButton.getElement()):this.__menuButton.getElement().detach())}}t.DailyScheduleEntry=a,function(t){let a;!function(e){e.onEntryDeleted="onEntryDeleted",e.onValueChanged="onValueChanged",e.onStateChanged="onStateChanged",e.onStartTimeChanged="onStartTimeChanged",e.onEndTimeChanged="onEndTimeChanged"}(a=t.DailyScheduleEntryEvents||(t.DailyScheduleEntryEvents={})),t.minSeconds=0,t.maxSeconds=86399,t.StateColors={analog:[{start:0,color:e.Color.RGBAColor.Gray},{start:100,color:e.Color.RGBAColor.Blue}],binary:{false:e.Color.RGBAColor.Gray,true:e.Color.RGBAColor.TcHmiGreen},multistate:[e.Color.RGBAColor.MetallicSilver,e.Color.RGBAColor.Gray,e.Color.RGBAColor.Goldenrod,e.Color.RGBAColor.Cantaloupe,e.Color.RGBAColor.RedFox,e.Color.RGBAColor.ChilliPepper,e.Color.RGBAColor.PlumVelvet,e.Color.RGBAColor.BurntPink]}}(a=t.DailyScheduleEntry||(t.DailyScheduleEntry={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(e){!function(t){class a extends t.Base{constructor(e,a,i){super(e,a,i),this.resizeHandler=new t.ResizeHandler(this)}__init(a){var i;super.__init(a),this.__data=new Map,this.__scheduleEntries=new Map,this.__hasChanges=!1,this.__headline=new t.Textblock(this.__id+"-headline",this),this.__scheduleEntriesContainer=$("<div>").addClass("schedule-entries-container"),this.__addEntryButtonPressedHandler=()=>this.__onAddEntryPressed(),this.__resetEntryButtonPressedHandler=e=>this.__onResetEntryPressed(e),this.__element.addClass("daily-schedule"),this.__element.append(this.__headline.getElement());let n=[{text:e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.AddEntry),onPressed:this.__addEntryButtonPressedHandler},{text:e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.Reset),name:"reset-button",onPressed:this.__resetEntryButtonPressedHandler}],s=t.ContextMenu.createContextMenuAndButton({id:this.__id,root:this.__element,parent:this,rowEntryOptions:n});this.__contextMenu=s.menu,this.__menuButton=s.button,this.__menuButton.getElement().addClass("menu-button"),this.__headline.getElement().append(s.button.getElement()),this.__scheduleEntriesContainer.css("height","calc(100% - "+(null===(i=this.__headline)||void 0===i?void 0:i.layoutHandler.getHeight())+")"),this.__element.append(this.__scheduleEntriesContainer),this.__resetButton=this.__contextMenu.getRowEntry("reset-button"),this.setOrientation(e.Orientation.vertical),this.setActiveText(e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.Active)),this.setInactiveText(e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.Inactive))}__attach(){this.__isAttached||(this.__processData(),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){var e;null===(e=this.__headline)||void 0===e||e.destroy(),this.__scheduleEntries.forEach(e=>e.destroy()),this.resizeHandler.destroy(),super.destroy()}static __sortData(t,a){return e.Helper.DateTime.convertSTTimeToSeconds(t[1].stTime)<e.Helper.DateTime.convertSTTimeToSeconds(a[1].stTime)?-1:e.Helper.DateTime.convertSTTimeToSeconds(t[1].stTime)>e.Helper.DateTime.convertSTTimeToSeconds(a[1].stTime)?1:0}static __convertDataToArray(e){let t=[];for(let a of e.values())t.push(a);return t}__convertDataToMap(t){let a=new Map;for(let i=0;i<t.length;i++)t[i].eState>=e.BA.SchedEntryState.eValue&&a.set(this.__id+"-entry-"+i,t[i]);return a}resetChanges(){var e;if(this.__oldData){this.__data=new Map;for(let[e,t]of this.__oldData)this.__data.set(e,JSON.parse(JSON.stringify(t)))}else this.__data=new Map;this.__processData(),this.__hasChanges=!1,null===(e=this.__resetButton)||void 0===e||e.setIsEnabled(!1),this.eventHandler.raise(a.DailyScheduleEvents.onDataChanged)}resetHasChanges(){var e;this.__hasChanges=!1,null===(e=this.__resetButton)||void 0===e||e.setIsEnabled(!1),this.__oldData=new Map;for(let[e,t]of this.__data)this.__oldData.set(e,JSON.parse(JSON.stringify(t)))}getScheduleEntries(){return this.__scheduleEntries}updatePositions(){this.__scheduleEntries.forEach(t=>{this.__attrHandler.orientation===e.Orientation.horizontal?t.setOffset(Number(this.__scheduleEntriesContainer.css("width").replace("px",""))/86400):t.setOffset(Number(this.__scheduleEntriesContainer.css("height").replace("px",""))/86400)})}hasChanges(){return this.__hasChanges}onResized(){if(void 0!==this.__scheduleEntriesContainer)for(let t of this.__scheduleEntries.values())this.__attrHandler.orientation===e.Orientation.horizontal?t.setOffset(Number(this.__scheduleEntriesContainer.css("width").replace("px",""))/86400):t.setOffset(Number(this.__scheduleEntriesContainer.css("height").replace("px",""))/86400)}__onAddEntryPressed(){if(this.__contextMenu.close(),this.__scheduleEntries.size<a.MaximumEntryCount){let i=t=>{var i;let n=e.BA.getDefaultClassValue();if(this.__attrHandler.dataType===e.DataType.enum){let e=this.getStateTexts();e&&e.length>0&&null!=e[0].value&&(n.udiVal=e[0].value)}let s={eState:e.BA.SchedEntryState.eValue,stTime:e.Helper.DateTime.convertDateToBaTime(t),uValue:n};null!=this.__attrHandler.snapPeriode&&(s.stTime=new e.BA.BaTime(e.Helper.DateTime.convertDateToBaTime(t)).snapToPeriode(60*this.__attrHandler.snapPeriode));let r=[];if(this.__data.size>0){let t=!1;for(let a of this.__data.values())!t&&e.Helper.DateTime.convertSTTimeToSeconds(a.stTime)>e.Helper.DateTime.convertSTTimeToSeconds(s.stTime)&&(r.push(s),t=!0),r.push(a);t||r.push(s)}else r.push(s);this.__data=this.__convertDataToMap(r),this.__processData(),this.__hasChanges=!0,null===(i=this.__resetButton)||void 0===i||i.setIsEnabled(!0),this.eventHandler.raise(a.DailyScheduleEvents.onDataChanged)};t.TimePicker.openTimePickerDialog(new Date,e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.SelectNewStartTime),i)}else t.DialogWindow.alert(`More than '${a.MaximumEntryCount}' time stamps are not allowed!`)}__onResetEntryPressed(a){return __awaiter(this,void 0,void 0,(function*(){this.__contextMenu.close(),this.hasChanges()&&(yield t.DialogWindow.confirm(e.Locale.Localization.getText(e.Locale.LangKey.ConfirmResetChanges)))&&this.resetChanges()}))}__onStartTimeChanged(i){var n,s,r;let o=i.getId(),l=this.__data.get(o);if(null==l)return void console.warn(`There is no data for the changed entry in ${this.__id}!`);l.stTime=i.getStartTime();let d=null===(n=e.Helper.Map.getPrevious(this.__scheduleEntries,o))||void 0===n?void 0:n.value;d&&(d.setEndTime(new e.BA.BaTime(i.getStartTime())),d.setMaxEndTime(new e.BA.BaTime(i.getEndTime()).subtractSeconds(t.WeeklySchedule.MinEntryTime)));let _=null===(s=e.Helper.Map.getNext(this.__scheduleEntries,o))||void 0===s?void 0:s.value;_&&_.setMinStartTime(new e.BA.BaTime(i.getStartTime()).addSeconds(t.WeeklySchedule.MinEntryTime)),this.__hasChanges=!0,null===(r=this.__resetButton)||void 0===r||r.setIsEnabled(!0),this.eventHandler.raise(a.DailyScheduleEvents.onDataChanged)}__onEndTimeChanged(t){var i;let n=t.getId();if(null==this.__data.get(n))return void console.warn(`There is no data for the changed entry in ${this.__id}!`);let s,r,o=this.__scheduleEntries.entries();do{if(s=o.next(),s.value[0]===n){if(r=o.next(),r.done)break;let a=this.__data.get(r.value[0]);if(null!=a&&a.eState>=e.BA.SchedEntryState.eValue){let e=t.getEndTime();null==e||tchmi_equal(a.stTime,e)||(a.stTime=e,r.value[1].setStartTime(t.getEndTime()))}break}}while(!s.done);this.__hasChanges=!0,null===(i=this.__resetButton)||void 0===i||i.setIsEnabled(!0),this.eventHandler.raise(a.DailyScheduleEvents.onDataChanged)}__onEntryDeleted(e){var t;let i=e.getId();this.__data.has(i)||console.warn(`Deleted entry does not exist in data of ${this.__id}!`),this.__data.delete(i),e.destroy(),e.getElement().detach(),this.__scheduleEntries.delete(i),this.__processData(),this.__hasChanges=!0,null===(t=this.__resetButton)||void 0===t||t.setIsEnabled(!0),this.eventHandler.raise(a.DailyScheduleEvents.onDataChanged)}__onValueChanged(e){var t;let i=this.__data.get(e.getId());if(null!=i){let n=e.getValue();null!=n&&(i.uValue=n,this.__hasChanges=!0,null===(t=this.__resetButton)||void 0===t||t.setIsEnabled(!0),this.eventHandler.raise(a.DailyScheduleEvents.onDataChanged))}}__onStateChanged(e){var t;let i=this.__data.get(e.getId());if(null!=i){let n=e.getState();null!=n&&(i.eState=n,this.__hasChanges=!0,null===(t=this.__resetButton)||void 0===t||t.setIsEnabled(!0),this.eventHandler.raise(a.DailyScheduleEvents.onDataChanged))}}setAttributes(e){return super.setAttributes(e),void 0!==e.title&&this.setTitle(e.title),void 0!==e.orientation&&this.setOrientation(e.orientation),void 0!==e.snapPeriode&&this.setSnapPeriode(e.snapPeriode),void 0!==e.stateColors&&this.setStateColors(e.stateColors),this.__scheduleEntries.forEach(t=>t.setAttributes(e)),this}getAttributes(){return this.__attrHandler.getRef()}setTitle(e){var t;return this.__attrHandler.checkAttribute(e,"title",{validator:"string"})?(this.__attrHandler.title=e,null===(t=this.__headline)||void 0===t||t.textHandler.setText(e),this):this}getTitle(){return this.__attrHandler.title}setData(t){var a;if(void 0===t)return this.__attrHandler.invalidAttribute("Data",t),this;if(tchmi_equal(t,this.__data))return this.__attrHandler.equalAttribute("Data"),this;null==t?this.__data=new Map:null!=t&&t instanceof Array?(t=t.sort((t,a)=>t.eState<=e.BA.SchedEntryState.eUndefined||e.Helper.DateTime.convertSTTimeToSeconds(t.stTime)>e.Helper.DateTime.convertSTTimeToSeconds(a.stTime)?1:-1),this.__data=this.__convertDataToMap(t)):this.__data=t,this.__processData(),this.__oldData=new Map;for(let[e,t]of this.__data)this.__oldData.set(e,JSON.parse(JSON.stringify(t)));return this.__hasChanges=!1,null===(a=this.__resetButton)||void 0===a||a.setIsEnabled(!1),this}__processData(){if(this.__data.size<=0||null===this.__attrHandler.orientation)for(let[e,t]of this.__scheduleEntries)t.getElement().detach(),t.destroy(),this.__scheduleEntries.delete(e);else{for(let[e,t]of this.__scheduleEntries)null==this.__data.get(e)&&(t.getElement().detach(),t.destroy(),this.__scheduleEntries.delete(e));let a,i=0,n=Array.from(this.__data);for(let[s,r]of this.__data){"string"==typeof r.eState&&(r.eState=Number(r.eState));let o=this.__scheduleEntries.get(s);if(r.eState>=e.BA.SchedEntryState.eValue){let l=r.stTime,d={nHour:23,nMinute:59,nSecond:59};for(let t=i+1;t<this.__data.size;t++)if(n[t][1].eState>=e.BA.SchedEntryState.eValue){d=n[t][1].stTime;break}if(null==o){let i=0;if(this.__attrHandler.orientation===e.Orientation.horizontal){let e=this.__scheduleEntriesContainer.innerWidth();void 0!==e&&e>0&&(i=e/86400)}else{let e=this.__scheduleEntriesContainer.innerHeight();void 0!==e&&e>0&&(i=e/86400)}o=new t.DailyScheduleEntry(s,this,this.__attrHandler),o.setOffset(i).setStartTime(new e.BA.BaTime(l)).setEndTime(new e.BA.BaTime(d)).setAllowMoving(!0).setValue(r.uValue).setState(r.eState);let n=[];n.push(o.eventHandler.register(t.DailyScheduleEntry.DailyScheduleEntryEvents.onStartTimeChanged,(e,t)=>this.__onStartTimeChanged(t))),n.push(o.eventHandler.register(t.DailyScheduleEntry.DailyScheduleEntryEvents.onEndTimeChanged,(e,t)=>this.__onEndTimeChanged(t))),n.push(o.eventHandler.register(t.DailyScheduleEntry.DailyScheduleEntryEvents.onEntryDeleted,(e,t)=>this.__onEntryDeleted(t))),n.push(o.eventHandler.register(t.DailyScheduleEntry.DailyScheduleEntryEvents.onValueChanged,(e,t)=>this.__onValueChanged(t))),n.push(o.eventHandler.register(t.DailyScheduleEntry.DailyScheduleEntryEvents.onStateChanged,(e,t)=>this.__onStateChanged(t))),o.eventHandler.register(t.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),n.forEach(e=>e())}),a&&(o.setMinStartTime(new e.BA.BaTime(null==a?void 0:a.getStartTime()).addSeconds(t.WeeklySchedule.MinEntryTime)),a.setMaxEndTime(new e.BA.BaTime(null==o?void 0:o.getEndTime()).subtractSeconds(t.WeeklySchedule.MinEntryTime))),this.__scheduleEntriesContainer.append(o.getElement()),this.__scheduleEntries.set(s,o)}else o.setStartTime(new e.BA.BaTime(l)).setEndTime(new e.BA.BaTime(d)).setAllowMoving(!0).setValue(r.uValue).setState(r.eState)}else null!=o&&(o.destroy(),o.getElement().detach(),this.__scheduleEntries.delete(s));a=o,i++}e.Helper.Map.first(this.__scheduleEntries)&&e.Helper.Map.first(this.__scheduleEntries).value.setMinStartTime(e.BA.BaTime.fromSeconds(t.DailyScheduleEntry.minSeconds));let s=e.Helper.Map.last(this.__scheduleEntries);s&&(s.value.setMaxEndTime(e.BA.BaTime.fromSeconds(t.DailyScheduleEntry.maxSeconds)),s.value.setAllowMoving(!1))}}getData(){return a.__convertDataToArray(this.__data)}setDataType(e){return this.__attrHandler.checkAttribute(e,"dataType",{validator:"number"})?(this.__attrHandler.dataType=e,this.__scheduleEntries.forEach(e=>e.setDataType(this.__attrHandler.dataType)),this):this}getDataType(){return this.__attrHandler.dataType}setSnapPeriode(e){return this.__attrHandler.checkAttribute(e,"snapPeriode",{validator:"number"})?(this.__attrHandler.snapPeriode=e,this.__scheduleEntries.forEach(t=>t.setSnapPeriode(e)),this):this}getSnapPeriode(){return this.__attrHandler.snapPeriode}setActiveText(e){return this.__attrHandler.checkAttribute(e,"activeText",{validator:"string"})?(this.__attrHandler.activeText=e,this.__scheduleEntries.forEach(t=>t.valueField.setActiveText(e)),this):this}getActiveText(){return this.__attrHandler.activeText}setInactiveText(e){return this.__attrHandler.checkAttribute(e,"inactiveText",{validator:"string"})?(this.__attrHandler.inactiveText=e,this.__scheduleEntries.forEach(t=>t.valueField.setInactiveText(e)),this):this}getInactiveText(){return this.__attrHandler.inactiveText}setUnit(t){return this.__attrHandler.checkAttribute(t,"unit",{validator:["string","number"]})?("number"==typeof t&&(t=e.Helper.convertUnitToString(t)),this.__attrHandler.unit=t,this.__scheduleEntries.forEach(e=>e.valueField.setUnit(t)),this):this}getUnit(){return this.__attrHandler.unit}setStateTexts(e){return this.__attrHandler.checkAttribute(e,"stateTexts",{validator:"array"})?(this.__attrHandler.stateTexts=e,this.__scheduleEntries.forEach(t=>t.valueField.setStateTexts(e)),this):this}getStateTexts(){return this.__attrHandler.stateTexts}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this):this}__processOrientation(){this.__scheduleEntries.forEach(e=>e.setOrientation(this.__attrHandler.orientation)),this.__attrHandler.orientation===e.Orientation.horizontal?this.__element.addClass("horizonal"):this.__element.removeClass("horizonal"),this.__processData()}getOrientation(){return this.__attrHandler.orientation}setStateColors(e){return this.__attrHandler.checkAttribute(e,"stateColors",{validator:()=>e instanceof Map})?(this.__attrHandler.stateColors=e,this.__scheduleEntries.forEach(t=>t.setStateColors(e)),this):this}getStateColors(){return this.__attrHandler.stateColors}__processReadOnly(){super.__processReadOnly(),this.__scheduleEntries.forEach(e=>e.setReadOnly(this.__attrHandler.readOnly)),this.__attrHandler.readOnly?this.__menuButton.getElement().detach():this.__headline.getElement().append(this.__menuButton.getElement())}}t.DailySchedule=a,function(e){let t;!function(e){e.onDataChanged="onDataChanged"}(t=e.DailyScheduleEvents||(e.DailyScheduleEvents={})),e.MaximumEntryCount=6}(a=t.DailySchedule||(t.DailySchedule={}))}(e.Components||(e.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(t){!function(a){class i extends a.Base{constructor(e,t,a){super(e,t,a),this.__loadEntriesFromBaObject=!0}__init(e){super.__init(e),this.baObjectHandler=new t.BaObjectHandler(this),this.__daySchedules=[],this.__element.addClass("weekly-schedule");for(let e=0;e<7;e++){let n=new a.DailySchedule(this.__id+"-day-schedule-"+e,this);n.eventHandler.register(a.BaseNode.BaseNodeEvents.onAttached,e=>{e.destroy();let t=n.eventHandler.register(a.DailySchedule.DailyScheduleEvents.onDataChanged,()=>{this.eventHandler.raise(i.WeeklyScheduleEvents.onDataChanged)});n.eventHandler.register(a.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),t()})}),this.__destroyersToCallOnDestroy.push(t.Locale.Localization.watchText(t.Locale.WeekDaysLongLangKey[e],e=>{this.logger.checkServerResult(t.Logger.Severity.warn,e)&&n.setTitle(e.text)})),this.__daySchedules.push(n)}this.setReadOnly(!0)}__attach(){if(!this.__isAttached){for(let e=0;e<this.__daySchedules.length;e++)this.__element.append(this.__daySchedules[e].getElement());super.__attach()}}__detach(){if(this.__isAttached){for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].getElement().detach();super.__detach()}}destroy(){for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].destroy();super.destroy()}processBaObject(){if(null!=this.baObjectHandler.baObject){switch(this.setDataType(this.baObjectHandler.baObject.DataType),this.baObjectHandler.baObject.DataType){case t.DataType.boolean:this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,e=>{this.setInactiveText(null==e?void 0:e.get(0)),this.setActiveText(null==e?void 0:e.get(1))},!0);break;case t.DataType.number:this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eUnit,e=>{void 0!==e&&this.setUnit(e)});break;case t.DataType.enum:this.baObjectHandler.watchValueRange(t.BA.BaParameterId.ePresentValue,e=>{let t=a.Combobox.toComboboxItemArray(e);this.setStateTexts(t)},!0)}this.__loadEntriesFromBaObject&&this.baObjectHandler.tryWatchBaVariable(t.BA.BaParameterId.eWeek,e=>{void 0!==e&&(null==e?this.setScheduleEntries(null):this.setScheduleEntries(t.Helper.Array.clone(e)))})}else this.setScheduleEntries(null)}resetChanges(){for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].resetChanges()}writeToPlc(){return __awaiter(this,void 0,void 0,(function*(){return new Promise((a,i)=>__awaiter(this,void 0,void 0,(function*(){if(this.hasChanges()){if(null!=this.baObjectHandler.baObject&&!this.__attrHandler.readOnly){let n=this.getScheduleEntries(),s=this.busyHandler.setBusy("Writing entries to PLC.");this.baObjectHandler.baObject.tryWriteBaVariableValue(t.BA.BaParameterId.eWeek,n,t=>{t.error!=e.Errors.NONE?i(e.Log.buildMessage(t.details)):a(!0),s()})}for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].resetHasChanges()}a(!1)})))}))}hasChanges(){for(let e=0;e<this.__daySchedules.length;e++)if(this.__daySchedules[e].hasChanges())return!0;return!1}set LoadEntriesFromBaObject(e){this.__loadEntriesFromBaObject=e}setAttributes(e){return super.setAttributes(e),null!=e.startDate&&this.setStartDate(e.startDate),null!=e.orientation&&this.setOrientation(e.orientation),this}getAttributes(){return this.__attrHandler.getRef()}setScheduleEntries(e){if(void 0===e)return this.__attrHandler.invalidAttribute("ScheduleEntries",e),this;if(null==e)for(let e=0;e<this.__daySchedules.length;e++)this.__daySchedules[e].setData(null);else{let t=this.busyHandler.setBusy("Processing entries");for(let t=0;t<e.length;t++)void 0!==this.__daySchedules[t]?this.__daySchedules[t].setData(e[t]):console.warn("The weekly schedule data contains more than "+this.__daySchedules.length+" days. Is this intended?");t()}return this.eventHandler.raise(i.WeeklyScheduleEvents.onDataChanged),this}getScheduleEntries(){let e=[];for(let t=0;t<this.__daySchedules.length;t++){this.__daySchedules[t].getData()&&e.push(this.__daySchedules[t].getData())}return e}setStartDate(e){if(!this.__attrHandler.checkAttribute(e,"startDate",{validator:"date"}))return this;this.__attrHandler.startDate=e;let a=this.__attrHandler.startDate;for(let e=0;e<this.__daySchedules.length;e++)null!=a?(this.__daySchedules[e].setTitle(a.toDateString()),a=new Date(a.getTime()+864e5)):this.__daySchedules[e].setTitle(t.Locale.Localization.getSymbolExpression(t.Locale.WeekDaysLongLangKey[e]));return this}getStartDate(){return this.__attrHandler.startDate}setDataType(e){return this.__daySchedules.forEach(t=>t.setDataType(e)),this}getDataType(){for(let e of this.__daySchedules.values())return e.getDataType();return null}setSnapPeriode(e){return this.__daySchedules.forEach(t=>t.setSnapPeriode(e)),this}getSnapPeriode(){for(let e of this.__daySchedules.values())return e.getSnapPeriode();return null}setActiveText(e){return this.__daySchedules.forEach(t=>t.setActiveText(e)),this}getActiveText(){for(let e of this.__daySchedules.values())return e.getActiveText();return null}setInactiveText(e){return this.__daySchedules.forEach(t=>t.setInactiveText(e)),this}getInactiveText(){for(let e of this.__daySchedules.values())return e.getInactiveText();return null}setUnit(e){return this.__daySchedules.forEach(t=>t.setUnit(e)),this}getUnit(){for(let e of this.__daySchedules.values())return e.getUnit();return null}setStateTexts(e){return this.__daySchedules.forEach(t=>t.setStateTexts(e)),this}getStateTexts(){for(let e of this.__daySchedules.values())return e.getStateTexts();return null}setOrientation(e){return this.__attrHandler.checkAttribute(e,"orientation",{validator:"number"})?(this.__attrHandler.orientation=e,this.__processOrientation(),this):this}__processOrientation(){this.__attrHandler.orientation===t.Orientation.horizontal?this.__element.css({"grid-template-columns":"none"}):this.__element.css({"grid-template-columns":"auto auto auto auto auto auto auto"}),this.__daySchedules.forEach(e=>e.setOrientation(this.__attrHandler.orientation)),this.__daySchedules.forEach(e=>e.updatePositions()),this.__daySchedules.forEach(e=>e.updatePositions())}getOrientation(){return this.__attrHandler.orientation}setStateColors(e){return this.__daySchedules.forEach(t=>t.setStateColors(e)),this}getStateColors(){for(let e of this.__daySchedules.values())return e.getStateColors();return null}__processReadOnly(){super.__processReadOnly(),this.__daySchedules.forEach(e=>e.setReadOnly(this.__attrHandler.readOnly))}}a.WeeklySchedule=i,function(e){let t;!function(e){e.onDataChanged="onDataChanged"}(t=e.WeeklyScheduleEvents||(e.WeeklyScheduleEvents={})),e.MinEntryTime=1800}(i=a.WeeklySchedule||(a.WeeklySchedule={}))}(t.Components||(t.Components={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(e){let t;!function(t){class a{constructor(){this.__cur=[],this.__selected=[],this.__old=[],this.__direction=a.NavDirection.Invalid}set(t){if(this.__selected=e.Helper.Array.clone(t),this.__old=e.Helper.Array.clone(this.__cur),this.__cur.length<t.length)return this.__cur.push(t[t.length-1]),this.__direction=a.NavDirection.Forward,!0;if(this.__cur.length>t.length){for(let e=this.__cur.length;e>t.length-1;e--)this.__cur.pop();return this.__direction=a.NavDirection.Backward,this.__old[t.length-1]!=t[t.length-1]&&(this.__cur.push(t[t.length-1]),this.__direction=a.NavDirection.Stay),!0}return this.__cur.length===t.length?t.length>0&&(e.Helper.Array.equals(this.__cur,t)?(this.__cur.pop(),this.__direction=a.NavDirection.Backward):(this.__cur=e.Helper.Array.clone(t),this.__direction=a.NavDirection.Stay),!0):(console.error("Error in set method of Path.js. Current element has wrong level."),this.__direction=a.NavDirection.Invalid,!1)}getCurrent(){return this.__cur}getOld(){return this.__old}getSelected(){return this.__selected}getDirection(){return this.__direction}getClosePath(){let t=[];if(this.__old.length<=this.__cur.length){let a=!0;for(let e=0;e<this.__old.length;e++)this.__cur[e]!=this.__old[e]&&(a=!1);a||(t=e.Helper.Array.clone(this.__old))}else for(let e=0;e<this.__old.length;e++)t.push(this.__old[e]);return t}reset(){this.__cur=[],this.__old=[],this.__direction=a.NavDirection.Invalid}}t.Path=a,function(e){let t;!function(e){e[e.Invalid=-1]="Invalid",e[e.Backward=0]="Backward",e[e.Stay=1]="Stay",e[e.Forward=2]="Forward"}(t=e.NavDirection||(e.NavDirection={}))}(a=t.Path||(t.Path={}))}(t=e.Navigation||(e.Navigation={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(e){let t;!function(t){t.Provider=[];class a{constructor(a){this.__path=new t.Path,this.__data=null,this.__navigations=new Map,this.__id=a,this.__logger=new e.Logger({name:this.__id})}__preparePath(t,a,i){if(void 0!==t){if(i||(i=[]),a&&(i.push(a),t.Path=e.Helper.Array.clone(i)),t.Children&&t.Children.size>0)for(let[e,a]of t.Children)this.__preparePath(a,e,i);i.pop()}}__setupNewNav(a,i,n){i.setNavigationProvider(this),void 0!==this.__data&&i.setData(this.__data),this.__navigations.set(a,i),n&&n.append(i.getElement());let s=i.eventHandler.register(t.BaseList.BaseListEvents.onEntrySelected,(e,t,a)=>{this.__changedNavigationId=t.getId(),this.select(a.getData())});i.eventHandler.register(e.Components.BaseNode.BaseNodeEvents.onDestroyed,e=>{this.removeNavigation(i.getId()),e.destroy(),s()})}getId(){return this.__id}createBaseListNavigation(e,a,i,n){let s=new t.BaseList(e,a,i);return this.__setupNewNav(e,s,n),s}createControlListNavigation(e,a,i,n){let s=new t.ControlList(e,a,i);return this.__setupNewNav(e,s,n),s}createParameterListNavigation(e,a,i,n){let s=new t.ParameterList(e,a,i);return this.__setupNewNav(e,s,n),s}createProjectNavigationListNavigation(e,a,i,n){let s=new t.ProjectNavigationList(e,a,i);return this.__setupNewNav(e,s,n),s}removeNavigation(e){let a=this.__navigations.get(e);return!!a&&(a.setNavigationProvider(null),this.__navigations.delete(e),0==this.__navigations.size&&t.Provider.splice(t.Provider.indexOf(this,1)),!0)}getNavigations(){return this.__navigations}select(e){if(null==e)return;let t=e.Path;if(t){if(this.__path.set(t))for(let[e,t]of this.__navigations)e!=this.__changedNavigationId&&t.select(this.__path)}else this.__path.reset();this.__changedNavigationId=void 0}getCurrentNode(){if(null==this.__data)return;let e=this.__path.getCurrent(),t=this.__data;for(let a=0;a<e.length;a++){if(null==t.Children||t.Children.size<=0)return;if(t=t.Children.get(e[a]),null==t)return}return t}setData(e){return void 0===e?(this.__logger.invalidAttribute("Data",e),this):tchmi_equal(e,this.__data)?(this.__logger.equalAttribute("Data"),this):(this.__data=e,this.__processData(),this)}__processData(){null!=this.__data&&this.__preparePath(this.__data);for(let e of this.__navigations.values())e.setData(this.__data)}getData(){return this.__data}}function i(e,t){if(e.IsTop!=t.IsTop)return!1;if(null==e.Children&&null==t.Children)return!!tchmi_equal(e,t);if(null==e.Children||null==t.Children)return!1;if(e.Children.size!=t.Children.size)return!1;for(let[a,n]of e.Children){let e=t.Children.get(a);if(!e)return!1;if(!i(n,e))return!1}return!0}t.NavigationProvider=a,t.createOrGetNavigationProvider=function(e){if(e)for(let a=0;a<t.Provider.length;a++){let n=t.Provider[a].getData();if(n&&null!=n.Children&&n.Children.size>0&&i(n,e))return t.Provider[a]}let n=new a("NavigationProvider"+t.Provider.length);return e&&n.setData(e),t.Provider.push(n),n}}(t=e.Navigation||(e.Navigation={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){!function(t){class a extends e.Components.Base{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.__entries=new Map,this.__element.addClass("base-list"),void 0===(null==e?void 0:e.slideDuration)&&this.setSlideDuration(200)}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){for(let e of this.__entries.values())e.destroy();super.destroy()}__setEntryData(e,t){e.setSlideDuration(this.__attrHandler.slideDuration),e.setData(t)}__createEntry(t,i=null){null==i&&(i=new a.BaseListEntry(t,this));let n=i.eventHandler.register(a.BaseListEntry.BaseListEntryEvents.onSelected,(e,t,i)=>{this.eventHandler.raise(a.BaseListEvents.onEntrySelected,i)}),s=i.eventHandler.register(a.BaseListEntry.BaseListEntryEvents.onClosed,(e,t,i)=>{this.eventHandler.raise(a.BaseListEvents.onEntryClosed,i)}),r=i.eventHandler.register(a.BaseListEntry.BaseListEntryEvents.onOpened,(e,t,i)=>{this.eventHandler.raise(a.BaseListEvents.onEntryOpened,i)});return i.eventHandler.register(e.Components.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),n(),s(),r()}),i}static getEntryFromEntriesByPath(e,t){for(let a of e.values()){let e=a.getPath();if(e[e.length-1]===t)return a}}select(t){var i,n;if(!this.__attrHandler.data)return;if(!this.__attrHandler.data.IsTop)return;let s=e.Helper.Array.clone(t.getCurrent()),r=t.getClosePath();if(r.length>0){let e,t=this.__entries;for(let n=0;n<=s.length&&!(n>r.length-1);n++){if(e=a.getEntryFromEntriesByPath(t,r[n]),!e)throw new Error("No entry was found to close it!");if(e.getIsOpen()&&(t=null===(i=e.getSublist())||void 0===i?void 0:i.getEntries(),!t))throw new Error("Entries should be availiable here!")}null==e||e.close()}s=e.Helper.Array.clone(t.getCurrent());let o,l=this.__entries;for(;s.length>0;){if(o=a.getEntryFromEntriesByPath(l,s[0]),!o)return void console.error(`Entry with id ${t[0]} was not found in BaseList ${this.__id}!`);let e=o.getData();if(!e||!e.Children||e.Children.size<=0)return void console.error(`Entry ${o.getId()} does not have any children but selected path has further children!`);if(o.open(),l=null===(n=o.getSublist())||void 0===n?void 0:n.getEntries(),!l)throw new Error("Entries should be defined here!");s.shift()}}getEntries(){return this.__entries}getEntry(e){var t;for(let a of this.__entries.values()){let i=null===(t=a.getData())||void 0===t?void 0:t.name;if(null!=i&&i===e)return a}return null}closeAllEntries(){for(let e of this.__entries.values()){let t=e.getData();void 0!==(null==t?void 0:t.Children)&&e.close()}}addEntry(e,t){var a;null==this.__attrHandler.data&&(this.__attrHandler.data={}),null==(null===(a=this.__attrHandler.data)||void 0===a?void 0:a.Children)&&(this.__attrHandler.data.Children=new Map),this.__attrHandler.data.Children.set(e,t);let i=this.__createEntry(this.__id+"-"+e);return this.__setEntryData(i,t),this.__element.append(i.getElement()),this.__entries.set(e,i),null!=t.cbOnCreated&&t.cbOnCreated.length>0&&t.cbOnCreated.forEach(e=>e(i)),i}hasEntry(e){return this.__entries.get(e)}removeEntry(e){if(null==this.__attrHandler.data||null==this.__attrHandler.data.Children)return!1;let t=this.__entries.get(e);return!(!this.__attrHandler.data.Children.has(e)||null==t)&&(t.getElement().detach(),t.destroy(),this.__entries.delete(e),this.__attrHandler.data.Children.delete(e),!0)}setNavigationProvider(e){return null!=e?this.__navigationProvider=e:delete this.__navigationProvider,this}getNavigationProvider(){return this.__navigationProvider}setAttributes(e){return super.setAttributes(e),void 0!==e.data&&this.setData(e.data),void 0!==e.slideDuration&&this.setSlideDuration(e.slideDuration),void 0!==e.sublistPadding&&this.setSublistPadding(e.sublistPadding,e.sublistPaddingUnit),this}getAttributes(){return this.__attrHandler.getRef()}setData(e){return this.__attrHandler.checkAttribute(e,"data",{validator:"object"})?(this.__attrHandler.data=e,this.__processData(),this):this}__processData(){var e;if(null==this.__attrHandler.data||null==this.__attrHandler.data.Children){for(let e of this.__entries.values())e.getElement().detach(),e.destroy();this.__entries.clear()}else{for(let[e,t]of this.__entries)null==this.__attrHandler.data.Children.get(e)&&(this.__entries.delete(e),t.getElement().detach(),t.destroy());for(let[e,t]of this.__attrHandler.data.Children){let a=this.__entries.get(e);null==a&&(a=this.__createEntry(this.__id+"-"+e),null!=t.cbOnCreated&&t.cbOnCreated.length>0&&t.cbOnCreated.forEach(e=>e(a)),this.__entries.set(e,a),this.__element.append(a.getElement())),this.__setEntryData(a,t)}}null===(e=this.__navigationProvider)||void 0===e||e.setData(this.__attrHandler.data?this.__attrHandler.data:null)}getData(){return this.__attrHandler.data}setSlideDuration(e){return this.__attrHandler.checkAttribute(e,"slideDuration",{validator:"number"})?(this.__attrHandler.slideDuration=e,this.__processSlideDuration(),this):this}__processSlideDuration(){for(let e of this.__entries.values())e.setSlideDuration(this.__attrHandler.slideDuration)}getSlideDuration(){return this.__attrHandler.slideDuration}setSublistPadding(t,a){return e.Components.LayoutHandler.dimensionSetter(this.__attrHandler,"sublistPadding",t,a)?(this.__processSublistPadding(),this):this}__processSublistPadding(){null==this.__attrHandler.sublistPadding?this.__element.css("--tchmi-ba-base-list-sublist-padding",""):this.__element.css("--tchmi-ba-base-list-sublist-padding",this.__attrHandler.sublistPadding+(this.__attrHandler.sublistPaddingUnit?this.__attrHandler.sublistPaddingUnit:"px"))}getSublistPadding(){return this.__attrHandler.sublistPadding}getSublistPaddingUnit(){return this.__attrHandler.sublistPaddingUnit}}t.BaseList=a,function(t){let a;!function(e){e.onEntrySelected="onEntrySelected",e.onEntryOpened="onEntryOpened",e.onEntryClosed="onEntryClosed"}(a=t.BaseListEvents||(t.BaseListEvents={}));class i extends e.Components.TextControl{constructor(e,t,a){super(e,t,a),this.__pressedHandler=e=>{if(null!=e.button&&0!=e.button)return;e.stopPropagation();let t=()=>{if(this.__sublist){let t=this.__sublist.getEntries();for(let a of t.values())if(null!=a.getElement().find(e.target)[0])return}this.__onSelected(),this.__element.off("pointerup",t)};this.__element.on("pointerup",t)}}__init(e){super.__init(e),this.__element.addClass("base-list-entry is-closed"),this.__isOpen=!1,this.__selecting=!1}__attach(){this.__isAttached||(this.__element.on("pointerdown",this.__pressedHandler),super.__attach())}__detach(){this.__isAttached&&(this.__element.off("pointerdown",this.__pressedHandler),super.__detach())}destroy(){var e;null===(e=this.__sublist)||void 0===e||e.destroy(),super.destroy()}__onSelected(){this.__selecting||null==this.__attrHandler.data||(null!=this.__attrHandler.data.Children&&this.__attrHandler.data.Children.size>0&&this.toggleOpen(),this.eventHandler.raise(i.BaseListEntryEvents.onSelected,this)),this.__selecting=!0,setTimeout(()=>this.__selecting=!1,this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:200)}__createSubList(){null==this.__sublist&&(this.__sublist=new t(this.__id+"-sublist",this));let a=this.__sublist.eventHandler.register(t.BaseListEvents.onEntrySelected,(e,a,i)=>{this.eventHandler.raise(t.BaseListEntry.BaseListEntryEvents.onSelected,i)}),i=this.__sublist.eventHandler.register(t.BaseListEvents.onEntryClosed,(e,a,i)=>{this.eventHandler.raise(t.BaseListEntry.BaseListEntryEvents.onClosed,i)}),n=this.__sublist.eventHandler.register(t.BaseListEvents.onEntryOpened,(e,a,i)=>{this.eventHandler.raise(t.BaseListEntry.BaseListEntryEvents.onOpened,i)});this.__sublist.eventHandler.register(e.Components.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),a(),i(),n()}),this.__sublist.setSublistPadding(this.__attrHandler.sublistPadding,this.__attrHandler.sublistPaddingUnit).setSlideDuration(this.__attrHandler.slideDuration).getElement().addClass("sublist"),this.__sublist.setData(this.__attrHandler.data)}getPath(){var e;if(!this.__attrHandler.data||!this.__attrHandler.data.Path)throw new Error(`Path of entry ${this.__id} was not set!`);return null===(e=this.__attrHandler.data)||void 0===e?void 0:e.Path}toggleOpen(){!1===this.__isOpen?this.open():this.close()}open(){if(!this.__isOpen&&(void 0===this.__sublist&&null!=this.__attrHandler.data&&null!=this.__attrHandler.data.Children&&this.__createSubList(),void 0!==this.__sublist)){if(this.__sublist.getElement().css("display","none"),this.__element.append(this.__sublist.getElement()),this.__sublist.getElement().slideDown(null!=this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:200,()=>{this.eventHandler.raise(i.BaseListEntryEvents.onOpened,this)}),this.__isOpen=!0,this.__element.removeClass("is-closed"),this.__baParent instanceof t){let e=this.__baParent.getEntries();for(let t of e.values())t.getId()!=this.__id&&t.close()}return!0}return!1}close(){return!!this.__isOpen&&(void 0!==this.__sublist&&this.__sublist.getElement().slideUp(null!=this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:200,()=>{var e,t;null===(e=this.__sublist)||void 0===e||e.closeAllEntries(),null===(t=this.__sublist)||void 0===t||t.getElement().detach(),this.__isOpen=!1,this.__element.addClass("is-closed"),this.eventHandler.raise(i.BaseListEntryEvents.onClosed,this)}),!0)}getSublist(){return this.__sublist}getIsOpen(){return this.__isOpen}addEntry(t,a){null==this.__attrHandler.data&&(this.__attrHandler.data={}),null==this.__attrHandler.data.Children&&(this.__attrHandler.data.Children=new Map),this.__attrHandler.data.Children.has(t)?this.logger.log(e.Logger.Severity.warn,`An entry with key '${t}' has already been added!`):(this.__attrHandler.data.Children.set(t,a),this.__processData())}hasEntry(e){return null!=this.__attrHandler.data&&null!=this.__attrHandler.data.Children&&this.__attrHandler.data.Children.has(e)}removeEntry(e){return null!=this.__attrHandler.data&&null!=this.__attrHandler.data.Children&&(!!this.__attrHandler.data.Children.delete(e)&&(this.__processData(),!0))}setAttributes(e){return super.setAttributes(e),void 0!==e.data&&this.setData(e.data),void 0!==e.slideDuration&&this.setSlideDuration(e.slideDuration),void 0!==e.sublistPadding&&this.setSublistPadding(e.sublistPadding,e.sublistPaddingUnit),this}getAttributes(){return this.__attrHandler.getRef()}setData(e){return this.__attrHandler.checkAttribute(e,"data",{validator:"object"})?(this.__attrHandler.data=e,this.__processData(),this):this}__processData(){if(null!=this.__attrHandler.data){if(this instanceof i&&this.__attrHandler.data.Title&&(this.textHandler.setText(this.__attrHandler.data.Title),this.textHandler.getTextElement().parent()[0]||this.__element.append(this.textHandler.getTextElement())),null!=this.__attrHandler.data.Children&&this.__attrHandler.data.Children.size>0&&(this.__element.addClass("is-selectable"),this.textHandler.setDecorationLine("underline").setDecorationStyle("solid"),null!=this.__sublist)){let e=this.__sublist.getData();if(null!=e&&null!=e.Children&&this.__attrHandler.data.Children.size===e.Children.size)for(let[t,a]of e.Children)this.__attrHandler.data.Children.has(t)||e.Children.delete(t);this.__sublist.setData(this.__attrHandler.data)}}else null!=this.__sublist&&(this.close(),this.__sublist.getElement().detach(),this.__sublist.destroy(),this.__sublist=void 0),this.__element.removeClass("is-selectable"),this.textHandler.setDecorationLine("none")}getData(){return this.__attrHandler.data}setSlideDuration(e){return this.__attrHandler.checkAttribute(e,"slideDuration",{validator:"number"})?(this.__attrHandler.slideDuration=e,this.__processSlideDuration(),this):this}__processSlideDuration(){var e;null===(e=this.__sublist)||void 0===e||e.setSlideDuration(this.__attrHandler.slideDuration)}getSlideDuration(){return this.__attrHandler.slideDuration}setSublistPadding(t,a){return e.Components.LayoutHandler.dimensionSetter(this.__attrHandler,"sublistPadding",t,a)?(this.__processSublistPadding(),this):this}__processSublistPadding(){var e;null===(e=this.__sublist)||void 0===e||e.setSublistPadding(this.__attrHandler.sublistPadding,this.__attrHandler.sublistPaddingUnit)}getSublistPadding(){return this.__attrHandler.sublistPadding}getSublistPaddingUnit(){return this.__attrHandler.sublistPaddingUnit}}t.BaseListEntry=i,function(e){let t;!function(e){e.onSelected="onEntrySelected",e.onOpened="onOpened",e.onClosed="onClosed"}(t=e.BaseListEntryEvents||(e.BaseListEntryEvents={}))}(i=t.BaseListEntry||(t.BaseListEntry={}))}(a=t.BaseList||(t.BaseList={}))}(e.Navigation||(e.Navigation={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(e){let t,a;!function(t){class a extends t.BaseList{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.__entries=new Map,this.__element.addClass("control-list")}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__setEntryData(e,t){super.__setEntryData(e,t)}__createEntry(e,t=null){return null==t&&(t=new a.ControlListEntry(e,this)),super.__createEntry(e,t),t}addEntry(e,t){return super.addEntry(e,t)}getEntry(e){return super.getEntry(e)}setData(e){return super.setData(e),this}getData(){return this.__attrHandler.data}}t.ControlList=a,function(a){class i extends t.BaseList.BaseListEntry{constructor(e,t,a){super(e,t,a)}__init(t){super.__init(t),this.__element.addClass("control-list-entry");let a=$("<div>").addClass("content-container");this.__element.append(a),this.controlContainer=new e.Components.ControlContainer(this.__id+"-control-container",this),this.controlContainer.setControlsHorizonzalAlignment("Right").getElement().addClass("control-container"),this.textHandler.setHorizontalAlignment("Left").getTextElement().addClass("title"),a.append(this.controlContainer.getElement())}__attach(){this.__isAttached||(this.controlContainer.getElement().on("pointerdown",e.EventHandler.stopPropagationHandler),super.__attach())}__detach(){this.__isAttached&&(this.controlContainer.getElement().off("pointerdown",e.EventHandler.stopPropagationHandler),super.__detach())}destroy(){this.controlContainer.destroy(),super.destroy()}onTextChanged(e){super.onTextChanged(e),this.__element.children(".content-container").append(this.textHandler.getTextElement())}__createSubList(){void 0===this.__sublist&&(this.__sublist=new a(this.__id+"-sublist",this)),super.__createSubList()}addEntry(e,t){super.addEntry(e,t)}getSublist(){return super.getSublist()}setData(e){return super.setData(e),this}getData(){return this.__attrHandler.data}__processData(){var e;super.__processData(),null!=(null===(e=this.__attrHandler.data)||void 0===e?void 0:e.controls)&&(this.controlContainer.getControls().length>0&&this.controlContainer.removeAllControls(),this.__attrHandler.data.controls instanceof Array?this.controlContainer.addControls(this.__attrHandler.data.controls):this.controlContainer.addControl(this.__attrHandler.data.controls))}}a.ControlListEntry=i}(a=t.ControlList||(t.ControlList={}))}(t=e.Navigation||(e.Navigation={})),function(e){e.BaView.prototype.toControlListData=function(t){if(!this.getIsValid())throw new Error("Converting BaView into data for ControlList is only possible when the BaView and its children have been loaded! Please call baView.loadAttributes(true) first!");if(null==this.texts)throw new Error("Converting BaView into data for ControlList is only possible when the texts of the a BaView and its children have been load. Please call baView.loadTexts(true) first!");let a={Title:this.texts.instDescription};if(t&&t.editEntry&&t.editEntry(this,a),this instanceof e.BaView&&null!=this.Children&&this.Children.size>0)for(var[i,n]of(a.Children=new Map,this.Children)){let s={};if(n instanceof e.BaView){if(s=n.toControlListData(t),null!=s.Children){s.Children.size>0&&a.Children.set(i,s)}}else{if(null!=(null==t?void 0:t.filter)&&0==t.filter(n))continue;if(null==n.texts)throw new Error("Converting BaView into data for ControlList is only possible when the texts of the a BaView and its children have been load. Please call baView.loadTexts(true) first!");s.Title=n.texts.instDescription,t&&t.editEntry&&t.editEntry(n,s),a.Children.set(i,s)}}return a}}(a=e.BA||(e.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){!function(t){!function(a){class i extends a.BaseList{constructor(e,t,a){super(e,t,a)}__init(e){super.__init(e),this.baObjectHandler=new t.BaObjectHandler(this),e.valueHandler||(e.valueHandler={}),void 0===e.valueHandler.autoWrite&&(e.valueHandler.autoWrite=!1),void 0===e.baUsedTitle&&this.setBaUsedTitle(t.BA.BaParameterId.eInstDescription),this.__element.addClass("parameter-list"),this.__entries=new Map}__attach(){this.__isAttached||super.__attach()}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__createEntry(e,a=null){null==a&&(a=new i.ParameterListEntry(e,this)),super.__createEntry(e,a);let n=a.eventHandler.register(i.ParameterListEntry.ParameterListEntryEvents.onValueChanged,(e,t,a)=>{this.eventHandler.raise(i.ParameterListEvents.onEntryValueChanged,a)});return a.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),n()}),a}__setEntryData(e,t){var a;e.setBaUsedTitle(this.__attrHandler.baUsedTitle),e.setAttributes({valueHandler:{autoWrite:null===(a=this.__attrHandler.valueHandler)||void 0===a?void 0:a.autoWrite}}),super.__setEntryData(e,t)}processBaObject(){null==this.__attrHandler.data&&(this.__attrHandler.data={}),this.baObjectHandler.baObject instanceof t.BA.BaBasicObject&&(this.__attrHandler.data=this.baObjectHandler.baObject),this.__processData()}addEntry(e,t){return super.addEntry(e,t)}setAttributes(e){var t;if(super.setAttributes(e),void 0!==e.baUsedTitle&&this.setBaUsedTitle(e.baUsedTitle),void 0!==e.valueHandler){this.__attrHandler.valueHandler=e.valueHandler;for(let e of this.__entries.values())e.setAttributes({valueHandler:{autoWrite:null===(t=this.__attrHandler.valueHandler)||void 0===t?void 0:t.autoWrite}})}return this}getAttributes(){return this.__attrHandler.getRef()}setData(e){return super.setData(e),this}setBaUsedTitle(e){return this.__attrHandler.checkAttribute(e,"baUsedTitle",{validator:"number"})?(null==e&&(e=t.BA.BaParameterId.eInstDescription),this.__attrHandler.baUsedTitle=e,this.__processBaUsedTitle(),this):this}__processBaUsedTitle(){for(let e of this.__entries.values())e.setBaUsedTitle(this.__attrHandler.baUsedTitle)}getBaUsedTitle(){return this.__attrHandler.baUsedTitle}}a.ParameterList=i,function(i){let n;!function(e){e.onEntryValueChanged="onEntryValueChanged"}(n=i.ParameterListEvents||(i.ParameterListEvents={}));class s extends a.BaseList.BaseListEntry{constructor(e,t,a){super(e,t,a),this.__valueFieldAppended=!1}__init(e){super.__init(e),this.baObjectHandler=new t.BaObjectHandler(this),this.__contentContainer=$("<div>").addClass("content-container"),this.__element.append(this.__contentContainer),this.__element.addClass("parameter-list-entry"),this.textHandler.setHorizontalAlignment("Left"),this.textHandler.getTextElement().addClass("title")}__attach(){this.__isAttached||(null!=this.__valueField&&this.__appendValueField(!0),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){var e,a;null===(e=this.__mappingSymbol)||void 0===e||e.destroy(),null===(a=this.__valueField)||void 0===a||a.destroy(),null!=this.__baVarWatchValueId&&this.__attrHandler.data instanceof t.BA.BaVariable&&this.__attrHandler.data.stopWatch(this.__baVarWatchValueId),null!=this.__destroyOnBaParameterInformationLoaded&&(this.__destroyOnBaParameterInformationLoaded(),delete this.__destroyOnBaParameterInformationLoaded),null!=this.__destroyOnValueFieldChanged&&(this.__destroyOnValueFieldChanged(),delete this.__destroyOnValueFieldChanged),super.destroy()}onTextChanged(e){super.onTextChanged(e),this.__contentContainer.append(this.textHandler.getTextElement())}__createSubList(){var e;null==this.__sublist&&(this.__sublist=new i(this.__id+"-sublist",this)),this.baObjectHandler.baObject&&(this.__attrHandler.data=this.baObjectHandler.baObject),super.__createSubList();let a=this.__sublist.eventHandler.register(i.ParameterListEvents.onEntryValueChanged,(e,t,a)=>{this.eventHandler.raise(i.ParameterListEntry.ParameterListEntryEvents.onValueChanged,a)});this.__sublist.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),a()}),this.__sublist.setAttributes({valueHandler:{autoWrite:null===(e=this.__attrHandler.valueHandler)||void 0===e?void 0:e.autoWrite}}),this.__sublist.setBaUsedTitle(this.__attrHandler.baUsedTitle)}__appendValueField(e){null!=this.__valueField&&(e?0==this.__valueFieldAppended&&(this.__contentContainer.append(this.__valueField.getElement()),this.__destroyOnValueFieldChanged=this.__valueField.eventHandler.register(t.Components.ValueField.ValueFieldEvents.onValueChanged,()=>{var e,t;this.__attrHandler.data&&(this.__attrHandler.data.Value=null===(e=this.__valueField)||void 0===e?void 0:e.getValue()),this.eventHandler.raise(s.ParameterListEntryEvents.onValueChanged,this,null===(t=this.__valueField)||void 0===t?void 0:t.getValue())}),this.__valueField.getElement().on("pointerdown",t.EventHandler.stopPropagationHandler),this.__valueFieldAppended=!0):1==this.__valueFieldAppended&&(this.__valueField.getElement().off("pointerdown",t.EventHandler.stopPropagationHandler),null!=this.__destroyOnValueFieldChanged&&(this.__destroyOnValueFieldChanged(),delete this.__destroyOnValueFieldChanged),this.__valueField.getElement().detach(),this.__valueFieldAppended=!1))}setAttributes(e){var t;return super.setAttributes(e),void 0!==e.baUsedTitle&&this.setBaUsedTitle(e.baUsedTitle),void 0!==e.title&&this.setTitle(e.title),void 0!==e.valueHandler&&(this.__attrHandler.valueHandler=e.valueHandler),null===(t=this.__valueField)||void 0===t||t.setAttributes(e),this}getAttributes(){return this.__attrHandler.getRef()}setData(e){return e instanceof t.BA.BaVariable?this.setBaParameter(e):e instanceof t.BA.BaBasicObject?this.baObjectHandler.setBaObject(e):super.setData(e),this}getData(){return this.__attrHandler.data}setValue(e){return void 0===e?this:null==this.__attrHandler.data?(console.error(`Attribute 'Data' of ParameterListEntry ${this.__id} was not set!`),this):tchmi_equal(e,this.__attrHandler.data.Value)?(this.__attrHandler.equalAttribute("Value"),this):(this.__attrHandler.data.Value=e,this.__processValue(),this)}__processValue(){var e,a,i,n;if(null!=this.__attrHandler.data)if(null==this.__attrHandler.data.Value)null!=(null===(e=this.__valueField)||void 0===e?void 0:e.getValueFeedback())?null===(a=this.__valueField)||void 0===a||a.setValueFeedback(null):null===(i=this.__valueField)||void 0===i||i.setValue(null);else if(null!=this.__attrHandler.data)switch(this.__attrHandler.data.DataType){case t.DataType.boolean:case t.DataType.number:case t.DataType.integer:case t.DataType.enum:case t.DataType.string:case t.DataType.dateTime:null!=(null===(n=this.__valueField)||void 0===n?void 0:n.getValueFeedback())?this.__valueField.setValueFeedback(this.__attrHandler.data.Value):this.__valueField.setValue(this.__attrHandler.data.Value)}else console.warn("Set data of Entry "+this.__id+" before setting the value of it!")}getValue(){return null==this.__attrHandler.data?null:this.__attrHandler.data.Value}setMinValue(e){return this.__attrHandler.checkAttribute(e,"minValue",{validator:"number"})?(this.__attrHandler.minValue=e,null!=this.__attrHandler.data?this.__attrHandler.data.DataType===t.DataType.number&&this.__valueField.setMinValue(this.__attrHandler.minValue):console.warn("Set data of Entry "+this.__id+" before setting the value of it"),this):this}getMinValue(){return this.__attrHandler.minValue}setMaxValue(e){return this.__attrHandler.checkAttribute(e,"maxValue",{validator:"number"})?(this.__attrHandler.maxValue=e,null!=this.__attrHandler.data?this.__attrHandler.data.DataType===t.DataType.number&&this.__valueField.setMaxValue(this.__attrHandler.maxValue):console.warn("Set data of Entry "+this.__id+" before setting the maxValue of it"),this):this}getMaxValue(){return this.__attrHandler.maxValue}setBaUsedTitle(e){return this.__attrHandler.checkAttribute(e,"baUsedTitle",{validator:"number"})?(null!=this.baObjectHandler.baObject&&null!=this.__attrHandler.baUsedTitle&&null!=this.__baUsedTitleWatchId&&this.baObjectHandler.baObject.stopWatchBaVariable(this.__baUsedTitleWatchId),null==e&&(e=t.BA.BaParameterId.eInstDescription),this.__attrHandler.baUsedTitle=e,this.__processBaUsedTitle(),this):this}__processBaUsedTitle(){null!=this.baObjectHandler.baObject&&null!=this.__attrHandler.baUsedTitle&&(this.__baUsedTitleWatchId=this.baObjectHandler.tryWatchBaVariable(this.__attrHandler.baUsedTitle,e=>{e&&this.textHandler.setText(e)}),null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setBaUsedTitle(this.__attrHandler.baUsedTitle)))}getBaUsedTitle(){return this.__attrHandler.baUsedTitle}setTitle(e){return this.__attrHandler.checkAttribute(e,"title",{validator:"string"})?(this.__attrHandler.title=e,this.textHandler.setText(e),this):this}getTitle(){return this.__attrHandler.title}processBaObject(){var e;if(null!=this.baObjectHandler.baObject){this.__attrHandler.data=this.baObjectHandler.baObject,this.__processData(),this.__processBaUsedTitle();let a=!1;if(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate)if(t.Globals.PrimitveBaObjects.indexOf(this.baObjectHandler.baObject.Identifier.ObjectType)>-1){if(this.baObjectHandler.baObject.DataType===t.DataType.boolean||this.baObjectHandler.baObject.DataType===t.DataType.number||this.baObjectHandler.baObject.DataType===t.DataType.enum){let t=this.__valueField;if(null==t)return;1!=(null===(e=this.__attrHandler.data)||void 0===e?void 0:e.ReadOnly)&&t.setReadOnly(null),t.baObjectHandler.setBaObject(this.baObjectHandler.baObject)}}else a=!0;else this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eStructurize||this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eAggregate?a=!0:console.error("Object purpose of menu entry is unknown");a&&null!=this.__valueField&&(this.__appendValueField(!1),this.__valueField.destroy(),delete this.__valueField)}}setBaParameter(e){return t.BA.BaVariable.isIBaVariableAttributes(e)?(tchmi_equal(this.__baParameter,e)||(this.__baParameter=e,this.__processBaParameter()),this):this}__processBaParameter(){if(this.__baParameter instanceof t.BA.BaVariable){if(!t.Server.UserManagement.checkAccess(this.__baParameter.Access.Read))return void this.__element.detach();this.__attrHandler.data=this.__baParameter,null==this.__valueField&&(this.__valueField=new t.Components.ValueField(this.__id+"-value-field",this,{valueHandler:this.__attrHandler.valueHandler})),this.__valueField.setValueHandler({baVariable:this.__baParameter});let a=this.busyHandler.setBusy(`Watching value of BaVariable '${this.__baParameter.InstanceName}' for paremeter list entry.`);this.__baVarWatchValueId=this.__baParameter.watch(e=>{null!=e&&this.__attrHandler.data&&(this.__attrHandler.data.Value=e,this.__processData()),a()}),this.setTitle(this.__baParameter.Info.Title),this.__baParameter.ID!=t.BA.BaParameterId.Additional?this.__destroyOnBaParameterInformationLoaded=e.EventProvider.register(t.Server.OnBaStandardParameterInformationLoaded,()=>{const e=t.Globals.BaStandardParameterInformation.get(this.__baParameter.InstanceName);this.setTitle(e.Title)}):this.__destroyOnBaParameterInformationLoaded=e.EventProvider.register(t.Server.OnBaExtensionTypesLoaded,()=>{const e=t.Globals.BaExtensionTypes.get(this.__baParameter.RefObject.Device.Description).get(this.__baParameter.RefObject.TypeName).AdditionalParameters.get(this.__baParameter.InstanceName);this.setTitle(e.Title)}),t.BA.BaVariable.isIBaEnumeratingParameterInfo(this.__baParameter.Info)?this.baObjectHandler.watchValueRange(this.__baParameter,e=>{null!=e&&this.__valueField instanceof t.Components.ValueField?this.__baParameter.DataType===t.DataType.enum?this.__valueField.setStateTexts(t.Components.Combobox.toComboboxItemArray(e)):this.__baParameter.DataType===t.DataType.boolean&&(this.__valueField.setActiveText(e.get(1)),this.__valueField.setInactiveText(e.get(0))):this.logger.log(t.Logger.Severity.warn,`Could not set state texts of ${this.__id}!`)}):t.BA.BaVariable.isIBaDecoratingParameterInfo(this.__baParameter.Info)?this.__baParameter.getDecoratingInfo().then(e=>{null!=e&&this.__valueField instanceof t.Components.ValueField&&"number"==typeof e&&this.__valueField.setUnit(e)}).catch(e=>this.logger.log(t.Logger.Severity.warn,e)):t.BA.BaVariable.isIBaEnumeratedParameterInfo(this.__baParameter.Info)?this.__baParameter.DataType===t.DataType.enum?this.__valueField.setStateTexts(t.Components.Combobox.toComboboxItemArray(this.__baParameter.Info.Enumerated)):(this.__valueField.setActiveText(this.__baParameter.Info.Enumerated[1]),this.__valueField.setInactiveText(this.__baParameter.Info.Enumerated[2])):t.BA.BaVariable.isIBaDecoratedParameterInfo(this.__baParameter.Info)&&this.__valueField.setUnit(this.__baParameter.Info.Decorated),this.__processData()}}getBaParameter(){return this.__baParameter}__processData(){var e,a,i,n,s,r,o,l,d,_,h;if(super.__processData(),null!=this.__attrHandler.data)if(null==(null===(e=this.__attrHandler.data.Access)||void 0===e?void 0:e.Read)||t.Server.UserManagement.checkAccess(null===(a=this.__attrHandler.data.Access)||void 0===a?void 0:a.Read)){switch(null!=this.__attrHandler.data.Title&&this.__attrHandler.data.Title.length>0&&this.setTitle(this.__attrHandler.data.Title),this.__attrHandler.data.DataType){case t.DataType.boolean:case t.DataType.number:case t.DataType.integer:case t.DataType.enum:case t.DataType.string:case t.DataType.dateTime:switch(null==this.__valueField&&(this.__valueField=new t.Components.ValueField(this.__id+"-value-field",this,{valueHandler:this.__attrHandler.valueHandler})),this.__attrHandler.data.DataType){case t.DataType.number:case t.DataType.integer:void 0!==this.__attrHandler.data.Unit&&this.__valueField.setUnit(this.__attrHandler.data.Unit),void 0!==this.__attrHandler.data.MinValue&&this.__valueField.setMinValue(this.__attrHandler.data.MinValue),void 0!==this.__attrHandler.data.MaxValue&&this.__valueField.setMaxValue(this.__attrHandler.data.MaxValue);break;case t.DataType.boolean:void 0!==this.__attrHandler.data.ActiveText&&this.__valueField.setActiveText(this.__attrHandler.data.ActiveText),void 0!==this.__attrHandler.data.InactiveText&&this.__valueField.setInactiveText(this.__attrHandler.data.InactiveText);break;case t.DataType.enum:if(null!=this.__attrHandler.data.EnumInfo){let e=[];for(let[t,a]of this.__attrHandler.data.EnumInfo)e.push({text:a,value:t});this.__valueField.setStateTexts(e)}this.__valueField.setDigits(0)}this.__valueField.setDataType(this.__attrHandler.data.DataType),this.__valueField.setValueHandler(this.__attrHandler.valueHandler),null!=this.__attrHandler.data.Value&&this.__valueField.setValue(this.__attrHandler.data.Value);break;case t.DataType.array:case t.DataType.object:switch(this.__appendValueField(!1),null===(i=this.__valueField)||void 0===i||i.destroy(),delete this.__valueField,this.__attrHandler.data.DataType){case t.DataType.array:if(this.__attrHandler.data.Value){let e=this.__attrHandler.data.Value;if(e.length>0){this.__attrHandler.data.Children=new Map;for(let a=0;a<e.length;a++){let i=a,n={DataType:void 0!==this.__attrHandler.data.ArrayType?this.__attrHandler.data.ArrayType:t.Helper.detectDataType(e[a]),Title:this.__attrHandler.data.Title+"["+i+"]",Mapping:this.__attrHandler.data.Mapping+"["+i+"]",Value:e[a]};this.__attrHandler.data.Children.set(a.toString(),n)}this.__attrHandler.data.DataType=t.DataType.object,this.__processData()}}case t.DataType.object:if(this.__attrHandler.data.Value&&t.Helper.detectDataType(this.__attrHandler.data.Value)===t.DataType.object&&!this.__attrHandler.data.Children){this.__attrHandler.data.Children=new Map;for(let e in this.__attrHandler.data.Value){let a={};a.Title=e,a.DataType=t.Helper.detectDataType(this.__attrHandler.data.Value[e]),a.Mapping=this.__attrHandler.data.Mapping+"::"+e,a.Value=this.__attrHandler.data.Value[e],this.__attrHandler.data.Children.set(e,a)}this.__processData()}}break;case t.DataType.unknown:break;default:return void this.logger.log(t.Logger.Severity.error,`Invalid data type '${this.__attrHandler.data.DataType}' was set for ParameterListEntry`,this.__attrHandler)}null!=this.__valueField&&(this.__attrHandler.data instanceof t.BA.BaBasicObject||(null!=(null===(n=this.__attrHandler.data.Access)||void 0===n?void 0:n.Write)?t.Server.UserManagement.checkAccess(null===(s=this.__attrHandler.data.Access)||void 0===s?void 0:s.Write)?null===(o=this.__valueField)||void 0===o||o.setReadOnly(!1):null===(r=this.__valueField)||void 0===r||r.setReadOnly(!0):this.__attrHandler.data instanceof t.BA.BaVariable?null===(_=this.__valueField)||void 0===_||_.setReadOnly(!0):null!=this.__attrHandler.data.ReadOnly?null===(l=this.__valueField)||void 0===l||l.setReadOnly(this.__attrHandler.data.ReadOnly):null===(d=this.__valueField)||void 0===d||d.setReadOnly(!0),null===(h=this.__valueField)||void 0===h||h.setValue(this.__attrHandler.data.Value)),this.__valueField.getElement().addClass("value-field"),this.__valueField.textHandler.setVerticalAlignment("Center").setHorizontalAlignment("Left").setFontSize(this.textHandler.getFontSize()),this.__appendValueField(!0))}else this.__element.detach()}__processReadOnly(){var e;super.__processReadOnly(),null===(e=this.__valueField)||void 0===e||e.setReadOnly(this.__attrHandler.readOnly)}}i.ParameterListEntry=s,function(e){let t;!function(e){e.onValueChanged="onValueChanged"}(t=e.ParameterListEntryEvents||(e.ParameterListEntryEvents={}))}(s=i.ParameterListEntry||(i.ParameterListEntry={}))}(i=a.ParameterList||(a.ParameterList={}))}(t.Navigation||(t.Navigation={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let a;!function(a){class i extends a.ParameterList{constructor(e,t,a){super(e,t,a),this.__entrySelectedHandler=()=>{this.__baParent instanceof i.ProjectNavigationListEntry||(this.setContentViewButtonOffset(this.hasEntryWithContentView()),this.__onDisplayedEventsChanged())},this.__displayedEventsChangedHandler=()=>{this.__baParent instanceof i.ProjectNavigationListEntry||this.__onDisplayedEventsChanged()}}__init(e){super.__init(e),this.__entries=new Map,void 0===(null==e?void 0:e.showEvents)&&this.setShowEvents(!0),void 0===(null==e?void 0:e.showObjectType)&&this.setShowObjectType(!0),void 0===(null==e?void 0:e.showValue)&&this.setShowValue(!0),void 0===(null==e?void 0:e.useNestedList)&&this.setUseNestedList(!0)}__attach(){this.__isAttached||(this.__destroyersToCallOnDetach.push(this.eventHandler.register(a.BaseList.BaseListEvents.onEntryOpened,this.__entrySelectedHandler)),this.__destroyersToCallOnDetach.push(this.eventHandler.register(a.BaseList.BaseListEvents.onEntryOpened,this.__entrySelectedHandler)),this.__destroyersToCallOnDetach.push(this.eventHandler.register(i.ProjectNavigationListEvents.onEntryDisplayedEventsChanged,this.__displayedEventsChangedHandler)),this.__baParent instanceof i.ProjectNavigationListEntry||this.__entrySelectedHandler(),super.__attach())}__detach(){this.__isAttached&&super.__detach()}destroy(){super.destroy()}__setEntryData(e,t){e.setShowValue(this.__attrHandler.showValue),e.setShowEvents(this.__attrHandler.showEvents),e.setShowObjectType(this.__attrHandler.showObjectType),e.setUseNestedList(this.__attrHandler.useNestedList),super.__setEntryData(e,t)}__createEntry(e,a=null){null==a&&(a=new i.ProjectNavigationListEntry(e,this)),super.__createEntry(e,a);let n=a.eventHandler.register(i.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onActiveEventsChanged,(e,t,a)=>{this.eventHandler.raise(i.ProjectNavigationListEvents.onEntryActiveEventsChanged,a)}),s=a.eventHandler.register(i.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,(e,t,a)=>{this.eventHandler.raise(i.ProjectNavigationListEvents.onEntryDisplayedEventsChanged,a)}),r=a.eventHandler.register(i.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onContentViewButtonPressed,(e,t,a)=>{this.eventHandler.raise(i.ProjectNavigationListEvents.onEntryContentViewButtonPressed,a)});return a.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),n(),s(),r()}),a}__onDisplayedEventsChanged(){let e=this.getMostDisplayedEvents();this.setMostEvents(e),this.hideObjects(),this.setContentViewButtonOffset(this.hasEntryWithContentView())}getMostDisplayedEvents(){var e,a;let i=0;for(let n of this.__entries.values()){let s=n.getDisplayedEventsCnt();if(i<s&&(i=s),(null===(e=n.baObjectHandler.baObject)||void 0===e?void 0:e.Purpose)===t.BA.ObjectPurpose.eStructurize||(null===(a=n.baObjectHandler.baObject)||void 0===a?void 0:a.Purpose)===t.BA.ObjectPurpose.eAggregate){let e=n.getSublist();if(null!=e){let t=e.getMostDisplayedEvents();i<t&&(i=t)}}}return i}filterChildren(e,a=[]){if(null==this.__attrHandler.data||"string"!=typeof e)return!1;if(e.length<0)return this.__currentFilter=null,!1;this.__currentFilter={filter:e,options:a};let i=!1;for(let n of this.__entries.values()){let s=n.baObjectHandler.baObject;if(null==s)return!1;if(s instanceof t.BA.BaView){if(s.filterChildren(e,a).length>0){n.show(),s.matchesFilter(e,a)?n.close():n.open();let t=n.getSublist();s.matchesFilter(e,a)?null==t||t.filterChildren("",a):null==t||t.filterChildren(e,a),i=!0}else n.close(),n.hide()}else s.matchesFilter(e,a)?n.show():n.hide()}return i}hideObjects(){var e;if(null!=this.__attrHandler.data)for(let t of this.__entries.values()){let a=t.getSublist();null!=a&&a.hideObjects(),this.__currentFilter&&(null===(e=t.baObjectHandler.baObject)||void 0===e?void 0:e.matchesFilter(this.__currentFilter.filter,this.__currentFilter.options))&&t.show()}}changeEvent(e,t){if(null!=this.__attrHandler.data)for(let a of this.__entries.values()){let i=a.getSublist();null!=i&&i.changeEvent(e,t),!0===t?a.showEvent(e):a.hideEvent(e),a.getDisplayedEventsCnt()<=0?a.hide():a.show()}}hasEntryWithContentView(){for(let e of this.__entries.values()){if(e.hasContentViewButton())return!0;if(e.getIsOpen()&&e.getSublist().hasEntryWithContentView())return!0}return!1}setContentViewButtonOffset(e){for(let t of this.__entries.values())t.hasContentViewButton()||!0!==e?(t.getElement().removeClass("has-no-content-view-button"),null!=t.getSublist()&&t.getSublist().setContentViewButtonOffset(e)):(t.getElement().addClass("has-no-content-view-button"),t.getIsOpen()&&t.getSublist().setContentViewButtonOffset(e))}getCurrentFilter(){return this.__currentFilter}setAttributes(e){return super.setAttributes(e),void 0===e.mostEvents&&this.setMostEvents(e.mostEvents),void 0===e.showEvents&&this.setShowEvents(e.showEvents),void 0===e.showObjectType&&this.setShowObjectType(e.showObjectType),void 0===e.showValue&&this.setShowValue(e.showValue),void 0===e.useNestedList&&this.setUseNestedList(e.useNestedList),this}getAttributes(){return this.__attrHandler.getRef()}setData(e){return e instanceof t.BA.BaBasicObject?this.baObjectHandler.setBaObject(e):super.setData(e),this}setMostEvents(e){if(!this.__attrHandler.checkAttribute(e,"mostEvents",{validator:"number",skipEqualityCheck:!0}))return this;this.__attrHandler.mostEvents=e;for(let t of this.__entries.values())t.setMostEvents(e);return this}getMostEvents(){return this.__attrHandler.mostEvents}setShowEvents(e){if(!this.__attrHandler.checkAttribute(e,"showEvents",{validator:"boolean"}))return this;this.__attrHandler.showEvents=e;for(let t of this.__entries.values())t.setShowEvents(e);return this}getShowEvents(){return this.__attrHandler.showEvents}setShowObjectType(e){if(!this.__attrHandler.checkAttribute(e,"showObjectType",{validator:"boolean"}))return this;this.__attrHandler.showObjectType=e;for(let t of this.__entries.values())t.setShowObjectType(e);return this}getShowObjectType(){return this.__attrHandler.showObjectType}setShowValue(e){if(!this.__attrHandler.checkAttribute(e,"showValue",{validator:"boolean"}))return this;this.__attrHandler.showValue=e;for(let t of this.__entries.values())t.setShowValue(e);return this}getShowValue(){return this.__attrHandler.showValue}setUseNestedList(e){if(!this.__attrHandler.checkAttribute(e,"useNestedList",{validator:"boolean"}))return this;this.__attrHandler.useNestedList=e;for(let t of this.__entries.values())t.setUseNestedList(e);return null!=this.__attrHandler.useNestedList&&!1===this.__attrHandler.useNestedList?(this.__oldSlideDuration=this.__attrHandler.slideDuration,this.setSlideDuration(0)):this.setSlideDuration(this.__oldSlideDuration),this}getUseNestedList(){return this.__attrHandler.useNestedList}processBaObject(){var e;super.processBaObject(),this.__baParent instanceof i.ProjectNavigationListEntry||(this.setContentViewButtonOffset(this.hasEntryWithContentView()),null===(e=this.baObjectHandler.baObject)||void 0===e||e.loadAttributes(!0,!0))}__processSlideDuration(){this.__oldSlideDuration=this.__attrHandler.slideDuration,null!=this.__attrHandler.useNestedList&&!1===this.__attrHandler.useNestedList&&(this.__attrHandler.slideDuration=0),super.__processSlideDuration()}__processData(){if(super.__processData(),null!=this.__attrHandler.data&&(null==this.__attrHandler.data.Children||0===this.__attrHandler.data.Children.size)){let e=this.__entries.get(this.__id+"-entry");e||(e=this.__createEntry(this.__id+"-entry"),this.__entries.set(e.getId(),e),this.__setEntryData(e,this.__attrHandler.data),this.__element.append(e.getElement()))}}}a.ProjectNavigationList=i,function(i){let n;!function(e){e.onEntryActiveEventsChanged="onEntryActiveEventsChanged",e.onEntryDisplayedEventsChanged="onEntryDisplayedEventsChanged",e.onEntryContentViewButtonPressed="onEntryContentViewButtonPressed"}(n=i.ProjectNavigationListEvents||(i.ProjectNavigationListEvents={})),i.DisableNodeTypeIcons=!1;class s extends a.ParameterList.ParameterListEntry{constructor(e,a,i){super(e,a,i),this.__eventTypeContainerAppended=!1,this.__objectTypeButtonAppended=!0,this.__displayedEventsCnt=0,this.__showPulse=!1,this.__changedParameters=new Map,this.__objectTypeButtonPressedHandler=()=>{var e;0!=this.checkAccess(t.Server.UserManagement.AccessRight.operate)&&(null===(e=this.baObjectHandler.baObject)||void 0===e||e.openParameterDialog())},this.__contentViewButtonPressedHandler=()=>{this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onContentViewButtonPressed,this)}}__init(e){super.__init(e),this.__element.addClass("project-navigation-list-entry"),this.__objectTypeButton=new t.Components.Button(this.__id+"-object-type-button",this),this.__eventIconContainer=$("<div>").addClass("event-icon-container"),this.__legendIconHandler=new t.Components.LegendIconHandler,this.__objectTypeButton.getElement().addClass("object-type-button"),this.__objectTypeButton.backgroundStyler.setImage(t.Icons.ObjectType.StructuredView.path,!0).setImageHeight(70,"%").setImageWidth(70,"%"),this.__contentContainer.append(this.__objectTypeButton.getElement()),this.__legendIconHandler.icon=t.Icons.ObjectType.StructuredView,this.textHandler.setText("..."),this.textHandler.getTextElement().addClass("title-textblock"),this.__contentContainer.append(this.textHandler.getTextElement()),this.textHandler.setVerticalAlignment("Center").setHorizontalAlignment("Left"),this.__contentContainer.append(this.__eventIconContainer),this.__eventTypeContainerAppended=!0}__attach(){var e,i;this.__isAttached||(this.__eventIconContainer.on("pointerdown",t.EventHandler.stopPropagationHandler),this.__objectTypeButton.getElement().on("pointerdown",t.EventHandler.stopPropagationHandler),null===(e=this.__contentViewButton)||void 0===e||e.getElement().on("pointerdown",t.EventHandler.stopPropagationHandler),this.__destroyOnObjectTypeButtonPressed=this.__objectTypeButton.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,this.__objectTypeButtonPressedHandler),this.__destroyOnContentViewButtonPressed=null===(i=this.__contentViewButton)||void 0===i?void 0:i.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,this.__contentViewButtonPressedHandler),null!=this.__baVarList&&this.__destroyersToCallOnDestroy.push(this.__baVarList.eventHandler.register(a.ParameterList.ParameterListEvents.onEntryValueChanged,(e,i,n)=>{let s=n.getBaParent();if(null!=s&&(s=null==s?void 0:s.getBaParent(),null!=s&&n instanceof a.ParameterList.ParameterListEntry&&s.getId()===this.__id)){let e=n.getData();e instanceof t.BA.BaVariable&&this.__changedParameters.set(e.ID,e)}})),this.__managePulse(),this.__legendIconHandler.show(),super.__attach())}__detach(){var e;this.__isAttached&&(this.__eventIconContainer.off("pointerdown",t.EventHandler.stopPropagationHandler),this.__objectTypeButton.getElement().off("pointerdown",t.EventHandler.stopPropagationHandler),null===(e=this.__contentViewButton)||void 0===e||e.getElement().off("pointerdown",t.EventHandler.stopPropagationHandler),null!=this.__destroyOnObjectTypeButtonPressed&&this.__destroyOnObjectTypeButtonPressed(),null!=this.__destroyOnContentViewButtonPressed&&this.__destroyOnContentViewButtonPressed(),this.__legendIconHandler.hide(),super.__detach())}destroy(){var e;if(null!=this.__destroyOnCustomBaPulse&&(this.__destroyOnCustomBaPulse(),delete this.__destroyOnCustomBaPulse),null!=this.__destroyOnObjectTypeButtonPressed&&(this.__destroyOnObjectTypeButtonPressed(),delete this.__destroyOnObjectTypeButtonPressed),null!=this.__destroyOnContentViewButtonPressed&&(this.__destroyOnContentViewButtonPressed(),delete this.__destroyOnContentViewButtonPressed),this.__objectTypeButton.destroy(),null===(e=this.__contentViewButton)||void 0===e||e.destroy(),this.__activeEvents)for(let e=0;e<this.__activeEvents.length;e++)this.__activeEvents[e].destroy();null!=this.__eventsWatchIdentifier&&(this.baObjectHandler.baObject instanceof t.BA.BaObject||this.baObjectHandler.baObject instanceof t.BA.BaView)&&this.baObjectHandler.baObject.stopWatchEventsPerIcon(this.__eventsWatchIdentifier),super.destroy()}__onEventDataChanged(e){let a=this.__activeEvents?this.__activeEvents.length:0,i=0;for(let[a,n]of e){let e;if(n.nCount>0){if(this.__activeEvents&&this.__activeEvents[i])e=this.__activeEvents[i];else{e=new t.Components.EventIcon(this.__id+"-event-icon-"+i,this),e.getElement().addClass("event-icon"),this.__activeEvents||(this.__activeEvents=[]),this.__activeEvents.push(e),1===this.__activeEvents.length&&e.getElement().addClass("first");let a=e.eventHandler.register(t.Components.EventIcon.EventIconEvents.onAcknowledged,()=>{var e;return null===(e=this.baObjectHandler.baObject)||void 0===e?void 0:e.acknowledge()});e.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),a()})}e.setEventCondition(a),e.setEventState(n.eMostPriorisedState),e.setEventCount(n.nCount),i++}}if(this.__displayedEventsCnt=i-(a-this.__displayedEventsCnt),this.__activeEvents&&i<this.__activeEvents.length)for(let e=this.__activeEvents.length-1;e>=i;e--)this.__activeEvents[e].getElement().detach(),this.__activeEvents[e].destroy(),this.__activeEvents.pop();if(this.__attrHandler.showEvents&&(this.__eventTypeContainerAppended||(this.__contentContainer.append(this.__eventIconContainer),this.__isAttached&&this.__eventIconContainer.on("pointerdown",t.EventHandler.stopPropagationHandler),this.__eventTypeContainerAppended=!0)),this.__activeEvents)for(let e=a;e<this.__activeEvents.length;e++)this.__eventIconContainer.append(this.__activeEvents[e].getElement());this.__managePulse(),this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onActiveEventsChanged,this),this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,this)}__createSubList(){null==this.__sublist&&(this.__sublist=new i(this.__id+"-sublist",this)),super.__createSubList();let e=this.__sublist.eventHandler.register(i.ProjectNavigationListEvents.onEntryActiveEventsChanged,(e,t,a)=>{this.eventHandler.raise(i.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onActiveEventsChanged,a)}),a=this.__sublist.eventHandler.register(i.ProjectNavigationListEvents.onEntryDisplayedEventsChanged,(e,t,a)=>{this.eventHandler.raise(i.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,a)}),n=this.__sublist.eventHandler.register(i.ProjectNavigationListEvents.onEntryContentViewButtonPressed,(e,t,a)=>{this.eventHandler.raise(i.ProjectNavigationListEntry.ProjectNavigationListEntryEvents.onContentViewButtonPressed,a)});this.__sublist.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,t=>{t.destroy(),e(),a(),n()}),this.__sublist.setShowValue(this.__attrHandler.showValue).setShowEvents(this.__attrHandler.showEvents).setShowObjectType(this.__attrHandler.showObjectType).setUseNestedList(this.__attrHandler.useNestedList).setMostEvents(this.__attrHandler.mostEvents)}__updateAppearance(){null!=this.__attrHandler.showObjectType&&(this.__attrHandler.showObjectType?this.__objectTypeButtonAppended||(this.__contentContainer.append(this.__objectTypeButton.getElement()),this.__isAttached&&(this.__destroyOnObjectTypeButtonPressed=this.__objectTypeButton.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,this.__objectTypeButtonPressedHandler)),this.__objectTypeButtonAppended=!0):this.__objectTypeButtonAppended&&(this.__objectTypeButton.getElement().detach(),null!=this.__destroyOnObjectTypeButtonPressed&&this.__destroyOnObjectTypeButtonPressed(),this.__objectTypeButtonAppended=!1)),null!=this.__attrHandler.showEvents&&(this.__attrHandler.showEvents?this.__eventTypeContainerAppended||(this.__contentContainer.append(this.__eventIconContainer),this.__eventIconContainer.on("pointerdown",t.EventHandler.stopPropagationHandler),this.__eventTypeContainerAppended=!0):this.__eventTypeContainerAppended&&(this.__eventIconContainer.off("pointerdown",t.EventHandler.stopPropagationHandler),this.__eventIconContainer.detach(),this.__eventTypeContainerAppended=!1)),null!=this.__attrHandler.showValue&&(this.__attrHandler.showValue?(this.__appendValueField(!0),this.__setValueFieldPositionOffset(0)):this.__appendValueField(!1))}__managePulse(){let e=!1;if(!this.__isOpen&&this.__activeEvents&&this.__activeEvents.length>0)for(let a=0;a<this.__activeEvents.length;a++){let i=this.__activeEvents[a],n=i.getEventCondition();if(null!=n&&n>=t.BA.EventCondition.eTypeAlarm&&n<=t.BA.EventCondition.eTypeOther&&(i.getEventState()===t.BA.EventIconState.eGone||i.getEventState()===t.BA.EventIconState.ePresent)){e=!0;break}}this.__enablePulse(e),e?this.__element.addClass("shows-pulse"):(this.__element.removeClass("shows-pulse"),this.__element.removeClass("pulse"))}__enablePulse(a){this.__showPulse!==a&&(a?this.__destroyOnCustomBaPulse=e.EventProvider.register(t.GlobalEvents.onCustomBaNewPulse,()=>{this.__element.addClass("pulse"),this.__element.on("animationend",()=>{this.__element.removeClass("pulse")})}):this.__destroyOnCustomBaPulse&&(this.__destroyOnCustomBaPulse(),delete this.__destroyOnCustomBaPulse),this.__showPulse=a)}__setValueFieldPositionOffset(e){var t,a,i;null!=e?e>0?(null===(t=this.__eventIconContainer)||void 0===t||t.addClass("use-value-field-offset"),this.__element.css("--event-icon-container-size-offset",String(e))):null===(a=this.__eventIconContainer)||void 0===a||a.removeClass("use-value-field-offset"):(this.__element.css("--event-icon-container-size-offset","0"),null===(i=this.__eventIconContainer)||void 0===i||i.removeClass("use-value-field-offset"))}open(){return!!super.open()&&(this.__eventIconContainer.fadeTo(this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:200,.3),this.__managePulse(),!0)}close(){return!!super.close()&&(this.__eventIconContainer.fadeTo(this.__attrHandler.slideDuration?this.__attrHandler.slideDuration:200,1,()=>this.__eventIconContainer.css("opacity","")),this.__isOpen?this.eventHandler.register(a.BaseList.BaseListEntry.BaseListEntryEvents.onClosed,e=>{e.destroy(),this.__managePulse()}):this.__managePulse(),!0)}getTitleTextblock(){return this.textHandler.getTextElement()}getActiveEvents(){return this.__activeEvents}hideEvent(e){if(this.__activeEvents)for(let t=0;t<this.__activeEvents.length;t++)if(this.__activeEvents[t].getEventCondition()===e){this.__activeEvents[t].getElement().addClass("tchmi-ba-display-none"),this.__displayedEventsCnt--,this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,this);break}}showEvent(e){if(this.__activeEvents)for(let t=0;t<this.__activeEvents.length;t++)if(this.__activeEvents[t].getEventCondition()===e){this.__activeEvents[t].getElement().removeClass("tchmi-ba-display-none"),this.__displayedEventsCnt++,this.eventHandler.raise(s.ProjectNavigationListEntryEvents.onDisplayedEventsChanged,this);break}}getDisplayedEventsCnt(){return this.__displayedEventsCnt}hasContentViewButton(){return null!=this.__contentContainer.children(".content-view-button")[0]}addContentViewButton(){var e,a;null==this.__contentViewButton&&(this.__contentViewButton=new t.Components.Button(this.__id+"-content-view-button",this),this.__contentViewButton.backgroundStyler.setImage(t.Icons.Standard.Right_Arrow.path,!0).setImageWidth(80,"%").setImageHeight(80,"%"),this.__contentViewButton.getElement().addClass("content-view-button"),this.__contentContainer.append(this.__contentViewButton.getElement()),this.__isAttached&&(this.__destroyOnContentViewButtonPressed=null===(e=this.__contentViewButton)||void 0===e?void 0:e.eventHandler.register(t.Components.Button.ButtonEvents.onPressed,this.__contentViewButtonPressedHandler),null===(a=this.__contentViewButton)||void 0===a||a.getElement().on("pointerdown",t.EventHandler.stopPropagationHandler)))}removeContentViewButton(){var e,t;null!=this.__destroyOnContentViewButtonPressed&&this.__destroyOnContentViewButtonPressed(),null===(e=this.__contentViewButton)||void 0===e||e.getElement().detach(),null===(t=this.__contentViewButton)||void 0===t||t.destroy()}setAttributes(e){return super.setAttributes(e),void 0!==e.contentHeight&&this.setContentHeight(e.contentHeight,e.contentHeightUnit),this}getAttributes(){return this.__attrHandler.getRef()}setUseNestedList(e){return this.__attrHandler.checkAttribute(e,"useNestedList",{validator:"boolean"})?(this.__attrHandler.useNestedList=e,null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setUseNestedList(e)),this):this}getUseNestedList(){return this.__attrHandler.useNestedList}setMostEvents(e){return this.__attrHandler.checkAttribute(e,"mostEvents",{validator:"number",skipEqualityCheck:!0})?(this.__attrHandler.mostEvents=e,null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setMostEvents(e)),this.__setValueFieldPositionOffset(this.__attrHandler.mostEvents),this):this}getMostEvents(){return this.__attrHandler.mostEvents}setShowEvents(e){return this.__attrHandler.checkAttribute(e,"showEvents",{validator:"boolean"})?(this.__attrHandler.showEvents=e,null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setShowEvents(e)),this.__updateAppearance(),this.__setValueFieldPositionOffset(this.__attrHandler.mostEvents),this):this}getShowEvents(){return this.__attrHandler.showEvents}setShowValue(e){return this.__attrHandler.checkAttribute(e,"showValue",{validator:"boolean"})?(this.__attrHandler.showValue=e,null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setShowValue(e)),this.__updateAppearance(),this.__setValueFieldPositionOffset(this.__attrHandler.mostEvents),this):this}getShowValue(){return this.__attrHandler.showValue}setShowObjectType(e){return this.__attrHandler.checkAttribute(e,"showObjectType",{validator:"boolean"})?(this.__attrHandler.showObjectType=e,null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate||this.__sublist.setShowObjectType(e)),this.__updateAppearance(),this.__setValueFieldPositionOffset(this.__attrHandler.mostEvents),this):this}getShowObjectType(){return this.__attrHandler.showObjectType}setContentHeight(e,a="px"){return t.Components.LayoutHandler.dimensionSetter(this.__attrHandler,"contentHeight",e,a)?(this.__processContentHeight(),this):this}__processContentHeight(){if(null!=this.__attrHandler.contentHeight&&(null==this.__attrHandler.contentHeightUnit&&(this.__attrHandler.contentHeightUnit="px"),this.__element.css("--content-height",this.__attrHandler.contentHeight+this.__attrHandler.contentHeightUnit),null!=this.baObjectHandler.baObject&&null!=this.__sublist&&(this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eStructurize||this.baObjectHandler.baObject.Purpose===t.BA.ObjectPurpose.eAggregate)))for(let e of this.__sublist.getEntries().values())e.setContentHeight(this.__attrHandler.contentHeight,this.__attrHandler.contentHeightUnit)}getContentHeight(){return this.__attrHandler.contentHeight}getContentHeightUnit(){return this.__attrHandler.contentHeightUnit}processBaObject(){if(super.processBaObject(),null==this.baObjectHandler.baObject)return;let e=this.baObjectHandler.baObject.Identifier.ObjectType,a=t.Icons.ObjectType.Object;if(e!==t.BA.ObjectType.Invalid)if(e===t.BA.ObjectType.eStructuredView){if(0==i.DisableNodeTypeIcons){let e=this.baObjectHandler.baObject.NodeType;if(null!=e){let i=t.BA.BaBasicObject.getNodeTypeIcon(e);null!=i&&(a=i)}}}else{let i=null!=t.BA.ObjectType[e]?t.BA.ObjectType[e]:"";i.length>0&&(a=t.Icons.ObjectType[i.slice(1,i.length)])}if(this.__objectTypeButton.backgroundStyler.setImage(a.path,!0),this.__legendIconHandler.icon=a,this.__isAttached&&this.__legendIconHandler.show(),this.baObjectHandler.baObject instanceof t.BA.BaView||this.baObjectHandler.baObject instanceof t.BA.BaObject&&this.baObjectHandler.baObject.IsEventEnabled){let e=this.busyHandler.setBusy("Watching events of BaObject",{showIndicator:t.BusyHandler.ShowEventLoading}),a=this.baObjectHandler.baObject.watchEventsPerIcon(t=>{this.__onEventDataChanged(t),e()});null!=a?this.__eventsWatchIdentifier=a:e()}if(this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eStructurize&&this.baObjectHandler.baObject.Purpose!==t.BA.ObjectPurpose.eAggregate)switch(e){case t.BA.ObjectType.eAnalogInput:case t.BA.ObjectType.eAnalogOutput:case t.BA.ObjectType.eAnalogValue:case t.BA.ObjectType.eBinaryInput:case t.BA.ObjectType.eBinaryOutput:case t.BA.ObjectType.eBinaryValue:case t.BA.ObjectType.eMultiStateInput:case t.BA.ObjectType.eMultiStateOutput:case t.BA.ObjectType.eMultiStateValue:case t.BA.ObjectType.eSchedule:case t.BA.ObjectType.eLoop:this.__attrHandler.showValue||null==this.__valueField||(this.__appendValueField(!1),this.__valueField.destroy(),delete this.__valueField);break;case t.BA.ObjectType.eEventClass:console.log("Was muss bei "+t.BA.ObjectType[e]+" noch angezeigt werden?");break;case t.BA.ObjectType.eTrend:case t.BA.ObjectType.eCalendar:case t.BA.ObjectType.eObject:break;case t.BA.ObjectType.eProject:console.log("Was muss bei "+t.BA.ObjectType[e]+" noch angezeigt werden?");break;default:console.error("Object type of menu entry is unknown!")}}}i.ProjectNavigationListEntry=s,function(e){let t;!function(e){e.onActiveEventsChanged="onActiveEventsChanged",e.onDisplayedEventsChanged="onDisplayedEventsChanged",e.onContentViewButtonPressed="onContentViewButtonPressed"}(t=e.ProjectNavigationListEntryEvents||(e.ProjectNavigationListEntryEvents={}))}(s=i.ProjectNavigationListEntry||(i.ProjectNavigationListEntry={}))}(i=a.ProjectNavigationList||(a.ProjectNavigationList={}))}(a=t.Navigation||(t.Navigation={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(e){let t;!function(t){class a{constructor(t,a){this.echartsOption={triggerEvent:!0},this.__options=null,this.__axisClickedHandler=t=>{t.xAxisIndex!==this.getAxisIndex()&&t.yAxisIndex!==this.getAxisIndex()||this.__dataType!==e.DataType.boolean&&this.__openConfigureAxisDialog()},this.__id=t,this.__parent=a,this.__logger=new e.Logger({name:this.__id}),this.echartsOption.id=t,this.resetToDefault(),e.Server.UserData.loadAxisSettings(this.__id).then(e=>{null!=e&&this.setOptions(e)})}__openConfigureAxisDialog(){var t,a;let i=$("<div>").addClass("tchmi-ba-charting-axis-configure-dialog-content");i.css({position:"relative",height:"100%",width:"100%"});let n=new e.Navigation.ParameterList(this.__id+"-config-list",this.__parent),s={Children:new Map([["auto-scale",{DataType:e.DataType.boolean,Title:"Auto scale",ReadOnly:!1,Value:null!=this.__options&&this.__options.autoScale,ActiveText:"",InactiveText:""}],["min",{DataType:this.__dataType,Title:"Min",ReadOnly:!1,Value:null!=(null===(t=this.__options)||void 0===t?void 0:t.min)?this.__options.min:0}],["max",{DataType:this.__dataType,Title:"Max",ReadOnly:!1,Value:null!=(null===(a=this.__options)||void 0===a?void 0:a.max)?this.__options.max:0}]])};n.setData(s),i.append(n.getElement());let r={appearance:{content:i,headline:{textAttributes:{text:e.Locale.Localization.getSymbolExpression(e.Locale.LangKey.AxisConfiguration)}},modal:!0,buttons:e.Components.DialogWindow.Buttons.Cancel,layout:{height:180,width:350}},callbacks:{cbClosed:()=>{n.destroy()}}};e.Components.DialogWindow.openDialogWindow(r);let o=n.eventHandler.register(e.Navigation.ParameterList.ParameterListEvents.onEntryValueChanged,(t,a,i)=>{let n={};switch(this.__options&&(n=e.Helper.Object.clone(this.__options)),i.getId()){case a.getId()+"-auto-scale":let e=i.getValue();null!=e?n.autoScale=e:delete n.autoScale;break;case a.getId()+"-min":let t=i.getValue();null!=t?n.min=t:delete n.min;break;case a.getId()+"-max":let s=i.getValue();null!=s?n.max=s:delete n.max}this.setOptions(n),this.__options&&e.Server.UserData.saveAxisSettings(this.__id,this.__options)});n.eventHandler.register(e.Components.BaseNode.BaseNodeEvents.onDestroyed,e=>{e.destroy(),o()})}updateEchartsOption(){}resetToDefault(){this.echartsOption.show=!0,this.echartsOption.gridIndex=0,this.echartsOption.minInterval=1,this.echartsOption.axisLine||(this.echartsOption.axisLine={}),this.echartsOption.axisLine.show=!0,this.echartsOption.axisTick||(this.echartsOption.axisTick={}),this.echartsOption.axisTick.show=!0,this.echartsOption.axisLabel||(this.echartsOption.axisLabel={}),this.echartsOption.axisLabel.show=!0,this.echartsOption.splitLine||(this.echartsOption.splitLine={}),this.echartsOption.splitLine.show=!0,this.updateColors()}getAxisIndex(){return this instanceof i?this.__parent.getYAxes().findIndex(e=>e.getId()===this.__id):this instanceof n?this.__parent.getXAxes().findIndex(e=>e.getId()===this.__id):-1}getId(){return this.__id}getFormatter(){return t=>{var a;if("number"!=typeof t){if(null==!t.value)return"";t=t.value}switch(t instanceof Array&&(t=t[1]),this.__dataType){case e.DataType.number:if("number"!=typeof t)throw new Error("Data type of value should be number!");return this.__unit?t.toFixed(0)+this.__unit:t.toFixed(0);case e.DataType.dateTime:let i=new Date(t);return i.toLocaleTimeString()+"\n"+i.toLocaleDateString();case e.DataType.boolean:if("boolean"!=typeof(t=0!==t))throw new Error("Data type of value should be boolean!");return t?this.__activeText:this.__inactiveText;case e.DataType.enum:if("number"!=typeof t)throw new Error("Data type of value should be number!");return this.__stateTexts?null===(a=this.__stateTexts.find(e=>e.value===t))||void 0===a?void 0:a.text:t;default:return t.toFixed(2)}}}getRequiredSpace(){return this.__name?65:50}hide(){this.echartsOption.show&&(this.echartsOption.show=!1,this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged))}getIsHided(){return null!=this.echartsOption.show&&!this.echartsOption.show}show(){this.echartsOption.show||(this.echartsOption.show=!0,this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged))}updateColors(){this.echartsOption.axisLine||(this.echartsOption.axisLine={}),this.echartsOption.axisLine.lineStyle||(this.echartsOption.axisLine.lineStyle={}),this.echartsOption.axisLine.lineStyle.color=this.__color?this.__color.toString():this.__parent.getUsedColors().lines.toString(),this.echartsOption.axisPointer&&this.echartsOption.axisPointer.label&&this.echartsOption.axisPointer.label.show&&(this.echartsOption.axisPointer.label.backgroundColor=this.__color?this.__color.toString():this.__parent.getUsedColors().handles.toString())}addLinkedSeries(e){this.__linkedSeries||(this.__linkedSeries=[]),this.__linkedSeries.push(e)}removeLinkedSeries(e){if(!this.__linkedSeries)return!1;let t=this.__linkedSeries.length;return this.__linkedSeries=this.__linkedSeries.filter(t=>t.getId()!=e.getId()),t!=this.__linkedSeries.length||(console.warn("Removing link of series wasn not successfull because series wasn found.",{series:e,axis:this}),!1)}getLinkedSeries(){return this.__linkedSeries}setName(e){return null!=e&&"string"!=typeof e?(this.__logger.invalidAttribute("Name",e),this):tchmi_equal(this.__name,e)?(this.__logger.equalAttribute("Name"),this):(null==e&&(e=void 0),this.__name=e,this.__processName(),this)}__processName(){this.echartsOption.name=this.__name,this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getName(){return this.__name}setOptions(e){if(void 0===e||"object"!=typeof e)return this.__logger.invalidAttribute("Options",e),this;if(tchmi_equal(this.__options,e))return this.__logger.equalAttribute("Options"),this;if(null==e)this.__options=e;else for(let t in e)null==this.__options&&(this.__options={}),this.__options[t]=e[t];return this.__processOptions(),this}__processOptions(){this.__options&&(this.__options.autoScale?(delete this.echartsOption.min,delete this.echartsOption.max):(null!=this.__options.min&&(this.echartsOption.min=this.__options.min),null!=this.__options.max&&(this.echartsOption.max=this.__options.max)),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged))}getOptions(){return this.__options}setUnit(e){return null!=e&&"string"!=typeof e?(this.__logger.invalidAttribute("Unit",e),this):tchmi_equal(this.__unit,e)?(this.__logger.equalAttribute("Unit"),this):(null==e&&(e=void 0),this.__unit=e,this.__processUnit(),this)}__processUnit(){}getUnit(){return this.__unit}setColor(t){return null==t||t instanceof e.Color.RGBAColor?tchmi_equal(this.__color,t)?(this.__logger.equalAttribute("Color"),this):(null==t&&(t=void 0),this.__color=t,this.__processColor(),this):(this.__logger.invalidAttribute("Color",t),this)}__processColor(){this.updateColors(),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getColor(){return this.__color}setActiveText(e){return void 0===e||null!=e&&"string"!=typeof e?(this.__logger.invalidAttribute("ActiveText",e),this):e===this.__activeText?(this.__logger.equalAttribute("ActiveText"),this):(this.__activeText=e,this.__processActiveText(),this)}__processActiveText(){}getActiveText(){return this.__activeText}setInactiveText(e){return void 0===e||null!=e&&"string"!=typeof e?(this.__logger.invalidAttribute("InactiveText",e),this):e===this.__inactiveText?(this.__logger.equalAttribute("InactiveText"),this):(this.__inactiveText=e,this.__processInactiveText(),this)}__processInactiveText(){}getInactiveText(){return this.__inactiveText}setStateTexts(e){return void 0===e?(this.__logger.invalidAttribute("StateTexts",e),this):tchmi_equal(e,this.__stateTexts)?(this.__logger.equalAttribute("StateTexts"),this):(this.__stateTexts=e,this.__processStateTexts(),this)}__processStateTexts(){}getStateTexts(){return this.__stateTexts}}t.Axis=a;class i extends a{constructor(e,t){super(e,t),this.echartsOption.position="left",this.__parent.getEchart().on("click","yAxis",this.__axisClickedHandler)}resetToDefault(){var e;super.resetToDefault(),this.echartsOption.axisLabel||(this.echartsOption.axisLabel={}),this.echartsOption.axisLabel.margin=10,this.echartsOption.axisLabel.fontSize=null===(e=this.__parent.getEchartOption().textStyle)||void 0===e?void 0:e.fontSize,this.echartsOption.axisLabel.formatter=this.getFormatter()}setDataType(e){return null!=e&&"number"!=typeof e?(this.__logger.invalidAttribute("DataType",e),this):tchmi_equal(this.__dataType,e)?(this.__logger.equalAttribute("DataType"),this):(null==e&&(e=void 0),this.__dataType=e,this.__processDataType(),this)}__processDataType(){var a;this.echartsOption.axisLabel||(this.echartsOption.axisLabel={}),this.echartsOption.axisLabel.show=!0,this.echartsOption.axisTick||(this.echartsOption.axisTick={}),this.echartsOption.axisTick.show=!0,this.echartsOption.axisPointer||(this.echartsOption.axisPointer={}),this.echartsOption.axisPointer.snap=!0,this.echartsOption.axisPointer.label||(this.echartsOption.axisPointer.label={}),this.echartsOption.axisPointer.label.show=!0,this.echartsOption.axisPointer.label.formatter=this.getFormatter(),this.__dataType===e.DataType.boolean?(this.setOptions({min:0,max:1}),this.echartsOption.axisPointer.label.show=!1):null==(null===(a=this.__options)||void 0===a?void 0:a.autoScale)&&this.setOptions({autoScale:!0}),this.updateColors(),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getDataType(){return this.__dataType}__processName(){var e;super.__processName(),this.echartsOption.nameLocation="middle",this.echartsOption.nameGap=40,this.echartsOption.nameTextStyle||(this.echartsOption.nameTextStyle={}),this.echartsOption.nameTextStyle.fontSize=Number(null===(e=this.__parent.getEchartOption().textStyle)||void 0===e?void 0:e.fontSize)+3,this.echartsOption.nameTextStyle.fontWeight="bold",this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}__processUnit(){super.__processUnit();let e=this.__unit;null==e&&(e=""),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}}t.YAxis=i;class n extends a{constructor(e,t){super(e,t),this.__showAxisHandle=!1,this.__parent.getEchart().on("click","xAxis",this.__axisClickedHandler)}updateEchartsOption(){var e;if(super.updateEchartsOption(),this.__showAxisHandle&&this.echartsOption.axisPointer){let t=this.__parent.getEchartOption().xAxis;if(t instanceof Array){let a=null===(e=t[this.getAxisIndex()].axisPointer)||void 0===e?void 0:e.value;null!=a&&(this.echartsOption.axisPointer.value=a)}}}updateColors(){super.updateColors(),this.__showAxisHandle&&this.echartsOption.axisPointer&&(this.echartsOption.axisPointer.handle={color:this.__parent.getUsedColors().handles.toString()})}resetToDefault(){super.resetToDefault(),this.echartsOption.position="bottom",this.echartsOption.axisPointer||(this.echartsOption.axisPointer={}),this.echartsOption.axisPointer.snap=!0,this.echartsOption.axisPointer.label||(this.echartsOption.axisPointer.label={}),this.echartsOption.axisPointer.label.show=!0,this.echartsOption.axisPointer.label.formatter=this.getFormatter(),this.updateColors()}setDataType(e){return null!=e&&"number"!=typeof e?(this.__logger.invalidAttribute("DataType",e),this):tchmi_equal(this.__dataType,e)?(this.__logger.equalAttribute("DataType"),this):(null==e&&(e=void 0),this.__dataType=e,this.__processDataType(),this)}__processDataType(){this.__dataType===e.DataType.dateTime?this.echartsOption.type="time":this.echartsOption.type="value",this.__processUnit(),this.__processName()}getDataType(){return this.__dataType}setShowAxisHandle(e){return null!=e&&"boolean"!=typeof e?(this.__logger.invalidAttribute("ShowAxisHandle",e),this):tchmi_equal(this.__showAxisHandle,e)?(this.__logger.equalAttribute("ShowAxisHandle"),this):(null==e&&(e=!1),this.__showAxisHandle=e,this.__processShowAxisHandle(),this)}__processShowAxisHandle(){this.echartsOption.axisPointer||(this.echartsOption.axisPointer={}),this.__showAxisHandle?this.echartsOption.axisPointer.handle={show:!0,size:30,color:this.__parent.getUsedColors().handles.toString()}:this.echartsOption.axisPointer.handle={show:!1},this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getShowAxisHandle(){return this.__showAxisHandle}__processName(){super.__processName(),this.__dataType===e.DataType.dateTime&&(this.echartsOption.name=""),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}__processUnit(){var e;let a=this.__unit;null==a&&(a=""),this.echartsOption.axisLabel||(this.echartsOption.axisLabel={}),this.echartsOption.axisLabel.margin=10,this.echartsOption.axisLabel.fontSize=null===(e=this.__parent.getEchartOption().textStyle)||void 0===e?void 0:e.fontSize,this.echartsOption.axisLabel.formatter=this.getFormatter(),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}}t.XAxis=n}(t=e.Charting||(e.Charting={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(e){let t;!function(t){t.DotSize=3,t.DotSymbol="circle";class a{constructor(a,i,n){this.echartsOption={},this.__yAxis=null,this.__yAxisIndex=0,this.__xAxis=null,this.__xAxisIndex=0,this.__dataType={x:void 0,y:void 0},this.__baObject=null,this.__maxData={x:null,y:null},this.__minData={x:null,y:null},this.__isHided=!1,this.__seriesClickedHandler=e=>{if(e.seriesIndex===this.getSeriesIndex()&&console.log("[Test] Series clicked!",this,e),this.__data){let t=this.__data[e.dataIndex];t&&t.options&&t.options.onClicked&&t.options.onClicked(t)}},this.__id=a,this.__parent=i,this.logger=new e.Logger({name:this.__id}),this.echartsOption.id=a,this.__parent.getEchart().on("click","series",this.__seriesClickedHandler),n&&(n.name&&this.setName(n.name),n.data&&this.setData(n.data)),this.echartsOption.type="line",this.echartsOption.symbol=t.DotSymbol,this.echartsOption.symbolSize=t.DotSize,this.echartsOption.animation=!0,this.echartsOption.animationDuration=500,this.echartsOption.yAxisIndex=0,this.echartsOption.xAxisIndex=0,n&&(n.yAxis&&this.setYAxis(n.yAxis),n.xAxis&&this.setXAxis(n.xAxis),n.dataType&&this.setDataType(n.dataType),n.color&&this.setColor(n.color),n.baObject&&this.setBaObject(n.baObject))}__detectDataType(t,a){return t instanceof Date?e.DataType.dateTime:"number"==typeof t?a&&this.__dataType.y===e.DataType.enum?e.DataType.enum:e.DataType.number:"boolean"==typeof t?e.DataType.boolean:e.DataType.unknown}__validateData(e){if(e instanceof Array){let t=this.__detectDataType(e[0].x),a=this.__detectDataType(e[0].y,!0);for(let i=0;i<e.length;i++){let n=e[i].x;if(this.__detectDataType(n)!==t&&null!=e[i].x)return console.error("Data types of all x values of a series must be equal!"),!1;let s=e[i].y;if(this.__detectDataType(s,!0)!==a&&null!=e[i].y)return console.error("Data types of all y values of a series must be equal!"),!1}return!0}return!0}__validateAxis(a,i){if(a){let n=a.getDataType();if(n){if(i!=n)return this.logger.log(e.Logger.Severity.warn,`Data type '${e.DataType[n]}' of axis '${a.getId()}' does not match to '${e.DataType[i]}'!`,{axis:a,series:this}),!1}else a instanceof t.YAxis?i!==e.DataType.boolean&&i!==e.DataType.number||a.setDataType(i):i!==e.DataType.number&&i!==e.DataType.dateTime||a.setDataType(i)}return!0}updateEchartsOption(){}verify(){this.__errObj={series:this};let t=this.__data;if(!t||t.length<=0)return console.warn("Series does not contain any data!",this.__errObj),!1;if(!this.__errObj)throw new Error("Error object should be availiable here!");return this.__errObj.seriesDataType=this.__dataType,this.__errObj.yAxisIndex=this.__yAxisIndex,this.__errObj.yAxis=this.__parent.getYAxes()[this.__errObj.yAxisIndex],null==this.echartsOption.yAxisIndex||null==this.echartsOption.xAxisIndex?(console.error("YAxisIndex or xAxisIndex of echart option is not set!",this.__errObj),!1):this.__yAxisIndex!=this.echartsOption.yAxisIndex||this.__xAxisIndex!=this.echartsOption.xAxisIndex?(console.error("YAxisIndex or xAxisIndex of series and echart option are not equal!",this.__errObj),!1):this.__errObj.yAxis?(this.__errObj.yAxisDataType=this.__errObj.yAxis.getDataType(),null==this.__errObj.yAxisDataType||null==this.__errObj.seriesDataType.y||this.__errObj.yAxisDataType===this.__errObj.seriesDataType.y||(console.error(`Invalid series! Y data types are different! ${e.DataType[this.__errObj.yAxisDataType]} != ${e.DataType[this.__errObj.seriesDataType.y]}`,this.__errObj),!1)):(console.error(`Invalid series! YAxis with id ${this.__errObj.yAxisIndex} does not exist!`,this.__errObj),!1)}getSeriesIndex(){return this.__parent.getSeries().findIndex(e=>e.getId()===this.__id)}getId(){return this.__id}getMaxData(){return this.__maxData}getMinData(){return this.__minData}addData(e){if(!(e instanceof Array||a.isSeriesLineData(e)))return this.logger.invalidAttribute("Data",e),this;if(null!=e&&e instanceof Array)for(let t=0;t<e.length;t++)if(!a.isSeriesLineData(e[t]))return this.logger.invalidAttribute("Data",e[t]),this;if(this.__data){let t=JSON.parse(JSON.stringify(this.__data));t.forEach(e=>{"string"==typeof e.x&&(e.x=new Date(e.x))}),e instanceof Array?t=t.concat(e):t.push(e),this.__validateData(t)&&this.setData(t)}else this.setData(e);return this}hide(){this.__isHided||(this.__isHided=!0,this.echartsOption.data=[],this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged))}show(){this.__isHided&&(this.__isHided=!1,this.__processData())}getIsHided(){return this.__isHided}setName(e){return null!=e&&"string"!=typeof e?(this.logger.invalidAttribute("Name",e),this):tchmi_equal(this.__name,e)?(this.logger.equalAttribute("Name"),this):(null==e&&(e=void 0),this.__name=e,this.__processName(),this)}__processName(){this.echartsOption.name=this.__name,this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getName(){return this.__name}setData(e){if(!(null==e||e instanceof Array||a.isSeriesLineData(e)))return this.logger.invalidAttribute("Data",e),this;if(null!=e&&e instanceof Array)for(let t=0;t<e.length;t++)if(!a.isSeriesLineData(e[t]))return this.logger.invalidAttribute("Data",e[t]),this;return tchmi_equal(this.__data,e)?(this.logger.equalAttribute("Data"),this):(null==e&&(e=void 0),e instanceof Array||void 0===e?this.__data=e:(this.__data=[],this.__data.push(e)),this.__processData(),this)}__processData(){var a,i;if(this.__data&&this.__data.length>0){let t=null!=this.__dataType.x?this.__dataType.x:void 0,n=null!=this.__dataType.y?this.__dataType.y:void 0,s=[];this.__maxData={x:null,y:null},this.__minData={x:null,y:null};for(let r=0;r<this.__data.length;r++){let o={},l=this.__data[r].x;if(null!=l){if(void 0===t&&(t=this.__detectDataType(l)),this.__detectDataType(l)!==t&&null!=this.__data[r].x)return void console.error("Data types of all x values of a series must be equal!");l instanceof Date&&((null==this.__maxData.x||this.__maxData.x<l)&&(this.__maxData.x=l),(null==this.__minData.x||this.__minData.x>l)&&(this.__minData.x=l),l=l.toISOString())}let d=this.__data[r].y;if(null!=d){if(void 0===n&&(n=this.__detectDataType(d,!0)),this.__detectDataType(d,!0)!==n)return void console.error("Data types of all y values of a series must be equal!");(null==this.__maxData.y||this.__maxData.y<d)&&(this.__maxData.y=d),(null==this.__minData.y||this.__minData.y>d)&&(this.__minData.y=d),n===e.DataType.boolean&&(d=d?1:0)}let _=this.__data[r].options;_&&(o.symbol=_.symbol,o.symbolSize=_.symbolSize,o.symbolRotate=_.symbolRotate,o.itemStyle||(o.itemStyle={}),o.itemStyle.color=null===(a=_.symbolColor)||void 0===a?void 0:a.toString(),o.name=_.name,o.label||(o.label={}),o.label.show=null===(i=_.label)||void 0===i?void 0:i.show,o.label.formatter="{b}"),o.value=[l,d],s.push(o)}if(void 0!==t&&void 0!==this.__xAxisIndex&&!this.__validateAxis(this.__parent.getXAxes()[this.__xAxisIndex],t))return;if(this.__isHided||(this.echartsOption.data=s),this.__dataType.x=t,this.__dataType.y=n,void 0!==n&&void 0!==this.__yAxisIndex&&!this.__validateAxis(this.__parent.getYAxes()[this.__yAxisIndex],n))return}else this.echartsOption.data=[];switch(this.__dataType.y){case e.DataType.boolean:case e.DataType.enum:this.echartsOption.step="start";break;default:delete this.echartsOption.step}this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getData(){return this.__data}setYAxis(e){var a;return void 0!==e&&(null==e||e instanceof t.YAxis)?(null!=this.__yAxis&&this.__yAxis.removeLinkedSeries(this),this.__yAxis=e,null===(a=this.__yAxis)||void 0===a||a.addLinkedSeries(this),this.__yAxis?this.__yAxisIndex=this.__yAxis.getAxisIndex():this.__yAxisIndex=0,this.__processYAxis(),this):(this.logger.invalidAttribute("YAxis",e),this)}__processYAxis(){if(this.echartsOption.yAxisIndex=this.__yAxisIndex,null!=this.__yAxisIndex&&this.__dataType.y){let e=this.__parent.getYAxes()[this.__yAxisIndex];this.__validateAxis(e,this.__dataType.y),this.echartsOption.tooltip||(this.echartsOption.tooltip={}),this.echartsOption.tooltip.formatter=e.getFormatter()}this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getYAxis(){return this.__yAxis}getYAxisIndex(){return this.__yAxisIndex}setXAxis(e){var a;return void 0!==e&&(null==e||e instanceof t.XAxis)?(null!=this.__xAxis&&this.__xAxis.removeLinkedSeries(this),this.__xAxis=e,null===(a=this.__xAxis)||void 0===a||a.addLinkedSeries(this),this.__xAxis?this.__xAxisIndex=this.__xAxis.getAxisIndex():this.__xAxisIndex=0,this.__processXAxis(),this):(this.logger.invalidAttribute("XAxis",e),this)}__processXAxis(){if(this.echartsOption.xAxisIndex=this.__xAxisIndex,null!=this.__xAxisIndex&&this.__dataType.x){let e=this.__parent.getXAxes()[this.__xAxisIndex];this.__validateAxis(e,this.__dataType.x)}this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getXAxis(){return this.__xAxis}getXAxisIndex(){return this.__xAxisIndex}setDataType(e){return null!=this.__dataType.x&&null!=this.__dataType.y&&console.error(`DataType of series ${this.__id} has already been set!`),this.__dataType=e,this}getDataType(){return this.__dataType}setColor(t){return null==t||t instanceof e.Color.RGBAColor?tchmi_equal(this.__color,t)?(this.logger.equalAttribute("Color"),this):(null==t&&(t=void 0),this.__color=t,this.__processColor(),this):(this.logger.invalidAttribute("Color",t),this)}__processColor(){var e,a;this.echartsOption.lineStyle||(this.echartsOption.lineStyle={}),this.echartsOption.lineStyle.color=null===(e=this.__color)||void 0===e?void 0:e.toString(),this.echartsOption.itemStyle||(this.echartsOption.itemStyle={}),this.echartsOption.itemStyle.color=null===(a=this.__color)||void 0===a?void 0:a.toString(),this.__parent.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged)}getColor(){return this.__color}setBaObject(t){return null==t||t instanceof e.BA.BaBasicObject?tchmi_equal(this.__color,t)?(this.logger.equalAttribute("BaObject"),this):(null==t?void 0:t.getIsValid())?(this.__baObject=t,this.__processBaObject(),this):this:(this.logger.invalidAttribute("BaObject",t),this)}__processBaObject(){}getBaObject(){return this.__baObject}}t.SeriesLine=a,function(t){t.isSeriesLineData=function(t){let a=!0;if(null!=t&&"object"==typeof t){let i=new Map;i.set("x",["number",()=>t.x instanceof Date]),i.set("y",["number","boolean",null]),e.TypeGuards.validateProperties(t,i)||(a=!1)}else a=!1;return a}}(a=t.SeriesLine||(t.SeriesLine={}))}(t=e.Charting||(e.Charting={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let a;!function(a){class i extends t.Components.Base{constructor(a,i){super(a,i),this.__showDataZoom=!1,this.__showXAxisHandle=!1,this.__echartsContainer=$("<div>").addClass("echarts-container"),this.__xAxes=[],this.__yAxes=[],this.__series=[],this.__usedColors={text:t.Color.RGBAColor.TcHmiBlue,handles:t.Color.RGBAColor.TcHmiBlue,lines:t.Color.RGBAColor.TcHmiBlue},this.__themeDataChangedHandler=()=>{switch(e.Theme.get()){case"Base":this.__usedColors={text:t.Color.RGBAColor.TcHmiBlue,handles:t.Color.RGBAColor.TcHmiBlue,lines:t.Color.RGBAColor.TcHmiBlue};break;case"Base-Dark":this.__usedColors={text:new t.Color.RGBAColor({r:255,g:255,b:255,a:1}),handles:new t.Color.RGBAColor({r:50,g:50,b:50,a:1}),lines:new t.Color.RGBAColor({r:255,g:255,b:255,a:1})}}this.__updateColors()},this.__autoDrawEnabled=!0,this.__minSpaceGrid=35,this.__spaceDataZoomSliderX={bottom:60,side:85},this.__spaceXAxisHandle=30,this.__element.addClass("chart"),this.__themeDataChangeDF=e.EventProvider.register("onThemeDataChanged",this.__themeDataChangedHandler),this.__themeDataChangedHandler(),this.__element.append(this.__echartsContainer),this.__echart=echarts.init(this.__echartsContainer[0]),this.__echart.setOption({});let n=this.__echart.getOption();n.toolbox={orient:"horizontal",left:"right",top:"top",itemSize:25,itemGap:10,feature:{restore:{title:" ",show:!1},saveAsImage:{title:" ",show:!1}}},n.tooltip={trigger:"item",axisPointer:{type:"cross",snap:!0}},n.grid={top:20,right:this.__minSpaceGrid,bottom:this.__minSpaceGrid,left:this.__minSpaceGrid},this.__echart.setOption(n),this.resizeHandler=new t.Components.ResizeHandler(this,this.__echartsContainer)}__attach(){this.__isAttached||(super.__attach(),this.onResized(),this.__destroyersToCallOnDetach.push(this.eventHandler.register(i.ChartEvents.onOptionsChanged,()=>{this.__collectChangesTimeoutId||(this.__collectChangesTimeoutId=setTimeout(()=>{clearTimeout(this.__collectChangesTimeoutId),delete this.__collectChangesTimeoutId,this.__updateEchartsOption()},50))})),this.eventHandler.raise(i.ChartEvents.onOptionsChanged))}__detach(){super.__detach()}destroy(){this.__themeDataChangeDF&&this.__themeDataChangeDF(),this.resizeHandler.destroy(),super.destroy()}onResized(){this.__echart.resize({width:this.__echartsContainer.width(),height:this.__echartsContainer.height()})}__onSeriesAdded(e){}__onSeriesRemoved(e){}__updateEchartsOption(){var e;if(!this.__autoDrawEnabled)return;if(this.busyHandler.getIsBusy())return;if(this.__xAxes.length<=0||this.__yAxes.length<=0)return;let a=this.__echart.getOption();if(a.textStyle||(a.textStyle={}),a.textStyle.color=this.__usedColors.text.toString(),a.axisPointer instanceof Array){let e=a.axisPointer[0];e||(e={}),e.handle||(e.handle={}),e.handle.color=this.__usedColors.handles.toString(),a.axisPointer[0]=e}else this.logger.log(t.Logger.Severity.warn,"Check axisPointer in echart options. Should be an array");a.xAxis=[];for(let e of this.__xAxes.values())e.updateEchartsOption(),a.xAxis.push(e.echartsOption);a.yAxis=[];for(let e of this.__yAxes.values())e.updateEchartsOption(),a.yAxis.push(e.echartsOption);a.series=[];for(let e of this.__series.values())e.verify()&&(e.updateEchartsOption(),a.series.push(e.echartsOption));a.dataZoom||(a.dataZoom=[]);let i=[];for(let e=0;e<this.__xAxes.length;e++)i.push(e);a.dataZoom[0]={type:"slider",xAxisIndex:i,bottom:25,show:this.__showDataZoom,handleSize:"80%",handleIcon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",handleStyle:{color:this.__usedColors.handles.toString(),shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2},moveHandleSize:20,moveHandleStyle:{color:this.__usedColors.lines.toString()},textStyle:{color:this.__usedColors.text.toString()},labelFormatter:null===(e=this.__xAxes[0])||void 0===e?void 0:e.getFormatter(),start:a.dataZoom[0]?a.dataZoom[0].start:void 0,end:a.dataZoom[0]?a.dataZoom[0].end:void 0},a.dataZoom[1]={type:"inside",xAxisIndex:i,start:a.dataZoom[1]?a.dataZoom[1].start:void 0,end:a.dataZoom[1]?a.dataZoom[1].end:void 0},this.__echart.setOption(a,!0)}__setGrid(e,t){let a=this.__echart.getOption();if(a.grid instanceof Array){a.grid[t]||(a.grid[t]={});for(let i in e)null!=e[i]&&(a.grid[t][i]=e[i])}this.__echart.setOption(a)}__updateColors(){for(let e of this.__xAxes.values())e.updateColors();for(let e of this.__yAxes.values())e.updateColors();this.eventHandler.raise(i.ChartEvents.onOptionsChanged)}addYAxis(e){if(e){for(let a=0;a<this.__yAxes.length;a++)if(e&&this.__yAxes[a].getId()===e)return void this.logger.log(t.Logger.Severity.error,`A YAxis with id ${e} was already added to chart ${this.__id}!`)}else{let t=0;for(e=this.__id+"-y-axis-"+t;this.__yAxes.findIndex(t=>t.getId()===e)>-1;)t++,e=this.__id+"-y-axis-"+t}let i=new a.YAxis(e,this);return this.__yAxes.push(i),setTimeout(()=>{this.__processShowDataZoom()},100),this.updateGrid(),i}removeYAxis(e){let i;if(e instanceof a.YAxis?(i=e,e=e.getId()):i=this.getYAxis(e),!i)return this.logger.log(t.Logger.Severity.warn,`Removing YAxis with id ${e} failed, because YAxis was not found in YAxis collection of chart ${this.__id}!`),!1;let n=[];for(let e=0;e<this.__series.length;e++){let a=this.__series[e];if(a.getYAxisIndex()===(null==i?void 0:i.getAxisIndex()))return this.logger.log(t.Logger.Severity.warn,"Cannot remove y axis because it is used by a data series!",{usingSeries:a,yAxis:i}),!1;a.getYAxisIndex()>i.getAxisIndex()&&n.push(a)}this.__yAxes=this.__yAxes.filter(t=>t.getId()!==e);for(let e=0;e<n.length;e++){let a=n[e],s=a.getYAxisIndex()-1;s<0?this.logger.log(t.Logger.Severity.warn,"Invalid axis was set",{newYAxisIndex:s,series:a,removedYAxis:i}):a.setYAxis(this.__yAxes[s])}return this.updateGrid(),!0}addXAxis(e){e||(e=this.__id+"-x-axis-"+this.__xAxes.length);for(let a=0;a<this.__xAxes.length;a++)if(this.__xAxes[a].getId()===e)return void this.logger.log(t.Logger.Severity.error,`A XAxis with id ${e} was already added to chart ${this.__id}!`);let i=new a.XAxis(e,this);return this.__xAxes.push(i),this.updateGrid(),i}removeXAxis(e){e instanceof a.XAxis&&(e=e.getId());let n=this.__xAxes.length;return this.__xAxes=this.__xAxes.filter(t=>t.getId()!==e),this.eventHandler.raise(i.ChartEvents.onOptionsChanged),n!==this.__xAxes.length||(this.logger.log(t.Logger.Severity.warn,`Removing XAxis with id ${e} failed, because XAxis was not found in XAxis collection of chart ${this.__id}!`),!1)}addSeriesLine(e,i){e||(e=this.__id+"-series-"+this.__series.length);for(let a=0;a<this.__series.length;a++)if(this.__series[a].getId()===e)return void this.logger.log(t.Logger.Severity.warn,`A SeriesLine with id ${e} was already added to chart ${this.__id}!`);let n=new a.SeriesLine(e,this,i);return this.__series.push(n),this.__onSeriesAdded(n),n}removeSeriesLine(e){let n;return n=e instanceof a.SeriesLine?e:this.__series.find(t=>t.getId()===e),n?(this.__series=this.__series.filter(e=>e.getId()!==(null==n?void 0:n.getId())),this.eventHandler.raise(i.ChartEvents.onOptionsChanged),this.__onSeriesRemoved(n),!0):(this.logger.log(t.Logger.Severity.warn,`Removing series with id ${e} failed, because series was not found in series collection of chart ${this.__id}!`),!1)}removeAllSeriesLine(){this.__series.forEach(e=>this.removeSeriesLine(e))}enableAutoDraw(e=!0){this.__autoDrawEnabled=e,this.eventHandler.raise(i.ChartEvents.onOptionsChanged)}updateGrid(){let e=0,t=0,a=0,n={};for(let i of this.__yAxes.values())if(0!==i.echartsOption.gridIndex)i.echartsOption.offset=0;else if(!i.getIsHided()){let n=i.echartsOption.position;switch(e="left"===n?t:a,i.echartsOption.offset=e,n){case"right":a+=i.getRequiredSpace();break;default:t+=i.getRequiredSpace()}}n.left=t>0?t:this.__minSpaceGrid,n.right=a>0?a:this.__minSpaceGrid,n.bottom=this.__minSpaceGrid,this.__showDataZoom&&(n.bottom=n.bottom+this.__spaceDataZoomSliderX.bottom,n.left<this.__spaceDataZoomSliderX.side&&(n.left=this.__spaceDataZoomSliderX.side),n.right<this.__spaceDataZoomSliderX.side&&(n.right=this.__spaceDataZoomSliderX.side)),this.__showXAxisHandle&&(n.bottom=n.bottom+this.__spaceXAxisHandle),this.__setGrid(n,0),this.eventHandler.raise(i.ChartEvents.onOptionsChanged)}getEchart(){return this.__echart}setEchartOption(e){return this.__echart.setOption(e),this}getEchartOption(){return this.__echart.getOption()}getYAxes(){return this.__yAxes}getYAxis(e){return this.__yAxes.find(t=>t.getId()===e)}getXAxes(){return this.__xAxes}getSeries(){return this.__series}getSpecificSeries(e){for(let t=0;t<this.__series.length;t++)if(this.__series[t].getId()===e)return this.__series[t]}restore(){this.__echart.dispatchAction({type:"restore"})}getUsedColors(){return this.__usedColors}setShowDataZoom(e){return void 0===e||null!=e&&"boolean"!=typeof e?(this.logger.invalidAttribute("ShowDataZoom",e),this):tchmi_equal(this.__showDataZoom,e)?(this.logger.equalAttribute("ShowDataZoom"),this):(null==e&&(e=!1),this.__showDataZoom=e,this.__yAxes.length>0&&this.__processShowDataZoom(),this)}__processShowDataZoom(){this.updateGrid(),this.eventHandler.raise(i.ChartEvents.onOptionsChanged)}getShowDataZoom(){return this.__showDataZoom}setShowXAxisHandle(e){return void 0===e||null!=e&&"boolean"!=typeof e?(this.logger.invalidAttribute("ShowXAxisHandle",e),this):tchmi_equal(this.__showXAxisHandle,e)?(this.logger.equalAttribute("ShowXAxisHandle"),this):(null==e&&(e=!1),this.__showXAxisHandle=e,this.__processShowXAxisHandle(),this)}__processShowXAxisHandle(){var e;null===(e=this.__xAxes[0])||void 0===e||e.setShowAxisHandle(this.__showXAxisHandle),this.updateGrid()}getShowXAxisHandle(){return this.__showXAxisHandle}}a.Chart=i,function(e){let t;!function(e){e.onOptionsChanged="onOptionsChanged"}(t=e.ChartEvents||(e.ChartEvents={}))}(i=a.Chart||(a.Chart={}))}(a=t.Charting||(t.Charting={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(e){let t;!function(t){class a extends t.Chart{constructor(t,a){super(t,a),this.__showHandleButtonChangedHandler=e=>{this.setShowXAxisHandle(e),this.__contextMenu.close()},this.__showDataZoomButtonChangedHandler=e=>{this.setShowDataZoom(e),this.__contextMenu.close()},this.__restoreButtonPressedHandler=()=>{this.restore(),this.__contextMenu.close()},this.__element.addClass("line-chart"),this.addXAxis(this.__id+"-x-axis-0"),this.addYAxis(this.__id+"-y-axis-0");let i=[{name:"x-axis-handle",controls:{type:e.Components.ComponentType.Checkbox,callback:this.__showHandleButtonChangedHandler,name:"checkbox",settings:{textAttributes:{horizontalAlignment:"Center"},readOnly:!1}}},{name:"x-axis-data-zoom",controls:{type:e.Components.ComponentType.Checkbox,callback:this.__showDataZoomButtonChangedHandler,name:"checkbox",settings:{textAttributes:{horizontalAlignment:"Center"},readOnly:!1}}},{onPressed:this.__restoreButtonPressedHandler,cbOnCreated:t=>{this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.Restore,a=>{this.logger.checkServerResult(e.Logger.Severity.warn,a)&&t.textHandler.setText(a.text)}))}}],n=e.Components.ContextMenu.createContextMenuAndButton({id:this.__id,parent:this,rowEntryOptions:i});this.__contextMenu=n.menu,this.__menuButton=n.button,this.__menuButton.getElement().addClass("line-chart-menu-button"),this.__element.append(this.__menuButton.getElement()),this.__contextMenu.getElement().addClass("line-chart-context-menu"),this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.Cursor,t=>{var a,i,n,s;this.logger.checkServerResult(e.Logger.Severity.warn,t)&&(null===(i=null===(a=this.__contextMenu.getRowEntry("x-axis-handle"))||void 0===a?void 0:a.controlContainer.getControl("checkbox"))||void 0===i||i.setActiveText(t.text),null===(s=null===(n=this.__contextMenu.getRowEntry("x-axis-handle"))||void 0===n?void 0:n.controlContainer.getControl("checkbox"))||void 0===s||s.setInactiveText(t.text))})),this.__destroyersToCallOnDestroy.push(e.Locale.Localization.watchText(e.Locale.LangKey.DataZoom,t=>{var a,i,n,s;this.logger.checkServerResult(e.Logger.Severity.warn,t)&&(null===(i=null===(a=this.__contextMenu.getRowEntry("x-axis-data-zoom"))||void 0===a?void 0:a.controlContainer.getControl("checkbox"))||void 0===i||i.setActiveText(t.text),null===(s=null===(n=this.__contextMenu.getRowEntry("x-axis-data-zoom"))||void 0===n?void 0:n.controlContainer.getControl("checkbox"))||void 0===s||s.setInactiveText(t.text))})),this.setShowDataZoom(!0)}__attach(){this.__isAttached||super.__attach()}__detach(){super.__detach()}destroy(){super.destroy(),this.__contextMenu.destroy()}__updateColors(){var e,t,a,i;for(let a of this.__xAxes.values())(null===(t=null===(e=a.echartsOption.splitLine)||void 0===e?void 0:e.lineStyle)||void 0===t?void 0:t.color)&&(a.echartsOption.splitLine.lineStyle.color=this.__usedColors.lines.toString());for(let e of this.__yAxes.values())(null===(i=null===(a=e.echartsOption.splitLine)||void 0===a?void 0:a.lineStyle)||void 0===i?void 0:i.color)&&(e.echartsOption.splitLine.lineStyle.color=this.__usedColors.lines.toString());super.__updateColors()}addYAxis(e){let a=super.addYAxis(e);if(a)return a.echartsOption.splitLine={lineStyle:{color:this.__usedColors.lines.toString(),type:"dotted"}},this.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged),a}addXAxis(e){let a=super.addXAxis(e);if(a)return a.echartsOption.splitLine={lineStyle:{color:this.__usedColors.lines.toString(),type:"dotted"}},this.eventHandler.raise(t.Chart.ChartEvents.onOptionsChanged),a}removeAllSeriesLine(){super.removeAllSeriesLine(),this.__xAxes.forEach(e=>this.removeXAxis(e)),this.__yAxes.forEach(e=>this.removeYAxis(e)),this.addXAxis(this.__id+"-x-axis-0"),this.addYAxis(this.__id+"-y-axis-0")}updateGrid(){super.updateGrid();let e=!1;for(let t=0;t<this.__yAxes.length;t++)"right"===this.__yAxes[t].echartsOption.position&&(e=!0);e?this.__element.addClass("has-right-axis"):this.__element.removeClass("has-right-axis"),this.onResized()}getMaxData(){let e,t,a={x:null,y:null};return this.__series.forEach(i=>{e=i.getMaxData().x,(null==a.x||null!=e&&a.x<e)&&(a.x=e),t=i.getMaxData().y,(null==a.y||null!=t&&a.y<t)&&(a.y=t)}),a}getMinData(){let e,t,a={x:null,y:null};return this.__series.forEach(i=>{e=i.getMinData().x,(null==a.x||null!=e&&a.x>e)&&(a.x=e),t=i.getMinData().y,(null==a.y||null!=t&&a.y>t)&&(a.y=t)}),a}getMenuButton(){return this.__menuButton}getContextMenu(){return this.__contextMenu}__processShowDataZoom(){var e;super.__processShowDataZoom();let t=null===(e=this.__contextMenu.getRowEntry("x-axis-data-zoom"))||void 0===e?void 0:e.controlContainer.getControl("checkbox");null==t||t.setState(this.__showDataZoom)}__processShowXAxisHandle(){var e;super.__processShowXAxisHandle();let t=null===(e=this.__contextMenu.getRowEntry("x-axis-handle"))||void 0===e?void 0:e.controlContainer.getControl("checkbox");null==t||t.setState(this.__showXAxisHandle)}}t.LineChart=a}(t=e.Charting||(e.Charting={}))}(t=e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));var TcHmi;__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function r(e){try{l(i.next(e))}catch(e){s(e)}}function o(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};!function(e){!function(t){let a,i;!function(a){class n extends a.LineChart{constructor(e,a){super(e,a),this.__settings=null,this.__seriesSelectorsContainer=$("<div>").addClass("series-selectors-container"),this.__seriesSelectors=new t.Navigation.ControlList(this.__id+"-series-selectors",this),this.__openSeriesSelectorsTB=new t.Components.ToggleButton(this.__id+"-open-series-selector-button",this),this.__binaryGridHeight=30,this.__openSeriesSelectorTBChangedHandler=()=>{this.__openSeriesSelectorsTB.getToggleState()?(this.__element.append(this.__seriesSelectorsContainer),this.__seriesSelectorsContainer.animate({width:"30%"},200),this.__contextMenu.close(),this.__openSeriesSelectorsTB.backgroundStyler.setImage(t.Icons.Standard.Right.path,!0)):(this.__seriesSelectorsContainer.animate({width:0},200,()=>{this.__seriesSelectorsContainer.detach()}),this.__openSeriesSelectorsTB.backgroundStyler.setImage(t.Icons.Standard.Left.path,!0))},this.__updateButtonPressedHandler=()=>{if(this.baObjectHandler.baObject)if(this.baObjectHandler.baObject instanceof i.BaView){this.baObjectHandler.baObject.getBaTrendObjects().forEach(e=>{this.__updateBaTrend(e,this.__autoUpdateBaTrend)})}else this.__updateBaTrend(this.baObjectHandler.baObject,this.__autoUpdateBaTrend);else this.__series.forEach(e=>{let t=e.getBaObject();t&&this.__updateBaTrend(t,this.__autoUpdateBaTrend)});this.__contextMenu.close()},this.__autoUpdateCbChangedHandler=e=>{this.__autoUpdateBaTrend=e,this.__settings||(this.__settings={}),this.__settings.autoUpdate=this.__autoUpdateBaTrend,this.__saveSettings(),this.__updateButtonPressedHandler()},this.baObjectHandler=new t.BaObjectHandler(this),this.__element.addClass("trend");let n=$("<div>").addClass("content-container");n.append(this.__echartsContainer,this.__menuButton.getElement()),this.__element.append(n),this.__loadSettings(),this.__seriesSelectorsContainer.append(this.__seriesSelectors.getElement());let s={Title:"All series",controls:[{type:t.Components.ComponentType.Checkbox,name:"visibility-checkbox",settings:{state:!0,readOnly:!1,layout:{maxWidth:25}},callback:e=>{this.__onSeriesVisibilityChanged(this.__id+"-select-all-series-selector",e)}}]};this.__seriesSelectors.addEntry(this.__id+"-select-all-series-selector",s),this.__openSeriesSelectorsTB.getElement().addClass("open-series-selectors-button"),this.__openSeriesSelectorsTB.backgroundStyler.setImageWidth(80,"%").setImageHeight(80,"%"),this.__openSeriesSelectorsTB.backgroundStyler.setImage(t.Icons.Standard.Left.path,!0),this.__xAxes[0].setDataType(t.DataType.dateTime);let r=this.__echart.getOption();r.axisPointer instanceof Array&&(r.axisPointer[0].link||(r.axisPointer[0].link=[]),r.axisPointer[0].link.push({xAxisIndex:"all"}),this.__echart.setOption(r)),this.__autoDrawEnabled=!1}__attach(){this.__isAttached||(this.__destroyersToCallOnDetach.push(this.__openSeriesSelectorsTB.eventHandler.register(t.Components.ToggleButton.ToggleButtonEvents.onToggleStateChanged,this.__openSeriesSelectorTBChangedHandler)),super.__attach())}__detach(){super.__detach()}destroy(){var e,t;if(super.destroy(),this.__openSeriesSelectorsTB.destroy(),this.__seriesSelectors.destroy(),this.__baTrendWatchIds)for(let[a,n]of this.__baTrendWatchIds){let s=null===(t=null===(e=i.BaDevices)||void 0===e?void 0:e.get(a.deviceName))||void 0===t?void 0:t.findBaObject(a.instancePath);s&&s.stopWatchBaVariable(n)}if(this.__baDescriptionWatchIds)for(let[e,t]of this.__baDescriptionWatchIds)null!=t.id&&t.object.stopWatchBaVariable(t.id)}__onSeriesAdded(e){var a;if(super.__onSeriesAdded(e),!this.__seriesSelectors.getEntries().has(e.getId())){let a=e.getBaObject();if(a){let s={controls:[{type:t.Components.ComponentType.Button,name:"open-parameter-window-button",settings:{background:{image:t.Icons.Standard.MenuBurger.path,imageHeight:60,imageHeightUnit:"%",imageWidth:60,imageWidthUnit:"%"},layout:{maxWidth:25}},callback:()=>{null==a||a.tryReadBaVariable(i.BaParameterId.eReferencedParam).then(e=>{var t;switch(null===(t=this.__settings)||void 0===t?void 0:t.displayedObjects){case n.DisplayedObjects.trendObjects:null==e||e.OwnerObject.openParameterDialog("Parameter");break;default:null==e||e.ReferenceObject.openParameterDialog("Parameter")}})}},{type:t.Components.ComponentType.Checkbox,name:"visibility-checkbox",settings:{state:!0,readOnly:!1,layout:{maxWidth:25}},callback:t=>{this.__onSeriesVisibilityChanged(e.getId(),t)}}]};this.__seriesSelectors.addEntry(e.getId(),s).backgroundStyler.setColor(e.getColor())}else{let a={Title:e.getName(),controls:[{type:t.Components.ComponentType.Checkbox,name:"visibility-checkbox",settings:{state:!0,readOnly:!1,layout:{maxWidth:25}},callback:t=>{this.__onSeriesVisibilityChanged(e.getId(),t)}}]};this.__seriesSelectors.addEntry(e.getId(),a).backgroundStyler.setColor(e.getColor())}}if(this.__series.length>1){this.__openSeriesSelectorsTB.getIsAttached()||this.__element.children(".content-container").append(this.__openSeriesSelectorsTB.getElement());for(let e=0;e<this.__series.length;e++)if(null!=this.__series[e].getBaObject()){this.__contextMenu.getRowEntry("select-displayed-object")||(this.__contextMenu.addRowEntry([{name:"select-displayed-object",controls:{type:t.Components.ComponentType.Combobox,name:"select-displayed-object-combobox",settings:{data:[{text:"Ref Object",value:n.DisplayedObjects.trendableObjects},{text:"Trend",value:n.DisplayedObjects.trendObjects}],readOnly:!1},callback:e=>{this.__selectDisplayedObject(e),this.__contextMenu.close()}}},{name:"select-displayed-description",controls:{type:t.Components.ComponentType.Combobox,name:"select-displayed-description-combobox",settings:{data:[{text:"InstDescription",value:i.BaParameterId.eInstDescription},{text:"Description",value:i.BaParameterId.eDescription},{text:"SymbolPath",value:i.BaParameterId.eSymbolPath},{text:"ObjectName",value:i.BaParameterId.eObjectName},{text:"InstObjectName",value:i.BaParameterId.eInstObjectName}],readOnly:!1},callback:e=>{this.__selectDisplayedDescription(e),this.__contextMenu.close()}}}]),this.__contextMenu.layoutHandler.setWidth(120)),this.__selectDisplayedObject(null===(a=this.__settings)||void 0===a?void 0:a.displayedObjects);break}this.__loadSettings()}else this.__openSeriesSelectorsTB.getElement().detach()}__onSeriesRemoved(e){super.__onSeriesRemoved(e),this.__seriesSelectors.getEntries().has(e.getId())&&this.__seriesSelectors.removeEntry(e.getId())}__onSeriesVisibilityChanged(e,a){var i,n;if(e===this.__id+"-select-all-series-selector"){let s;null==this.__settings&&(this.__settings={}),null==this.__settings.hiddenSeries&&(this.__settings.hiddenSeries=[]);for(let[r,o]of this.__seriesSelectors.getEntries())if(o instanceof t.Navigation.ControlList.ControlListEntry&&o.getId()!=e){if(s=this.__series.find(e=>e.getId()===o.getId()),null===(i=o.controlContainer.getControl("visibility-checkbox"))||void 0===i||i.setState(a),!s)continue;this.__toggleSeriesVisibility(s,!0===a),!1===a&&(null===(n=this.__settings.hiddenSeries)||void 0===n||n.push(s.getId()))}this.__saveSettings()}else{let t=this.__series.find(t=>t.getId()===e);t&&(this.__toggleSeriesVisibility(t,!0===a),null!=this.__settings&&(null==this.__settings.hiddenSeries&&(this.__settings.hiddenSeries=[]),!1===a?this.__settings.hiddenSeries.push(t.getId()):this.__settings.hiddenSeries=this.__settings.hiddenSeries.filter(e=>e!==t.getId()),this.__saveSettings()))}}__loadSettings(){var e,a,i,n;return __awaiter(this,void 0,void 0,(function*(){var s=yield t.Server.UserData.loadTrendSettings(this.__id);this.__settings=s,null===(a=null===(e=this.__contextMenu.getRowEntry("auto-update"))||void 0===e?void 0:e.controlContainer.getControl("auto-update-checkbox"))||void 0===a||a.setState(null===(i=this.__settings)||void 0===i?void 0:i.autoUpdate),null!=(null===(n=this.__settings)||void 0===n?void 0:n.hiddenSeries)&&this.__series.forEach(e=>{var t,a;(null===(a=null===(t=this.__settings)||void 0===t?void 0:t.hiddenSeries)||void 0===a?void 0:a.find(t=>t===e.getId()))?this.__toggleSeriesVisibility(e,!1):this.__toggleSeriesVisibility(e,!0)})}))}__saveSettings(){return __awaiter(this,void 0,void 0,(function*(){null!=this.__settings&&(yield t.Server.UserData.saveTrendSettings(this.__id,this.__settings))}))}static __onlineTrendIntervalHandler(e){var t;if(!n.__onlineTrends)return;let a,i=new Date;for(let[s,r]of n.__onlineTrends){let n=null===(t=s.getContextMenu().getRowEntry("pause-entry"))||void 0===t?void 0:t.controlContainer.getControl("pause-entry-toggle-button");if(!n||!n.getToggleState())for(let[t,n]of r){if(a=s.getSpecificSeries(t.RefObject.Mapping),!a)continue;if(null==t.Value)return;let n={x:i,y:t.Value},r=a.getData();r&&r.length>e&&r.splice(0,1),a.addData(n)}}}static __setBaTrendYAxis(e,s,r){return new Promise((o,l)=>{if(!s.getIsValid())return void l(s.isNotValidText);let d;const _=s.Params.get(i.BaParameterId.ePresentValue);if(null==_)throw new Error("BaObject does not cotain a PresentValue!");switch(s.DataType){case t.DataType.number:let h=s.tryGetBaVariable(i.BaParameterId.eUnit);h||(h=s.tryGetBaVariable(i.BaParameterId.eOutputUnit)),h&&e.baObjectHandler.watchBaVariable(h,i=>{var s,l,_;if(void 0!==h){let o=t.Helper.convertUnitToString(i);if(null==e.getYAxes()[0].getLinkedSeries())d=e.getYAxes()[0];else for(let t of e.getYAxes().values())if(t.getUnit()===o){d=t;break}switch(d||(d=e.addYAxis()),d.setDataType(r.getDataType().y),d.setUnit(o),o){case"%":d.setOptions({autoScale:1==(null===(s=d.getOptions())||void 0===s?void 0:s.autoScale),min:0,max:100});break;default:d.setOptions({autoScale:0!=(null===(l=d.getOptions())||void 0===l?void 0:l.autoScale)})}r.setYAxis(d),r.setXAxis(e.getXAxes()[0]),null===(_=r.getXAxis())||void 0===_||_.resetToDefault(),e.busyHandler.getIsBusy()||n.__verifyBooleanAxis(e),e.eventHandler.raise(a.Chart.ChartEvents.onOptionsChanged)}o()},!0);break;case t.DataType.boolean:d=n.__setBinaryTrendAxes(e,r).yAxis,e.baObjectHandler.watchValueRange(_,e=>{null==d||d.setInactiveText(null==e?void 0:e.get(0)),null==d||d.setActiveText(null==e?void 0:e.get(1))},!0),o();break;case t.DataType.enum:e.baObjectHandler.watchValueRange(_,a=>{var i,s,l,_;if(void 0!==a){let h=t.Components.Combobox.toComboboxItemArray(a);if(null==e.getYAxes()[0].getLinkedSeries())d=e.getYAxes()[0];else for(let a of e.getYAxes().values())if(a.getDataType()===t.DataType.enum){d=a;break}if(d||(d=e.addYAxis()),d.setDataType(r.getDataType().y),d.echartsOption.axisLabel||(d.echartsOption.axisLabel={}),d.echartsOption.axisLabel.show=!1,d.echartsOption.splitLine||(d.echartsOption.splitLine={}),d.echartsOption.splitLine.show=!1,d.setStateTexts(h),null!=!d.echartsOption.min&&d.setOptions({autoScale:0!=(null===(i=d.getOptions())||void 0===i?void 0:i.autoScale),min:0}),h){let e=null===(s=d.getOptions())||void 0===s?void 0:s.min,t=null;h.forEach(e=>{null==t?t=e.value:null!=e.value&&(t=Math.min(t,e.value))}),null!=t&&null!=e&&(t-=1,t!==e&&d.setOptions({min:t}))}if(null!=!d.echartsOption.max&&d.setOptions({autoScale:1==(null===(l=d.getOptions())||void 0===l?void 0:l.autoScale),max:0}),h){let e=null===(_=d.getOptions())||void 0===_?void 0:_.max,t=null;h.forEach(e=>{null==t?t=e.value:null!=e.value&&(t=Math.max(t,e.value))}),null!=t&&null!=e&&(t+=1,t!==e&&d.setOptions({max:t}))}r.setYAxis(d),e.busyHandler.getIsBusy()||n.__verifyBooleanAxis(e),o()}});break;default:e.logger.log(t.Logger.Severity.warn,`DataType ${t.DataType[s.DataType]} is not trendable!`,s),l()}})}static __verifyBooleanAxis(e){if(e.getSeries().length>0){let a;e.enableAutoDraw(!1);for(let i=0;i<e.getSeries().length;i++)a=e.getSeries()[i],a.getDataType().y===t.DataType.boolean&&0===a.getXAxisIndex()&&n.__setBinaryTrendAxes(e,a);e.enableAutoDraw()}}static __setBinaryTrendAxes(e,t){var a;let i,n,s;0!=t.getYAxisIndex()&&(i=e.getYAxes()[t.getYAxisIndex()]);let r,o=e.addYAxis();t.setYAxis(o),i&&(n=i.getActiveText(),s=i.getInactiveText(),e.removeYAxis(i)),o.setDataType(t.getDataType().y),n&&o.setActiveText(n),s&&o.setInactiveText(s),t.echartsOption.areaStyle||(t.echartsOption.areaStyle={}),t.echartsOption.showSymbol=!0,r=e.getSeries().length>1?e.addXAxis():e.getXAxes()[0];let l=null==r?void 0:r.getAxisIndex();return r&&(r.echartsOption.axisTick||(r.echartsOption.axisTick={}),r.echartsOption.axisTick.show=!1,r.echartsOption.axisLine||(r.echartsOption.axisLine={}),r.echartsOption.axisLine.show=!0,r.echartsOption.splitLine||(r.echartsOption.splitLine={}),r.echartsOption.splitLine.show=!1,e.getXAxes().length>1&&(r.echartsOption.axisLabel||(r.echartsOption.axisLabel={}),r.echartsOption.axisLabel.show=!1,r.echartsOption.axisPointer.label.show=!1),r.echartsOption.gridIndex=l,t.setXAxis(r)),o&&(o.setOptions({autoScale:1==(null===(a=o.getOptions())||void 0===a?void 0:a.autoScale),min:0,max:1}),o.echartsOption.splitLine={show:!1},o.echartsOption.gridIndex=l),{xAxis:r,yAxis:o}}static __addBaOnlineTrendDataSeries(e,a){let s={name:a.InstancePath,dataType:{y:a.DataType},color:t.Color.getPastelColor(e.getSeries().length)},r=e.addSeriesLine(a.Mapping,s);return n.__setBaTrendYAxis(e,a,r).then(()=>{let t=a.tryGetBaVariable(i.BaParameterId.ePresentValue);if(t){n.__onlineTrends||(n.__onlineTrends=new Map);let a=n.__onlineTrends.get(e);a||(a=new Map,n.__onlineTrends.set(e,a)),a.set(t,t.watch(e=>{}))}}),r}__updateBaTrend(e,t=!1){if(this.__series.find(t=>t.getId()===this.__id+"."+e.Mapping))if(t){this.__baTrendWatchIds||(this.__baTrendWatchIds=new Map);let t=e.tryWatchBaVariable(i.BaParameterId.eLogBuffer,t=>{t&&this.__processLogEntries(t,e)});null!=t&&this.__baTrendWatchIds.set(e.IdentifierEx,t)}else if(e.tryReadBaVariable(i.BaParameterId.eLogBuffer).then(t=>{t&&this.__processLogEntries(t,e)}),this.__baTrendWatchIds){let t=this.__baTrendWatchIds.get(e.IdentifierEx);t&&e.stopWatchBaVariable(t)}}__processLogEntries(e,a){let n=this.__series.find(e=>e.getId()===this.__id+"."+a.Mapping);if(n&&void 0!==e){let s,r,o=[],l=null;for(let a=0;a<e.length;a++){r={x:0,y:0},s=e[a];let i=null!=n.getDataType().y?n.getDataType().y:void 0;if(null==s.Value)if(null!=l)s.Value=l;else switch(i){case t.DataType.number:case t.DataType.enum:s.Value=0;break;case t.DataType.boolean:s.Value=!1}if(l=s.Value,r.y=s.Value,r.x=s.TimeStamp,o.push(r),s.Events)for(let e in s.Events)if(s.Events[e]){switch(r={x:0,y:0},r.y=s.Value,r.x=s.TimeStamp,r.options={},r.options.symbolSize=10,r.options.symbolOffset?r.options.symbolOffset=[0,r.options.symbolOffset[1]-15]:r.options.symbolOffset=[0,-10],e){case"Start":r.options.symbol="triangle",r.options.symbolRotate=-90,r.options.symbolColor=new t.Color.RGBAColor({r:0,g:255,b:0,a:1});break;case"Stop":r.options.symbol="rect",r.options.symbolRotate=0,r.options.symbolColor=new t.Color.RGBAColor({r:255,g:0,b:0,a:1});break;case"BufferPurged":r.options.symbol="pin",r.options.symbolRotate=0,r.options.symbolColor=new t.Color.RGBAColor({r:100,g:100,b:100,a:1});break;case"Interrupted":r.options.symbol="arrow",r.options.symbolRotate=0,r.options.symbolColor=new t.Color.RGBAColor({r:100,g:100,b:100,a:1})}o.push(r)}if(s.StatusFlags)for(let e in s.StatusFlags)if(s.StatusFlags[e]){switch(r={x:0,y:0},r.y=s.Value,r.x=s.TimeStamp,r.options={},r.options.symbolSize=10,r.options.symbolOffset?r.options.symbolOffset=[0,r.options.symbolOffset[1]-15]:r.options.symbolOffset=[0,-10],e){case"Fault":r.options.symbol="image://"+t.Icons.Events.Flag.Fault.path;break;case"InAlarm":r.options.symbol="image://"+t.Icons.Events.Flag.InAlarm.path;break;case"Overridden":r.options.symbol="image://"+t.Icons.Events.Flag.Overridden.path;break;case"OutOfService":r.options.symbol="image://"+t.Icons.Events.Flag.OutOfService.path}o.push(r)}}a.tryReadBaVariable(i.BaParameterId.eDescription).then(e=>{null==n||n.setName(e)}),n.setData(o),this.__xAxes.forEach(e=>{var t;let a=this.getMinData().x;a instanceof Date&&(a=a.toISOString());let i=this.getMaxData().x;i instanceof Date&&(i=i.toISOString()),e.setOptions({autoScale:1==(null===(t=e.getOptions())||void 0===t?void 0:t.autoScale),min:null==a?void 0:a,max:null==i?void 0:i})}),n.getId()===this.__series[this.__series.length-1].getId()&&this.enableAutoDraw()}}__toggleSeriesVisibility(e,a){var i,n;let s=null===(i=t.Helper.Map.findByKey(this.__seriesSelectors.getEntries(),t=>t===e.getId()))||void 0===i?void 0:i.value;s instanceof t.Navigation.ControlList.ControlListEntry&&(null===(n=s.controlContainer.getControl("visibility-checkbox"))||void 0===n||n.setState(a)),a?(e.show(),e.getDataType().y===t.DataType.boolean?(this.__xAxes[e.getXAxisIndex()].show(),this.__yAxes[e.getYAxisIndex()].show()):this.__yAxes[e.getYAxisIndex()].show()):(e.hide(),e.getDataType().y===t.DataType.boolean?(this.__xAxes[e.getXAxisIndex()].hide(),this.__yAxes[e.getYAxisIndex()].hide()):function(e){let t=e.getLinkedSeries();if(t){let a,i=!0;for(let e=0;e<t.length;e++)if(a=t[e],!a.getIsHided()){i=!1;break}i?e.hide():e.show()}}(this.__yAxes[e.getYAxisIndex()])),this.updateGrid()}__selectDisplayedObject(e){var t,a;null==e&&(e=n.DisplayedObjects.trendableObjects),this.__settings||(this.__settings={}),this.__settings.displayedObjects=e,this.__saveSettings(),null===(a=null===(t=this.__contextMenu.getRowEntry("select-displayed-object"))||void 0===t?void 0:t.controlContainer.getControl("select-displayed-object-combobox"))||void 0===a||a.setSelectedValue(this.__settings.displayedObjects),this.__selectDisplayedDescription(this.__settings.displayedDescription)}__selectDisplayedDescription(e){var t,a;null==e&&(e=i.BaParameterId.eInstDescription),this.__settings||(this.__settings={}),this.__settings.displayedDescription=e,this.__saveSettings(),null===(a=null===(t=this.__contextMenu.getRowEntry("select-displayed-description"))||void 0===t?void 0:t.controlContainer.getControl("select-displayed-description-combobox"))||void 0===a||a.setSelectedValue(this.__settings.displayedDescription);for(let t=0;t<this.__series.length;t++){let a=this.__seriesSelectors.getEntries().get(this.__series[t].getId());if(!a)continue;let s=this.__series[t].getBaObject();s&&s.tryReadBaVariable(i.BaParameterId.eReferencedParam).then(s=>{var r;if(!s)throw new Error(`No data returned for '${i.BaParameterId[i.BaParameterId.eReferencedParam]}'!`);let o;switch(null===(r=this.__settings)||void 0===r?void 0:r.displayedObjects){case n.DisplayedObjects.trendObjects:o=s.OwnerObject;break;default:o=null==s?void 0:s.ReferenceObject}this.__baDescriptionWatchIds||(this.__baDescriptionWatchIds=new Map);let l=this.__baDescriptionWatchIds.get(this.__series[t].getId()),d=!0;if(l&&null!=l.id)if(l.object!==o)l.object.stopWatchBaVariable(l.id);else{let t=o.tryGetBaVariable(e);l.id.InstanceName===(null==t?void 0:t.InstanceName)&&(d=!1)}if(d){null==o.tryGetBaVariable(e)&&(e=i.BaParameterId.eInstDescription,this.__settings||(this.__settings={}),this.__settings.displayedDescription=e,this.__saveSettings());let n=a.busyHandler.setBusy("Loading description");this.__baDescriptionWatchIds.set(this.__series[t].getId(),{object:o,id:o.tryWatchBaVariable(e,e=>{e&&a.textHandler.setText(e),n()})})}})}}processBaObject(){if(this.baObjectHandler.baObject)if(this.baObjectHandler.baObject instanceof i.BaView){this.baObjectHandler.baObject.getBaTrendObjects().forEach(e=>{e.loadAttributes().then(()=>{e.getIsValid()&&this.addBaTrend(e)})})}else this.baObjectHandler.baObject instanceof i.BaBasicObject&&this.baObjectHandler.baObject.Identifier.ObjectType===i.ObjectType.eTrend&&(this.baObjectHandler.baObject.loadAttributes().then(()=>{var e;(null===(e=this.baObjectHandler.baObject)||void 0===e?void 0:e.getIsValid())&&(this.addBaTrend(this.baObjectHandler.baObject),this.__contextMenu.layoutHandler.setWidth(140))}),this.eventHandler.raise(a.Chart.ChartEvents.onOptionsChanged),this.__contextMenu.addRowEntry([{text:"Parameter",onPressed:()=>{var e;null===(e=this.baObjectHandler.baObject)||void 0===e||e.openParameterDialog("Parameter"),this.__contextMenu.close()}}]),this.__contextMenu.layoutHandler.setWidth(140))}addBaTrend(e){var a;null==this.__contextMenu.getRowEntry("update-entry")&&(this.__contextMenu.addRowEntry([{text:"Update",name:"update-entry",onPressed:this.__updateButtonPressedHandler},{name:"auto-update",controls:{type:t.Components.ComponentType.Checkbox,name:"auto-update-checkbox",callback:this.__autoUpdateCbChangedHandler,settings:{textAttributes:{horizontalAlignment:"Center"},state:null===(a=this.__settings)||void 0===a?void 0:a.autoUpdate,activeText:"Auto update",inactiveText:"Auto update",readOnly:!1}}}]),this.__contextMenu.layoutHandler.setWidth(110)),e.tryReadBaVariable(i.BaParameterId.eReferencedParam).then(a=>{var i;if(null!=a){let s=this.addSeriesLine(this.__id+"."+e.Mapping,{color:t.Color.getPastelColor(this.__series.length),baObject:e});s&&a.ReferenceObject.getIsValid()&&(t.Globals.PrimitveBaObjects.indexOf(a.ReferenceObject.Identifier.ObjectType)>-1?(void 0===s.getDataType().y&&s.setDataType({y:a.ReferenceObject.DataType}),n.__setBaTrendYAxis(this,a.ReferenceObject,s).then(()=>{this.__loadSettings()})):this.logger.log(t.Logger.Severity.warn,"Referred object is not valid. Please load attributes first!")),this.__updateBaTrend(e,null===(i=this.__settings)||void 0===i?void 0:i.autoUpdate)}else this.logger.log(t.Logger.Severity.info,`Trend object '${e.InstancePath}' has no reference object and will be ignored!`)})}removeBaTrend(e){this.removeSeriesLine(this.__id+"."+e.Mapping)}containsBaTrend(e){let t=this.__id+"."+e.Mapping;return null!=this.__series.find(e=>e.getId()===t)}updateGrid(){if(super.updateGrid(),this.__xAxes.length<2)return;let e=this.__echart.getOption().grid,t=this.__showDataZoom?this.__spaceDataZoomSliderX.bottom:20;if(e instanceof Array){for(let a=this.__xAxes.length-1;a>0;a--){e[a]||(e[a]={});let i=this.__xAxes.find(e=>e.echartsOption.gridIndex===a);i&&!i.echartsOption.show?e[a].height=0:(e[a].bottom=t,e[a].left=e[0].left,e[a].right=e[0].right,e[a].height=this.__binaryGridHeight,t+=this.__binaryGridHeight+10)}t=t-this.__binaryGridHeight+30,this.__showDataZoom?e[0].bottom=Number(e[0].bottom)+t-this.__spaceDataZoomSliderX.bottom:e[0].bottom=Number(e[0].bottom)+t;for(let t=0;t<e.length;t++)this.__setGrid(e[t],t)}}static createBaOnlineTrend(e,s,r){if(t.Globals.PrimitveBaObjects.indexOf(e.Identifier.ObjectType)>-1||e instanceof i.BaView&&e.getTrendableObjects().length>0){let o=t.Globals.CreatedBaseNodes.get(e.Mapping+"-online-trend");if(o)return o;s||(s=2e3),r||(r=100),o=new n(e.Mapping+"-online-trend",null),o.setShowDataZoom(!1);let l=[],d=[];if(e instanceof i.BaView){if(d=e.getTrendableObjects(),d.length<=0)return o.logger.log(t.Logger.Severity.warn,"No trends were found in BaView "+e.InstancePath),o}else d.push(e);l=[];for(let e=0;e<d.length;e++){let t=d[e];t.loadAttributes().then(()=>{t.getIsValid()&&l.push(n.__addBaOnlineTrendDataSeries(o,t))})}const _=[],h=new t.Logger({name:"CreateBaOnlineTrend"});return o.getContextMenu().addRowEntry([{onPressed:()=>__awaiter(this,void 0,void 0,(function*(){const e=t.Locale.Localization.getText(t.Locale.LangKey.ConfirmResetLiveTrend);(yield t.Components.DialogWindow.confirm(e))&&l&&l.forEach(e=>e.setData(null)),o.__contextMenu.close()})),cbOnCreated:e=>{_.push(t.Locale.Localization.watchText(t.Locale.LangKey.Reset,a=>{h.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}},{name:"pause-entry",controls:{type:t.Components.ComponentType.ToggleButton,name:"pause-entry-toggle-button",cbOnCreated:e=>{_.push(t.Locale.Localization.watchText(t.Locale.LangKey.Pause,a=>{h.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)}))}}}]),o.getContextMenu().layoutHandler.setWidth(100),null==o||o.enableAutoDraw(),o.eventHandler.raise(a.Chart.ChartEvents.onOptionsChanged),null==n.__onlineTrendIntervalId&&(n.__onlineTrendIntervalId=setInterval(()=>{n.__onlineTrendIntervalHandler(r)},s)),o.eventHandler.register(t.Components.BaseNode.BaseNodeEvents.onDestroyed,(e,t)=>{var a,i;e.destroy();let s=null===(a=n.__onlineTrends)||void 0===a?void 0:a.get(t);if(s)for(let[e,t]of s)e.stopWatch(t);null===(i=n.__onlineTrends)||void 0===i||i.delete(t),(!n.__onlineTrends||n.__onlineTrends.size<=0)&&n.__onlineTrendIntervalId&&(clearInterval(n.__onlineTrendIntervalId),delete n.__onlineTrends,delete n.__onlineTrendIntervalId),_.forEach(e=>e())}),o}return null}}a.Trend=n,function(n){let s;e.EventProvider.register(t.Server.Events.onBaSiteExtensionLoaded,e=>{e.destroy(),r.init(),o.init()}),function(e){e[e.trendableObjects=0]="trendableObjects",e[e.trendObjects=1]="trendObjects"}(s=n.DisplayedObjects||(n.DisplayedObjects={}));class r{static init(){t.Server.UserData.loadTrendCollections().then(e=>this.collectionStorage=e)}static __getListConvertOptions(){return{editEntry:(e,a)=>{if("trendable-objects"===this.__displayedObjects&&!e.isTrendable())return;if("trend-objects"===this.__displayedObjects&&!e.isTrendObject())return;let n=!1;this.__currentOpt&&this.__currentOpt.collectionName&&this.collectionStorage&&null!=this.collectionStorage[this.__currentOpt.collectionName]&&null!=this.collectionStorage[this.__currentOpt.collectionName].baObjects.find(t=>t.instancePath===e.InstancePath&&t.deviceName===e.Device.Description)&&(n=!0,this.__selectedTrends.push({deviceName:e.Device.Description,instancePath:e.InstancePath})),a.controls=[{type:t.Components.ComponentType.Checkbox,name:"select-cb",settings:{readOnly:!1,state:n,layout:{maxWidth:25}},callback:(a,n,s)=>__awaiter(this,void 0,void 0,(function*(){if(!this.__selectedTrends)throw new Error("Selected trends array should be available here!");e instanceof i.BaObject&&(a&&this.__selectedTrends.length>=this.__currentOpt.maxSelection&&(yield t.Components.DialogWindow.alert(`It is not possible to add more objects / trends to trend collection!\nMaxmium amount of trends in a collection is ${this.__currentOpt.maxSelection}!`),null==s||s.setState(!a)),e.isTrendObject()?e.tryReadBaVariable(i.BaParameterId.eReferencedParam).then(i=>__awaiter(this,void 0,void 0,(function*(){if(!this.__selectedTrends)throw new Error("Selected trends array should be available here!");null!=i?a?this.__selectedTrends.push({deviceName:i.ReferenceObject.Device.Description,instancePath:i.ReferenceObject.InstancePath}):null!=this.__selectedTrends.find(e=>e.instancePath===i.ReferenceObject.InstancePath&&e.deviceName===i.ReferenceObject.Device.Description)&&(this.__selectedTrends=this.__selectedTrends.filter(e=>e.instancePath!==i.ReferenceObject.InstancePath||e.deviceName!==i.ReferenceObject.Device.Description)):(yield t.Components.DialogWindow.alert(`Trend object '${e.InstancePath}' has no reference object! Assign an trendable object first!`),null==s||s.setState(!a))}))):e.isTrendable()&&e.getReferringObjects().then(i=>__awaiter(this,void 0,void 0,(function*(){if(!this.__selectedTrends)throw new Error("Selected trends array should be available here!");if(a){if(null==this.__selectedTrends.find(t=>t.instancePath===e.InstancePath&&t.deviceName===e.Device.Description)){if(i.length<=0){if(!(yield t.Components.DialogWindow.confirm(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmAssignToTrend))))return void(null==s||s.setState(!a));{let a=s.busyHandler.setBusy("Assiging to unused trend");t.Server.assignBaObjectToUnusedTrend(e).then(()=>{a()}).catch(i=>{t.Logger.log(t.Logger.Severity.warn,`Assign BaObject '${e.InstancePath}' to unused trend failed`,i),a()})}}this.__selectedTrends.push({deviceName:e.Device.Description,instancePath:e.InstancePath})}}else null!=this.__selectedTrends.find(t=>t.instancePath===e.InstancePath&&t.deviceName===e.Device.Description)&&(this.__selectedTrends=this.__selectedTrends.filter(t=>t.instancePath!==e.InstancePath||t.deviceName!==e.Device.Description))}))))}))},{type:t.Components.ComponentType.Button,settings:{background:{image:t.Icons.Standard.MenuBurger.path,imageHeight:60,imageHeightUnit:"%",imageWidth:60,imageWidthUnit:"%"},layout:{maxWidth:25}},callback:()=>{e.openParameterDialog()}}]},filter:e=>"trendable-objects"===this.__displayedObjects?e.isTrendable():e.isTrendObject()}}static __setListData(){var e;this.__selectedTrends=[];try{if(this.__currentOpt&&this.__currentOpt.baView&&this.__configuratorDialog){this.__currentRoot={deviceName:this.__currentOpt.baView.Device.Description,instancePath:this.__currentOpt.baView.InstancePath};let e=this.__configuratorDialog.busyHandler.setBusy("Loading BaView");this.__currentOpt.baView.loadAttributes(!0,!0).then(()=>{var t;null===(t=this.__list)||void 0===t||t.setData(this.__currentOpt.baView.toControlListData(this.__getListConvertOptions())),e()}).catch(a=>__awaiter(this,void 0,void 0,(function*(){var i;yield t.Components.DialogWindow.alert(t.Logger.log(t.Logger.Severity.warn,"Loading BaView for TrendCollectionConfigurator failed!",a)),e(),null===(i=this.__configuratorDialog)||void 0===i||i.close()})))}else{if(!this.__currentOpt||!this.__currentOpt.collectionName||null==this.collectionStorage)throw"Not_specified";try{let t=this.collectionStorage[this.__currentOpt.collectionName];if(!(t.root&&i.BaDevices&&i.BaDevices.size>0))throw"Not_specified";{let a=null===(e=i.BaDevices.get(t.root.deviceName))||void 0===e?void 0:e.findBaObject(t.root.instancePath);if(!(a&&a instanceof i.BaView))throw"Not_specified";this.__currentOpt.baView=a,this.__setListData()}}catch(e){throw"Not_specified"}}}catch(e){if("Not_specified"===e&&i.BaDevices&&i.BaDevices.size>0){let e={Children:new Map},t=0,a=this.__configuratorDialog.busyHandler.setBusy("Loading ProjectStructure");for(let[n,s]of i.BaDevices)t++,s.ProjectStructure.loadAttributes(!0,!0).then(()=>{var i;t--,e.Children.set(n,s.ProjectStructure.toControlListData(this.__getListConvertOptions())),0===t&&(null===(i=this.__list)||void 0===i||i.setData(e),a())})}}}static __saveCollection(){return __awaiter(this,void 0,void 0,(function*(){return new Promise((e,a)=>__awaiter(this,void 0,void 0,(function*(){var a;if(null!=(null===(a=this.__currentOpt)||void 0===a?void 0:a.collectionName)&&(this.__currentCollectionName=this.__currentOpt.collectionName),!this.__currentCollectionName)return yield t.Components.DialogWindow.alert(t.Locale.Localization.getText(t.Locale.LangKey.AlertNoCollectionName)),e(!1);if(!this.__selectedTrends)throw new Error("Selected trends array should be available here!");let n=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmSaveTrendCollection),this.__currentCollectionName);if(null!=this.__currentCollectionName&&null!=this.__selectedTrends){if(yield t.Components.DialogWindow.confirm(n)){let e=this.collectionStorage[this.__currentCollectionName];e||(e={baObjects:[]}),e.baObjects=this.__selectedTrends,this.__currentRoot&&(e.root=this.__currentRoot),yield t.Server.UserData.saveTrendCollection(this.__currentCollectionName,e),this.init(),this.__selectedTrends.forEach(e=>{var t,a;let n=null===(a=null===(t=i.BaDevices)||void 0===t?void 0:t.get(e.deviceName))||void 0===a?void 0:a.findBaObject(e.instancePath);n instanceof i.BaObject&&(n.isTrendObject()?n.loadAttributes():n.getReferringObjects().then(e=>{let t=e[0].OwnerObject;t.isTrendObject()&&t.loadAttributes()}))})}return e(!0)}})))}))}static open(e){var a;return null===(a=this.__list)||void 0===a||a.setData(null),delete this.__currentCollectionName,delete this.__currentRoot,delete this.__currentOpt,delete this.__selectedTrends,this.__currentOpt=e,this.__currentOpt||(this.__currentOpt={}),null==(null==e?void 0:e.maxSelection)&&(this.__currentOpt.maxSelection=this.MAX_SELECTION),new Promise((a,i)=>{var n,s,r,o;if(!this.__grid){if(this.__grid=$("<div>").addClass("tchmi-ba-trend-configurator-grid"),this.__nameContainer=new t.Components.ControlContainer("tchmi-ba-trend-configurator-name-container"),this.__nameContainer.setControlsHorizonzalAlignment("Left"),this.__nameContainer.addControls([{type:t.Components.ComponentType.Textblock,settings:{textAttributes:{horizontalAlignment:"Right",fontSize:14,fontWeight:"Bold",decorationLine:"underline"}},cbOnCreated:e=>{e.getElement().css("max-width","fit-content"),t.Locale.Localization.watchText(t.Locale.LangKey.TrendCollectionName,a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text+":")})}},{type:t.Components.ComponentType.InputBox,name:"name-input",settings:{dataType:t.DataType.string,readOnly:null!=(null===(n=this.__currentOpt)||void 0===n?void 0:n.collectionName),textAttributes:{horizontalAlignment:"Left"},layout:{maxWidth:250}},callback:e=>__awaiter(this,void 0,void 0,(function*(){if(e.indexOf("-tab")>-1||e.indexOf("-list")>-1)yield t.Components.DialogWindow.alert(`Invalid collection name '${e}'!`);else if(null==this.collectionStorage||null==this.collectionStorage[e])this.__currentCollectionName=e;else{let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.AlertDuplicateCollectionName),e);yield t.Components.DialogWindow.alert(a)}}))}]),!this.__grid)throw new Error("Configurator grid should be available here!");this.__grid.append(this.__nameContainer.getElement()),this.__list=new t.Navigation.ControlList("tchmi-ba-trend-configurator-list",null,{cssClass:"tchmi-ba-trend-configurator-list"}),this.__grid.append(this.__list.getElement())}if(!this.__configuratorDialog){let e=t.Components.ContextMenu.createContextMenuAndButton({id:"tchmi-ba-trend-configurator-context-menu",rowEntryOptions:[{controls:{type:t.Components.ComponentType.Combobox,settings:{readOnly:!1,data:[{text:"Trendable objects",value:"trendable-objects"},{text:"Trend objects",value:"trend-objects"}]},callback:t=>{this.__displayedObjects=t,this.__setListData(),e.menu.close()}}}]});e.menu.layoutHandler.setMinWidth(130),this.__configuratorDialog=new t.Components.DialogWindow("tchmi-ba-trend-configurator-dialog",null,{content:this.__grid,modal:!1,buttons:t.Components.DialogWindow.Buttons.OkCancel,layout:{width:1e3},controls:e.button}),t.Locale.Localization.watchText(t.Locale.LangKey.NewTrendCollection,e=>{var a;t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&(null===(a=this.__configuratorDialog)||void 0===a||a.setHeadlineText(e.text))})}let l=this.__configuratorDialog.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onConfirmed,()=>__awaiter(this,void 0,void 0,(function*(){var e,t;null===(e=this.__configuratorDialog)||void 0===e||e.stopClosing(),(yield this.__saveCollection())&&(a(),null===(t=this.__configuratorDialog)||void 0===t||t.close())})));this.__configuratorDialog.eventHandler.register(t.Components.DialogWindow.DialogWindowEvents.onClosed,e=>__awaiter(this,void 0,void 0,(function*(){e.destroy(),l()})));let d=null===(s=this.__nameContainer)||void 0===s?void 0:s.getControl("name-input");d&&d.setValue(null!=(null===(r=this.__currentOpt)||void 0===r?void 0:r.collectionName)?this.__currentOpt.collectionName:"Collection name...").setReadOnly(null!=(null===(o=this.__currentOpt)||void 0===o?void 0:o.collectionName)),(null==e?void 0:e.modal)?this.__configuratorDialog.setButtons(t.Components.DialogWindow.Buttons.OkCancel):this.__configuratorDialog.setButtons(t.Components.DialogWindow.Buttons.OkCancelSize),this.__configuratorDialog.open(null==e?void 0:e.modal),this.__setListData()})}static selectCollection(){return new Promise((e,a)=>__awaiter(this,void 0,void 0,(function*(){var i;if(null!=this.__selectionDialog)return this.__selectionDialog.open(),e(null);if(null==this.collectionStorage||Object.keys(this.collectionStorage).length<=0){let e=t.Locale.Localization.getText(t.Locale.LangKey.AlertNoCollectionsCreated);return yield t.Components.DialogWindow.alert(e),a(e)}let n=new t.Navigation.ControlList("tchmi-ba-trend-collection-select-list",null,{layout:{width:100,widthUnit:"%",height:100,heightUnit:"%"}}),s={Children:new Map};for(let a in this.collectionStorage)s.Children.set(a,{Title:a,controls:{type:t.Components.ComponentType.Button,settings:{background:{image:t.Icons.Standard.Right_Arrow.path,imageHeight:80,imageHeightUnit:"%",imageWidth:80,imageWidthUnit:"%"}},callback:()=>{var t;null===(t=this.__selectionDialog)||void 0===t||t.close(),e(a)}}});n.setData(s),this.__selectionDialog=null===(i=t.Components.DialogWindow.createDialogWindow({appearance:{content:n.getElement(),buttons:t.Components.DialogWindow.Buttons.Cancel,headline:{textAttributes:{text:"Select trend collection"}},layout:{maxWidth:400}},callbacks:{cbClosed:()=>{var e;n.destroy(),null===(e=this.__selectionDialog)||void 0===e||e.destroy(),delete this.__selectionDialog}},behaviour:{destroyOnClose:!0}}))||void 0===i?void 0:i.open()})))}static getCollections(){return null!=this.collectionStorage&&Object.keys(this.collectionStorage).length>0?this.collectionStorage:null}static getCollection(e){return null!=this.collectionStorage&&null!=this.collectionStorage[e]?this.collectionStorage[e]:null}static removeObjectFromCollection(e,a){let i=this.getCollection(e);if(i){let n=i.baObjects.length;if(i.baObjects=i.baObjects.filter(e=>e.instancePath!==a.instancePath||e.deviceName!==a.deviceName),n!=i.baObjects.length)return t.Server.UserData.saveTrendCollection(e,i),this.init(),i.baObjects.length<=0&&confirm(`Collection ${e} does not contain any BaObjects. Do you want to delete the collection?`)&&this.deleteCollection(e),!0}return!1}static deleteCollection(e){return new Promise((a,i)=>__awaiter(this,void 0,void 0,(function*(){if(null==this.collectionStorage||null==this.collectionStorage[e])return void a(!1);let i=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmDeleteTrendCollection),e);(yield t.Components.DialogWindow.confirm(i))?(yield t.Server.UserData.deleteTrendCollection(e),this.init(),a(!0)):a(!1)})))}}r.__displayedObjects="trendable-objects",r.MAX_SELECTION=10,n.CollectionConfigurator=r;class o{static init(){t.Server.UserData.loadTrendCollectionSelection().then(e=>this.__collectionSelection=e)}static __getSelectedCollectionName(){var e;if(!this.__tabWindow)throw new Error("TabWindow should be available here");let t=null===(e=this.__tabWindow.getSelectedTab())||void 0===e?void 0:e.getId();if(!t)throw new Error("A tab should be selected here");return t.replace("-tab","")}static addOrUpdateCollection(e){var n,s;return __awaiter(this,void 0,void 0,(function*(){let o=t.Globals.CreatedBaseNodes.get(e+"-trend");if(o||(o=new a.Trend(e+"-trend",null),o.layoutHandler.setAttributes({width:100,widthUnit:"%",height:100,heightUnit:"%"}),yield t.Server.UserData.saveTrendCollectionSelection(e),this.init()),!this.__tabWindow)throw new Error("Collection tab window should be available here.");null==this.__tabWindow.getTab(e+"-tab")&&(this.__tabWindow.addTab(e+"-tab",{content:o.getElement(),textAttributes:{text:e}}),this.__tabWindow.selectTab(e+"-tab")),o.getSeries().length!=(null===(n=r.getCollection(e))||void 0===n?void 0:n.baObjects.length)&&o.removeAllSeriesLine(),null===(s=r.getCollection(e))||void 0===s||s.baObjects.forEach(a=>{var n;let s=null===(n=i.BaDevices)||void 0===n?void 0:n.get(a.deviceName);if(s){let n=s.findBaObject(a.instancePath);n?n instanceof i.BaObject&&(n.isTrendObject()?n.loadAttributes().then(()=>{n.getIsValid()&&!o.containsBaTrend(n)&&o.addBaTrend(n)}):n.getReferringObjects().then(i=>__awaiter(this,void 0,void 0,(function*(){let s=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmBaObjectNotTrendedRemoveFromCollection),a.instancePath,a.deviceName,e);if(i.length<=0)return void((yield t.Components.DialogWindow.confirm(s))&&(r.removeObjectFromCollection(e,a),this.addOrUpdateCollection(e)));let l=i[0].OwnerObject;l.isTrendObject()&&(null==n||n.loadAttributes().then(()=>{l.getIsValid()&&!o.containsBaTrend(l)&&o.addBaTrend(l)}))})))):t.Components.DialogWindow.confirm(`BaObject "${a.instancePath}" was not found in trend collection "${e}"!\nDo you want to remove it from the collection?`).then(t=>{t&&r.removeObjectFromCollection(e,a)})}else t.Components.DialogWindow.confirm(`Device ${a.deviceName} for trend collection '${e}' was not found!\nDo you want to remove the "${a.instancePath}" from the collection "${e}"?`).then(t=>{t&&r.removeObjectFromCollection(e,a)})})}))}static open(e){if(this.__tabWindow||(this.__tabWindow=new t.Components.TabWindow("tchmi-ba-trend-collection-tab-window",null,{layout:{width:100,widthUnit:"%",height:100,heightUnit:"%"}})),!this.__dialog){let e=t.Components.ContextMenu.createContextMenuAndButton({id:"tchmi-ba-trend-collection-dialog-window",rowEntryOptions:[{onPressed:()=>{r.selectCollection().then(e=>{null!=e&&this.addOrUpdateCollection(e)}),e.menu.close()},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.AddCollection,a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})}},{onPressed:()=>__awaiter(this,void 0,void 0,(function*(){var a,i;let n=this.__getSelectedCollectionName(),s=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.ConfirmRemoveCollectionFromView),n);(yield t.Components.DialogWindow.confirm(s))&&(yield t.Server.UserData.deleteTrendCollectionSelection(n),this.init(),null===(a=t.Globals.CreatedBaseNodes.get(n+"-trend"))||void 0===a||a.destroy(),null===(i=this.__tabWindow)||void 0===i||i.removeTab(n+"-tab")),e.menu.close()})),cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.RemoveCollectionFromView,a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})}},{onPressed:()=>{r.open(),e.menu.close()},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.NewTrendCollection,a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})}},{onPressed:()=>{let t=this.__getSelectedCollectionName();r.open({collectionName:t}).then(()=>{this.addOrUpdateCollection(t)}),e.menu.close()},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.EditCollection,a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})}},{onPressed:()=>{r.selectCollection().then(e=>{var a,i,n;null!=e&&(r.deleteCollection(e),null===(a=t.Globals.CreatedBaseNodes.get(e+"-trend"))||void 0===a||a.destroy(),(null===(i=this.__tabWindow)||void 0===i?void 0:i.getTab(e+"-tab"))&&(null===(n=this.__tabWindow)||void 0===n||n.removeTab(e+"-tab")))}),e.menu.close()},cbOnCreated:e=>{t.Locale.Localization.watchText(t.Locale.LangKey.DeleteCollection,a=>{t.Logger.checkServerResult(t.Logger.Severity.warn,a)&&e.textHandler.setText(a.text)})}}]});this.__dialog=new t.Components.DialogWindow("tchmi-ba-trend-collection-dialog-window",null,{buttons:t.Components.DialogWindow.Buttons.CancelSize,content:this.__tabWindow.getElement(),controls:e.button}),t.Locale.Localization.watchText(t.Locale.LangKey.TrendCollections,e=>{var a;t.Logger.checkServerResult(t.Logger.Severity.warn,e)&&(null===(a=this.__dialog)||void 0===a||a.setHeadlineText(e.text))})}if(e){if(null==r.getCollection(e)){let a=tchmi_format_string(t.Locale.Localization.getText(t.Locale.LangKey.AlertCollectionNameNotFound),e);return void t.Components.DialogWindow.alert(a)}this.addOrUpdateCollection(e),this.__dialog.open()}else if(null!=this.__collectionSelection){let e=!1,a=!1;for(let i=0;i<this.__collectionSelection.length;i++)r.getCollection(this.__collectionSelection[i])?(this.addOrUpdateCollection(this.__collectionSelection[i]),e=!0):(t.Server.UserData.deleteTrendCollectionSelection(this.__collectionSelection[i]),a=!0);a&&this.init(),e?this.__dialog.open():r.selectCollection().then(e=>{var t;null!=e&&(this.addOrUpdateCollection(e),null===(t=this.__dialog)||void 0===t||t.open())})}else a.Trend.CollectionConfigurator.selectCollection().then(e=>{null!=e&&a.Trend.CollectionView.open(e)}).catch(()=>{var e;return null===(e=this.__dialog)||void 0===e?void 0:e.close()})}static showsTrendCollections(){return null!=this.__collectionSelection&&this.__collectionSelection.length>0}}o.__collectionSelection=null,n.CollectionView=o}(n=a.Trend||(a.Trend={}))}(a=t.Charting||(t.Charting={})),function(e){e.BaBasicObject.prototype.isTrendable=function(){if(!this.getIsValid())throw Error("BaBasicObject has not been loaded yet. Make sure to call loadAttributes() first.");return t.Globals.PrimitveBaObjects.indexOf(this.Identifier.ObjectType)>-1&&this instanceof e.BaObject},e.BaBasicObject.prototype.isTrendObject=function(){return this.Identifier.ObjectType===e.ObjectType.eTrend},e.BaView.prototype.getTrendableObjects=function(){let a=[];if(this instanceof e.BaView)for(let i of this.Children.values())i instanceof e.BaView&&(a=a.concat(i.getTrendableObjects())),t.Globals.PrimitveBaObjects.indexOf(i.Identifier.ObjectType)>-1&&a.push(i);return a},e.BaView.prototype.getBaTrendObjects=function(){let t=[];if(this instanceof e.BaView)for(let a of this.Children.values())a instanceof e.BaView&&(t=t.concat(a.getBaTrendObjects())),a instanceof e.BaObject&&a.Identifier.ObjectType===e.ObjectType.eTrend&&t.push(a);return t}}(i=t.BA||(t.BA={}))}(e.BuildingAutomation||(e.BuildingAutomation={}))}(TcHmi||(TcHmi={}));